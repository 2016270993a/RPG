<!--
*********LATEST CHANGES/ADDITIONS*********
10/20" - more i18n updates and updated french translation
10/17" - small syntax fixes in html(syntax fixes and a small update to sheet button rolls), i18n updates on sheet and roll template, updated french translation. 
******************************************

******************TODO********************
Add custom ability names
New Roll Template styles
"Permanent bonus" to attack and defense section
Advantage button - auto calculate +2atk and 1d4dmg
Concentration check    
******************************************

<!-- *******  PAGE 3 -->
<div class="sheet-section sheet-section-pc3">   
    <div class="sheet-row">
        <div class="sheet-2colrow">
            <div class="sheet-col" >  <!-- BEGIN Column1 -->
                <label class="sheet-label-large" data-i18n="rituals">Rituals</label>    
                <div class="sheet-ability-section">
                    <div> 
                        <input type="text" name="attr_ritual-name" title="Ritual name" data-i18n-title="title-ritual-name" placeholder="Name" data-i18n-placeholder="name" />
                    </div>
                    <div>
                        <button type="roll" title="Ritual Check" data-18n="title-ritual-check" class="sheet-hidden sheet-roll" value="&{template:powercheck}{{name=^{ritual}: @{ritual-name}}} {{character=@{character-name}}} {{selected=@{ritualattribute}}} {{attribute=[[@{ritualattribute}+?{Enemy Disadvantage|0}]]}} {{roll=[[1d20]]}} " name="roll_RitualCheck"></button>
                        <select name="attr_ritualattribute" style="width:auto;" size="1" title="Attribute for Ritual" data-i18n-title="title-power-attribute" >
                            <option value="[[@{accurate}]]" data-i18n="accurate">Accurate</option>
                            <option value="[[@{cunning}]]" data-i18n="cunning">Cunning</option>
                            <option value="[[@{discreet}]]" data-i18n="discreet">Discreet</option>
                            <option value="[[@{persuasive}]]" data-i18n="persuasive">Persuasive</option>
                            <option value="[[@{quick}]]" data-i18n="quick">Quick</option>
                            <option value="[[@{resolute}]]" data-i18n="resolute" selected>Resolute</option>
                            <option value="[[@{strong}]]" data-i18n="strong">Strong</option>
                            <option value="[[@{vigilant}]]" data-i18n="vigilant">Vigilant</option>					
                        </select>
                        <select name="attr_ritual-corruption" title="Temporary Corruption when power is used" data-i18n-title="title-temporary-corruption-when-ritual-is-used">
                                <option value="0" selected>-</option>
                                <option value="[[1]]" >1</option>
                                <option value="[[1d4]]" >1d4</option>
                                <option value="[[1d6]]" >1d6</option>
                                <option value="[[1d8]]" >1d8</option>
                        </select>
                        <span data-i18n="temporary-corruption-abbrv">Temp Corruption</span>
                    </div>
                    <textarea name="attr_ritualdesc" title="Ritual description" data-i18n-title="title-ritual-description" placeholder="Effect" data-i18n-placeholder="effect"></textarea>
                </div>
                <fieldset class="repeating_ritual">
                <div class="sheet-ability-section">
                    <div> 
                        <input type="text" name="attr_ritual-name" title="Ritual name" data-i18n-title="title-ritual-name" placeholder="Name" data-i18n-placeholder="name" />
                    </div>
                    <div>
                        <button type="roll" title="Ritual Check" data-18n="title-ritual-check" class="sheet-hidden sheet-roll" value="&{template:powercheck}{{name=^{ritual}: @{ritual-name}}} {{character=@{character-name}}} {{selected=@{ritualattribute}}} {{attribute=[[@{ritualattribute}+?{Enemy Disadvantage|0}]]}} {{roll=[[1d20]]}} " name="roll_RitualCheck"></button>
                        <select name="attr_ritualattribute" style="width:auto;" size="1" title="Attribute for Ritual" data-i18n-title="title-power-attribute" >
                            <option value="[[@{accurate}]]" data-i18n="accurate">Accurate</option>
                            <option value="[[@{cunning}]]" data-i18n="cunning">Cunning</option>
                            <option value="[[@{discreet}]]" data-i18n="discreet">Discreet</option>
                            <option value="[[@{persuasive}]]" data-i18n="persuasive">Persuasive</option>
                            <option value="[[@{quick}]]" data-i18n="quick">Quick</option>
                            <option value="[[@{resolute}]]" data-i18n="resolute" selected>Resolute</option>
                            <option value="[[@{strong}]]" data-i18n="strong">Strong</option>
                            <option value="[[@{vigilant}]]" data-i18n="vigilant">Vigilant</option>					
                        </select>
                        <select name="attr_ritual-corruption" title="Temporary Corruption when power is used" data-i18n-title="title-temporary-corruption-when-ritual-is-used">
                                <option value="0" selected>-</option>
                                <option value="[[1]]" >1</option>
                                <option value="[[1d4]]" >1d4</option>
                                <option value="[[1d6]]" >1d6</option>
                                <option value="[[1d8]]" >1d8</option>
                        </select>
                        <span data-i18n="temporary-corruption-abbrv">Temp Corruption</span>
                    </div>
                    <textarea name="attr_ritualdesc" title="Ritual description" data-i18n-title="title-ritual-description" placeholder="Effect" data-i18n-placeholder="effect"></textarea>
                </div>
                </fieldset>
            </div> 
<!-- END column 1 -->  
<!-- BEGIN Column2 -->
            <div class="sheet-col" >  
                <label class="sheet-label-large" data-i18n="mystical-powers">Mystical Powers</label> 
                <div class="sheet-ability-section">
                    <div>
                        <input type="text" name="attr_powername" title="Power"s name" data-i18n-title="title-powers-name" placeholder="Name" data-i18n-placeholder="name" /> 
                    </div>
                    <div>
                        <button type="roll" title="Mystical Power Check" data-i18n-title="title-mystical-power-check" class="sheet-hidden sheet-roll" value="&{template:powercheck}{{name=^{power}: @{powername}}} {{character=@{character-name}}} {{selected=@{powerattribute}}} {{attribute=[[@{powerattribute}+?{Enemy Disadvantage|0}]]}} {{roll=[[1d20]]}} " name="roll_PowerCheck"></button>
                        <select name="attr_powerattribute" style="width:auto;" size="1" title="Attribute for Mystical Power" data-i18n-title="title-mystical-power-attribute" >
                            <option value="[[@{accurate}]]" data-i18n="accurate">Accurate</option>
                            <option value="[[@{cunning}]]" data-i18n="cunning">Cunning</option>
                            <option value="[[@{discreet}]]" data-i18n="discreet">Discreet</option>
                            <option value="[[@{persuasive}]]" data-i18n="persuasive">Persuasive</option>
                            <option value="[[@{quick}]]" data-i18n="quick">Quick</option>
                            <option value="[[@{resolute}]]" data-i18n="resolute" selected>Resolute</option>
                            <option value="[[@{strong}]]" data-i18n="strong">Strong</option>
                            <option value="[[@{vigilant}]]" data-i18n="vigilant">Vigilant</option>					
                        </select>
                        <select name="attr_power-corruption" title="Temporary Corruption when power is used" data-i18n-title="title-temporary-corruption-when-power-is-used" >
                                <option value="0" selected>-</option>
                                <option value="[[1]]" >1</option>
                                <option value="[[1d4]]" >1d4</option>
                                <option value="[[1d6]]" >1d6</option>
                                <option value="[[1d8]]" >1d8</option>
                        </select>
                        <div class="sheet-faded-nam">
                            <input type="checkbox" name="attr_power-level" value="1" title="Novice" data-i18n-title="title-novice" /><span>N</span>
                            <input type="checkbox" name="attr_power-level" value="2" title="Adept" data-i18n-title="title-adept" /><span>A</span>
                            <input type="checkbox" name="attr_power-level" value="3" title="Master" data-i18n-title="title-master" /><span>M</span>
                        </div>
                    </div>
                    <textarea name="attr_powerdesc" title="Power description" data-i18n-title="title-power-description" placeholder="Effect" data-i18n-placeholder="effect"></textarea>
                </div>
                <fieldset class="repeating_power">
                <div class="sheet-ability-section">
                    <div>
                        <input type="text" name="attr_powername" title="Power"s name" data-i18n-title="title-powers-name" placeholder="Name" data-i18n-placeholder="name" /> 
                    </div>
                    <div>
                        <button type="roll" title="Mystical Power Check" data-i18n-title="title-mystical-power-check" class="sheet-hidden sheet-roll" value="&{template:powercheck}{{name=^{power}: @{powername}}} {{character=@{character-name}}} {{selected=@{powerattribute}}} {{attribute=[[@{powerattribute}+?{Enemy Disadvantage|0}]]}} {{roll=[[1d20]]}} " name="roll_PowerCheck"></button>
                        <select name="attr_powerattribute" style="width:auto;" size="1" title="Attribute for Mystical Power" data-i18n-title="title-mystical-power-attribute" >
                            <option value="[[@{accurate}]]" data-i18n="accurate">Accurate</option>
                            <option value="[[@{cunning}]]" data-i18n="cunning">Cunning</option>
                            <option value="[[@{discreet}]]" data-i18n="discreet">Discreet</option>
                            <option value="[[@{persuasive}]]" data-i18n="persuasive">Persuasive</option>
                            <option value="[[@{quick}]]" data-i18n="quick">Quick</option>
                            <option value="[[@{resolute}]]" data-i18n="resolute" selected>Resolute</option>
                            <option value="[[@{strong}]]" data-i18n="strong">Strong</option>
                            <option value="[[@{vigilant}]]" data-i18n="vigilant">Vigilant</option>					
                        </select>
                        <select name="attr_power-corruption" title="Temporary Corruption when power is used" data-i18n-title="title-temporary-corruption-when-power-is-used" >
                                <option value="0" selected>-</option>
                                <option value="[[1]]" >1</option>
                                <option value="[[1d4]]" >1d4</option>
                                <option value="[[1d6]]" >1d6</option>
                                <option value="[[1d8]]" >1d8</option>
                        </select>
                        <div class="sheet-faded-nam">
                            <input type="checkbox" name="attr_power-level" value="1" title="Novice" data-i18n-title="title-novice" /><span>N</span>
                            <input type="checkbox" name="attr_power-level" value="2" title="Adept" data-i18n-title="title-adept" /><span>A</span>
                            <input type="checkbox" name="attr_power-level" value="3" title="Master" data-i18n-title="title-master" /><span>M</span>
                        </div>
                    </div>
                    <textarea name="attr_powerdesc" title="Power description" data-i18n-title="title-power-description" placeholder="Effect" data-i18n-placeholder="effect"></textarea>
                </div>
                </fieldset>                    
            </div> <!-- END column 2 -->
        </div>
    </div>
</div>
<!-- *******  PAGE 4 -->
<div class="sheet-section sheet-section-pc4">
    <div class="sheet-row" style="text-align:center">
        <div>
            <div style="display:inline-block;">
                <label style="text-align:center;padding:0;margin:0;" data-i18n="currency-thaler">Thaler</label>
                <input type="number" class="sheet-number-box-small" value="0" name="attr_player-thaler" style="width:4em;"/>
            </div>
            <div style="display:inline-block;">
                <label style="text-align:center;padding:0;margin:0;" data-i18n="currency-shilling">Shilling</label>
                <input type="number" class="sheet-number-box-small" value="0" name="attr_player-shilling" style="width:4em;"/>
            </div>
            <div style="display:inline-block;">
                <label style="text-align:center;padding:0;margin:0;" data-i18n="currency-orteg">Orteg</label>
                <input type="number" class="sheet-number-box-small" value="0" name="attr_player-orteg" style="width:4em;"/>
            </div>
        </div>
    </div>
    <div class="sheet-row">
        <div class="sheet-2colrow">
            <div class="sheet-col">
                <div style="margin-bottom:1em;">
                    <label class="sheet-label-large" data-i18n="detailed-equipment-and-artifacts">Detailed Equipment & Artifacts</label>
                    <div style="margin-bottom:4px">
                        <div class="sheet-faded" style="height:100%; margin-left:-1em;">
                            <input type="checkbox" name="attr_artifact-isBound" title="Bound to player" data-i18n-title="title-bond-to-player" />
                            <input type="text" name="attr_artifact-name" title="Name" data-i18n-title="name" placeholder="Name" data-i18n-placeholder="name" style="width: 55%;" />
                            <select name="attr_artifact-corruption" title="Temporary Corruption when equipment or artifacts is used" data-i18n-title="title-temporary-corruption-when-equipment-is-used" style="width: 15%">
                                    <option value="0" selected>-</option>
                                    <option value="[[1]]" >1</option>
                                    <option value="[[1d4]]" >1d4</option>
                                    <option value="[[1d6]]" >1d6</option>
                                    <option value="[[1d8]]" >1d8</option>
                            </select>
                            <span data-i18n="temporary-corruption">Temp Corruption</span>
                        </div>
                        <textarea name="attr_artifact-description" style="height:2em" title="Description" data-i18n-title="description" placeholder="Description" data-i18n-placeholder="description"></textarea>
                    </div>
                    <fieldset class="repeating_artifacts" style="margin-bottom:4px">
                        <div class="sheet-faded" style="height:100%; margin-left:-1em;">
                            <input type="checkbox" name="attr_artifact-isBound" title="Bound to player" data-i18n-title="title-bond-to-player" />
                            <input type="text" name="attr_artifact-name" title="Name" data-i18n-title="name" placeholder="Name" data-i18n-placeholder="name" />
                            <select name="attr_artifact-corruption" title="Temporary Corruption when equipment or artifacts is used" data-i18n-title="title-temporary-corruption-when-equipment-is-used">
                                    <option value="0" selected>-</option>
                                    <option value="[[1]]" >1</option>
                                    <option value="[[1d4]]" >1d4</option>
                                    <option value="[[1d6]]" >1d6</option>
                                    <option value="[[1d8]]" >1d8</option>
                            </select>
                            <span data-i18n="temporary-corruption">Temp Corruption</span>
                        </div>
                        <textarea name="attr_artifact-description" style="height:2em" title="Description" data-i18n-title="description" placeholder="Description" data-i18n-placeholder="description"></textarea>
                    </fieldset>
                </div>
                <div style="margin-bottom:1em;">
                    <label class="sheet-label-large" data-i18n="items">Items</label>
                    <div>
                        <input type="text" style="width:290px" name="attr_item-sleeping-roll" title="Standard Equipment" data-i18n-title="title-standard-equipment" value="Sleeping roll"/>
                        <input type="number" class="sheet-number-box-small" name="attr_item-sleeping-roll-quantity" value="1" title="Item Quantity" data-i18n-title="title-item-quantity" style="width:5em;text-align:left;padding-left:.5em;"/>
                    </div>
                    <div>
                        <input type="text" style="width:290px" name="attr_item-cooking-pan" title="Standard Equipment" data-i18n-title="title-standard-equipment" value="Cooking equipment"/>
                        <input type="number" class="sheet-number-box-small" name="attr_item-cooking-pan-quantity" value="1" title="Item Quantity" data-i18n-title="title-item-quantity" style="width:5em;text-align:left;padding-left:.5em;"/>
                    </div>
                    <div>
                        <input type="text" style="width:290px" name="attr_item-firewood" title="Standard Equipment" data-i18n-title="title-standard-equipment" value="Firewood"/>
                        <input type="number" class="sheet-number-box-small" name="attr_item-firewood-quantity" value="1" title="Item Quantity" data-i18n-title="title-item-quantity" style="width:5em;text-align:left;padding-left:.5em;"/>
                    </div>
                    <div>
                        <input type="text" style="width:290px" name="attr_item-flint-and-steel" title="Standard Equipment" data-i18n-title="title-standard-equipment" value="Flint and Steel"/>
                        <input type="number" class="sheet-number-box-small" name="attr_item-flint-and-steel-quantity" value="1" title="Item Quantity" data-i18n-title="title-item-quantity" style="width:5em;text-align:left;padding-left:.5em;"/>
                    </div>
                    <div>
                        <input type="text" style="width:290px" name="attr_item-rope" title="Standard Equipment" data-i18n-title="title-standard-equipment" value="Rope"/>
                        <input type="number" class="sheet-number-box-small" name="attr_item-rope-quantity" value="1" title="Item Quantity" data-i18n-title="title-item-quantity" style="width:5em;text-align:left;padding-left:.5em;"/>
                    </div>
                    <div>
                        <input type="text" style="width:290px" name="attr_item-waterskin" title="Standard Equipment" data-i18n-title="title-standard-equipment" value="Waterskin"/>
                        <input type="number" class="sheet-number-box-small" name="attr_item-waterskin-quantity" value="1" title="Item Quantity" data-i18n-title="title-item-quantity" style="width:5em;text-align:left;padding-left:.5em;"/>
                    </div>
                    <fieldset class="repeating_item">
                        <input type="text" style="width:290px" name="attr_item-name" title="Item Name" data-i18n-title="title-item-name" placeholder="Item Name" data-i18n-placeholder="item-name" />
                        <input type="number" class="sheet-number-box-small" name="attr_item-quantity" value="1" title="Item Quantity" data-i18n-title="title-item-quantity" style="width:5em;text-align:left;padding-left:.5em;"/>
                    </fieldset>
                </div>
            </div> <!-- END column 1 -->
            <div class="sheet-col">
                <div class="sheet-ability-section">
                    <label class="sheet-label-large" data-i18n="character-background">Character Background</label>
                    <textarea name="attr_background" data-i18n-title="character-background" title="Explain where your character comes from and where he or she wants to go and accomplish." placeholder="Explain where your character comes from and where he or she wants to go and accomplish." data-i18n-placeholder="character-background"></textarea>
                </div>
                <div class="sheet-ability-section">
                    <label class="sheet-label-large" data-i18n="group">Group</label>
                    <input type="text" name="attr_groupName" title="Group Name" data-i18n-title="group-name" placeholder="Group Name" data-i18n-placeholder="group-name" />
                    <textarea name="attr_groupGoal"style="height:3.5em;" title="Group Goal" data-i18n-title="group-goal" placeholder="Group Goal" data-i18n-placeholder="group-goal"></textarea>
                </div>
                <div class="sheet-ability-section">
                    <label class="sheet-label-large" data-i18n="friends">Friends</label>
                    <div style="margin-bottom:4px;">
                        <input type="text" name="attr_friendName" title="Friend Name" data-i18n-title="friends-name" placeholder="Friend Name" data-i18n-placeholder="friends-name" />
                        <input type="text" name="attr_friendRace" title="Friend Race" data-i18n-title="friends-race" placeholder="Friend Race" data-i18n-placeholder="friends-race" />
                        <input type="text" name="attr_friendOccupation" title="Friend Occupation" data-i18n-title="friends-occupation" placeholder="Friend Occupation" data-i18n-placeholder="friends-occupation" />
                        <input type="text" name="attr_friendPlayer" title="Player" data-i18n-title="player" placeholder="Player" data-i18n-placeholder="player" />
                    </div>
                    <fieldset class="repeating_friends-list">  
                        <div style="margin-bottom:4px;">
                            <input type="text" name="attr_friendName" title="Friend Name" data-i18n-title="friends-name" placeholder="Friend Name" data-i18n-placeholder="friends-name" />
                            <input type="text" name="attr_friendRace" title="Friend Race" data-i18n-title="friends-race" placeholder="Friend Race" data-i18n-placeholder="friends-race" />
                            <input type="text" name="attr_friendOccupation" title="Friend Occupation" data-i18n-title="friends-occupation" placeholder="Friend Occupation" data-i18n-placeholder="friends-occupation" />
                            <input type="text" name="attr_friendPlayer" title="Player" data-i18n-title="player" placeholder="Player" data-i18n-placeholder="player" />
                        </div>                  
                    </fieldset>
                </div>
            </div>
        </div>
    </div>
</div>

<rolltemplate class="sheet-rolltemplate-abilitycheck">
    <table>
    	<tr><th class="attribhead" colspan="2">{{name}}</th></tr>
		{{#rollLess() selected 0}}
        	<tr><td class="attribcat" colspan="2">{{character}} has failed to select an Attribute for this Ability</td></tr>
        {{/rollLess() selected 0}}
        {{#rollGreater() selected 0}}
    		<tr><td class="attribcat"><span data-i18n="character">Character</span>:&nbsp;</td><td class="attribresult">{{character}}</td></tr>
    		<tr><td class="attribcat"><span data-i18n="attribute">Attribute</span>:&nbsp;</td><td class="attribresult">{{attribute}}</td></tr>
    		<tr><td class="attribcat"><span data-i18n="dice-roll">Roll</span>:&nbsp;</td><td class="attribresult">{{roll}}</td></tr>
    		{{#rollLess() roll attribute}}
    			<tr class="effex"><td colspan="2"><span class="attribhit" data-i18n="success">Success</span>!</td></tr>
    		{{/rollLess() roll attribute}}
    		{{#rollTotal() roll attribute}}
    			<tr class="effex"><td colspan="2"><span class="attribhit" data-i18n="success">Success</span>!</td></tr>
    		{{/rollTotal() roll attribute}}
    		{{#rollGreater() roll attribute}}
    		    <tr class="effex"><td colspan="2"><span class="attribmiss" data-i18n="failure">Failure</span>...</td></tr>
    		{{/rollGreater() roll attribute}}
    	{{/rollGreater() selected 0}}
    </table>
</rolltemplate>
<rolltemplate class="sheet-rolltemplate-powercheck">
    <table>
		<tr><th class="attribhead" colspan="2">{{name}}</th></tr>
		<tr><td class="attribcat"><span data-i18n="character">Character</span>:&nbsp;</td><td class="attribresult">{{character}}</td></tr>
		<tr><td class="attribcat"><span data-i18n="attribute">Attribute</span>:&nbsp;</td><td class="attribresult">{{attribute}}</td></tr>
		<tr><td class="attribcat"><span data-i18n="dice-roll">Roll</span>:&nbsp;</td><td class="attribresult">{{roll}}</td></tr>
		{{#rollLess() roll attribute}}
			<tr class="effex"><td colspan="2"><span class="attribhit" data-i18n="success">Success</span>!</td></tr>
		{{/rollLess() roll attribute}}
		{{#rollTotal() roll attribute}}
			<tr class="effex"><td colspan="2"><span class="attribhit" data-i18n="success">Success</span>!</td></tr>
		{{/rollTotal() roll attribute}}		
		{{#rollGreater() roll attribute}}
		    <tr class="effex"><td colspan="2"><span class="attribmiss" data-i18n="failure">Failure</span>...</td></tr>
		{{/rollGreater() roll attribute}}
    </table>
</rolltemplate>
<rolltemplate class="sheet-rolltemplate-attrib">
    <table>
		<tr><th class="attribhead" colspan="2">{{name}}</th></tr>
		<tr><td class="attribcat"><span data-i18n="character">Character</span>:&nbsp;</td><td class="attribresult">{{character}}</td></tr>
		<tr><td class="attribcat"><span data-i18n="attribute">Attribute</span>:&nbsp;</td><td class="attribresult">{{attribute}}</td></tr>
		<tr><td class="attribcat"><span data-i18n="dice-roll">Roll</span>:&nbsp;</td><td class="attribresult">{{roll}}</td></tr>
		{{#rollLess() roll attribute}}
			<tr class="effex"><td colspan="2"><span class="attribhit" data-i18n="success">Success</span>!</td></tr>
		{{/rollLess() roll attribute}}
		{{#rollTotal() roll attribute}}
			<tr class="effex"><td colspan="2"><span class="attribhit" data-i18n="success">Success</span>!</td></tr>
		{{/rollTotal() roll attribute}}		
		{{#rollGreater() roll attribute}}
		    <tr class="effex"><td colspan="2"><span class="attribmiss" data-i18n="failure">Failure</span>...</td></tr>
		{{/rollGreater() roll attribute}}
    </table>
</rolltemplate>
<rolltemplate class="sheet-rolltemplate-defense">
    <table>
        {{#rollLess() defense-type 0}}
    		<tr><th class="defhead" colspan="2">{{character-name}}&nbsp;<span data-i18n="negates-extra-damage">negates extra damage</span>{{#name}}&nbsp;<span data-i18n="using">using</span>&nbsp;{{name}}{{/name}}</th></tr>
            <tr><td class="defcat"><span data-i18n="damage-negated">Damage negated</span>:</td><td class="defresult">{{damage-taken}}</td></tr>
        {{/rollLess() defense-type 0}}
        
        {{#rollGreater() defense-type 0}}                
			<tr><th class="defhead" colspan="2">{{character-name}}&nbsp;<span data-i18n="defends">defends</span>{{#name}}&nbsp;<span data-i18n="with">with</span>&nbsp;{{name}}{{/name}}</th></tr>
			<tr><td class="defcat"><span data-i18n="attribute">Attribute</span>:</td><td class="defresult">{{attribute}}</td></tr>
			<tr><td class="defcat"><span data-i18n="dice-roll">Roll</span>:</td><td class="defresult">{{defense-roll}}</td></tr>
			{{#rollLess() defense-roll attribute1}} <!-- miss -->
			    {{#^rollWasFumble() defense-roll}}<tr><th class="effex" colspan="2"><span class="defmiss"><span data-i18n="enemy-missed">Enemy missed</span>!</span></th></tr>{{/^rollWasFumble() defense-roll}}
			    {{#rollWasFumble() defense-roll}} <tr><th class="effex" colspan="2" style="text-shadow:1px 1px 1px Black"><span class="defmiss"><span data-i18n="enemy-critically-missed">Enemy critically missed</span>!</span></th></tr>{{/rollWasFumble() defense-roll}}
			{{/rollLess() defense-roll attribute1}}
			
			{{#rollGreater() defense-roll attribute}} <!-- hit -->
				 {{#^rollWasCrit() defense-roll}}<tr><th colspan="2" style="border-bottom:0px;"><span class="defhit"><span data-i18n="enemy-hit">Enemy hit</span>!</span></th></tr>{{/^rollWasCrit() defense-roll}}
				 {{#rollWasCrit() defense-roll}}<tr><th colspan="2" style="border-bottom:0px;"><span class="defhit"><span style="text-shadow:1px 1px 1px Black" data-i18n="enemy-critically-hit">Enemy critically hit</span>!</span></th></tr>{{/rollWasCrit() defense-roll}}
                {{#rollGreater() damage-taken 0 }}<tr style="background-color:#ffffff"><td class="effex" colspan="2"><span data-i18n="damage-negated">Damage negated</span>:&nbsp;{{damage-taken}}</td></tr>{{/rollGreater() damage-taken 0 }}
                {{#rollLess() damage-taken 1}}<tr style="background-color:#ffffff"><td class="effex" colspan="2"><span data-i18n="damage-negated">Damage negated</span>:&nbsp;0</td></tr>{{/rollLess() damage-taken 1}}
			{{/rollGreater() defense-roll attribute}}
        {{/rollGreater() defense-type 0}}
    </table>
</rolltemplate>
<rolltemplate class="sheet-rolltemplate-attack">
    <table>
        {{#rollLess() attack-type 0}}
        	<tr><th class="attkhead" colspan="2">{{character-name}}&nbsp;<span data-i18n="does-extra-damage">does extra damage</span>&nbsp;{{#name}}&nbsp;<span data-i18n="with">with</span>&nbsp;{{name}}{{/name}}</th></tr>
			<tr style="background-color:#ffffff"><td class="attkcat"><span data-i18n="damage">Damage</span>:</td><td class="attkresult">{{damage}}</td></tr>		
        {{/rollLess() attack-type 0}}
        {{#rollGreater() attack-type 0}}
            
			<tr><th class="attkhead" colspan="2">{{character-name}}&nbsp;<span data-i18n="attacks-chat">attacks</span>{{#name}}&nbsp;<span data-i18n="with">with</span>&nbsp;{{name}}{{/name}}</th></tr>
            <tr><td class="attkcat"><span data-i18n="attribute">Attribute</span>:&nbsp;</td><td class="attkresult">{{attribute}}</td></tr>
            <tr><td class="attkcat"><span data-i18n="dice-roll">Roll</span>:&nbsp;</td><td class="attkresult">{{attack}}</td></tr> 
			{{#rollLess() attack attribute1}}
				{{#^rollWasFumble() attack}}<tr><th class="effex" colspan="2"><span class="attkhit"><span data-i18n="attack-hit">Attack hit</span>!</span></th></tr>{{/^rollWasFumble() attack}}
				{{#rollWasFumble() attack}} <tr><th class="effex" colspan="2" style="text-shadow:1px 1px 1px Black"><span class="attkhit"><span data-i18n="attack-critically-hit">Attack critically hit</span>!</span></th></tr>{{/rollWasFumble() attack}}
				{{#rollGreater() damage 0}}<tr style="background-color:#ffffff"><td class="effex" colspan="2"><span data-i18n="damage">Damage</span>:&nbsp;{{damage}} {{#rollWasFumble() attack}}<span> + </span> {{damage-crit}} {{/rollWasFumble() attack}}</td></tr>{{/rollGreater() damage 0}}
			{{/rollLess() attack attribute1}}
			        
			{{#rollGreater() attack attribute}}
				{{#^rollWasCrit() attack}}<tr><th colspan="2"><span data-i18n="attack-missed">Attack missed</span>!</th></tr>{{/^rollWasCrit() attack}}
				{{#rollWasCrit() attack}}<tr><th colspan="2" style="text-shadow:1px 1px 1px Black"><span data-i18n="attack-critically-missed">Attack critically missed</span>!</span></th></tr>{{/rollWasCrit() attack}}
			{{/rollGreater() attack attribute}}  
        {{/rollGreater() attack-type 0}} 
    </table>
</rolltemplate>

<script type="text/worker">

var Sheet = Sheet || (function() {

	var version= 1.0,
	Debug = false,	
// convert weapon quality selector from numeric value to text
	qualitySwap = function() {
// get weapon quality text values
		getAttrs(["weapon1-quality"], function(values) {
			var qualityName, 
				list=["None", "Balanced", "Blunt", "Deep Impact", "Jointed", "Long", "Precise", "Short"],
				index = ~~values["weapon1-quality"];
				qualityName = list[index];
			console.log("....Given: " + values["weapon1-quality"] );
			console.log("....Index: " + index );
			console.log("....QualityName: " + qualityName );
				setAttrs({
					"weapon1-quality":qualityName
				});
		});

// get repeating weapon quality text values
		getSectionIDs("repeating_weapons", function(ids) {
			var fields = _.map(ids,function(id) {
				return "repeating_weapons_" + id + "_weapon1-quality";
				console.log("....Row id " + id );
			});

			getAttrs(fields, function(values) {
				_.each(ids, function(rowid, i) {												
					console.log("....repeating_weapons_" + rowid + "_weapon1-quality");
					var qualityName,
						list=["None", "Balanced", "Blunt", "Deep Impact", "Jointed", "Long", "Precise", "Short"],
						index = ~~values["repeating_weapons_" + rowid + "_weapon1-quality"];
						qualityName = list[index];
					console.log("....Row id " + rowid );
					console.log("....Given: " + values["repeating_weapons_" + rowid + "_weapon1-quality"] );
					console.log("....Index: " + index );
					console.log("....QualityName: " + qualityName );
						setAttrs({
						["repeating_weapons_" + rowid + "_weapon1-quality"]:qualityName
					});
				});
			});
		});		

	},

/* recalculateSheet */
	recalculateSheet = function(oldversion) {
		if (oldversion < 0.1) {
//call your functions here
		qualitySwap();
		}
	},
	
/* checkForUpdate looks at current version of page in
 * sheet_version and compares to code Sheet.version calls
 * recalulateSheet if versions don"t match or if recalculate
 * button was pressed. */
	checkForUpdate = function() {
		getAttrs(["sheet_version","sheet_forcesync","recalc1"],function(v){
			var setter={},currVer=0,setAny=0,recalc=false;
			currVer=parseFloat(v["sheet_version"],10)||0;
			console.log("Current sheet data version:"+currVer+", Sheet code version:" + version );
			
			if ( currVer!== version ) {
				recalc=true;
				setter["sheet_version"]= version;
				setAny=1;
			}
			if (v["recalc1"] && v["recalc1"]!="0" ) {
				currVer=-1;
				recalc=true;
				setter["recalc1"]=0;
				setAny=1;
			}
			if (v["sheet_forcesync"] && v["sheet_forcesync"]!="0" ) {
				currVer=-1;
				recalc=true;
				setter["sheet_forcesync"]=0;
				setAny=1;
			}
			if (setAny) {
				 setAttrs( setter);
			}
			if (recalc) {
				recalculateSheet(currVer);
			}
		});
	};
	return {
		version:version,
		checkForUpdate:checkForUpdate,
		qualitySwap:qualitySwap
	};
}());

//sheet
on("sheet:opened",function() {Sheet.checkForUpdate();});
on("change:recalc1",function() {Sheet.checkForUpdate();});

</script>