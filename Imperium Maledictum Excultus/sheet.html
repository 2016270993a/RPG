<input class="toggle-tabs" type="hidden" name="attr_tab" value="page1"  />

<div class="tabs">
    <div class="tab-page1"><button type="action"
        name="act_page1">Page 1</button></div>
    <div class="tab-page2"><button type="action"
        name="act_page2">Page 2</button></div>
    <div class="tab-settings"><button type="action"
        name="act_settings">Settings</button></div>
</div>

<div class="grid page1 widegap">
    <div class="grid col3 vwidegap">
        <h1 class="vspan2">Imperium Maledictum</h1>

        <div class="grid col4 span2 vcol">
            <input type="text" spellcheck="false" list="origin" name="attr_origin" />
            <datalist id="origin">
                <option>Agri World</option>
                <option>Feral World</option>
                <option>Feudal World</option>
                <option>Forge World</option>
                <option>Hive World</option>
                <option>Schola Progenium</option>
                <option>Shrine World</option>
                <option>Voidborn</option>
            </datalist>
            <label>Origin</label>

            <input type="text" spellcheck="false" list="faction" name="attr_faction" />
            <datalist id="faction">
                <option>Adeptus Administratum</option>
                <option>Adeptus Astra Telepathica</option>
                <option>Adeptus Mechanicus</option>
                <option>Adeptus Ministorum</option>
                <option>Astra Militarum</option>
                <option>Imperial Fleet</option>
                <option>Infractionist</option>
                <option>The Inquisition</option>
                <option>Rogue Trader Dynasty</option>
            </datalist>
            <label>Faction</label>

            <input type="text" spellcheck="false" list="role" name="attr_role" />
            <datalist id="role">
                <option>Interlocutor</option>
                <option>Mystic</option>
                <option>Penumbra</option>
                <option>Savant</option>
                <option>Warrior</option>
                <option>Zealot</option>
            </datalist>
            <label>Role</label>

            <input type="text" spellcheck="false" name="attr_patron" />
            <label>Patron</label>
        </div>

        <div class="grid col6 span2 vcol">
            <input type="text" spellcheck="false" name="attr_age" />
            <label>Age</label>

            <input type="text" spellcheck="false" name="attr_eyes" />
            <label>Eyes</label>

            <input type="text" spellcheck="false" name="attr_hair" />
            <label>Hair</label>

            <input type="text" spellcheck="false" name="attr_height" />
            <label>Height</label>

            <input type="text" spellcheck="false" name="attr_weight" />
            <label>Weight</label>

            <input type="text" spellcheck="false" name="attr_handedness" />
            <label>Handedness</label>
        </div>
    </div>

    <div class="grid col3 widegap">
        <div class="grid vcol">
            <input class="lrg" type="text" spellcheck="false" name="attr_character_name" />
            <label>Character Name</label>
        </div>

        <div class="grid col4 span2 vcol">
            <input class="span3" type="text" spellcheck="false"
                name="attr_distinguishing_features" />
            <label class="span3">Distinguishing Features</label>

            <div class="grid col2 vspan2 vcol nogap xp">
                <input type="number" name="attr_current_xp" />
                <label class="hint">Current</label>

                <input type="number" name="attr_spent_xp" />
                <label class="hint">Spent</label>
            </div>
        </div>
    </div>

    <div class="grid col3-chars vwidegap">
        <div class="grid nogap characteristics">
            <h2>Characteristics</h2>

            <div class="grid nogap lined">
                <div class="grid col10">
                    <span />
                    <span class="label">WS</span>
                    <span class="label">BS</span>
                    <span class="label">STR</span>
                    <span class="label">TGH</span>
                    <span class="label">AG</span>
                    <span class="label">INT</span>
                    <span class="label">PER</span>
                    <span class="label">WIL</span>
                    <span class="label">FEL</span>

                    <span class="label">Starting</span>
                    <input type="number" name="attr_ws_start" tooltip="Weapon Skill" />
                    <input type="number" name="attr_bs_start" tooltip="Ballistic Skill" />
                    <input type="number" name="attr_str_start" tooltip="Strength" />
                    <input type="number" name="attr_tgh_start" tooltip="Toughness" />
                    <input type="number" name="attr_ag_start" tooltip="Agility" />
                    <input type="number" name="attr_int_start" tooltip="Intelligence" />
                    <input type="number" name="attr_per_start" tooltip="Perception" />
                    <input type="number" name="attr_wil_start" tooltip="Willpower" />
                    <input type="number" name="attr_fel_start" tooltip="Fellowship" />

                    <span class="label">Advances</span>
                    <input type="number" name="attr_ws_advances" />
                    <input type="number" name="attr_bs_advances" />
                    <input type="number" name="attr_str_advances" />
                    <input type="number" name="attr_tgh_advances" />
                    <input type="number" name="attr_ag_advances" />
                    <input type="number" name="attr_int_advances" />
                    <input type="number" name="attr_per_advances" />
                    <input type="number" name="attr_wil_advances" />
                    <input type="number" name="attr_fel_advances" />

                    <span class="label">Current</span>
                    <span class="input" name="attr_ws" />
                    <span class="input" name="attr_bs" />
                    <span class="input" name="attr_str" />
                    <span class="input" name="attr_tgh" />
                    <span class="input" name="attr_ag" />
                    <span class="input" name="attr_int" />
                    <span class="input" name="attr_per" />
                    <span class="input" name="attr_wil" />
                    <span class="input" name="attr_fel" />

                    <input type="hidden" name="attr_ws_bonus" value="0" />
                    <input type="hidden" name="attr_bs_bonus" value="0" />
                    <input type="hidden" name="attr_str_bonus" value="0" />
                    <input type="hidden" name="attr_tgh_bonus" value="0" />
                    <input type="hidden" name="attr_ag_bonus" value="0" />
                    <input type="hidden" name="attr_int_bonus" value="0" />
                    <input type="hidden" name="attr_per_bonus" value="0" />
                    <input type="hidden" name="attr_wil_bonus" value="0" />
                    <input type="hidden" name="attr_fel_bonus" value="0" />
                </div>
            </div>
        </div>

        <div class="grid nogap vsplit">
            <h2>Fate</h2>

            <div class="grid col2 vcol novgap">
                <label>Current</label>
                <input type="number" name="attr_current_fate" value="3" />

                <label>Total</label>
                <input type="number" name="attr_total_fate_max" value="3" />
            </div>

        </div>

        <div class="grid nogap vsplit corruption">
            <h2>Corruption</h2>

            <div class="grid col4 vcol novgap">
                <label>Total</label>
                <input type="number" name="attr_total_corruption" />

                <label class="span3">Mutations & Malignancies</label>
                <div class="auto-expand span3">
                    <span name="attr_mutations"></span>
                    <textarea spellcheck="false" name="attr_mutations"></textarea>
                </div>
            </div>
        </div>
    </div>

    <div class="grid nogap skills">
        <h2>Skills & Specialisations</h2>

        <div class="grid col3 widegap">

            <div class="grid nogap lined">
                <div class="grid col5-skills">
                    <span class="label">Skill</span>
                    <span class="label span2">Char.</span>
                    <span class="label pullup">Adv. <sub>(+5 each)</sub></span>
                    <span class="label">Total</span>

                    <label>Athletics</label>
                    <span class="label">STR</span>
                    <span class="input" name="attr_str" />
                    <input type="hidden" name="attr_athletics_advances" value="0" />
                    <input type="number" name="attr_athletics_advances" />
                    <input type="hidden" name="attr_athletics" value="0" />
                    <span class="input" name="attr_athletics" />

                    <label>Awareness</label>
                    <span class="label">PER</span>
                    <span class="input" name="attr_per" />
                    <input type="hidden" name="attr_awareness_advances" value="0" />
                    <input type="number" name="attr_awareness_advances" />
                    <input type="hidden" name="attr_awareness" value="0" />
                    <span class="input" name="attr_awareness" />

                    <label>Dexterity</label>
                    <span class="label">AG</span>
                    <span class="input" name="attr_ag" />
                    <input type="hidden" name="attr_dexterity_advances" value="0" />
                    <input type="number" name="attr_dexterity_advances" />
                    <input type="hidden" name="attr_dexterity" value="0" />
                    <span class="input" name="attr_dexterity" />

                    <label>Discipline</label>
                    <span class="label">WIL</span>
                    <span class="input" name="attr_wil" />
                    <input type="hidden" name="attr_discipline_advances" value="0" />
                    <input type="number" name="attr_discipline_advances" />
                    <input type="hidden" name="attr_discipline" value="0" />
                    <span class="input" name="attr_discipline" />

                    <label>Fortitude</label>
                    <span class="label">TGH</span>
                    <span class="input" name="attr_tgh" />
                    <input type="hidden" name="attr_fortitude_advances" value="0" />
                    <input type="number" name="attr_fortitude_advances" />
                    <input type="hidden" name="attr_fortitude" value="0" />
                    <span class="input" name="attr_fortitude" />

                    <label>Intuition</label>
                    <span class="label">PER</span>
                    <span class="input" name="attr_per" />
                    <input type="hidden" name="attr_intuition_advances" value="0" />
                    <input type="number" name="attr_intuition_advances" />
                    <input type="hidden" name="attr_intuition" value="0" />
                    <span class="input" name="attr_intuition" />

                    <label>Linguistics</label>
                    <span class="label">INT</span>
                    <span class="input" name="attr_int" />
                    <input type="hidden" name="attr_linguistics_advances" value="0" />
                    <input type="number" name="attr_linguistics_advances" />
                    <input type="hidden" name="attr_linguistics" value="0" />
                    <span class="input" name="attr_linguistics" />

                    <label>Logic</label>
                    <span class="label">INT</span>
                    <span class="input" name="attr_int" />
                    <input type="hidden" name="attr_logic_advances" value="0" />
                    <input type="number" name="attr_logic_advances" />
                    <input type="hidden" name="attr_logic" value="0" />
                    <span class="input" name="attr_logic" />

                    <label>Lore</label>
                    <span class="label">INT</span>
                    <span class="input" name="attr_int" />
                    <input type="hidden" name="attr_lore_advances" value="0" />
                    <input type="number" name="attr_lore_advances" />
                    <input type="hidden" name="attr_lore" value="0" />
                    <span class="input" name="attr_lore" />

                    <label>Medicae</label>
                    <span class="label">INT</span>
                    <span class="input" name="attr_int" />
                    <input type="hidden" name="attr_medicae_advances" value="0" />
                    <input type="number" name="attr_medicae_advances" />
                    <input type="hidden" name="attr_medicae" value="0" />
                    <span class="input" name="attr_medicae" />
                </div>
            </div>

            <div class="grid nogap lined">
                <div class="grid col5-skills">
                    <span class="label">Skill</span>
                    <span class="label span2">Char.</span>
                    <span class="label pullup">Adv. <sub>(+5 each)</sub></span>
                    <span class="label">Total</span>

                    <label>Melee</label>
                    <span class="label">WS</span>
                    <span class="input" name="attr_ws" />
                    <input type="hidden" name="attr_melee_advances" value="0" />
                    <input type="number" name="attr_melee_advances" />
                    <input type="hidden" name="attr_melee" value="0" />
                    <span class="input" name="attr_melee" />

                    <label>Navigation</label>
                    <span class="label">INT</span>
                    <span class="input" name="attr_int" />
                    <input type="hidden" name="attr_navigation_advances" value="0" />
                    <input type="number" name="attr_navigation_advances" />
                    <input type="hidden" name="attr_navigation" value="0" />
                    <span class="input" name="attr_navigation" />

                    <label>Piloting</label>
                    <span class="label">AG</span>
                    <span class="input" name="attr_ag" />
                    <input type="hidden" name="attr_piloting_advances" value="0" />
                    <input type="number" name="attr_piloting_advances" />
                    <input type="hidden" name="attr_piloting" value="0" />
                    <span class="input" name="attr_piloting" />

                    <label>Presence</label>
                    <span class="label">WIL</span>
                    <span class="input" name="attr_wil" />
                    <input type="hidden" name="attr_presence_advances" value="0" />
                    <input type="number" name="attr_presence_advances" />
                    <input type="hidden" name="attr_presence" value="0" />
                    <span class="input" name="attr_presence" />

                    <label>Psychic Mastery</label>
                    <span class="label">WIL</span>
                    <span class="input" name="attr_wil" />
                    <input type="hidden" name="attr_psychic_mastery_advances" value="0" />
                    <input type="number" name="attr_psychic_mastery_advances" />
                    <input type="hidden" name="attr_psychic_mastery" value="0" />
                    <span class="input" name="attr_psychic_mastery" />

                    <label>Ranged</label>
                    <span class="label">BS</span>
                    <span class="input" name="attr_bs" />
                    <input type="hidden" name="attr_ranged_advances" value="0" />
                    <input type="number" name="attr_ranged_advances" />
                    <input type="hidden" name="attr_ranged" value="0" />
                    <span class="input" name="attr_ranged" />

                    <label>Rapport</label>
                    <span class="label">FEL</span>
                    <span class="input" name="attr_fel" />
                    <input type="hidden" name="attr_rapport_advances" value="0" />
                    <input type="number" name="attr_rapport_advances" />
                    <input type="hidden" name="attr_rapport" value="0" />
                    <span class="input" name="attr_rapport" />

                    <label>reflexes</label>
                    <span class="label">AG</span>
                    <span class="input" name="attr_ag" />
                    <input type="hidden" name="attr_reflexes_advances" value="0" />
                    <input type="number" name="attr_reflexes_advances" />
                    <input type="hidden" name="attr_reflexes" value="0" />
                    <span class="input" name="attr_reflexes" />

                    <label>Stealth</label>
                    <span class="label">AG</span>
                    <span class="input" name="attr_ag" />
                    <input type="hidden" name="attr_stealth_advances" value="0" />
                    <input type="number" name="attr_stealth_advances" />
                    <input type="hidden" name="attr_stealth" value="0" />
                    <span class="input" name="attr_stealth" />

                    <label>Tech</label>
                    <span class="label">INT</span>
                    <span class="input" name="attr_int" />
                    <input type="hidden" name="attr_tech_advances" value="0" />
                    <input type="number" name="attr_tech_advances" />
                    <input type="hidden" name="attr_tech" value="0" />
                    <span class="input" name="attr_tech" />
                </div>
            </div>

            <div class="grid nogap lined">
                <div class="grid col4-skills">
                    <span class="label">Specialisation</span>
                    <span class="label">Skill</span>
                    <span class="label pullup">ADV <sub>(+5 each)</sub></span>
                    <span class="label">Total</span>
                </div>

                <fieldset class="repeating_specialisations">
                    <input type="text" spellcheck="false" name="attr_specialisation_name" />
                    <select class="input" name="attr_specialisation_skill">
                        <option value=""></option>
                        <option value="athletics">Athletics</option>
                        <option value="awareness">Awareness</option>
                        <option value="dexterity">Dexterity</option>
                        <option value="discipline">Discipline</option>
                        <option value="fortitude">Fortitude</option>
                        <option value="intuition">Intuition</option>
                        <option value="linguistics">Linguistics</option>
                        <option value="logic">Logic</option>
                        <option value="lore">Lore</option>
                        <option value="medicae">Medicae</option>
                        <option value="melee">Melee</option>
                        <option value="navigation">Navigation</option>
                        <option value="piloting">Piloting</option>
                        <option value="presence">Presence</option>
                        <option value="psychic_mastery">Psychic Mastery</option>
                        <option value="ranged">Ranged</option>
                        <option value="rapport">Rapport</option>
                        <option value="reflexes">reflexes</option>
                        <option value="stealth">Stealth</option>
                        <option value="tech">Tech</option>
                    </select>
                    <input type="hidden" name="attr_specialisation_advances" value="0" />
                    <input type="number" name="attr_specialisation_advances" />
                    <input type="hidden" name="attr_specialisation_total" value="0" />
                    <span class="input" name="attr_specialisation_total" />
                </fieldset>
            </div>

        </div>
    </div>

    <div class="grid col3 widegap">
        <div class="grid widegap">
            <div class="grid nogap">
                <h2>Goals</h2>
                <div class="auto-expand">
                    <span name="attr_goals"></span>
                    <textarea spellcheck="false" name="attr_goals"></textarea>
                </div>
            </div>

            <div class="grid nogap">
                <h2>Connections</h2>
                <div class="auto-expand">
                    <span name="attr_connections"></span>
                    <textarea spellcheck="false" name="attr_connections"></textarea>
                </div>
            </div>

            <div class="grid nogap">
                <h2>Notes</h2>
                <div class="auto-expand">
                    <span name="attr_notes"></span>
                    <textarea spellcheck="false" name="attr_notes"></textarea>
                </div>
            </div>

            <div class="grid nogap">
                <h2>Divination</h2>
                <div class="auto-expand">
                    <span name="attr_divination"></span>
                    <textarea spellcheck="false" name="attr_divination"></textarea>
                </div>
            </div>

            <div class="grid nogap">
                <h2>Solars</h2>
                <div class="auto-expand">
                    <span name="attr_solars"></span>
                    <textarea spellcheck="false" name="attr_solars"></textarea>
                </div>
            </div>

            <div class="grid nogap">
                <h3>Other Currencies</h3>
                <div class="auto-expand">
                    <span name="attr_other_currencies"></span>
                    <textarea spellcheck="false" name="attr_other_currencies"></textarea>
                </div>
            </div>
        </div>

        <div class="grid span2 widegap">
            <div class="grid nogap">
                <h2>Influence</h2>

                <div class="grid col3-influences">
                    <span class="label">Faction</span>
                    <span class="label">Infl.</span>
                    <span class="label">Contacts</span>
                </div>

                <fieldset class="repeating_influences">
                    <input type="text" spellcheck="false" name="attr_influence_faction" />
                    <input type="hidden" name="attr_influence_value" value="0" />
                    <input type="number" name="attr_influence_value" />
                    <input type="text" spellcheck="false" name="attr_influence_contacts" />
                </fieldset>
            </div>

            <div class="grid nogap">
                <h2>Talents</h2>

                <div class="grid col2-talents">
                    <span class="label">Talent</span>
                    <span class="label">Effect</span>
                </div>

                <fieldset class="repeating_talents">
                    <input type="text" spellcheck="false" name="attr_talent_name" />
                    <div class="auto-expand">
                        <span name="attr_talent_effect"></span>
                        <textarea spellcheck="false" name="attr_talent_effect"></textarea>
                    </div>
                </fieldset>
            </div>
        </div>
    </div>
</div>

<div class="grid page2 widegap">
    <h2>Page 2</h2>
</div>

<div class="grid settings widegap">
    <h2>Settings</h2>
</div>

<script type="text/worker">

    const tab_list = ["page1","page2","settings"];
    const chars_data = {
        "ws": "Weapon Skill",
        "bs": "Ballistic Skill",
        "str": "Strength",
        "tgh": "Toughness",
        "ag": "Agility",
        "int": "Intelligence",
        "per": "Perception",
        "wil": "Willpower",
        "fel": "Fellowship"
    };
    const skill_data = {
        "athletics": {
            "name": "Athletics",
            "char": "str"
        },
        "awareness": {
            "name": "Awareness",
            "char": "per"
        },
        "dexterity": {
            "name": "Dexterity",
            "char": "ag"
        },
        "discipline": {
            "name": "Discipline",
            "char": "wil"
        },
        "fortitude": {
            "name": "Fortitude",
            "char": "tgh"
        },
        "intuition": {
            "name": "Intuition",
            "char": "per"
        },
        "linguistics": {
            "name": "Linguistics",
            "char": "int"
        },
        "logic": {
            "name": "Logic",
            "char": "int"
        },
        "lore": {
            "name": "Lore",
            "char": "int"
        },
        "medicae": {
            "name": "Medicae",
            "char": "int"
        },
        "melee": {
            "name": "Melee",
            "char": "ws"
        },
        "navigation": {
            "name": "Navigation",
            "char": "int"
        },
        "presence": {
            "name": "Presence",
            "char": "wil"
        },
        "piloting": {
            "name": "Piloting",
            "char": "ag"
        },
        "psychic_mastery": {
            "name": "Psychic Mastery",
            "char": "wil"
        },
        "ranged": {
            "name": "Ranged",
            "char": "bs"
        },
        "rapport": {
            "name": "Rapport",
            "char": "fel"
        },
        "reflexes": {
            "name": "reflexes",
            "char": "ag"
        },
        "stealth": {
            "name": "Stealth",
            "char": "ag"
        },
        "tech": {
            "name": "Tech",
            "char": "int"
        }
    };
    const chars_list = Object.keys(chars_data);
    const chars_start_list = chars_list.map(i => i + "_start");
    const chars_advances_list = chars_list.map(i => i + "_advances");
    const chars_trigger_list = chars_start_list
        .concat(chars_advances_list);
    const skill_list = Object.keys(skill_data);

    tab_list.forEach(button => {
        on(`clicked:${button}`, function() {
            setAttrs({"tab": button});
        });
    });

    chars_trigger_list.forEach(trigger => {
        on(`change:${trigger}`, function() {
            getAttrs(chars_trigger_list, function(values) {
                let update = {};
                chars_list.forEach(char => {
                    let start = parseInt(values[`${char}_start`])||0;
                    let advances = parseInt(values[`${char}_advances`])||0;
                    let total = start + advances;
                    let bonus = Math.floor(total / 10);
                    update[`${char}`] = total;
                    update[`${char}_bonus`] = bonus;
                });
                setAttrs(update);
            });
        });
    });

</script>
