<input type="hidden" name="attr_load_version" value="0.23">
<input type="hidden" name="attr_sheet_version">
<input type="hidden" class="sheet-tabstoggle" name="attr_sheet_tab" value="character" />
<input type="checkbox" name="attr_blitz_check" class="blitz-check" value="1" hidden>

<div>
    <button type="action" name="act_character">Character</button>
    <button type="action" name="act_gear">Gear</button>
    <button type="action" name="act_admin">Admin/Settings</button>
</div>

<div class="sheet-character">
    <div class="background">
        <div class="char-image">
            <img class="portrait" name="attr_character_avatar">
            <div>
                <h3>Pilot Image</h3>
            </div>
        </div>
        <div class="background-info">
            <div class="background-info-upper">
                <div class="info-upper-row">
                    <div class="info-upper-row1">Name: <input type="text" class="infoused" name="attr_character_name"
                            value=""></div>
                    <div class="info-upper-row1">Geneotype: <input type="text" class="infoused" name="attr_geneotype"
                            value=""></div>
                    <div class="info-upper-row1">Gender: <input type="text" class="infoused" name="attr_gender"
                            value="">
                    </div>
                </div>
                <div class="info-upper-row">
                    <div class="info-upper-row1" style="width: fit-content;">
                        Callsign: <input type="text" name="attr_callsign" value="">
                    </div>
                    <div class="info-upper-row1" style="width:  fit-content;">
                        Age: <input type="text" class="digit" name="attr_age" value=""></div>
                    <div class="info-upper-row1" style="width: fit-content;">
                        National Origin: <input type="text" class="" name="attr_national_origin" value="">
                    </div>
                </div>
            </div>
            <div class="background-infolower">
                <div class="infobox">
                    <h3>Lifepath & Motivation</h3>
                    <div>
                        <textarea class="inputarea" name="attr_lifepath"></textarea>
                    </div>
                </div>
                <div class="infobox">
                    <h3>Description</h3>
                    <div>
                        <textarea class="inputarea" name="attr_description"></textarea>
                    </div>

                </div>

                <div class="infobox">
                    <h3>Contacts</h3>
                    <fieldset class="repeating_contacts">
                        <input type="text" class="infoused" name="attr_contact_name">
                        <span class="pull-right">
                            Used:<input type="checkbox" name="attr_contact_exhausted">
                        </span>

                        i:<input type="checkbox" name="attr_contact_hide" class="sheet-toggle-show">
                        <div class="sheet-body">
                            <textarea class="inputarea" name="attr_contact_desc"></textarea>
                        </div>
                        </span>
                    </fieldset>
                </div>
            </div>
        </div>
    </div>
    <div class="attributes">

        <div class="damage-box">
            <div class="">
                <h3>Posture</h3>
                <select name="attr_posture">
                    <option value="stationary">Stationary</option>
                    <option value="braced">Braced</option>
                    <option value="dug_in">-> Dug In</option>
                    <option value="standard" selected>Standard</option>
                    <option value="cautious_move">-> Cautious Move</option>
                    <option value="all_out">All Out</option>
                    <option value="top_speed">-> Top Speed</option>
                </select>
                <button type="action" name="act_initiative_start">Initiative</button>
                : <input type="number" name="attr_initiative" value="0" min="0" class="digit">
                <p>AP:<input type="number" name="attr_action_points" value="1" min="0" class="digit">/ 
                    <input type="number" name="attr_action_points_max" value="1" min="0" class="digit">  
                </p>
                
                <button type="action" name="act_round_start">Start Round</button>
                
                <p>
                    Declare Actions:<select name="attr_action_penalty">
                        <option value="0">0</option>
                        <option value="1" selected>1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                    </select>
                </p>    
                <button type="action" name="act_activation_start">Start Activation</button>

                
                
            </div>
            <h3>Damage Results</h3>
            <div>
                Total:<span type="number" name="attr_damage_total" value="0"> </span>
                [Shell:<span type="number" name="attr_damage_shell" value="0"></span>
                System:<span type="number" name="attr_damage_system" value="0"></span>]
            </div>

            <h4> Damage</h4>
            <fieldset class="repeating_damage">
                <input type="text" name="attr_damage_name" class="infoused">
                -<input type="number" class="digit" name="attr_damage_level" value="0" min="0" max="4">d6
                <div>
                    <span>(<input type="checkbox" name="attr_damage_shell_check"> shell
                        <input type="checkbox" name="attr_damage_system_check"> system) </span>
                    i:<input type="checkbox" name="attr_damage_info" class="sheet-toggle-show" />
                    <div class="sheet-body">
                        Effect:<textarea name="attr_damage_effect" class="inputarea"></textarea>
                        Deterioration:<textarea name="attr_damage_deterioration" class="inputarea"></textarea>
                        Fix:<textarea name="attr_damage_fix" class="inputarea"></textarea>
                    </div>
                </div>
            </fieldset>
            <h4>Damage Notes</h4> <textarea class="inputarea" name="attr_damage_desc" rows="3"></textarea>
        </div>
        <div class="attributes-box">
            <div class="attributes-box-rows">
                <div class="infobox">
                    <h3>Aptitudes</h3>
                    <div>
                        <fieldset class="repeating_aptitudes">
                            <input type="text" class="used" name="attr_aptitudes_name">
                            <input type="checkbox" name="attr_aptitudes_used">
                        </fieldset>
                    </div>
                </div>
                <div class="infobox">
                    <h3>Quirks</h3>
                    <div>
                        <fieldset class="repeating_quirks">
                            <input type="text" class="used" name="attr_quirks_name">
                            <input type="checkbox" name="attr_quirks_used">
                        </fieldset>
                    </div>
                </div>
                <div class="infobox">
                    <h3>Adversities</h3>
                    <div>
                        <fieldset class="repeating_adversities">
                            <input type="text" class="used" name="attr_adversities_name">
                            <input type="checkbox" name="attr_adversities_used">
                        </fieldset>
                    </div>
                </div>
            </div>
            <div class="attributes-box-rows">
                <div class="infobox">
                    <h3>Perks</h3>
                    <div>
                        <fieldset class="repeating_perks">
                            <input class="lvinfoused" type="text" name="attr_perks_name">
                            <input type="number" name="attr_perk_lvl" class="digit" value="0" min="0" max="">
                            <span class="pull-right">
                                Used: <input type="checkbox" name="attr_perk_used">
                            </span>
                            i:<input type="checkbox" name="attr_perk_hide" class="sheet-toggle-show">
                            <div class="sheet-body">
                                <textarea class="inputarea" name="attr_perk_desc"> </textarea>
                            </div>
                        </fieldset>
                    </div>
                </div>

                <div class="infobox">
                    <h3>Flaws</h3>
                    <fieldset class="repeating_flaws">
                        <input type="text" class="lvinfoused" name="attr_flaws_name">
                        <input type="number" name="attr_flaws_lvl" class="digit" value="0" min="0" max="">
                        <span class="pull-right">
                            Used: <input type="checkbox" name="attr_flaws_used">
                        </span>
                        i:<input type="checkbox" name="attr_flaws_hide" class="sheet-toggle-show">
                        <div class="sheet-body">
                            <textarea class="inputarea" name="attr_flaws_desc"> </textarea>
                        </div>
                    </fieldset>
                </div>
            </div>
        </div>

    </div>
    <div class="play-info">
        <div class="inventory">
            <div class="infobox">
                <h3>Personal Inventory</h3>
                <span>Total Burden
                    <span class="pull-right">
                        <span type="number" name="attr_burden_total" value="0"></span>/
                        <input class="digit" type="number" name="attr_burden_total_max" value="8">
                    </span></span>
                <div class="infobox">
                    <h4> <label for="equipment" name="attr_personal_equipment_hide">Equipment.</label> <input
                            type="checkbox" id="equipment" name="attr_personal_equipment_hide" class="sheet-toggle-show"
                            hidden>
                        <span class="pull-right">Burden</span>
                    </h4>
                    <input name="attr_personal_equipment_burden_total" type="number" hidden />
                    <fieldset class="repeating_personal-equipment">
                        <div>
                            <span><input class="infoused" name="attr_personal_equipment_name" type="text"> </span>
                            <span class="pull-right">
                                <input type="number" name="attr_personal_equipment_burden" step="0.25" />
                            </span>
                            <input type="checkbox" name="attr_personal_equipment_hide" class="sheet-toggle-show">

                            <div class="sheet-body">
                                [G] <input type="checkbox" name="attr_personal_equipment_gadget" />
                                [K] <input type="checkbox" name="attr_personal_equipment_kit" />
                                [R] <input type="checkbox" name="attr_personal_equipment_rig" />
                                [S] <input type="checkbox" name="attr_personal_equipment_suit" />
                                Modifiers: <input class="infoused" type="text"
                                    name="attr_personal_equipment_modifiers" />
                                PL:<input name="attr_personal_equipment_pl" type="number">
                                <h5>Notes</h5> <textarea class="inputarea"
                                    name="attr_personal_equipment_desc"></textarea>
                            </div>
                        </div>
                    </fieldset>
                    <input type="checkbox" name="attr_personal_equipment_hide" class="sheet-toggle-show" hidden>
                    <div class="sheet-body">
                        <textarea name="attr_inventory_text" class="inputarea"></textarea>
                    </div>
                </div>
                <h4>Weapons <span class="pull-right">Ammo</span></h4>
                <input name="attr_weapon_burden_total" type="number" value="0" hidden />
                <fieldset class="repeating_weapon">
                    <div><span name="attr_weapon_size"></span>
                        <span>
                            <input type="checkbox" name="attr_weapon_frame_check" class="frame-check" hidden>
                            <span class="no-frame" name="attr_weapon_name">
                            </span>
                            <span class="frame" name="attr_frame_weapon_type"></span>
                            i:<input type="checkbox" name="attr_weapon_hide" class="sheet-toggle-show" checked>
                        </span>
                        <span class="pull-right"> <input type="number" class="digit" name="attr_weapon_ammo">/<span
                                name="attr_weapon_ammo_max"></span></span>
                        <button type="action" name="act_tumble">roll</button>
                    </div>

                    <input type="checkbox" name="attr_weapon_hide" class="sheet-toggle-show" hidden>
                    <div class="sheet-body">
                        Damage: <input type="number" name="attr_weapon_damage">
                        <span class="pull-right">Burden: <input class="digit" type="number" name="attr_weapon_burden"
                                step="0.25"></span>
                        <span>
                            <select name="attr_weapon_size" class="size">
                                <option value="Light" selected>Light</option>
                                <option value="Medium">Medium</option>
                                <option value="Heavy">Heavy</option>
                            </select>
                            <input type="checkbox" name="attr_weapon_frame_check" class="frame-check" hidden>
                            <span class="no-frame"> <input class="infoused" type="text" name="attr_weapon_name"
                                    value="weapon">
                            </span>
                            <span class="frame">
                                <select name="attr_frame_weapon_type" class="size">
                                    <option value="Assault Rifle">Assault Rifle</option>
                                    <option value="Auto Shotgun">Auto Shotgun</option>
                                    <option value="Carbine">Carbine</option>
                                    <option value="Heavy Rifle">Heavy Rifle</option>
                                    <option value="Machine Pistol">Machine Pistol</option>
                                    <option value="Pistol/Revolver">Pistol/Revolver</option>
                                    <option value="Shotgun">Shotgun</option>
                                    <option value="Sniper Rifle">Sniper Rifle</option>
                                </select>
                            </span>
                        </span>

                        <p>Range: <input class="emcalc" style="--index: -11;" type="text" name="attr_weapon_range">
                            <span class="pull-right">Ammo:<input type="number" name="attr_weapon_ammo_max"
                                    class="digit"></span>
                        </p>

                        Frame:<input type="checkbox" name="attr_weapon_frame_check" class="frame-check">
                        Cumbersome:<input type="checkbox" name="attr_weapon_cumbersome">
                        PL: <input type="number" name="attr_weapon_pl" class="digit">
                        <div>Traits: <input class="infoused" type="text" name="attr_weapon_trait"></div>

                        <span>
                            <select name="attr_weapon_domain">
                                <option value="athletics">Athletics</option>
                                <option value="awareness">Awareness</option>
                                <option value="business">Business</option>
                                <option value="craft">Craft</option>
                                <option value="culture">Culture</option>
                                <option value="electronicwarfare">Electronic Warfare</option>
                                <option value="electronics">Electronics</option>
                                <option value="gunnery">Gunnery</option>
                                <option value="hardscience">Hardscience</option>
                                <option value="influence">Influence</option>
                                <option value="institutions">Institutions</option>
                                <option value="investigation">Investigation</option>
                                <option value="mechanics">Mechanics</option>
                                <option value="medicine">Medicine</option>
                                <option value="melee">Melee</option>
                                <option value="pilot">Pilot</option>
                                <option value="showmanship">Showmanship</option>
                                <option value="socialscience">Socialscience</option>
                                <option value="survival">Survival</option>
                                <option value="tactics">Tactics</option>
                            </select>
                            <span type="number" name="attr_weapon_expertise" value="0"></span>
                        </span>
                        <span>Skill:<input type="number" name="attr_skill_level" class="digit" value="0" min="0"
                                max="5">(<input type="checkbox" name="attr_skill_familiar" value="1">F)

                        </span>
                        <textarea class="inputarea" name="attr_weapon_mods"> </textarea>


                    </div>
                    </span>
                </fieldset>
                <h4> Armour</h4>
                <span>Toughness <input type="number" name="attr_toughness" value="2" style="width: 2em;"> Armour <input
                        type="number" name="attr_armour" value="0" style="width: 2em;"> </span>
                <textarea name="attr_armour_desc" class="inputarea" rows="3"></textarea>
            </div>
        </div>
        <div class="skills-misc">
            <input type="checkbox" class="archetype-toggle" name="attr_optional_archetype" hidden />
            <div class="archetype">
                <h3>Archetype</h3>
                <h4> <input type="text" class="" list="archetypelist" name="attr_archetype" value=""
                        style="text-align: center;"><input type="text" name="attr_archetype_rank_letter" value="E"
                        class="digit">-
                    <input type="number" class="digit" min="0" name="attr_archetype_rank" value="0">
                </h4>

                <span>Equipment:<input type="text" name="attr_archetype_equipment" class="infoused" /> </span>
                <div>
                    Resource:<input type="text" class="infoused" name="attr_archetype_resource_name">
                    <input type="number" name="attr_archetype_resource">/<input type="number"
                        name="attr_archetype_resource_max"> Regain <input type="text"
                        name="attr_archetype_resource_regain">
                </div>
                Rules:<fieldset class="repeating_archetype-rules">
                    <input type="text" name="attr_archetype_rules_level">
                    Info: <input type="checkbox" name="attr_archetype_rules" class="sheet-toggle-show">
                    <div class="sheet-body">
                        <textarea class="inputarea" name="attr_archetype_rules_effect"></textarea>
                    </div>
                </fieldset>
            </div>
            <div class="skills">
                <h3>Skills</h3>
                <h4> Bonus <span class="font-d6">f</span>: <input type="number" name="attr_bonus_dice" value="0">
                    TN: <input type="number" name="attr_tn" value="5">
                    Reliable <span class="font-d6">f</span>: <input type="number" name="attr_reliable" value="0">
                    <input type="number" name="attr_tn_bonus" value="0" hidden>
                    <select name="attr_whisper" >
                        <option value="" selected>Public</option>
                        <option value="/w gm ">Whisper</option>
                    </select>
                </h4>
                <div> Athletics :
                    <input type="hidden" name="attr_name_athletics" value="Athletics">
                    <input class="sheet-domains" type="hidden" name="attr_expertise_athletics" value="0">
                    <span class="sheet-domains-0">
                        Expertise: <span type="number" name="attr_expertise_athletics"></span>
                        (Total Skills:<span name="attr_domain_expertise_athletics" value="0"></span>/6)
                    </span>
                    <span class="sheet-domains-1">
                        Expertise: <span type="number" name="attr_expertise_athletics"> </span>
                        Reroll <input type="checkbox" name="attr_expertise_athletics_used">
                        (Total Skills:<span type="number" name="attr_domain_expertise_athletics" value="">
                        </span>/9)</span>
                    <span class="sheet-domains-2">
                        Expertise: <span type="number" name="attr_expertise_athletics"> </span>
                        Reroll: <input type="checkbox" name="attr_expertise_athletics_used">
                        Doubles. (Total Skills:<span type="number" name="attr_domain_expertise_athletics"></span>/13)
                    </span>
                    <span class="sheet-domains-3">
                        Expertise: <span type="number" name="attr_expertise_athletics"> </span>
                        Reroll: <input type="checkbox" name="attr_expertise_athletics_used">
                        Doubles. TB:1
                    </span>
                    <fieldset class="repeating_skills-athletics">
                        <input type="text" name="attr_skill_domain" value="athletics" hidden>
                        <input type="text" name="attr_skill_name" value="" class="em13">
                        (<input type="checkbox" name="attr_skill_familiar" value="1">F)
                        <button type="action" name="act_tumble">Roll</button>
                        Level: <input type="number" name="attr_skill_level" value="0" min="0" max="5">
                        XP:<input type="number" name="attr_skill_xp_stored" value="0">
                        <input type="checkbox" name="attr_skill_xp" value="1">
                    </fieldset>
                </div>
                <div> Awareness :
                    <input type="hidden" name="attr_name_awareness" value="Awareness">
                    <input class="sheet-domains" type="hidden" name="attr_expertise_awareness" value="0">
                    <span class="sheet-domains-0">
                        Expertise: <span type="number" name="attr_expertise_awareness" value=""> </span>
                        (Total Skills:<span type="number" name="attr_domain_expertise_awareness" value="0"> </span>
                        /6)
                    </span>
                    <span class="sheet-domains-1">
                        Expertise: <span type="number" name="attr_expertise_awareness"> </span>
                        Reroll <input type="checkbox" name="attr_expertise_awareness_used">
                        (Total Skills:<span type="number" name="attr_domain_expertise_awareness"></span>/9)
                    </span>
                    <span class="sheet-domains-2">
                        Expertise: <span type="number" name="attr_expertise_awareness"> </span>
                        Reroll: <input type="checkbox" name="attr_expertise_awareness_used">
                        Doubles. (Total Skills:<span type="number" name="attr_domain_expertise_awareness"></span>/13)
                    </span>
                    <span class="sheet-domains-3">
                        Expertise: <span type="number" name="attr_expertise_awareness"> </span>
                        Reroll: <input type="checkbox" name="attr_expertise_awareness_used">
                        Doubles. TB:1
                    </span>
                    <fieldset class="repeating_skills-awareness">
                        <input type="text" name="attr_skill_domain" value="awareness" hidden>
                        <input type="text" name="attr_skill_name" value="" class="em13">
                        (<input type="checkbox" name="attr_skill_familiar" value="1">F)
                        <button type="action" name="act_tumble">Roll</button>
                        Level: <input type="number" name="attr_skill_level" value="0" min="0" max="5">
                        XP:<input type="number" name="attr_skill_xp_stored" value="0">
                        <input type="checkbox" name="attr_skill_xp" value="1">
                    </fieldset>
                </div>

                <div> Business :
                    <input type="text" name="attr_name_business" value="Business" hidden>
                    <input class="sheet-domains" type="hidden" name="attr_expertise_business" value="0">
                    <span class="sheet-domains-0">
                        Expertise: <span type="number" name="attr_expertise_business" value=""> </span>
                        (Total Skills:<span type="number" name="attr_domain_expertise_business" value="0"> </span>
                        /6)
                    </span>
                    <span class="sheet-domains-1">
                        Expertise: <span type="number" name="attr_expertise_business"> </span>
                        Reroll <input type="checkbox" name="attr_expertise_business_used">
                        (Total Skills:<span type="number" name="attr_domain_expertise_business"></span>/9)
                    </span>
                    <span class="sheet-domains-2">
                        Expertise: <span type="number" name="attr_expertise_business"> </span>
                        Reroll: <input type="checkbox" name="attr_expertise_business_used">
                        Doubles. (Total Skills:<span type="number" name="attr_domain_expertise_business">/13) </span>
                    </span>
                    <span class="sheet-domains-3">
                        Expertise: <span type="number" name="attr_expertise_business"> </span>
                        Reroll: <input type="checkbox" name="attr_expertise_business_used">
                        Doubles. TB:1
                    </span>
                    <fieldset class="repeating_skills-business">
                        <input type="text" name="attr_skill_domain" value="business" hidden>
                        <input type="text" name="attr_skill_name" value="" class="em13">
                        (<input type="checkbox" name="attr_skill_familiar" value="1">F)
                        <button type="action" name="act_tumble">Roll</button>
                        Level: <input type="number" name="attr_skill_level" value="0" min="0" max="5">
                        XP:<input type="number" name="attr_skill_xp_stored" value="0">
                        <input type="checkbox" name="attr_skill_xp" value="1">
                    </fieldset>
                </div>

                <div> Craft :
                    <input type="text" name="attr_name_craft" value="Craft" hidden>
                    <input class="sheet-domains" type="hidden" name="attr_expertise_craft" value="0">
                    <span class="sheet-domains-0">
                        Expertise: <span type="number" name="attr_expertise_craft" value=""> </span>
                        (Total Skills:<span type="number" name="attr_domain_expertise_craft" value="0"> </span>
                        /6)
                    </span>
                    <span class="sheet-domains-1">
                        Expertise: <span type="number" name="attr_expertise_craft"> </span>
                        Reroll <input type="checkbox" name="attr_expertise_craft_used">
                        (Total Skills:<span type="number" name="attr_domain_expertise_craft" value=""> </span>/9)</span>
                    <span class="sheet-domains-2">
                        Expertise: <span type="number" name="attr_expertise_craft"> </span>
                        Reroll: <input type="checkbox" name="attr_expertise_craft_used">
                        Doubles. (Total Skills:<span type="number" name="attr_domain_expertise_craft" value="">
                        </span>/13)
                    </span>
                    <span class="sheet-domains-3">
                        Expertise: <span type="number" name="attr_expertise_craft"> </span>
                        Reroll: <input type="checkbox" name="attr_expertise_craft_used">
                        Doubles. TB:1
                    </span>
                    <fieldset class="repeating_skills-craft">
                        <input type="text" name="attr_skill_domain" value="craft" hidden>
                        <input type="text" name="attr_skill_name" value="" class="em13">
                        (<input type="checkbox" name="attr_skill_familiar" value="1">F)
                        <button type="action" name="act_tumble">Roll</button>
                        Level: <input type="number" name="attr_skill_level" value="0" min="0" max="5">
                        XP:<input type="number" name="attr_skill_xp_stored" value="0">
                        <input type="checkbox" name="attr_skill_xp" value="1">
                    </fieldset>
                </div>

                <div> Culture :
                    <input type="text" name="attr_name_culture" value="Culture" hidden>
                    <input class="sheet-domains" type="hidden" name="attr_expertise_culture" value="0">
                    <span class="sheet-domains-0">
                        Expertise: <span type="number" name="attr_expertise_culture" value=""> </span>
                        (Total Skills:<span type="number" name="attr_domain_expertise_culture" value="0"> </span>
                        /6)
                    </span>
                    <span class="sheet-domains-1">
                        Expertise: <span type="number" name="attr_expertise_culture"> </span>
                        Reroll <input type="checkbox" name="attr_expertise_culture_used">
                        (Total Skills:<span type="number" name="attr_domain_expertise_culture" value="">
                        </span>/9)</span>
                    <span class="sheet-domains-2">
                        Expertise: <span type="number" name="attr_expertise_culture"> </span>
                        Reroll: <input type="checkbox" name="attr_expertise_culture_used">
                        Doubles. (Total Skills:<span type="number" name="attr_domain_expertise_culture">/13) </span>
                    </span>
                    <span class="sheet-domains-3">
                        Expertise: <span type="number" name="attr_expertise_culture"> </span>
                        Reroll: <input type="checkbox" name="attr_expertise_culture_used">
                        Doubles. TB:1
                    </span>
                    <fieldset class="repeating_skills-culture">
                        <input type="text" name="attr_skill_domain" value="culture" hidden>
                        <input type="text" name="attr_skill_name" value="" class="em13">
                        (<input type="checkbox" name="attr_skill_familiar" value="1">F)
                        <button type="action" name="act_tumble">Roll</button>
                        Level: <input type="number" name="attr_skill_level" value="0" min="0" max="5">
                        XP:<input type="number" name="attr_skill_xp_stored" value="0">
                        <input type="checkbox" name="attr_skill_xp" value="1">
                    </fieldset>
                </div>

                <div> Electronic Warfare :
                    <input type="text" name="attr_name_electronicwarfare" value="Electronic Warfare" hidden>
                    <input class="sheet-domains" type="hidden" name="attr_expertise_electronicwarfare" value="0">
                    <span class="sheet-domains-0">
                        Expertise: <span type="number" name="attr_expertise_electronicwarfare" value=""> </span>
                        (Total Skills:<span type="number" name="attr_domain_expertise_electronicwarfare" value="">
                        </span>
                        /6)
                    </span>
                    <span class="sheet-domains-1">
                        Expertise: <span type="number" name="attr_expertise_electronicwarfare"> </span>
                        Reroll <input type="checkbox" name="attr_expertise_electronicwarfare_used">
                        (Total Skills:<span type="number" name="attr_domain_expertise_electronicwarfare" value="">
                        </span>/9)</span>
                    <span class="sheet-domains-2">
                        Expertise: <span type="number" name="attr_expertise_electronicwarfare"> </span>
                        Reroll: <input type="checkbox" name="attr_expertise_electronicwarfare_used">
                        Doubles. (Total Skills:<span type="number"
                            name="attr_domain_expertise_electronicwarfare"></span>
                        /13)
                    </span>
                    <span class="sheet-domains-3">
                        Expertise: <span type="number" name="attr_expertise_electronicwarfare"> </span>
                        Reroll: <input type="checkbox" name="attr_expertise_electronicwarfare_used">
                        Doubles. TB:1
                    </span>
                    <fieldset class="repeating_skills-electronicwarfare">
                        <input type="text" name="attr_skill_domain" value="electronicwarfare" hidden>
                        <input type="text" name="attr_skill_name" value="" class="em13">
                        (<input type="checkbox" name="attr_skill_familiar" value="1">F)
                        <button type="action" name="act_tumble">Roll</button>
                        Level: <input type="number" name="attr_skill_level" value="0" min="0" max="5">
                        XP:<input type="number" name="attr_skill_xp_stored" value="0">
                        <input type="checkbox" name="attr_skill_xp" value="1">
                    </fieldset>
                </div>

                <div> Electronics :
                    <input type="text" name="attr_name_electronics" value="Electronics" hidden>
                    <input class="sheet-domains" type="hidden" name="attr_expertise_electronics" value="0">
                    <span class="sheet-domains-0">
                        Expertise: <span type="number" name="attr_expertise_electronics" value=""> </span>
                        (Total Skills:<span type="number" name="attr_domain_expertise_electronics" value="0"> </span>
                        /6)
                    </span>
                    <span class="sheet-domains-1">
                        Expertise: <span type="number" name="attr_expertise_electronics"> </span>
                        Reroll <input type="checkbox" name="attr_expertise_electronics_used">
                        (Total Skills:<span type="number" name="attr_domain_expertise_electronics"></span>/9)
                    </span>
                    <span class="sheet-domains-2">
                        Expertise: <span type="number" name="attr_expertise_electronics"> </span>
                        Reroll: <input type="checkbox" name="attr_expertise_electronics_used">
                        Doubles. (Total Skills:<span type="number" name="attr_domain_expertise_electronics"></span>/13)
                    </span>
                    <span class="sheet-domains-3">
                        Expertise: <span type="number" name="attr_expertise_electronics"> </span>
                        Reroll: <input type="checkbox" name="attr_expertise_electronics_used">
                        Doubles. TB:1
                    </span>
                    <fieldset class="repeating_skills-electronics">
                        <input type="text" name="attr_skill_domain" value="electronics" hidden>
                        <input type="text" name="attr_skill_name" value="" class="em13">
                        (<input type="checkbox" name="attr_skill_familiar" value="1">F)
                        <button type="action" name="act_tumble">Roll</button>
                        Level: <input type="number" name="attr_skill_level" value="0" min="0" max="5">
                        XP:<input type="number" name="attr_skill_xp_stored" value="0">
                        <input type="checkbox" name="attr_skill_xp" value="1">
                    </fieldset>
                </div>

                <div> Gunnery :
                    <input type="text" name="attr_name_gunnery" value="Gunnery" hidden>
                    <input class="sheet-domains" type="hidden" name="attr_expertise_gunnery" value="0">
                    <span class="sheet-domains-0">
                        Expertise: <span type="number" name="attr_expertise_gunnery" value=""> </span>
                        (Total Skills:<span type="number" name="attr_domain_expertise_gunnery" value="0"> </span>
                        /6)
                    </span>
                    <span class="sheet-domains-1">
                        Expertise: <span type="number" name="attr_expertise_gunnery"> </span>
                        Reroll <input type="checkbox" name="attr_expertise_gunnery_used">
                        (Total Skills:<span type="number" name="attr_domain_expertise_gunnery" value="">
                        </span>/9)</span>
                    <span class="sheet-domains-2">
                        Expertise: <span type="number" name="attr_expertise_gunnery"> </span>
                        Reroll: <input type="checkbox" name="attr_expertise_gunnery_used">
                        Doubles. (Total Skills:<span type="number" name="attr_domain_expertise_gunnery">/13) </span>
                    </span>
                    <span class="sheet-domains-3">
                        Expertise: <span type="number" name="attr_expertise_gunnery"> </span>
                        Reroll: <input type="checkbox" name="attr_expertise_gunnery_used">
                        Doubles. TB:1
                    </span>
                    <fieldset class="repeating_skills-gunnery">
                        <input type="text" name="attr_skill_domain" value="gunnery" hidden>
                        <input type="text" name="attr_skill_name" value="" class="em13">
                        (<input type="checkbox" name="attr_skill_familiar" value="1">F)
                        <button type="action" name="act_tumble">Roll</button>
                        Level: <input type="number" name="attr_skill_level" value="0" min="0" max="5">
                        XP:<input type="number" name="attr_skill_xp_stored" value="0">
                        <input type="checkbox" name="attr_skill_xp" value="1">
                    </fieldset>
                </div>

                <div> Hard Science :
                    <input type="text" name="attr_name_hardscience" value="Hard Science" hidden>
                    <input class="sheet-domains" type="hidden" name="attr_expertise_hardscience" value="0">
                    <span class="sheet-domains-0">
                        Expertise: <span type="number" name="attr_expertise_hardscience" value=""> </span>
                        (Total Skills:<span type="number" name="attr_domain_expertise_hardscience" value="0"> </span>
                        /6)
                    </span>
                    <span class="sheet-domains-1">
                        Expertise: <span type="number" name="attr_expertise_hardscience"> </span>
                        Reroll <input type="checkbox" name="attr_expertise_hardscience_used">
                        (Total Skills:<span type="number" name="attr_domain_expertise_hardscience"></span>/9)
                    </span>
                    <span class="sheet-domains-2">
                        Expertise: <span type="number" name="attr_expertise_hardscience"> </span>
                        Reroll: <input type="checkbox" name="attr_expertise_hardscience_used">
                        Doubles. (Total Skills:<span type="number" name="attr_domain_expertise_hardscience"></span>/13)
                    </span>
                    <span class="sheet-domains-3">
                        Expertise: <span type="number" name="attr_expertise_hardscience"> </span>
                        Reroll: <input type="checkbox" name="attr_expertise_hardscience_used">
                        Doubles. TB:1
                    </span>
                    <fieldset class="repeating_skills-hardscience">
                        <input type="text" name="attr_skill_domain" value="hardscience" hidden>
                        <input type="text" name="attr_skill_name" value="" class="em13">
                        (<input type="checkbox" name="attr_skill_familiar" value="1">F)
                        <button type="action" name="act_tumble">Roll</button>
                        Level: <input type="number" name="attr_skill_level" value="0" min="0" max="5">
                        XP:<input type="number" name="attr_skill_xp_stored" value="0">
                        <input type="checkbox" name="attr_skill_xp" value="1">
                    </fieldset>
                </div>

                <div> Influence :
                    <input type="text" name="attr_name_influence" value="Influence" hidden>
                    <input class="sheet-domains" type="hidden" name="attr_expertise_influence" value="0">
                    <span class="sheet-domains-0">
                        Expertise: <span type="number" name="attr_expertise_influence" value=""> </span>
                        (Total Skills:<span type="number" name="attr_domain_expertise_influence" value="0"> </span>
                        /6)
                    </span>
                    <span class="sheet-domains-1">
                        Expertise: <span type="number" name="attr_expertise_influence"> </span>
                        Reroll <input type="checkbox" name="attr_expertise_influence_used">
                        (Total Skills:<span type="number" name="attr_domain_expertise_influence"></span>/9)
                    </span>
                    <span class="sheet-domains-2">
                        Expertise: <span type="number" name="attr_expertise_influence"> </span>
                        Reroll: <input type="checkbox" name="attr_expertise_influence_used">
                        Doubles. (Total Skills:<span type="number" name="attr_domain_expertise_influence"></span>/13)
                    </span>
                    <span class="sheet-domains-3">
                        Expertise: <span type="number" name="attr_expertise_influence"> </span>
                        Reroll: <input type="checkbox" name="attr_expertise_influence_used">
                        Doubles. TB:1
                    </span>
                    <fieldset class="repeating_skills-influence">
                        <input type="text" name="attr_skill_domain" value="influence" hidden>
                        <input type="text" name="attr_skill_name" value="" class="em13">
                        (<input type="checkbox" name="attr_skill_familiar" value="1">F)
                        <button type="action" name="act_tumble">Roll</button>
                        Level: <input type="number" name="attr_skill_level" value="0" min="0" max="5">
                        XP:<input type="number" name="attr_skill_xp_stored" value="0">
                        <input type="checkbox" name="attr_skill_xp" value="1">
                    </fieldset>
                </div>

                <div> Institutions :
                    <input type="text" name="attr_name_institutions" value="Institutions" hidden>
                    <input class="sheet-domains" type="hidden" name="attr_expertise_institutions" value="0">
                    <span class="sheet-domains-0">
                        Expertise: <span type="number" name="attr_expertise_institutions" value=""> </span>
                        (Total Skills:<span type="number" name="attr_domain_expertise_institutions" value="0"> </span>
                        /6)
                    </span>
                    <span class="sheet-domains-1">
                        Expertise: <span type="number" name="attr_expertise_institutions"> </span>
                        Reroll <input type="checkbox" name="attr_expertise_institutions_used">
                        (Total Skills:<span type="number" name="attr_domain_expertise_institutions"></span>/9)
                    </span>
                    <span class="sheet-domains-2">
                        Expertise: <span type="number" name="attr_expertise_institutions"> </span>
                        Reroll: <input type="checkbox" name="attr_expertise_institutions_used">
                        Doubles. (Total Skills:<span type="number" name="attr_domain_expertise_institutions"></span>/13)
                    </span>
                    <span class="sheet-domains-3">
                        Expertise: <span type="number" name="attr_expertise_institutions"> </span>
                        Reroll: <input type="checkbox" name="attr_expertise_institutions_used">
                        Doubles. TB:1
                    </span>
                    <fieldset class="repeating_skills-institutions">
                        <input type="text" name="attr_skill_domain" value="institutions" hidden>
                        <input type="text" name="attr_skill_name" value="" class="em13">
                        (<input type="checkbox" name="attr_skill_familiar" value="1">F)
                        <button type="action" name="act_tumble">Roll</button>
                        Level: <input type="number" name="attr_skill_level" value="0" min="0" max="5">
                        XP:<input type="number" name="attr_skill_xp_stored" value="0">
                        <input type="checkbox" name="attr_skill_xp" value="1">
                    </fieldset>
                </div>

                <div> Investigation :
                    <input type="text" name="attr_name_investigation" value="Investigation" hidden>
                    <input class="sheet-domains" type="hidden" name="attr_expertise_investigation" value="0">
                    <span class="sheet-domains-0">
                        Expertise: <span type="number" name="attr_expertise_investigation" value=""> </span>
                        (Total Skills:<span type="number" name="attr_domain_expertise_investigation" value="0"> </span>
                        /6)
                    </span>
                    <span class="sheet-domains-1">
                        Expertise: <span type="number" name="attr_expertise_investigation"> </span>
                        Reroll <input type="checkbox" name="attr_expertise_investigation_used">
                        (Total Skills:<span type="number" name="attr_domain_expertise_investigation" value=""></span>/9)
                    </span>
                    <span class="sheet-domains-2">
                        Expertise: <span type="number" name="attr_expertise_investigation"> </span>
                        Reroll: <input type="checkbox" name="attr_expertise_investigation_used">
                        Doubles. (Total Skills:<span type="number"
                            name="attr_domain_expertise_investigation"></span>/13)
                    </span>
                    <span class="sheet-domains-3">
                        Expertise: <span type="number" name="attr_expertise_investigation"> </span>
                        Reroll: <input type="checkbox" name="attr_expertise_investigation_used">
                        Doubles. TB:1
                    </span>
                    <fieldset class="repeating_skills-investigation">
                        <input type="text" name="attr_skill_domain" value="investigation" hidden>
                        <input type="text" name="attr_skill_name" value="" class="em13">
                        (<input type="checkbox" name="attr_skill_familiar" value="1">F)
                        <button type="action" name="act_tumble">Roll</button>
                        Level: <input type="number" name="attr_skill_level" value="0" min="0" max="5">
                        XP:<input type="number" name="attr_skill_xp_stored" value="0">
                        <input type="checkbox" name="attr_skill_xp" value="1">
                    </fieldset>
                </div>

                <div> Mechanics :
                    <input type="text" name="attr_name_mechanics" value="Mechanics" hidden>
                    <input class="sheet-domains" type="hidden" name="attr_expertise_mechanics" value="0">
                    <span class="sheet-domains-0">
                        Expertise: <span type="number" name="attr_expertise_mechanics" value=""> </span>
                        (Total Skills:<span type="number" name="attr_domain_expertise_mechanics" value="0"> </span>
                        /6)
                    </span>
                    <span class="sheet-domains-1">
                        Expertise: <span type="number" name="attr_expertise_mechanics"> </span>
                        Reroll <input type="checkbox" name="attr_expertise_mechanics_used">
                        (Total Skills:<span type="number" name="attr_domain_expertise_mechanics"></span>/9)
                    </span>
                    <span class="sheet-domains-2">
                        Expertise: <span type="number" name="attr_expertise_mechanics"> </span>
                        Reroll: <input type="checkbox" name="attr_expertise_mechanics_used">
                        Doubles. (Total Skills:<span type="number" name="attr_domain_expertise_mechanics"></span>/13)
                    </span>
                    <span class="sheet-domains-3">
                        Expertise: <span type="number" name="attr_expertise_mechanics"> </span>
                        Reroll: <input type="checkbox" name="attr_expertise_mechanics_used">
                        Doubles. TB:1
                    </span>
                    <fieldset class="repeating_skills-mechanics">
                        <input type="text" name="attr_skill_domain" value="mechanics" hidden>
                        <input type="text" name="attr_skill_name" value="" class="em13">
                        (<input type="checkbox" name="attr_skill_familiar" value="1">F)
                        <button type="action" name="act_tumble">Roll</button>
                        Level: <input type="number" name="attr_skill_level" value="0" min="0" max="5">
                        XP:<input type="number" name="attr_skill_xp_stored" value="0">
                        <input type="checkbox" name="attr_skill_xp" value="1">
                    </fieldset>
                </div>

                <div> Medicine :
                    <input type="text" name="attr_name_medicine" value="Medicine" hidden>
                    <input class="sheet-domains" type="hidden" name="attr_expertise_medicine" value="0">
                    <span class="sheet-domains-0">
                        Expertise: <span type="number" name="attr_expertise_medicine" value=""> </span>
                        (Total Skills:<span type="number" name="attr_domain_expertise_medicine" value="0"> </span>
                        /6)
                    </span>
                    <span class="sheet-domains-1">
                        Expertise: <span type="number" name="attr_expertise_medicine"> </span>
                        Reroll <input type="checkbox" name="attr_expertise_medicine_used">
                        (Total Skills:<span type="number" name="attr_domain_expertise_medicine"></span>/9)
                    </span>
                    <span class="sheet-domains-2">
                        Expertise: <span type="number" name="attr_expertise_medicine"> </span>
                        Reroll: <input type="checkbox" name="attr_expertise_medicine_used">
                        Doubles. (Total Skills:<span type="number" name="attr_domain_expertise_medicine">/13) </span>
                    </span>
                    <span class="sheet-domains-3">
                        Expertise: <span type="number" name="attr_expertise_medicine"> </span>
                        Reroll: <input type="checkbox" name="attr_expertise_medicine_used">
                        Doubles. TB:1
                    </span>
                    <fieldset class="repeating_skills-medicine">
                        <input type="text" name="attr_skill_domain" value="medicine" hidden>
                        <input type="text" name="attr_skill_name" value="" class="em13">
                        (<input type="checkbox" name="attr_skill_familiar" value="1">F)
                        <button type="action" name="act_tumble">Roll</button>
                        Level: <input type="number" name="attr_skill_level" value="0" min="0" max="5">
                        XP:<input type="number" name="attr_skill_xp_stored" value="0">
                        <input type="checkbox" name="attr_skill_xp" value="1">
                    </fieldset>
                </div>

                <div> Melee :
                    <input type="text" name="attr_name_melee" value="Melee" hidden>
                    <input class="sheet-domains" type="hidden" name="attr_expertise_melee" value="0">
                    <span class="sheet-domains-0">
                        Expertise: <span type="number" name="attr_expertise_melee" value=""> </span>
                        (Total Skills:<span type="number" name="attr_domain_expertise_melee" value="0"> </span>
                        /6)
                    </span>
                    <span class="sheet-domains-1">
                        Expertise: <span type="number" name="attr_expertise_melee"> </span>
                        Reroll <input type="checkbox" name="attr_expertise_melee_used">
                        (Total Skills:<span type="number" name="attr_domain_expertise_melee" value=""> </span>/9)</span>
                    <span class="sheet-domains-2">
                        Expertise: <span type="number" name="attr_expertise_melee"> </span>
                        Reroll: <input type="checkbox" name="attr_expertise_melee_used">
                        Doubles. (Total Skills:<span type="number" name="attr_domain_expertise_melee" value="">
                        </span>/13)
                    </span>
                    <span class="sheet-domains-3">
                        Expertise: <span type="number" name="attr_expertise_melee"> </span>
                        Reroll: <input type="checkbox" name="attr_expertise_melee_used">
                        Doubles. TB:1
                    </span>
                    <fieldset class="repeating_skills-melee">
                        <input type="text" name="attr_skill_domain" value="melee" hidden>
                        <input type="text" name="attr_skill_name" value="" class="em13">
                        (<input type="checkbox" name="attr_skill_familiar" value="1">F)
                        <button type="action" name="act_tumble">Roll</button>
                        Level: <input type="number" name="attr_skill_level" value="0" min="0" max="5">
                        XP:<input type="number" name="attr_skill_xp_stored" value="0">
                        <input type="checkbox" name="attr_skill_xp" value="1">
                    </fieldset>
                </div>

                <div> Pilot :
                    <input type="text" name="attr_name_pilot" value="Pilot" hidden>
                    <input class="sheet-domains" type="hidden" name="attr_expertise_pilot" value="0">
                    <span class="sheet-domains-0">
                        Expertise: <span type="number" name="attr_expertise_pilot" value=""> </span>
                        (Total Skills:<span type="number" name="attr_domain_expertise_pilot" value="0"> </span>
                        /6)
                    </span>
                    <span class="sheet-domains-1">
                        Expertise: <span type="number" name="attr_expertise_pilot"> </span>
                        Reroll <input type="checkbox" name="attr_expertise_pilot_used">
                        (Total Skills:<span type="number" name="attr_domain_expertise_pilot" value=""> </span>/9)</span>
                    <span class="sheet-domains-2">
                        Expertise: <span type="number" name="attr_expertise_pilot"> </span>
                        Reroll: <input type="checkbox" name="attr_expertise_pilot_used">
                        Doubles. (Total Skills:<span type="number" name="attr_domain_expertise_pilot" value="">
                        </span>/13)
                    </span>
                    <span class="sheet-domains-3">
                        Expertise: <span type="number" name="attr_expertise_pilot"> </span>
                        Reroll: <input type="checkbox" name="attr_expertise_pilot_used">
                        Doubles. TB:1
                    </span>
                    <fieldset class="repeating_skills-pilot">
                        <input type="text" name="attr_skill_domain" value="pilot" hidden>
                        <input type="text" name="attr_skill_name" value="" class="em13">
                        (<input type="checkbox" name="attr_skill_familiar" value="1">F)
                        <button type="action" name="act_tumble">Roll</button>
                        Level: <input type="number" name="attr_skill_level" value="0" min="0" max="5">
                        XP:<input type="number" name="attr_skill_xp_stored" value="0">
                        <input type="checkbox" name="attr_skill_xp" value="1">
                    </fieldset>
                </div>

                <div> Showmanship :
                    <input type="text" name="attr_name_showmanship" value="Showmanship" hidden>
                    <input class="sheet-domains" type="hidden" name="attr_expertise_showmanship" value="0">
                    <span class="sheet-domains-0">
                        Expertise: <span type="number" name="attr_expertise_showmanship" value=""> </span>
                        (Total Skills:<span type="number" name="attr_domain_expertise_showmanship" value="0"> </span>
                        /6)
                    </span>
                    <span class="sheet-domains-1">
                        Expertise: <span type="number" name="attr_expertise_showmanship"> </span>
                        Reroll <input type="checkbox" name="attr_expertise_showmanship_used">
                        (Total Skills:<span type="number" name="attr_domain_expertise_showmanship"></span>/9)
                    </span>
                    <span class="sheet-domains-2">
                        Expertise: <span type="number" name="attr_expertise_showmanship"> </span>
                        Reroll: <input type="checkbox" name="attr_expertise_showmanship_used">
                        Doubles. (Total Skills:<span type="number" name="attr_domain_expertise_showmanship"></span>/13)
                    </span>
                    <span class="sheet-domains-3">
                        Expertise: <span type="number" name="attr_expertise_showmanship"> </span>
                        Reroll: <input type="checkbox" name="attr_expertise_showmanship_used">
                        Doubles. TB:1
                    </span>
                    <fieldset class="repeating_skills-showmanship">
                        <input type="text" name="attr_skill_domain" value="showmanship" hidden>
                        <input type="text" name="attr_skill_name" value="" class="em13">
                        (<input type="checkbox" name="attr_skill_familiar" value="1">F)
                        <button type="action" name="act_tumble">Roll</button>
                        Level: <input type="number" name="attr_skill_level" value="0" min="0" max="5">
                        XP:<input type="number" name="attr_skill_xp_stored" value="0">
                        <input type="checkbox" name="attr_skill_xp" value="1">
                    </fieldset>
                </div>

                <div> Social Science :
                    <input type="text" name="attr_name_socialscience" value="Social Science" hidden>
                    <input class="sheet-domains" type="hidden" name="attr_expertise_socialscience" value="0">
                    <span class="sheet-domains-0">
                        Expertise: <span type="number" name="attr_expertise_socialscience" value=""> </span>
                        (Total Skills:<span type="number" name="attr_domain_expertise_socialscience" value="0"> </span>
                        /6)
                    </span>
                    <span class="sheet-domains-1">
                        Expertise: <span type="number" name="attr_expertise_socialscience"> </span>
                        Reroll <input type="checkbox" name="attr_expertise_socialscience_used">
                        (Total Skills:<span type="number" name="attr_domain_expertise_socialscience" value=""></span>/9)
                    </span>
                    <span class="sheet-domains-2">
                        Expertise: <span type="number" name="attr_expertise_socialscience"> </span>
                        Reroll: <input type="checkbox" name="attr_expertise_socialscience_used">
                        Doubles. (Total Skills:<span type="number"
                            name="attr_domain_expertise_socialscience"></span>/13)
                    </span>
                    <span class="sheet-domains-3">
                        Expertise: <span type="number" name="attr_expertise_socialscience"> </span>
                        Reroll: <input type="checkbox" name="attr_expertise_socialscience_used">
                        Doubles. TB:1
                    </span>
                    <fieldset class="repeating_skills-socialscience">
                        <input type="text" name="attr_skill_domain" value="socialscience" hidden>
                        <input type="text" name="attr_skill_name" value="" class="em13">
                        (<input type="checkbox" name="attr_skill_familiar" value="1">F)
                        <button type="action" name="act_tumble">Roll</button>
                        Level: <input type="number" name="attr_skill_level" value="0" min="0" max="5">
                        XP:<input type="number" name="attr_skill_xp_stored" value="0">
                        <input type="checkbox" name="attr_skill_xp" value="1">
                    </fieldset>
                </div>

                <div> Survival :
                    <input type="text" name="attr_name_survival" value="Survival" hidden>
                    <input class="sheet-domains" type="hidden" name="attr_expertise_survival" value="0">
                    <span class="sheet-domains-0">
                        Expertise: <span type="number" name="attr_expertise_survival" value=""> </span>
                        (Total Skills:<span type="number" name="attr_domain_expertise_survival" value="0"> </span>
                        /6)
                    </span>
                    <span class="sheet-domains-1">
                        Expertise: <span type="number" name="attr_expertise_survival"> </span>
                        Reroll <input type="checkbox" name="attr_expertise_survival_used">
                        (Total Skills:<span type="number" name="attr_domain_expertise_survival"></span>/9)
                    </span>
                    <span class="sheet-domains-2">
                        Expertise: <span type="number" name="attr_expertise_survival"> </span>
                        Reroll: <input type="checkbox" name="attr_expertise_survival_used">
                        Doubles. (Total Skills:<span type="number" name="attr_domain_expertise_survival">/13) </span>
                    </span>
                    <span class="sheet-domains-3">
                        Expertise: <span type="number" name="attr_expertise_survival"> </span>
                        Reroll: <input type="checkbox" name="attr_expertise_survival_used">
                        Doubles. TB:1
                    </span>
                    <fieldset class="repeating_skills-survival">
                        <input type="text" name="attr_skill_domain" value="survival" hidden>
                        <input type="text" name="attr_skill_name" value="" class="em13">
                        (<input type="checkbox" name="attr_skill_familiar" value="1">F)
                        <button type="action" name="act_tumble">Roll</button>
                        Level: <input type="number" name="attr_skill_level" value="0" min="0" max="5">
                        XP:<input type="number" name="attr_skill_xp_stored" value="0">
                        <input type="checkbox" name="attr_skill_xp" value="1">
                    </fieldset>
                </div>

                <div> Tactics :
                    <input type="text" name="attr_name_tactics" value="Tactics" hidden>
                    <input class="sheet-domains" type="hidden" name="attr_expertise_tactics" value="0">
                    <span class="sheet-domains-0">
                        Expertise: <span type="number" name="attr_expertise_tactics" value=""> </span>
                        (Total Skills:<span type="number" name="attr_domain_expertise_tactics" value="0"> </span>
                        /6)
                    </span>
                    <span class="sheet-domains-1">
                        Expertise: <span type="number" name="attr_expertise_tactics"> </span>
                        Reroll <input type="checkbox" name="attr_expertise_tactics_used">
                        (Total Skills:<span type="number" name="attr_domain_expertise_tactics" value="">
                        </span>/9)</span>
                    <span class="sheet-domains-2">
                        Expertise: <span type="number" name="attr_expertise_tactics"> </span>
                        Reroll: <input type="checkbox" name="attr_expertise_tactics_used">
                        Doubles. (Total Skills:<span type="number" name="attr_domain_expertise_tactics">/13) </span>
                    </span>
                    <span class="sheet-domains-3">
                        Expertise: <span type="number" name="attr_expertise_tactics"> </span>
                        Reroll: <input type="checkbox" name="attr_expertise_tactics_used">
                        Doubles. TB:1
                    </span>
                    <fieldset class="repeating_skills-tactics">
                        <input type="text" name="attr_skill_domain" value="tactics" hidden>
                        <input type="text" name="attr_skill_name" value="" class="em13">
                        (<input type="checkbox" name="attr_skill_familiar" value="1">F)
                        <button type="action" name="act_tumble">Roll</button>
                        Level: <input type="number" name="attr_skill_level" value="0" min="0" max="5">
                        XP:<input type="number" name="attr_skill_xp_stored" value="0">
                        <input type="checkbox" name="attr_skill_xp" value="1">
                    </fieldset>
                    <span>Total Skills:<span type="number" name="attr_skill_total" value="0"> </span></span>

                </div>
            </div>
            <div class="infobox">
                <h3>Misc </h3>
                <textarea name="attr_notes_desc" class="inputarea"></textarea>
            </div>
        </div>
    </div>
</div>

<div class="sheet-gear">
    Gear sheet
    <div class="background-info" id="gear1">
        <div>
            Name:<input type="text" name="attr_gear_name">
            Model:<input type="text" name="attr_gear_model">
            PL:<input type="number" name="attr_gearPL">
            TV:<input type="number" name="attr_gear_tv">
        </div>
        <div>
            Actor Type: <input type="text" name="attr_gear_actor_type">
            Height: <input type="number" name="attr_gear_height" step=".5">in
        </div>
        <div>
            Crew:<input type="number" name="attr_gear_crew">
            Movement Rate (MR):<input type="text" name="attr_gear_mr" class="em13">
            Armour (Arm):<input type="number" name="attr_gear_arm">
            Hull Integrity (HI):<input type="number" name="attr_gear_hi" value="0">
        </div>
        <div class="no-buttons">
            <div class="background">
                <h4>TN Bonus: </h4>
                <div class="infobox">
                    <span>Gunnery (GU): <input type="number" name="attr_gear_gunnery_base" class="digit">
                        Total:<span type="number" name="attr_gear_gunnery" class="digit"></span>
                    </span>

                    Skills
                    <fieldset class="repeating_skills-gunnery">
                        <input type="text" name="attr_skill_domain" value="gunnery" hidden>
                        <span type="text" name="attr_skill_name" value=""> </span>
                        <button type="action" name="act_geartumble">Roll</button>
                        Lv:<span type="number" name="attr_skill_level"> </span>
                        XP:<input type="checkbox" name="attr_skill_xp" value="1">
                    </fieldset>
                </div>
                <div class="infobox">
                    <span>Pilot (PI): <input type="number" name="attr_gear_pilot_base" class="digit">
                        Total: <span type="number" name="attr_gear_pilot" class="digit"> </span>
                    </span>
                    Skills:
                    <fieldset class="repeating_skills-pilot">
                        <input type="text" name="attr_skill_domain" value="pilot" hidden>
                        <span type="text" name="attr_skill_name" value=""> </span>
                        <button type="action" name="act_geartumble">Roll</button>
                        Lv:<span type="number" name="attr_skill_level"></span>
                        XP:<input type="checkbox" name="attr_skill_xp" value="1">
                    </fieldset>
                </div>
                <div class="infobox">
                    <span>Electronic Warfare (EW): <input type="number" name="attr_gear_electronicwarfare_base"
                            class="digit">
                        Total: <span type="number" name="attr_gear_electronicwarfare" class="digit"></span>
                    </span>
                    Skills
                    <fieldset class="repeating_skills-electronicwarfare">
                        <input type="text" name="attr_skill_domain" value="electronicwarfare" hidden>
                        <span type="text" name="attr_skill_name"></span>
                        <button type="action" name="act_geartumble">Roll</button>
                        Lv:<span type="number" name="attr_skill_level"> </span>
                        XP:<input type="checkbox" name="attr_skill_xp" value="1">
                    </fieldset>
                </div>

            </div>
        </div>



    </div>
    <div class="attributes" id="gear2">
        <div class="damage-box" id="gear2damage">
            <div class="">
                <h3>Posture</h3>
                <select name="attr_posture">
                    <option value="stationary">Stationary</option>
                    <option value="braced">Braced</option>
                    <option value="dug_in">-> Dug In</option>
                    <option value="standard" selected>Standard</option>
                    <option value="cautious_move">-> Cautious Move</option>
                    <option value="all_out">All Out</option>
                    <option value="top_speed">-> Top Speed</option>
                </select>
                <button type="action" name="act_initiative_start">Initiative</button>
                : <input type="number" name="attr_initiative" value="0" min="0" class="digit">
                <p>AP:<input type="number" name="attr_action_points" value="1" min="0" class="digit">/ 
                    <input type="number" name="attr_action_points_max" value="1" min="0" class="digit">  
                </p>
                
                <button type="action" name="act_round_start">Start Round</button>
                
                <p>
                    Declare Actions:<select name="attr_action_penalty">
                        <option value="0">0</option>
                        <option value="1" selected>1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                    </select>
                </p>    
                <button type="action" name="act_activation_start">Start Activation</button>
            </div>
            <h3> Damage results </h3>
            <span>Hull Integrity(<span type="number" name="attr_gear_damage_total"></span>/<span type="number"
                    name="attr_gear_hi"></span>) </span>
            <div>
                <fieldset class="repeating_gear-damage">
                    <span> <input type="text" class="infoused" name="attr_gear_damage_name">
                        -<input type="number" class="digit" name="attr_gear_damage_level" value="0" min="0"
                            style="width: 2em;">d6
                        <input type="checkbox" name="attr_gear_damage_info" class="sheet-toggle-show" />
                        <div class="sheet-body">
                            Hull Integrity Damage:<input type="checkbox" name="attr_gear_damage_integrity" value="1"
                                checked>
                            Effect:<textarea class="inputarea" name="attr_gear_damage_effect"></textarea>
                            Deterioration:<textarea class="inputarea" name="attr_gear_damage_deterioration"></textarea>
                            Fix:<textarea class="inputarea" name="attr_gear_damage_fix"></textarea>
                        </div>
                    </span>
                </fieldset>

            </div>
            <h4>Gear Damage Notes</h4> <textarea class="inputarea" name="attr_gear_damage_desc" rows="3"></textarea>
        </div>
        <div class="infobox" id="gear2weapons">
            <h3> Weapon Systems </h3>
            <div class="gearweapon-rep">
                <h4>Bonus Dice: <input type="number" name="attr_bonus_dice" value="0">
                    TN: <input type="number" name="attr_tn" value="5">
                    Reliable: <input type="number" name="attr_reliable" value="0">
                    <select name="attr_whisper" >
                        <option value=" " selected>Public</option>
                        <option value="/w gm ">Whisper</option>
                    </select>
                </h4>

                <fieldset class="repeating_gearweapon">
                    <span type="text" name="attr_gear_weapon_size"></span>
                    <span type="text" name="attr_gear_weapon_type"></span>
                    <button type="action" name="act_tumble"> roll</button>
                    
                    
                    Dam:<span type="number" name="attr_gear_weapon_damage"></span>
                    Traits:
                    <input type="checkbox" name="attr_gear_weapon_traits_ammo" value="1" class="sheet-toggle-show-span"
                        hidden />
                    <span class="sheet-body">
                        Ammo: (<input type="radio" value="2" name="attr_gear_weapon_traits_ammo_selector" checked>
                        <span type="text" name="attr_gear_weapon_traits_selector_2"></span>
                        <input type="radio" value="3" name="attr_gear_weapon_traits_ammo_selector">
                        <span type="text" name="attr_gear_weapon_traits_selector_3"></span>)
                        </span>
                    <span type="text" name="attr_gear_weapon_traits"></span>
                    <span type="text" name="attr_gear_weapon_traits_other"></span>

                    <span class="pull-right">
                        <input type="number" name="attr_gear_weapon_ammo">/
                        <span type="number" name="attr_gear_weapon_ammo_max"></span>
                    </span>
                    i:<input type="checkbox" name="attr_gear_weapon_info" class="sheet-toggle-show" />

                    <div class="sheet-body">
                        Size:<select name="attr_gear_weapon_size">
                            <option value="Light">Light</option>
                            <option value="Medium">Medium</option>
                            <option value="Heavy">Heavy</option>
                            <option value=" ">None</option>
                        </select>
                        Type: <input type="text" name="attr_gear_weapon_type" value="Weapon">
                        Code <input type="text" name="attr_gear_weapon_code" class="em8">

                        <span class="pull-right">
                            Ammo : <input type="number" name="attr_gear_weapon_ammo_max" value="0">
                        </span>
                        <div>
                            <select name="attr_gear_weapon_domain">
                                <option value="gunnery" selected>Gunnery</option>
                                <option value="pilot">Pilot</option>
                                <option value="electronicwarfare">Electronic Warfare</option>

                            </select>
                            Skill Level:<input type="number" name="attr_gear_skill_level" value="0">

                            <input type="number" name="attr_gear_weapon_expertise" hidden>
                            Expertise: <span type="number" name="attr_gear_weapon_expertise"></span>
                            TN Bonus: <input type="number" name="attr_gear_weapon_tn_bonus" value="0" hidden>
                            <span type="number" name="attr_gear_weapon_tn_bonus" value="0"> </span>
                            (<input type="checkbox" name="attr_gear_weapon_skill_familiar" value="1"> F)
                            <div>
                            </div>

                            Damage <input type="number" name="attr_gear_weapon_damage" class="digit" value="0">
                            <input type="checkbox" name="attr_gear_weapon_damage_show" class="sheet-toggle-show-span" />
                            <span class="sheet-body">

                                <input type="number" name="attr_gear_weapon_damage_l" class="digit" value="0">/
                                <input type="number" name="attr_gear_weapon_damage_m" class="digit" value="0">/
                                <input type="number" name="attr_gear_weapon_damage_h" class="digit" value="0">
                            </span>

                            Category <input type="text" name="attr_gear_weapon_catagory" class="em8">
                            Range: <input type="text" name="attr_gear_weapon_range" class="em8">-
                            <input type="checkbox" name="attr_blitz_check" class="blitz-check" value="1">
                            <span class="no-blitz">
                                <input type="number" name="attr_gear_weapon_range_min" class="">-
                                <input type="number" name="attr_gear_weapon_range_med" class="">/
                                <input type="number" name="attr_gear_weapon_range_max" class="">m
                            </span>
                            <span class="blitz">
                                Blitz: <input type="number" name="attr_gear_weapon_blitz_range_min" class="">-
                                <input type="number" name="attr_gear_weapon_blitz_range_med" class="">/
                                <input type="number" name="attr_gear_weapon_blitz_range_max" class="">in
                            </span>
                        </div>
                        Arc: <select name="attr_gear_weapon_arc">
                            <option value="front" selected>Front</option>
                            <option value="left">Left</option>
                            <option value="right">Right</option>
                            <option value="turret">Turret</option>
                        </select>
                        Traits <input type="text" name="attr_gear_weapon_traits" value="None">
                        <input type="checkbox" name="attr_gear_weapon_traits_show" class="sheet-toggle-show" />
                        <div class="sheet-body">
                            <span class="trait-box">
                                <span class="trait-item">
                                    Ammo:<input type="checkbox" name="attr_gear_weapon_traits_ammo" value="1">
                                    <input type="checkbox" name="attr_gear_weapon_traits_ammo" value="1"
                                        class="sheet-toggle-show-span" hidden />
                                    <span class="sheet-body">
                                            <span type="text" name="attr_gear_weapon_traits_selector_2"> </span> OR
                                            <span type="text" name="attr_gear_weapon_traits_selector_3"> </span>
                                    </span>
                                </span>

                                <span class="trait-item">
                                    Advanced:
                                    <input type="checkbox" name="attr_gear_weapon_traits_advanced" value="1">

                                    <input type="checkbox" name="attr_gear_weapon_traits_ammo" value="1"
                                        class="sheet-toggle-show-span" hidden />
                                    <span class="sheet-body">
                                        <input type="radio" value="1" name="attr_gear_weapon_traits_advanced_selector"
                                            checked>|
                                        <input type="radio" value="2" name="attr_gear_weapon_traits_advanced_selector">
                                        <input type="radio" value="3" name="attr_gear_weapon_traits_advanced_selector">
                                    </span></span>
                                <span class="trait-item">
                                    Apex <input type="checkbox" name="attr_gear_weapon_traits_apex" value="1">
                                    <input type="checkbox" name="attr_gear_weapon_traits_ammo" value="1"
                                        class="sheet-toggle-show-span" hidden />
                                    <span class="sheet-body">
                                        <input type="radio" value="1" name="attr_gear_weapon_traits_apex_selector"
                                            checked>|
                                        <input type="radio" value="2" name="attr_gear_weapon_traits_apex_selector">
                                        <input type="radio" value="3" name="attr_gear_weapon_traits_apex_selector">
                                    </span></span>
                                <span class="trait-item">
                                    Attachment <input type="checkbox" name="attr_gear_weapon_traits_attachment"
                                        value="1">
                                    <input type="checkbox" name="attr_gear_weapon_traits_ammo" value="1"
                                        class="sheet-toggle-show-span" hidden />
                                    <span class="sheet-body">
                                        <input type="radio" value="1" name="attr_gear_weapon_traits_attachment_selector"
                                            checked>|
                                        <input type="radio" value="2"
                                            name="attr_gear_weapon_traits_attachment_selector">
                                        <input type="radio" value="3"
                                            name="attr_gear_weapon_traits_attachment_selector">
                                    </span>
                                </span>
                                <span class="trait-item">
                                    Auto <input type="checkbox" name="attr_gear_weapon_traits_auto" value="1">
                                    <input type="checkbox" name="attr_gear_weapon_traits_ammo" value="1"
                                        class="sheet-toggle-show-span" hidden />
                                    <span class="sheet-body">
                                        <input type="radio" value="1" name="attr_gear_weapon_traits_auto_selector"
                                            checked>|
                                        <input type="radio" value="2" name="attr_gear_weapon_traits_auto_selector">
                                        <input type="radio" value="3" name="attr_gear_weapon_traits_auto_selector">
                                    </span>
                                </span>
                                <span class="trait-item">
                                    Backup <input type="checkbox" name="attr_gear_weapon_traits_backup" value="1">
                                    <input type="checkbox" name="attr_gear_weapon_traits_ammo" value="1"
                                        class="sheet-toggle-show-span" hidden />
                                    <span class="sheet-body">
                                        <input type="radio" value="1" name="attr_gear_weapon_traits_backup_selector"
                                            checked>|
                                        <input type="radio" value="2" name="attr_gear_weapon_traits_backup_selector">
                                        <input type="radio" value="3" name="attr_gear_weapon_traits_backup_selector">
                                    </span>
                                </span>
                                <span class="trait-item">
                                    Blast <input type="checkbox" name="attr_gear_weapon_traits_blast" value="1">
                                    <input type="checkbox" name="attr_gear_weapon_traits_ammo" value="1"
                                        class="sheet-toggle-show-span" hidden />
                                    <span class="sheet-body">
                                        <input type="radio" value="1" name="attr_gear_weapon_traits_blast_selector"
                                            checked>|
                                        <input type="radio" value="2" name="attr_gear_weapon_traits_blast_selector">
                                        <input type="radio" value="3" name="attr_gear_weapon_traits_blast_selector">
                                    </span>
                                </span>
                                <span class="trait-item">

                                    Bomb <input type="checkbox" name="attr_gear_weapon_traits_bomb" value="1">
                                    <input type="checkbox" name="attr_gear_weapon_traits_ammo" value="1"
                                        class="sheet-toggle-show-span" hidden />
                                    <span class="sheet-body">
                                        <input type="radio" value="1" name="attr_gear_weapon_traits_bomb_selector"
                                            checked>|
                                        <input type="radio" value="2" name="attr_gear_weapon_traits_bomb_selector">
                                        <input type="radio" value="3" name="attr_gear_weapon_traits_bomb_selector">
                                    </span>
                                </span>
                                <span class="trait-item">
                                    Corrosion <input type="checkbox" name="attr_gear_weapon_traits_corrosion" value="1">
                                    <input type="checkbox" name="attr_gear_weapon_traits_ammo" value="1"
                                        class="sheet-toggle-show-span" hidden />
                                    <span class="sheet-body">
                                        <input type="radio" value="1" name="attr_gear_weapon_traits_corrosion_selector"
                                            checked>|
                                        <input type="radio" value="2" name="attr_gear_weapon_traits_corrosion_selector">
                                        <input type="radio" value="3" name="attr_gear_weapon_traits_corrosion_selector">
                                    </span>
                                </span>
                                <span class="trait-item">
                                    Flak <input type="checkbox" name="attr_gear_weapon_traits_flak" value="1">
                                    <input type="checkbox" name="attr_gear_weapon_traits_ammo" value="1"
                                        class="sheet-toggle-show-span" hidden />
                                    <span class="sheet-body">
                                        <input type="radio" value="1" name="attr_gear_weapon_traits_flak_selector"
                                            checked>|
                                        <input type="radio" value="2" name="attr_gear_weapon_traits_flak_selector">
                                        <input type="radio" value="3" name="attr_gear_weapon_traits_flak_selector">
                                    </span>
                                </span>
                                <span class="trait-item">
                                    Forearm <input type="checkbox" name="attr_gear_weapon_traits_forearm" value="1">
                                    <input type="checkbox" name="attr_gear_weapon_traits_ammo" value="1"
                                        class="sheet-toggle-show-span" hidden />
                                    <span class="sheet-body">
                                        <input type="radio" value="1" name="attr_gear_weapon_traits_forearm_selector"
                                            checked>|
                                        <input type="radio" value="2" name="attr_gear_weapon_traits_forearm_selector">
                                        <input type="radio" value="3" name="attr_gear_weapon_traits_forearm_selector">
                                    </span>
                                </span>
                                <span class="trait-item">
                                    Frag <input type="checkbox" name="attr_gear_weapon_traits_frag" value="1">
                                    <input type="checkbox" name="attr_gear_weapon_traits_ammo" value="1"
                                        class="sheet-toggle-show-span" hidden />
                                    <span class="sheet-body">
                                        <input type="radio" value="1" name="attr_gear_weapon_traits_frag_selector"
                                            checked>|
                                        <input type="radio" value="2" name="attr_gear_weapon_traits_frag_selector">
                                        <input type="radio" value="3" name="attr_gear_weapon_traits_frag_selector">
                                    </span>
                                </span>
                                <span class="trait-item">
                                    Guided <input type="checkbox" name="attr_gear_weapon_traits_guided" value="1">
                                    <input type="checkbox" name="attr_gear_weapon_traits_ammo" value="1"
                                        class="sheet-toggle-show-span" hidden />
                                    <span class="sheet-body">
                                        <input type="radio" value="1" name="attr_gear_weapon_traits_guided_selector"
                                            checked>|
                                        <input type="radio" value="2" name="attr_gear_weapon_traits_guided_selector">
                                        <input type="radio" value="3" name="attr_gear_weapon_traits_guided_selector">
                                    </span>
                                </span>
                                <span class="trait-item">
                                    Haywire <input type="checkbox" name="attr_gear_weapon_traits_haywire" value="1">
                                    <input type="checkbox" name="attr_gear_weapon_traits_ammo" value="1"
                                        class="sheet-toggle-show-span" hidden />
                                    <span class="sheet-body">
                                            <input type="radio" value="1" name="attr_gear_weapon_traits_haywire_selector"
                                                checked>|
                                            <input type="radio" value="2" name="attr_gear_weapon_traits_haywire_selector">
                                            <input type="radio" value="3" name="attr_gear_weapon_traits_haywire_selector">
                                    </span>
                                </span>
                                <span class="trait-item">
                                    Limited Ammo <input type="checkbox" name="attr_gear_weapon_traits_limited_ammo"
                                        value="1">
                                    <input type="checkbox" name="attr_gear_weapon_traits_ammo" value="1"
                                        class="sheet-toggle-show-span" hidden />
                                    <span class="sheet-body">
                                        <input type="radio" value="1"
                                            name="attr_gear_weapon_traits_limited_ammo_selector" checked>|
                                        <input type="radio" value="2"
                                            name="attr_gear_weapon_traits_limited_ammo_selector">
                                        <input type="radio" value="3"
                                            name="attr_gear_weapon_traits_limited_ammo_selector">
                                    </span>
                                </span>
                                <span class="trait-item">
                                    Link <input type="checkbox" name="attr_gear_weapon_traits_link" value="1">
                                    <input type="checkbox" name="attr_gear_weapon_traits_ammo" value="1"
                                        class="sheet-toggle-show-span" hidden />
                                    <span class="sheet-body">
                                        <input type="radio" value="1" name="attr_gear_weapon_traits_link_selector"
                                            checked>|
                                        <input type="radio" value="2" name="attr_gear_weapon_traits_link_selector">
                                        <input type="radio" value="3" name="attr_gear_weapon_traits_link_selector">
                                    </span>
                                </span>
                                <span class="trait-item">
                                    Precise <input type="checkbox" name="attr_gear_weapon_traits_precise" value="1">
                                    <input type="checkbox" name="attr_gear_weapon_traits_ammo" value="1"
                                        class="sheet-toggle-show-span" hidden />
                                    <span class="sheet-body">
                                        <input type="radio" value="1" name="attr_gear_weapon_traits_precise_selector"
                                            checked>|
                                        <input type="radio" value="2" name="attr_gear_weapon_traits_precise_selector">
                                        <input type="radio" value="3" name="attr_gear_weapon_traits_precise_selector">
                                    </span>
                                </span>
                                <span class="trait-item">
                                    Silent <input type="checkbox" name="attr_gear_weapon_traits_silent" value="1">
                                    <input type="checkbox" name="attr_gear_weapon_traits_ammo" value="1"
                                        class="sheet-toggle-show-span" hidden />
                                    <span class="sheet-body">
                                        <input type="radio" value="1" name="attr_gear_weapon_traits_silent_selector"
                                            checked>|
                                        <input type="radio" value="2" name="attr_gear_weapon_traits_silent_selector">
                                        <input type="radio" value="3" name="attr_gear_weapon_traits_silent_selector">
                                    </span>
                                </span>
                                <span class="trait-item">
                                    Smoke <input type="checkbox" name="attr_gear_weapon_traits_smoke" value="1">
                                    <input type="checkbox" name="attr_gear_weapon_traits_ammo" value="1"
                                        class="sheet-toggle-show-span" hidden />
                                    <span class="sheet-body">
                                        <input type="radio" value="1" name="attr_gear_weapon_traits_smoke_selector"
                                            checked>|
                                        <input type="radio" value="2" name="attr_gear_weapon_traits_smoke_selector">
                                        <input type="radio" value="3" name="attr_gear_weapon_traits_smoke_selector">
                                    </span>
                                </span>
                                <span class="trait-item">
                                    Spray <input type="checkbox" name="attr_gear_weapon_traits_spray" value="1">
                                    <input type="checkbox" name="attr_gear_weapon_traits_ammo" value="1"
                                        class="sheet-toggle-show-span" hidden />
                                    <span class="sheet-body">
                                        <input type="radio" value="1" name="attr_gear_weapon_traits_spray_selector"
                                            checked>|
                                        <input type="radio" value="2" name="attr_gear_weapon_traits_spray_selector">
                                        <input type="radio" value="3" name="attr_gear_weapon_traits_spray_selector">
                                    </span>
                                </span>
                            </span>

                            <div class="trait-box">


                                <span class="trait-item">
                                    AoE: <input type="number" name="attr_gear_weapon_traits_aoe" class="digit"
                                        value="0">m
                                    <span> <input type="checkbox" name="attr_gear_weapon_traits_single"
                                            class="sheet-toggle-show-span" hidden />
                                        <span class="sheet-body">
                                            -(<input type="number" name="attr_gear_weapon_traits_aoe_l" class="digit"
                                                value="0">m/
                                            <input type="number" name="attr_gear_weapon_traits_aoe_m" class="digit"
                                                value="0">m/
                                            <input type="number" name="attr_gear_weapon_traits_aoe_h" class="digit"
                                                value="0">m)
                                        </span> </span>
                                    <input type="checkbox" name="attr_gear_weapon_traits_ammo" value="1"
                                        class="sheet-toggle-show-span" hidden />
                                    <span class="sheet-body">
                                        <input type="radio" value="1" name="attr_gear_weapon_traits_aoe_selector"
                                            checked>|
                                        <input type="radio" value="2" name="attr_gear_weapon_traits_aoe_selector">
                                        <input type="radio" value="3" name="attr_gear_weapon_traits_aoe_selector">
                                    </span>
                                </span>
                                <span class="trait-item">
                                    AP:<input type="number" name="attr_gear_weapon_traits_ap" class="digit" value="0">
                                    <span> <input type="checkbox" name="attr_gear_weapon_traits_single"
                                            class="sheet-toggle-show-span" hidden />
                                        <span class="sheet-body">
                                            -<input type="number" name="attr_gear_weapon_traits_ap_l" class="digit"
                                                value="0">/
                                            <input type="number" name="attr_gear_weapon_traits_ap_m" class="digit"
                                                value="0">/
                                            <input type="number" name="attr_gear_weapon_traits_ap_h" class="digit"
                                                value="0">
                                        </span></span>
                                    <input type="checkbox" name="attr_gear_weapon_traits_ammo" value="1"
                                        class="sheet-toggle-show-span" hidden />
                                    <span class="sheet-body">
                                        <input type="radio" value="1" name="attr_gear_weapon_traits_ap_selector"
                                            checked>|
                                        <input type="radio" value="2" name="attr_gear_weapon_traits_ap_selector">
                                        <input type="radio" value="3" name="attr_gear_weapon_traits_ap_selector">
                                    </span>
                                </span>
                                <span class="trait-item">
                                    Brawler:
                                    <input type="number" name="attr_gear_weapon_traits_brawler" class="digit" value="0">
                                    <span>
                                        <input type="checkbox" name="attr_gear_weapon_traits_single"
                                            class="sheet-toggle-show-span" hidden />
                                        <span class="sheet-body">
                                            -<input type="number" name="attr_gear_weapon_traits_brawler_l" class="digit"
                                                value="0">/
                                            <input type="number" name="attr_gear_weapon_traits_brawler_m" class="digit"
                                                value="0">/
                                            <input type="number" name="attr_gear_weapon_traits_brawler_h" class="digit"
                                                value="0">
                                        </span></span>

                                    <input type="checkbox" name="attr_gear_weapon_traits_ammo" value="1"
                                        class="sheet-toggle-show-span" hidden />
                                    <span class="sheet-body">
                                        <input type="radio" value="1" name="attr_gear_weapon_traits_brawler_selector"
                                            checked>|
                                        <input type="radio" value="2" name="attr_gear_weapon_traits_brawler_selector">
                                        <input type="radio" value="3" name="attr_gear_weapon_traits_brawler_selector">
                                    </span>
                                </span>
                                <span class="trait-item">

                                    Burst:<input type="number" name="attr_gear_weapon_traits_burst" class="digit"
                                        value="0">
                                    <span>
                                        <input type="checkbox" name="attr_gear_weapon_traits_single"
                                            class="sheet-toggle-show-span" hidden />
                                        <span class="sheet-body">
                                            -<input type="number" name="attr_gear_weapon_traits_burst_l" class="digit"
                                                value="0">/
                                            <input type="number" name="attr_gear_weapon_traits_burst_m" class="digit"
                                                value="0">/
                                            <input type="number" name="attr_gear_weapon_traits_burst_h" class="digit"
                                                value="0">
                                        </span></span>
                                    <input type="checkbox" name="attr_gear_weapon_traits_ammo" value="1"
                                        class="sheet-toggle-show-span" hidden />
                                    <span class="sheet-body">
                                        <input type="radio" value="1" name="attr_gear_weapon_traits_burst_selector"
                                            checked>|
                                        <input type="radio" value="2" name="attr_gear_weapon_traits_burst_selector">
                                        <input type="radio" value="3" name="attr_gear_weapon_traits_burst_selector">
                                    </span>
                                </span>
                                <span class="trait-item">
                                    Demo:<input type="number" name="attr_gear_weapon_traits_demo" class="digit"
                                        value="0">
                                    <span> <input type="checkbox" name="attr_gear_weapon_traits_single"
                                            class="sheet-toggle-show-span" hidden />
                                        <span class="sheet-body">
                                            -<input type="number" name="attr_gear_weapon_traits_demo_l" class="digit"
                                                value="0">/
                                            <input type="number" name="attr_gear_weapon_traits_demo_m" class="digit"
                                                value="0">/
                                            <input type="number" name="attr_gear_weapon_traits_demo_h" class="digit"
                                                value="0">
                                        </span></span>
                                    <input type="checkbox" name="attr_gear_weapon_traits_ammo" value="1"
                                        class="sheet-toggle-show-span" hidden />
                                    <span class="sheet-body">
                                        <input type="radio" value="1" name="attr_gear_weapon_traits_demo_selector"
                                            checked>|
                                        <input type="radio" value="2" name="attr_gear_weapon_traits_demo_selector">
                                        <input type="radio" value="3" name="attr_gear_weapon_traits_demo_selector">
                                    </span>
                                </span>
                                <span class="trait-item">
                                    Fire:<input type="number" name="attr_gear_weapon_traits_fire" class="digit"
                                        value="0">
                                    <span> <input type="checkbox" name="attr_gear_weapon_traits_single"
                                            class="sheet-toggle-show-span" hidden />
                                        <span class="sheet-body">
                                            -<input type="number" name="attr_gear_weapon_traits_fire_l" class="digit"
                                                value="0">/
                                            <input type="number" name="attr_gear_weapon_traits_fire_m" class="digit"
                                                value="0">/
                                            <input type="number" name="attr_gear_weapon_traits_fire_h" class="digit"
                                                value="0">
                                        </span></span>
                                    <input type="checkbox" name="attr_gear_weapon_traits_ammo" value="1"
                                        class="sheet-toggle-show-span" hidden />
                                    <span class="sheet-body">
                                        <input type="radio" value="1" name="attr_gear_weapon_traits_fire_selector"
                                            checked>|
                                        <input type="radio" value="2" name="attr_gear_weapon_traits_fire_selector">
                                        <input type="radio" value="3" name="attr_gear_weapon_traits_fire_selector">
                                    </span>
                                </span>
                                <span class="trait-item">
                                    Reach:<input type="number" name="attr_gear_weapon_traits_reach" class="digit"
                                        value="0">
                                    <span><input type="checkbox" name="attr_gear_weapon_traits_single"
                                            class="sheet-toggle-show-span" hidden />
                                        <span class="sheet-body">
                                            -<input type="number" name="attr_gear_weapon_traits_reach_l" class="digit"
                                                value="0">/
                                            <input type="number" name="attr_gear_weapon_traits_reach_m" class="digit"
                                                value="0">/
                                            <input type="number" name="attr_gear_weapon_traits_reach_h" class="digit"
                                                value="0">
                                        </span> </span>
                                    <input type="checkbox" name="attr_gear_weapon_traits_ammo" value="1"
                                        class="sheet-toggle-show-span" hidden />
                                    <span class="sheet-body">
                                        <input type="radio" value="1" name="attr_gear_weapon_traits_reach_selector"
                                            checked>|
                                        <input type="radio" value="2" name="attr_gear_weapon_traits_reach_selector">
                                        <input type="radio" value="3" name="attr_gear_weapon_traits_reach_selector">
                                    </span>
                                </span>
                            </div>
                            <div>
                                Expand: <input type="checkbox" name="attr_gear_weapon_traits_single" />
                            </div>
                            <p>See Desc <input type="checkbox" name="attr_gear_weapon_traits_see_desc" value="1">
                                <input type="text" name="attr_gear_weapon_traits_desc" value="">
                                Other: <input type="text" name="attr_gear_weapon_traits_other" value="">
                            </p>
                            </span>
                        </div>
                        <span type="text" name="attr_gear_weapon_traits_desc" value=""></span>

                        PL <input type="number" name="attr_gear_weapon_pl">


                        <textarea class="inputarea" name="attr_gear_weapon_notes"></textarea>
                        Location <input type="text" name="attr_gear_weapon_location" class="em8">
                        Slots <input type="number" name="attr_gear_weapon_slots" class="digit">
                        Aux Location <input type="text" name="attr_gear_weapon_aux_location" class="em8">
                        Aux Slots <input type="number" name="attr_gear_weapon_slots_misc" class="digit">
                    </div>
                </fieldset>
                Add Weapon Code: <input type="text" name="attr_gear_weapon_code" class="em8">
                <button type="action" name="act_gear_weapon_stat">Add New Weapon</button>
            </div>
            <div class="">
                <h3>Electronic Systems </h3>
                <div class="">
                    <div class="">
                        <h4><label for="sensors" name="attr_sensors">Sensors.</label>
                            <input type="checkbox" id="sensors" name="attr_sensors_hide" class="sheet-toggle-show"
                                hidden>
                        </h4>
                        <span> Type: <input type="text" name="attr_gear_sensors_type" class="em8" value="Basic">
                            <input type="checkbox" name="attr_blitz_check" class="blitz-check" value="1">
                            <span class="no-blitz"> Range: <input type="number" name="attr_gear_sensors_range"
                                    value="2">km </span>
                            <span class="blitz"> Blitz Range: <input type="number" name="attr_gear_sensors_blitz_range"
                                    value="18">" </span>
                            <span>Effect <input type="text" name="attr_gear_sensors_effect" class="em8" value="None">
                                <select name="attr_gear_sensors_mode" class="em8">
                                    <option value="active" selected>Active</option>
                                    <option value="passive">Passive</option>
                                    <option value="none">None</option>
                                </select>
                            </span>
                            <input type="checkbox" name="attr_sensors_hide" class="sheet-toggle-show" hidden>
                            <div class="sheet-body">
                                <textarea class="inputarea" name="attr_gear_sensors_desc"></textarea>
                            </div>
                        </span>
                    </div>
                    <div>
                        <h4> <label for="comms" name="attr_comms">Comms Suite.</label>
                            <input type="checkbox" id="comms" name="attr_comms_hide" class="sheet-toggle-show" hidden>
                        </h4>
                        </h4>
                        <input type="checkbox" name="attr_blitz_check" class="blitz-check" value="1">
                        <span class="no-blitz"> Range: <input type="number" name="attr_gear_sensors_range" value="2">km
                        </span>
                        <span class="blitz"> Blitz Range: <input type="number" name="attr_gear_sensors_blitz_range"
                                value="18">" </span>

                        <span>Effect <input type="text" name="attr_gear_sensors_effect" class="em8" value="None">
                        </span>
                        <input type="checkbox" name="attr_comms_hide" class="sheet-toggle-show" hidden>
                        <div class="sheet-body">
                            <textarea class="inputarea" name="attr_gear_comms_desc"></textarea>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>
    <div class="attributes" id="gear3">
        <div class="infobox" id="gear3customization" style="width: 40%;">
            <h3> Customisation </h3>
            <div>
                <h4> Location <span class="pull-right">Slots </span> </h4>
            </div>
            <div> Torso <span class="pull-right"><input type="number" name="attr_slots_torso">/<input type="number"
                        name="attr_slots_torso_max"> </span> </div>
            <div> Right Manip <span class="pull-right"><input type="number" name="attr_slots_l_manip">/<input
                        type="number" name="attr_slotsLManip_max"></span></div>
            <div> Left Manip <span class="pull-right"><input type="number" name="attr_slots_r_manip">/<input
                        type="number" name="attr_slots_r_manip_max"></span></div>
            <div> Right Shoulder <span class="pull-right"><input type="number" name="attr_slots_l_shoulder">/<input
                        type="number" name="attr_slotss_l_shoulder_max"></span></div>
            <div> Left Shoulder <span class="pull-right"><input type="number" name="attr_slots_r_shoulder">/<input
                        type="number" name="attr_slots_r_shoulder_max"></span></div>
            <div class="infobox">
                <h4>Maintainace</h4>
                <span>Type:<select name="attr_gear_maintainance_type">
                        <option value="3">High Maintainace</option>
                        <option value="7" selected>Regular Maintainace</option>
                        <option value="11">Low Maintainace</option>

                    </select>
                </span>
                <span>Tech:<select name="attr_gear_maintainance_tech">
                        <option value="-1">High Tech</option>
                        <option value="0" selected>Regular Tech</option>
                        <option value="1">Low Tech</option>
                    </select>
                </span>
                <span>Prevalence:<select name="attr_gear_maintainance_prevalence">
                        <option value="rare">Rare</option>
                        <option value="common" selected>Common</option>
                        <option value="Ubiquitous">Ubiquitous </option>
                </span>
                <span>Total: <span name="attr_gear_arm" type="number" class="digit"> </span> hours every
                    <span name="attr_gear_maintainance_type"> </span> days </span>
                <span>Remaining:<input name="attr_gear_maintainance_hours" class="digit" type="number"> hours,
                    <input name="attr_gear_maintainance_cycle_remaining" class="digit" type="number" value="7"> days
                </span>
                <span>Current Penalty: <input name="attr_gear_maintainance_penalty" type="number" max="0"> </span>
                Notes:
                <textarea class="inputarea" name="attr_gear_maintainance_desc"></textarea>
                <h4>Repairs</h4>
                <span> <input name="attr_gear_maintainance_repairs" type="number" class="digit">/
                    <input type="number" name="attr_gear_maintainance_repairs_max" class="digit"> hours. TB: <span
                        name="attr_gear_maintainance_tech"> </span></span> </span>
                <textarea class="inputarea" name="attr_gear_maintainance_repairs_desc"></textarea>
            </div>
        </div>
        <div class="infobox" id="gear3traitsequipment">
            <h3> Traits & Equipment </h3>
            <fieldset class="repeating_gear-equipment-traits">
                <div>Name <input type="text" name="attr_gear_equipment_traits_name"> Info: <input type="checkbox"
                        name="attr_geartraithide" class="sheet-toggle-show">
                    <div class="sheet-body">
                        <div>
                            Location <input type="text" name="attr_gear_equipment_traits_location">
                            Slots<input type="number" name="attr_gear_equipment_traits_slots">
                            PL<input type="number" name="attr_gear_equipment_traits_pl">
                        </div>
                        <textarea class="inputarea" name="attr_gear_equipment_traits_desc"></textarea>
                    </div>
                </div>
            </fieldset>
        </div>
    </div>
    <div class="" id="gear4">
        <div class="infobox" id="gear4misc">
            <h3>Misc </h3>
            <textarea class="inputarea" name="attr_gear_desc"></textarea>
        </div>
    </div>
</div>
<div class="sheet-admin">
    <h2> Notes for the GM</h2>
    <textarea name="attr_admin_gmnotes"></textarea>
    Downtime
    <textarea name="attr_admin_downtime"></textarea>
    Optional Rules
    <span>No Archetypes : <input type="checkbox" name="attr_optional_archetype">
    </span>
    <div>
        <h3>Current Issues</h3>
        <p>
            To be added: Personal Armor list.
        </p>
        <p>
            Formatting: Gear Weapons. 
        </p>





    </div>
    Version Changes:
    <span>Ver:<span name="attr_load_version"></span> </span>
    <span> Wiki:https://wiki.roll20.net/Heavy_Gear_4th_Edition </span>
    <div>

    </div>
</div>

<datalist id="archetypelist">
    <option value="Caretaker"></option>
    <option value="Commander"></option>
    <option value="Duelist"></option>
    <option value="Fixer"></option>
    <option value="Grunt"></option>
    <option value="Pilot"></option>
    <option value="Scout"></option>
    <option value="Techie"></option>
</datalist>

<datalist id="domainlist">
    <option value="athletics"></option>
    <option value="awareness"></option>
    <option value="business"></option>
    <option value="craft"></option>
    <option value="culture"></option>
    <option value="electronicwarfare"></option>
    <option value="electronics"></option>
    <option value="gunnery"></option>
    <option value="hardscience"></option>
    <option value="institutions"></option>
    <option value="investigation"></option>
    <option value="mechanics"></option>
    <option value="medicine"></option>
    <option value="melee"></option>
    <option value="influence"></option>
    <option value="pilot"></option>
    <option value="showmanship"></option>
    <option value="socialscience"></option>
    <option value="survival"></option>
    <option value="tactics"></option>
</datalist>

<rolltemplate class="sheet-rolltemplate-custom">
    <div class="sheet-container sheet-color-{{color}}">
        <div class="sheet-header">
            {{#title}}<div class="sheet-title">{{title}}</div>{{/title}}
            {{#subtitle}}<div class="sheet-subtitle">{{subtitle}}</div>{{/subtitle}}
        </div>
        <div class="sheet-content">
            {{#allprops() title subtitle desc color}}
            <div class="sheet-key">{{key}}</div>
            <div class="sheet-value">{{value}}</div>
            {{/allprops() title subtitle desc color}}
            {{#desc}}<div class="sheet-desc">{{desc}}</div>{{/desc}}
        </div>
    </div>
</rolltemplate>

<rolltemplate class="sheet-rolltemplate-diceroll">
    <div class="sheet-container sheet-color-{{color}}">
        <div class="sheet-header">
            {{#title}}<div class="sheet-title">{{title}}</div>{{/title}}
            {{#subtitle}}<div class="sheet-subtitle">{{subtitle}}</div>{{/subtitle}}
        </div>
        <div class="sheet-content">
            <span>Score </span><span>{{computed::roll}}</span>
            <span>MOS </span><span>{{computed::MOS}} </span>

            {{#rollGreater() doubles 1}}
            <span>Doubles on</span> <span>{{computed::doubles}} </span>
            {{/rollGreater() doubles 1 }}

        </div>
        <div class="sheet-desc">
            {{#rollGreater() reliable 0}}

            <span>{{reliable}} Reliable dice</span> <span>
                {{computed::changedone}}|{{computed::changedtwo}}|{{computed::changedthree}}|
                {{computed::changedfour}}|{{computed::changedfive}}|{{computed::changedsix}}
            </span>
            {{/rollGreater() reliable 0}}
            {{#rollLess() reliable 0}}

            <span>{{reliable}}Reliable dice</span> <span>
                {{computed::changedone}}|{{computed::changedtwo}}|{{computed::changedthree}}|
                {{computed::changedfour}}|{{computed::changedfive}}|{{computed::changedsix}}
            </span>
            {{/rollLess() reliable 0}}
        </div>



        <div class="sheet-desc">
            <span> {{computed::one}}x <span style="font-family: dicefontd6;">A </span> |
                {{computed::two}}x <span style="font-family: dicefontd6;">B </span> |
                {{computed::three}}x <span style="font-family: dicefontd6;">C </span> |
                {{computed::four}}x <span style="font-family: dicefontd6;">D </span> |
                {{computed::five}}x <span style="font-family: dicefontd6;">E </span> |
                {{computed::six}}x <span style="font-family: dicefontd6;">F </span>
            </span>
        </div>

</rolltemplate>

<script type="text/worker">
//top tab buttons code
const buttonlist = ["character","gear","admin"];
buttonlist.forEach(button => {
    on(`clicked:${button}`, function() {
        setAttrs({
            sheet_tab: button
        });
    });
});



const domains = ['athletics','awareness','business','craft','culture','electronicwarfare','electronics','gunnery','hardscience','influence','institutions','investigation','mechanics','medicine','melee','pilot','showmanship','socialscience','survival','tactics'];
const gearSkills = ['gunnery','pilot','electronicwarfare'];
const gearWeaponTraits = ['ammo','advanced','aoe','ap','apex','attachment','auto','backup','blast','bomb','brawler','burst','corrosion','demo','fire','flak','forearm','frag','guided','haywire','limited_ammo','link','precise','reach','silent','smoke','spray','see_desc'];
const gearWeaponTraitsX = ['aoe','ap','brawler','burst','demo','fire','reach'];


//when stat button pushed, lookup weapon attributes

on('clicked:gear_weapon_stat', function() {
    getAttrs(["gear_weapon_code","gear_arm"], function(v) {
        let input = v["gear_weapon_code"];
        let gearweapon = gearWeaponLookup(input);
        gearweapon.code = input;
        let damage = 0;

        //change size to full word
        if (gearweapon.size == "L") {
            gearweapon.size = "Light";
        } else if (gearweapon.size == "M") {
            gearweapon.size = "Medium";
        } else if (gearweapon.size == "H") {
            gearweapon.size = "Heavy"
        } else  {
            gearweapon.size = " ";
            
        }
        if (gearweapon.size == "Light") {
            damage = gearweapon.l;
        } else if (gearweapon.size == "Medium") {
            damage = gearweapon.m;
        } else if (gearweapon.size == "Heavy") {
            damage = gearweapon.h;
        }   else {
            damage = gearweapon.l;
        }
        if (gearweapon.type == "Fist") {
            damage = parseInt(v["gear_arm"])-2;
            console.log(damage);
        }

        gearweapon["damage"] = damage;        
       
        gearweapon.traits = deCapitalise(gearweapon.traits);
        console.log("gear weapon1:"+gearweapon);
        


        gearWeaponTraits.forEach(trait => {//for each trait, check if it is in the list of traits
            if (gearweapon.traits.includes(trait)) {
                gearweapon[trait] = 1;
                
            } else {
                gearweapon[trait] = 0;
            }
            //check if selector is initalised
            if (gearweapon.selector == undefined) {
                gearweapon.selector = [1];
                
            }

            
        }); 
        //take array gearweapon.traits and for each entry, check if it has a ":", if it does, then take the part before the : and compare it to traitsX, if it is, add the part after the : to the gearweapon.trait
        gearWeaponTraitsX.forEach(trait => {
            gearweapon.traits.forEach(entry => {
                //if entry includes "(or)" or : split it
                    let entryArray = entry.split("(or)");
                    entryArray.forEach(entry => {
                        if (entry.includes(":")) {
                            entryArray = entry.split(":");
                            console.log("entryArray[0]:"+entryArray[0]+" trait:"+trait);

                            if (entryArray[0] == trait) {
                                gearweapon[trait] = entryArray[1];
                                //if entryArray[1] has /, then find split it
                                if(entryArray[1].includes("/")){
                                    let entryArray2 = entryArray[1].split("/");
                                    if (gearweapon.size == "Light") {
                                        gearweapon[trait] = entryArray2[0];
                                    } else if (gearweapon.size == "Medium") {
                                        gearweapon[trait] = entryArray2[1];
                                    } else if (gearweapon.size == "Heavy") {
                                        gearweapon[trait] = entryArray2[2];
                                    } 
                                } else {
                                    gearweapon[trait] = entryArray[1];
                                }
                                    gearweapon[trait] = parseInt(gearweapon[trait]);
                                };
                        };
                    });
                
            });
        });
        //remove : and anything after from gearweapon.traits
        gearweapon.traits.forEach((entry,index) => {
            if (entry.includes(":")) {
                let entryArray = entry.split(":");
                gearweapon.traits[index] = entryArray[0];
            }
        });
        console.log(gearweapon);
        var newrowid = generateRowID();
        var newrowattrs = {};
        //set code
        newrowattrs["repeating_gearweapon_" + newrowid + "_gear_weapon_code"] = gearweapon.code;
        newrowattrs["repeating_gearweapon_" + newrowid + "_gear_weapon_type"] = gearweapon.type;
        newrowattrs["repeating_gearweapon_" + newrowid + "_gear_weapon_range"] = gearweapon.range;
        newrowattrs["repeating_gearweapon_" + newrowid + "_gear_weapon_damage_l"] = gearweapon.l;
        newrowattrs["repeating_gearweapon_" + newrowid + "_gear_weapon_damage_m"] = gearweapon.m;
        newrowattrs["repeating_gearweapon_" + newrowid + "_gear_weapon_damage_h"] = gearweapon.h;
        newrowattrs["repeating_gearweapon_" + newrowid + "_gear_weapon_damage"] = gearweapon.damage;
        newrowattrs["repeating_gearweapon_" + newrowid + "_gear_weapon_catagory"] = gearweapon.mode;
        newrowattrs["repeating_gearweapon_" + newrowid + "_gear_weapon_slots"] = gearweapon.slots;
        newrowattrs["repeating_gearweapon_" + newrowid + "_gear_weapon_slots_misc"] = gearweapon.aux;
        newrowattrs["repeating_gearweapon_" + newrowid + "_gear_weapon_location"] = gearweapon.location;
        newrowattrs["repeating_gearweapon_" + newrowid + "_gear_weapon_ammo"] = gearweapon.ammunition;
        newrowattrs["repeating_gearweapon_" + newrowid + "_gear_weapon_ammo_max"] = gearweapon.ammunition;
        newrowattrs["repeating_gearweapon_" + newrowid + "_gear_weapon_pl"] = gearweapon.pl;
        newrowattrs["repeating_gearweapon_" + newrowid + "_gear_weapon_traits_desc"] = gearweapon.desc;
        newrowattrs["repeating_gearweapon_" + newrowid + "_gear_weapon_size"] = gearweapon.size;
        
        if (gearweapon.desc !== "") {
            newrowattrs["repeating_gearweapon_" + newrowid + "_gear_weapon_traits_see_desc"] = 1;
        }

        gearWeaponTraits.forEach(trait => {
            newrowattrs["repeating_gearweapon_" + newrowid + "_gear_weapon_traits_" + trait] = gearweapon[trait];
            //let index be the index of the array gearweapon.traits that matches trait
            let index = gearweapon.traits.indexOf(trait);
            console.log("index:"+index+" trait:"+trait+" gearweapon[trait]:"+gearweapon[trait]);
            if (index != -1) {
                newrowattrs["repeating_gearweapon_" + newrowid + "_gear_weapon_traits_" + trait +"_selector"] = gearweapon.selector[index];
                console.log("repeating_gearweapon_n_gear_weapon_traits_" + trait +"_selector: "+ gearweapon.selector[index]);
        
            } 

           });

            
        setAttrs(newrowattrs);
        

    });
});

// on change repeating gear weapon traits ammo, change repeating gear weapon selector to match
on("change:repeating_gearweapon_gear_weapon_traits_ammo", function() {
    getAttrs(["repeating_gearweapon_gear_weapon_traits_ammo"], function(v) {
        let checked = "on";
        if (v["repeating_gearweapon_gear_weapon_traits_ammo"] == "0") {
            checked = "off";
        }

        setAttrs({
            "repeating_gearweapon_gear_weapon_traits_selector": checked
        });
    });
});

//lookup table for gear weapon attributes
const gearWeaponLookup = (string) => {
    let gearweapon = {};
    let code, extra; // declare variables outside of if statement
  
    // find if input has a space in it
    if (string.indexOf(' ') >= 0) {
      let inputArray = string.split(' '); // input has a space, split into code and extra
      code = inputArray[0];
      extra = inputArray[1];
    } else {
      code = string;
    }
    // take first letter of code, and look up size
    let sizeletter = code.charAt(0);
    console.log(sizeletter + "sizeletter");

    //take rest of code and look up type
    let weaponcode = code.slice(1);

    if (code == "FS" || weaponcode == "FS") {
        weaponcode = "FS";
        sizeletter = " ";
    }
    switch (weaponcode) {

        case "AAM":
        gearweapon = {type:"Anti-Air Missile", range :"120-360/720",size: sizeletter, l:7,m:8, h:9, traits:["Flak"," Guided"," Limited Ammo"], mode:"D, I", slots:3, aux:0, location:"Shoulder, Torso", ammunition:3, pl:3, desc:""};
        break;
        case "ABM":
        gearweapon = {type:"Air Burst Missile", range :"240-480/960",size: sizeletter, l:6,m:7, h:8, traits:["AoE: 15m"," Blast"," Guided",""], mode:"I", slots:4, aux:0, location:"Shoulder, Torso", ammunition:3, pl:4, desc:""};
        break;
        case "ARM":
        gearweapon = {type:"Anti-Armor Mine", range :"-",size: sizeletter, l:7,m:8, h:9, traits:["AP:3/4/5"," Mine"], mode:"-", slots:0, aux:0, location:"-", ammunition:0, pl:3, desc:""};
        break;
        case "APGL":
        gearweapon = {type:"Anti-Per. Grenade Launcher", range :"15 (3in)",size: sizeletter, l:4,m:5, h:6, traits:["Frag"], mode:"P", slots:1, aux:0, location:"Torso", ammunition:4, pl:1, desc:""};
        break;
        case "APM":
        gearweapon = {type:"Anti-Personnel Mines", range :"-",size: sizeletter, l:4,m:5, h:6, traits:["AoE: 5m"," Mine"], mode:"-", slots:0, aux:0, location:"-", ammunition:0, pl:1, desc:""};
        break;
        case "APR":
        gearweapon = {type:"Anti-Personnel Rockets", range :"60-180/360",size: sizeletter, l:6,m:7, h:8, traits:["AoE: 15m"], mode:"D, I", slots:2, aux:0, location:"Shoulder, Torso", ammunition:4, pl:1, desc:""};
        break;
        case "ATM":
        gearweapon = {type:"Anti-Tank Missile", range :"120-360/720",size: sizeletter, l:8,m:9, h:10, traits:["AP:2/3/4"," Guided"," Limited Ammo"], mode:"D, I", slots:2, aux:2, location:"Shoulder, Torso", ammunition:2, pl:5, desc:""};
        break;
        case "VG":
        gearweapon = {type:"Anti-Vehicle Grenade", range :"30-60/90",size: sizeletter, l:4,m:5, h:6, traits:["AP: 2/4/6"," Limited Ammo"], mode:"D", slots:2, aux:0, location:"Manip", ammunition:4, pl:3, desc:""};
        break;
        case "AVM":
        gearweapon = {type:"Anti-Vehicle Missile", range :"60-180/360",size: sizeletter, l:5,m:6, h:7, traits:["AP:1"," Guided"," Limited Ammo"], mode:"D, I", slots:2, aux:0, location:"Shoulder, Torso", ammunition:2, pl:3, desc:""};
        break;
        case "AG":
        gearweapon = {type:"Artillery Gun", range :"240-480/960",size: sizeletter, l:9,m:10, h:11, traits:["AoE: 15m"," Blast"," AP:1"," Demo:2"], mode:"I", slots:6, aux:4, location:"Manip, Torso", ammunition:1, pl:6, desc:""};
        break;
        case "AM":
        gearweapon = {type:"Artillery Missile", range :"120-360/960",size: sizeletter, l:7,m:8, h:9, traits:["AoE: 15m"," Blast"," Demo: 2"," Guided"," AP:1"," Limited Ammo"], mode:"I", slots:3, aux:2, location:"Torso", ammunition:4, pl:6, desc:""};
        break;
        case "AR":
        gearweapon = {type:"Artillery Rockets", range :"120-360/720",size: sizeletter, l:7,m:8, h:9, traits:["AoE: 15m"," Demo:2"," See Desc"," Limited Ammo"], mode:"D, I", slots:3, aux:2, location:"Torso", ammunition:4, pl:3, desc:"When attacking with this weapon, the user may increase the ammo used on the attack by 1 to add +1d6 to the attack roll against a single target. This may be done multiple times but can only be used once per target."};
        break;
        case "AC":
        gearweapon = {type:"Autocannon", range :"60-180/360",size: sizeletter, l:6,m:7, h:8, traits:["Ammo","Burst:1","or","Precise"], selector:[2,2,1,3], mode:"D", slots:2, aux:1, location:"Manip", ammunition:6, pl:1, desc:""};
        break;
        case "BA":
        gearweapon = {type:"Bayonet", range :"3 (0in)",size: sizeletter, l:5,m:6, h:7, traits:["Attachment"," See Desc"], mode:"M", slots:0, aux:0, location:"-", ammunition:0, pl:1, desc:"Swapping to or from a weapon with a bayonet counts as an additional action"};
        break;
        case "BZ":
        gearweapon = {type:"Bazooka", range :"30-120/240",size: sizeletter, l:7,m:8, h:9, traits:["AP:2/3/4"], mode:"D", slots:2, aux:1, location:"Manip", ammunition:6, pl:1, desc:""};
        break;
        case "BM":
        gearweapon = {type:"Bomb", range :"-",size: sizeletter, l:7,m:8, h:9, traits:["AoE:15m/20m/25m"," Bomb 15m/20m/25m"," Bomb"], mode:"D", slots:0, aux:0, location:"-", ammunition:1, pl:1, desc:""};
        break;
        case "CB":
        gearweapon = {type:"Chain Bayonet", range :"3 (0in)",size: sizeletter, l:5,m:6, h:7, traits:["Attachment"," Demo:2"," Brawler:1"," See Desc"], mode:"M", slots:1, aux:0, location:"-", ammunition:0, pl:4, desc:"Swapping to or from a weapon with a bayonet counts as an additional action"};
        break;
        case "CBL":
        gearweapon = {type:"Chain Blade", range :"6 (1in)",size: sizeletter, l:7,m:8, h:9, traits:["Demo:2/4/6"," Brawler:1"], mode:"M", slots:2, aux:0, location:"Manip", ammunition:0, pl:4, desc:""};
        break;
        case "CL":
        gearweapon = {type:"Claws", range :"3 (0in)",size: sizeletter, l:7,m:8, h:9, traits:["Forearm"], mode:"M", slots:1, aux:0, location:"Manip", ammunition:0, pl:1, desc:""};
        break;
        case "CW":
        gearweapon = {type:"Combat Weapon", range :"3 (0in)",size: sizeletter, l:7,m:8, h:9, traits:["Demo: 2/3/4"," Backup"], mode:"M", slots:1, aux:0, location:"Manip", ammunition:0, pl:1, desc:""};
        break;
        case "EM":
        gearweapon = {type:"EM Mines", range :"-",size: sizeletter, l:4,m:5, h:6, traits:["Mine"," Haywire"], mode:"-", slots:0, aux:0, location:"-", ammunition:0, pl:4, desc:""};
        break;
        case "EL":
        gearweapon = {type:"Explosive Lance", range :"8 (2in)",size: sizeletter, l:7,m:8, h:9, traits:["AP: 2/3/4"," Demo: 3/5/7"], mode:"M", slots:2, aux:0, location:"Manip", ammunition:0, pl:5, desc:""};
        break;
        case "FG":
        gearweapon = {type:"Field Gun", range :"120-240/480",size: sizeletter, l:9,m:10, h:11, traits:["Ammo","AoE: 15m"," Blast","or","AP:3/4/5"],selector:[2,2,2,1,3], mode:"D, I", slots:4, aux:4, location:"Manip,Torso", ammunition:1, pl:6, desc:""};
        break;
        case "FM":
        gearweapon = {type:"Field Mortar", range :"180-360/720",size: sizeletter, l:8,m:9, h:10, traits:["AoE: 20m"," Blast"], mode:"I", slots:3, aux:2, location:"Shoulder,Torso", ammunition:1, pl:4, desc:""};
        break;
        case "FS":
        gearweapon = {type:"Fist", range :"0 (0in)",size: " ", l:0,m:0, h:0, traits:["See Desc"], mode:"M", slots:0, aux:0, location:"-", ammunition:0, pl:0, desc:"A Gear or Strider with the Hands equipment that has an open hand is counted as having a fist. This is not counted as a weapon for any rules interaction. The Damage of a Fist is equal to the Arm - 2 of the vehicle."};
        break;
        case "FLA":
        gearweapon = {type:"Flail", range :"5 (1in)",size: sizeletter, l:6,m:7, h:8, traits:[" See Desc"], mode:"M", slots:2, aux:0, location:"Manip", ammunition:0, pl:2, desc:"Attacks from flails do not allow the effects of shields or bucklers."};
        break;
        case "FL":
        gearweapon = {type:"Flamer", range :"0-90/180",size: sizeletter, l:3,m:4, h:5, traits:["Fire:2/3/4"," Spray"," Burst:1"], mode:"D", slots:2, aux:1, location:"Manip", ammunition:4, pl:3, desc:""};
        break;
        case "FC":
        gearweapon = {type:"Frag Cannon", range :"0-90/180",size: sizeletter, l:5,m:6, h:7, traits:["Ammo","Precise"," AP:1/2/3","or","Frag"],selector:[2,2,2,1,3], mode:"D", slots:2, aux:1, location:"Manip", ammunition:6, pl:1, desc:""};
        break;
        case "FRG":
        gearweapon = {type:"Frag Grenades", range :"0-60/90",size: sizeletter, l:3,m:4, h:5, traits:["AoE: 15m"," Blast"," Frag"," Limited Ammo"], mode:"D, I", slots:1, aux:0, location:"Manip", ammunition:4, pl:1, desc:""};
        break;
        case "GL":
        gearweapon = {type:"Grenade Launcher", range :"60-120/240",size: sizeletter, l:0,m:0, h:0, traits:["Burst:1"," See Desc"], mode:"D, I", slots:2, aux:1, location:"Manip", ammunition:4, pl:1, desc:"Grenade Launchers may fire Anti-Vehicle, Frag, Incendiary, Haywire, White Sand and Smoke Grenades using those Grenade’s damage but the Grenade Launcher’s stats for everything else (this includes range and Ammo. Attacks with the Grenade and Grenade Launcher use the combined traits of both. When selecting the weapon, the user must select 2 of the available grenade types to be available to use (these are still restricted by PL). The user may only use those 2 types when attacking. A Grenade Launcher may fire grenades the same size as it or lower (A MGL can fire Medium or Light grenades). Ignore the LA:X trait on any Grenades used."};
        break;
        case "GM":
        gearweapon = {type:"Guided Mortar", range :"180-360/72",size: sizeletter, l:7,m:8, h:9, traits:["AoE: 15m"," Blast"," Guided"], mode:"I", slots:3, aux:2, location:"Shoulder,Torso", ammunition:1, pl:5, desc:""};
        break;
        case "HYG":
        gearweapon = {type:"Haywire Grenades", range :"0-60/90",size: sizeletter, l:4,m:5, h:6, traits:["Haywire"," Limited Ammo"], mode:"D, I", slots:1, aux:0, location:"Manip", ammunition:4, pl:5, desc:""};
        break;
        case "HW":
        gearweapon = {type:"Haywire Whip", range :"7 (2in)",size: sizeletter, l:5,m:6, h:7, traits:["Haywire"], mode:"M", slots:2, aux:0, location:"Manip", ammunition:0, pl:5, desc:""};
        break;
        case "IG":
        gearweapon = {type:"Incendiary Grenades", range :"0-60/90",size: sizeletter, l:5,m:6, h:7, traits:["Fire: 1/2/3"," AE:15m"," Limited Ammo"], mode:"D, I", slots:1, aux:0, location:"Manip", ammunition:4, pl:4, desc:""};
        break;
        case "IM":
        gearweapon = {type:"Incendiary Mines", range :"-",size: sizeletter, l:5,m:6, h:7, traits:["Fire: 2/3/4"," AE: 5m"," Mine"], mode:"-", slots:0, aux:0, location:"-", ammunition:0, pl:4, desc:""};
        break;
        case "LA":
        gearweapon = {type:"Lance", range :"8 (2In)",size: sizeletter, l:7,m:8, h:9, traits:["AP: 3/4/5"], mode:"M", slots:2, aux:0, location:"Manip", ammunition:0, pl:5, desc:""};
        break;
        case "LC":
        gearweapon = {type:"Laser Cannon", range :"120-360/720",size: sizeletter, l:6,m:7, h:8, traits:["Precise"," Adv"], mode:"D", slots:3, aux:0, location:"Manip", ammunition:0, pl:5, desc:""};
        break;
        case "MG":
        gearweapon = {type:"Machine Gun", range :"30-90/180",size: sizeletter, l:3,m:4, h:5, traits:["Burst:2"," Backup"], mode:"D", slots:1, aux:1, location:"Manip,Torso, Shoulder", ammunition:6, pl:1, desc:""};
        break;
        case "MS":
        gearweapon = {type:"Morningstar", range :"5 (1in)",size: sizeletter, l:9,m:10, h:11, traits:[""], mode:"M", slots:3, aux:0, location:"Manip", ammunition:0, pl:2, desc:""};
        break;
        case "PZ":
        gearweapon = {type:"Panzerfaust", range :"30-60/90",size: sizeletter, l:7,m:8, h:9, traits:["AP:2/3/4"," Limited Ammo"," See Desc"], mode:"D", slots:1, aux:0, location:"Manip", ammunition:2, pl:2, desc:"Panzerfausts are always assumed to be stored on the torso if they are listed on a vehicle’s profile"};
        break;
        case "PA":
        gearweapon = {type:"Particle Accelerator", range :"60-240/480",size: sizeletter, l:7,m:8, h:9, traits:["Haywire"," Advanced"], mode:"D", slots:3, aux:0, location:"Manip", ammunition:0, pl:6, desc:""};
        break;
        case "P":
        gearweapon = {type:"Pistol", range :"0-120/240",size: sizeletter, l:6,m:7, h:8, traits:["Precise"," Backup"], mode:"D", slots:1, aux:0, location:"Manip", ammunition:0, pl:1, desc:""};
        break;
        case "PL":
        gearweapon = {type:"Pulse Laser", range :"60-240/480",size: sizeletter, l:6,m:7, h:8, traits:["Ammo","Burst: 1"," Advanced","or","AP: 2/3/4","Apex"," Advanced"],selector:[2,2,2,1,3,3,3], mode:"D", slots:3, aux:0, location:"Manip", ammunition:0, pl:7, desc:""};
        break;
        case "RG":
        gearweapon = {type:"Railgun", range :"120-480/960",size: sizeletter, l:4,m:5, h:6, traits:["AP:4/5/6"," Advanced"," Precise"], mode:"D", slots:4, aux:2, location:"Manip", ammunition:1, pl:6, desc:""};
        break;
        case "RBZ":
        gearweapon = {type:"Rapid Fire Bazooka", range :"60-120/240",size: sizeletter, l:7,m:8, h:9, traits:["AP:1/2/3"," Burst:1"], mode:"D", slots:2, aux:1, location:"Manip", ammunition:3, pl:2, desc:""};
        break;
        case "RS":
        gearweapon = {type:"Revisionist Staff", range :"6 (2in)",size: sizeletter, l:7,m:8, h:9, traits:["AP:2"," Brawler:1"], mode:"M", slots:3, aux:0, location:"Manip", ammunition:0, pl:5, desc:""};
        break;
        case "RF":
        gearweapon = {type:"Rifle", range :"120-360/720",size: sizeletter, l:6,m:7, h:8, traits:["Precise"], mode:"D", slots:2, aux:1, location:"Manip", ammunition:5, pl:2, desc:""};
        break;
        case "RP":
        gearweapon = {type:"Rocket Pack", range :"60-180/360",size: sizeletter, l:7,m:8, h:9, traits:["AoE: 15m"," AP:1"," Limited Ammo"," See Desc"], mode:"D, I", slots:2, aux:0, location:"Shoulder,Torso", ammunition:4, pl:3, desc:"When attacking with this weapon, the user may increase the ammo used on the attack by 1 to add +1d6 to the attack roll against a single target. This may be done multiple times but can only be used once per target."};
        break;
        case "RC":
        gearweapon = {type:"Rotary Cannon", range :"60-180/360",size: sizeletter, l:5,m:6, h:7, traits:["Burst:2"], mode:"D", slots:3, aux:1, location:"Manip", ammunition:5, pl:2, desc:""};
        break;
        case "RL":
        gearweapon = {type:"Rotary Laser", range :"60-180/360",size: sizeletter, l:5,m:6, h:7, traits:["Burst:2"," Advanced"," Forearm"], mode:"D", slots:3, aux:0, location:"Manip", ammunition:0, pl:6, desc:""};
        break;
        case "SY":
        gearweapon = {type:"Scythe", range :"6 (2in)",size: sizeletter, l:6,m:7, h:8, traits:["AP:2/3/4"], mode:"M", slots:3, aux:0, location:"Manip", ammunition:0, pl:3, desc:""};
        break;
        case "SE":
        gearweapon = {type:"Shaped Explosives", range :"0 (0in)",size: sizeletter, l:8,m:9, h:10, traits:["AP:2/3/4"," Demo:4"," Brawler:-1"], mode:"M", slots:2, aux:0, location:"Manip", ammunition:0, pl:2, desc:""};
        break;
        case "SM":
        gearweapon = {type:"Smoke Grenades", range :"0-60/90",size: sizeletter, l:0,m:0, h:0, traits:["AoE: 5m/20m/25m"," Smoke"," Limited Ammo"," See Desc"], mode:"D", slots:1, aux:0, location:"Manip", ammunition:4, pl:1, desc:"Any AoE attack made by this weapon is Smoke and does no damage."};
        break;
        case "SC":
        gearweapon = {type:"Snub Cannon", range :"30-90/180",size: sizeletter, l:8,m:9, h:10, traits:["AP:2/3/4"," Demo:3"], mode:"D", slots:2, aux:1, location:"Manip", ammunition:3, pl:2, desc:""};
        break;
        case "SG":
        gearweapon = {type:"Spike Gun", range :"3 (0in)",size: sizeletter, l:6,m:7, h:8, traits:["AP:2/4/6"," Forearm"], mode:"D", slots:1, aux:0, location:"Manip", ammunition:0, pl:2, desc:""};
        break;
        case "ST":
        gearweapon = {type:"Staff", range :"6 (2in)",size: sizeletter, l:6,m:7, h:8, traits:[""], mode:"M", slots:2, aux:0, location:"Manip", ammunition:0, pl:1, desc:""};
        break;
        case "SMG":
        gearweapon = {type:"Submachine Gun", range :"0-90/180",size: sizeletter, l:5,m:6, h:7, traits:["Burst:2"," Backup"], mode:"D", slots:1, aux:1, location:"Manip", ammunition:4, pl:1, desc:""};
        break;
        case "TG":
        gearweapon = {type:"Tank Gun", range :"120-360/72",size: sizeletter, l:9,m:10, h:11, traits:["AP:3/4/5"," Demo:2"], mode:"D", slots:6, aux:4, location:"Manip, Torso", ammunition:1, pl:6, desc:""};
        break;
        case "VC":
        gearweapon = {type:"Vehicle Claymore", range :"-",size: sizeletter, l:7,m:8, h:9, traits:["Spray"," Mine"], mode:"-", slots:0, aux:0, location:"-", ammunition:0, pl:3, desc:""};
        break;
        case "VB":
        gearweapon = {type:"Vibro-Blade", range :"3 (0in)",size: sizeletter, l:7,m:8, h:9, traits:["AP:1/3/5"," Backup"], mode:"M", slots:1, aux:0, location:"Manip", ammunition:0, pl:1, desc:""};
        break;
        case "VK":
        gearweapon = {type:"Vibro-Katana", range :"3 (0in)",size: sizeletter, l:7,m:8, h:9, traits:["AP:2/4/6"], mode:"M", slots:2, aux:0, location:"Manip", ammunition:0, pl:2, desc:""};
        break;
        case "VR":
        gearweapon = {type:"Vibro-Rapier", range :"3 (0in)",size: sizeletter, l:6,m:7, h:8, traits:["Precise"," AP:1/3/5"], mode:"M", slots:2, aux:0, location:"Manip", ammunition:0, pl:2, desc:""};
        break;
        case "WH":
        gearweapon = {type:"Whip", range :"6 (2in)",size: sizeletter, l:5,m:6, h:7, traits:[""], mode:"M", slots:1, aux:0, location:"Manip", ammunition:0, pl:1, desc:""};
        break;
        case "WS":
        gearweapon = {type:"White Sand Grenade", range :"0-60/90",size: sizeletter, l:4,m:5, h:6, traits:["AoE:15m"," Corrosion"," Limited Ammo"], mode:"D, I", slots:2, aux:0, location:"Manip", ammunition:4, pl:6, desc:""};
        break;
        case "default":
        gearweapon = {type:" ", range :"",size: sizeletter, l:0,m:0, h:0, traits:[""], mode:"", slots:0, aux:0, location:"", ammunition:0, pl:0, desc:""};
        break;
        
    };
    console.log(gearweapon);
    return (gearweapon);
};



//return a integer for all array
const parseIntArray = (array) => {
    let output = [];
    array.forEach(element => {
        output.push(parseInt(element));
    });
    return output;
};
//function that capitalises first letter of a string and replaces _ with spaces
const capitalise = (string) => {
    let output = string.charAt(0).toUpperCase() + string.slice(1);
    output = output.replace(/_/g, " ");
    output = output.replace("Aoe:", "AoE:");
    output = output.replace("Ap:", "AP:");
    return output;
};
const deCapitalise = (array) => { 
    let newArray = [];
    array.forEach(item => {
      if (typeof item === 'string') { // check if item is a string
        let newItem = item.toLowerCase();
        newItem = newItem.replace(/ /g, "_"); // replace spaces with underscores
        newItem = newItem.replace(":_", ":"); //remove space after :
        //remove space at begining of string
        if (newItem.charAt(0) === "_") {
          newItem = newItem.slice(1);
        }
        newArray.push(newItem);
      } else {
        newArray.push(item);
      }
      //remove space after :

    });
    return newArray;
  };
   
//input new gearWeaponAttrs to a new repeating section
const newGearWeapon = (attrs) => {
    var newrowid = generateRowID();
    let output = {};
    gearWeaponAttrs.forEach(attr => {
        output["repeating_gearweapon_"+ newrowid +"_"+attr] = attrs[attr];
    });
    setAttrs(gearWeaponAttrs);

};



domains.forEach(function (domains) { //calculates expertise when improving or deleting skills
    on("change:repeating_skills-" + domains + ":skill_level remove:repeating_skills-" + domains + " sheet:opened", function () {
        repeatingSum('domain_expertise_' + domains ,'skills-' + domains, 'skill_level');
    });
});

//changes gear weapon traits to a string of traits that each gear weapon 
gearWeaponTraits.forEach(function (trait) {
    on('change:repeating_gearweapon:gear_weapon_traits_'+trait+' change:repeating_gearweapon:gear_weapon_traits_'+trait+'_selector', function() {
        let traitList = {};
        let selectList = {};
        let numCallbacks = 0;
        let traitString = "";
        let select1 = "";
        let select2 = "";
        let select3 = "";
        gearWeaponTraits.forEach(function(trait) {
            traitList[trait] = 0;
            selectList[trait] = 0;
            getAttrs([`repeating_gearweapon_gear_weapon_traits_${trait}`,"repeating_gearweapon_gear_weapon_traits_"+trait+"_selector"], function(v) {
                numCallbacks++;
                if (v[`repeating_gearweapon_gear_weapon_traits_${trait}`] !== undefined) {
                traitList[trait] = parseInt(v["repeating_gearweapon_gear_weapon_traits_"+trait]);
                } else {
                traitList[trait] = 0;
                }
                if (v["repeating_gearweapon_gear_weapon_traits_"+trait+"_selector"] !== undefined) {
                selectList[trait] = parseInt(v["repeating_gearweapon_gear_weapon_traits_"+trait+"_selector"]);
                } else {
                selectList[trait] = 0;
                }
                if (traitList[trait] == 1 && !gearWeaponTraitsX.includes(trait)) {//if trait is 1 and not a trait with x, make it trait
                    traitString += capitalise(`${trait}, `);
                    if (selectList[trait] == 1 && trait !='ammo') {
                    select1 += capitalise(`${trait}, `);
                    } else if (selectList[trait] == 2 && trait !='ammo') {
                    select2 += capitalise(`${trait}, `);
                    } else if (selectList[trait] == 3 && trait !='ammo') {
                    select3 += capitalise(`${trait}, `);
                    } else if (traitList[trait] == 1 && trait =='ammo') {
                    //select1 += capitalise(`ammo, `);
                    } 

                } else if (traitList[trait] == 1 && gearWeaponTraitsX.includes(trait)) {//if trait is 1 and is a trait with x, make it trait:1
                    traitString +=  capitalise(`${trait}:${traitList[trait]}, `);
                    if (selectList[trait] == 1 ) {
                    select1 += capitalise(`${trait}:${traitList[trait]}, `);
                    } else if (selectList[trait] == 2) {
                    select2 += capitalise(`${trait}:${traitList[trait]}, `);
                    } else if (selectList[trait] == 3) {
                    select3 += capitalise(`${trait}:${traitList[trait]}, `);
                    }
                    if (trait == 'aoe') {//change , to m,
                        traitString = traitString.replace(/,/g, "m, ");
                    };
                } else if (traitList[trait] > 1) {// if triat is greater than 1, make it trait:x
                    traitString +=  capitalise(`${trait}:${traitList[trait]}, `);
                    if (selectList[trait] == 1) {
                    select1 += capitalise(`${trait}:${traitList[trait]}, `);
                    } else if (selectList[trait] == 2) {
                    select2 += capitalise(`${trait}:${traitList[trait]}, `);
                    } else if (selectList[trait] == 3) {
                    select3 += capitalise(`${trait}:${traitList[trait]}, `);
                    }
                    if (trait == 'aoe') {//change , to m,
                        traitString = traitString.replace(/,/g, "m, ");
                    };
                }  else if (traitList[trait] < 0) {// if triat is less than 0, make it trait:-x
                    traitString +=  capitalise(`${trait}:${traitList[trait]}, `);
                    if (trait == 'aoe') {//change , to m,
                        traitString = traitString.replace(/,/g, "m, "); 
                    };
                }
            

                setAttrs({
                    repeating_gearweapon_gear_weapon_traits: select1,
                    repeating_gearweapon_gear_weapon_traits_selector_2: select2,
                    repeating_gearweapon_gear_weapon_traits_selector_3: select3,
                });
            });
            
        });
         
    });
});

//change gearweapon_blitz_check to 1 if blitz_check is checked
/*on("sheet:opened change:blitz_check", function () {
    getSectionIDs("repeating_gearweapon", function (idarray) {
        let fieldNames = [];
        idarray.forEach(function (id) { //forEach is an alternative to _each, native to javascript.
            fieldNames.push("repeating_gearweapon_" + id + "_blitz_check");
        });
        getAttrs(fieldNames, function (values) {
            let output = {};  // create an object literal, to hold the outputs key/value pairs.
            idarray.forEach(id => { // this is an alternative syntax, works the same as the previous forEach, but is simpler.
                output["repeating_gearweapon_" + id + "_blitz_check"] = values["blitz_check"];
            });
            setAttrs(output);
        });
    });
});
*/
// --- Damage Calulations ---
on('change:repeating_damage remove:repeating_damage sheet:opened', function() { //calculates total damage
    repeatingSum(["damage_shell","damage_system"],"damage",["damage_shell_check","damage_system_check", "damage_level"]);
}); 

on('change:repeating_gear-damage remove:repeating_gear-damage sheet:opened', function() { //calculates gear damage
    repeatingSum("gear_damage_total","gear-damage",["gear_damage_level", "gear_damage_integrity"]);
}); 


//    -----  Weapon Domain Calcualtions    ----- 
on('change:repeating_weapon sheet:opened', function() { //calculates domains to expertise used in personal weapons
    getAttrs(["repeating_weapon_weapon_domain"], (values) => {
        let domain = values["repeating_weapon_weapon_domain"];//gets domain name
        getAttrs(["expertise_" +  domain], (values) => {
            setAttrs({"repeating_weapon_weapon_expertise": values["expertise_" + domain]});
        });
    });
    repeatingSum("weapon_burden_total","weapon",["weapon_burden"]);    //calculate weapon burden
}); 
 
//
on('change:repeating_gearweapon sheet:opened change:skill_total', function(eventInfo) { //calculates domains to expertise used in personal weapons
    getAttrs(["repeating_gearweapon_gear_weapon_domain"], (values) => {
        console.log(values["repeating_gearweapon_gear_weapon_domain"]);
        let domain = values["repeating_gearweapon_gear_weapon_domain"];//gets domain name

        getAttrs(["expertise_" + domain,"gear_"+ domain, ], (values) => {
            let expertise = values["expertise_" + domain];//gets expertise value
            let tn_bonus = values["gear_"+ domain];//gets tn bonus value
            setAttrs({
                repeating_gearweapon_gear_weapon_expertise: expertise
            });
            setAttrs({
                repeating_gearweapon_gear_weapon_tn_bonus: tn_bonus
            });
        });
    });
}); 




on('change:repeating_personal-equipment sheet:opened', function() { //calculates burden
    console.log("getting personal burden");
    repeatingSum("personal_equipment_burden_total","personal-equipment",["personal_equipment_burden"]);
});

// ---- roll buttons  ----
domains.forEach(function (domain) { // roll buttons for skill section
    on("clicked:repeating_skills-" + domain + ":tumble", function () {
        //roller("repeating_skills-"+domain+"_skill_name","name_"+domain,"repeating_skills-" +domain+"_skill_level","expertise_"+domain,"bonus_dice","tn","tn_bonus","reliable","repeating_skills-"+domain+"_skill_familiar");
        getAttrs(["whisper","repeating_skills-"+domain+"_skill_name","name_"+domain,"repeating_skills-" +domain+"_skill_level","expertise_"+domain,"bonus_dice","tn","tn_bonus","reliable","repeating_skills-"+domain+"_skill_familiar"], (values) => {
            let whisper = values["whisper"];
            let names = [values["repeating_skills-"+domain+"_skill_name"],values["name_"+domain]];
            let expertise = parseInt(values["expertise_"+domain]);
            let dice = parseIntArray([values["repeating_skills-" +domain+"_skill_level"],values["bonus_dice"]]);
            let tn = parseIntArray([values["tn"],values["tn_bonus"]]);
            let reliabledice = parseIntArray([values["reliable"],values["repeating_skills-"+domain+"_skill_familiar"]]) ;

            rollArray(whisper,names,expertise,dice,tn,reliabledice);
        });
    });
});




gearSkills.forEach(function (gearSkills) { // roll buttons for gear skills
    on("clicked:repeating_skills-"+ gearSkills + ":geartumble", function () {
        //roller("repeating_skills-"+gearSkills+"_skill_name","name_"+gearSkills,"repeating_skills-" +gearSkills+"_skill_level","expertise_"+gearSkills,"bonus_dice","tn","gear_"+gearSkills,"reliable","repeating_skills-"+gearSkills+"_skill_familiar"); 

        getAttrs(["whisper","repeating_skills-"+gearSkills+"_skill_name","name_"+gearSkills,"repeating_skills-" +gearSkills+"_skill_level","expertise_"+gearSkills,"bonus_dice","tn","tn_bonus","gear_"+gearSkills,"reliable","repeating_skills-"+gearSkills+"_skill_familiar"], (values) => {
            let whisper = values["whisper"];
            let names = [values["repeating_skills-"+gearSkills+"_skill_name"],values["name_"+gearSkills]];
            let expertise = parseInt(values["expertise_"+gearSkills]);
            let dice = parseIntArray([values["repeating_skills-" +gearSkills+"_skill_level"],values["bonus_dice"]]);
            let tn = parseIntArray([values["tn"],values["gear_"+gearSkills],values["tn_bonus"]]);
            let reliabledice = parseIntArray([values["reliable"],values["repeating_skills-"+gearSkills+"_skill_familiar"]]) ;

            rollArray(whisper,names,expertise,dice,tn,reliabledice);
        });
    });
});


on("clicked:repeating_weapon:tumble", function () { //roll for personal weapons
    //roller("repeating_weapon_weapon_name","repeating_weapon_weapon_domain","repeating_weapon_skill_level","repeating_weapon_weapon_expertise","bonus_dice","tn","tn_bonus","reliable","repeating_weapon_skill_familiar");
    getAttrs(["whisper","repeating_weapon_weapon_name","repeating_weapon_weapon_domain","repeating_weapon_skill_level","repeating_weapon_weapon_expertise","bonus_dice","tn","tn_bonus","reliable","repeating_weapon_skill_familiar"], (values) => {
        let whisper = values["whisper"];
        let names = [values["repeating_weapon_weapon_name"],values["repeating_weapon_weapon_domain"]];
        let expertise = parseInt(values["repeating_weapon_weapon_expertise"]);
        let dice = parseIntArray([values["repeating_weapon_skill_level"],values["bonus_dice"]]);
        let tn = parseIntArray([values["tn"],values["tn_bonus"]]);
        let reliabledice = parseIntArray([values["reliable"],values["repeating_weapon_skill_familiar"]]) ;

        rollArray(whisper,names,expertise,dice,tn,reliabledice);
    });
});

on("clicked:repeating_gearweapon:tumble", function () {//roller for gear weapons
    //roller("repeating_gearweapon_gear_weapon_type","repeating_gearweapon_gear_weapon_domain","repeating_gearweapon_gear_skill_level","repeating_gearweapon_gear_weapon_expertise","bonus_dice","tn","repeating_gearweapon_gear_weapon_tn_bonus","reliable","repeating_gearweapon_gear_weapon_skill_familiar");
    getAttrs(["whisper","repeating_gearweapon_gear_weapon_type","repeating_gearweapon_gear_weapon_domain","repeating_gearweapon_gear_skill_level","repeating_gearweapon_gear_weapon_expertise","bonus_dice","tn","tn_bonus","repeating_gearweapon_gear_weapon_tn_bonus","reliable","repeating_gearweapon_gear_weapon_skill_familiar"], (values) => {
        let whisper = values["whisper"];
        let names = [values["repeating_gearweapon_gear_weapon_type"],values["repeating_gearweapon_gear_weapon_domain"]];
        let expertise = parseInt(values["repeating_gearweapon_gear_weapon_expertise"]);
        let dice = parseIntArray([values["repeating_gearweapon_gear_skill_level"],values["bonus_dice"]]);
        let tn = parseIntArray([values["tn"],  values["repeating_gearweapon_gear_weapon_tn_bonus"],values["tn_bonus"]]);
        let reliabledice = parseIntArray([values["reliable"],values["repeating_gearweapon_gear_weapon_skill_familiar"]]) ;

        rollArray(whisper,names,expertise,dice,tn,reliabledice);
    });
});

//function that takes in arrays of names, dicepool, tn and reliable and outputs the sums of each
//names[] is an array [skillname,domain]
//expertise is a number
//dicepool[] is an array [skilllevel,bonusdice....] as values
//tn[] is an array [tn,tnbonus....] as values
//reliable[] is an array [reliable,reliablebonus....] as values

const rollArray = (whisper,names,expertise,dice,tnArray,reliabledice) => {
    console.log("rollArray");
    console.log(names,expertise,dice,tnArray,reliabledice);
    let skillname = names[0];
    let skilllevel = parseInt(dice[0]);
    let domain = names[1];
    let tn = parseInt(tnArray[0]);
    let rollexpression = "d6kl1";

    //calculate bonus dice as all dice[] exept the first
    let bonus = 0;
    for (i=1;i<dice.length;i++) {
        bonus = bonus + dice[i];
    }; 

    //calculate tn bonus as all tn[] exept the first
    let tnBonus = 0;
    for (i=1;i<tnArray.length;i++) {
        tnBonus = tnBonus + tnArray[i];
        console.log("tnBonus:",tnBonus);
    };

    tn = tn - (tnBonus);//add tn bonus to tn
    console.log("tn2:",tn,"tnBonus:",tnBonus);
    // reliable is the sum of reliabledice[]
    let reliable = 0;
    for (i=0;i<reliabledice.length;i++) {
        reliable = reliable + reliabledice[i];
    };

    let reliableRoll = Math.abs(reliable);//need to make positive
    let diceRoll = Math.abs(skilllevel + bonus);

    if (expertise == 3){ // expertise 3 tn bonus
        tn--;
        console.log("tn reduced due to Expertise 3");
    }; 

    if (tn > 6) { //tn over 6 is converted to bonus dice at 1:2
        bonus = bonus - Math.floor((tn - 6)/2);
        tn = 6;
        console.log("tn reduced due to tn over 6. bonus:", bonus, tn);
    };
    
    if (skilllevel == 0) {
        bonus--;
        console.log("bonus reduced due to skill level 0",bonus,skilllevel);
    }; 

    if (skilllevel + bonus < 1) {// work out if dice pool is keeping or dropping dice
        console.log("skilllevel + bonus < 1",skilllevel,bonus);
       rollexpression = "d6kl1";
    } else {
        rollexpression = "d6k1";  
    };
    domain = capitalise(domain);
    console.log(skillname, domain, "lv:"+ skilllevel, "Ex:"+ expertise,bonus,"tn:"+ tn,tnBonus,"Rel:"+ reliable);
    startRoll(whisper+"&{template:diceroll} {{title=@{character_name} using "+skillname+"}} {{subtitle= Expertise ("+domain+"):"+expertise+" TN("+tn+")| Skill="+skilllevel+"+Bonus="+bonus+"(Reliable="+reliable+")}}  {{roll=[[("+diceRoll+"+"+reliableRoll+"+1)"+rollexpression+"]] }} {{MOS=[[0]]}} {{doubles=[["+expertise+"]]}} {{reliable=[["+reliable+"]]}} {{six=[[6]]}} {{five=[[5]]}} {{four=[[4]]}} {{three=[[3]]}} {{two=[[2]]}} {{one=[[1]]}}  {{changedsix=[[6]]}} {{changedfive=[[5]]}} {{changedfour=[[4]]}} {{changedthree=[[3]]}} {{changedtwo=[[2]]}} {{changedone=[[1]]}}" , (diceroll) => {
        let total = diceroll.results.roll.result;
        let dice = diceroll.results.roll.dice;
        let MOS = 0;
        let doubles = 0;
        const total6s = dice.filter(d => d === 6).length;
        const total5s = dice.filter(d => d === 5).length;
        const total4s = dice.filter(d => d === 4).length;
        const total3s = dice.filter(d => d === 3).length;
        const total2s = dice.filter(d => d === 2).length;
        const total1s = dice.filter(d => d === 1).length;

        const targetArray = [0,total1s,total2s,total3s,total4s,total5s,total6s];
        const reliableArray = [reliable,0,0,0,0,0,0];//records reliable dice
        console.log(targetArray,total);
        let tempArray = targetArray;
        
        //remove x reliable dice
        //if reliable is greater than 1, remove x lowest 
        if (reliableArray[0] > 0) {
            console.log("reliable is greater than 1");
            while (reliableArray[0] > 0) {
                for (i=1;i<7;i++) {
                    if (tempArray[i] > 0) {
                        tempArray[i]--;
                        reliableArray[i]--;
                        reliableArray[0]--;
                        i = 7;
                    };
                };
            };
        };

        //if reliable is less than 1, remove x highest
        if (reliableArray[0] < 0) {
            console.log("reliable is less than 1");
            while (reliableArray[0] < 0) {
                for (i=6;i>0;i--) {
                    if (tempArray[i] > 0) {
                        tempArray[i]--;
                        reliableArray[i]--;
                        reliableArray[0]++;
                        i = 0;
                    };
                };
            };
        };
        //calculate total
        //if (skilllevel + bonus) is >0 find highest number
        if ((skilllevel + bonus) > 0) { 
            for (i=6;i>0;i--) {
                if (tempArray[i] > 0) {
                    console.log("calculate high total :"+i);
                    total = i;
                    i = 0;
                };
            };
        };            
        //if (skilllevel + bonus) is <1 find lowest number
        if ((skilllevel + bonus) < 1) {
            for (i=1;i<7;i++) {
                if (tempArray[i] > 0) {
                    console.log("calculate low total :"+i);
                    total = i;
                    i = 7;
                };
        };
    };
        tempArray[total]--;//take out the total from the array

        if (total < tn) { //tn is bigger, calculate MOF
        } else {  //tn is smaller, calculate MOS
            for (i=tn;i<=total;i++) {
                MOS = MOS + tempArray[i];
            };
        };

        if (expertise > 1) {
            for (i=1;i<tn;i++) {
                if (tempArray[i] > 1){
                    tempArray[i] = tempArray[i] - 2;
                    doubles = i;
                    total++;
                    i = tn;
                    
                    console.log("doubles:"+doubles+" added " + tempArray);
                };
            };
        };
            
            total = total + MOS;
            MOS = total - tn;
            
            console.log("temp:"+tempArray,"reliable+:"+reliableArray);

        finishRoll(diceroll.rollId, {
            roll: total,
            MOS:    MOS,
            six:    total6s,
            five:   total5s,
            four:   total4s,
            three:  total3s,
            two:    total2s,
            one:    total1s,
            changedsix:    reliableArray[6],
            changedfive:   reliableArray[5],
            changedfour:   reliableArray[4],
            changedthree:  reliableArray[3],
            changedtwo:    reliableArray[2],
            changedone:    reliableArray[1],
            doubles: doubles
        });
    });
    
};  

// ---  Button Functions  ---
//round start button
on("clicked:round_start", function () { //
    console.log("round start button");
    getAttrs(["whisper","posture","action_points_max"] , (values) => {
        let posture = capitalise(values["posture"]);
        console.log("posture:"+posture);
        setAttrs({
            action_points: values["action_points_max"]
        });
        startRoll(values["whisper"]+"&{template:custom} {{title=@{character_name} Round Start}} {{Posture = "+posture+"}} ", (diceroll) => {
            finishRoll(diceroll.rollId, {
                roll: 0
            });
        });
    });
});
//activation start button
on("clicked:activation_start", function () {
    console.log("activation start button");
    getAttrs(["whisper","posture","action_points_max","action_penalty"] , (values) => {
        let posture = capitalise(values["posture"]);
        let actionPenalty = parseInt(values["action_penalty"]);
        console.log("posture:"+posture);
        startRoll(values["whisper"]+"&{template:custom} {{title=@{character_name} Activation Start}} {{Posture = "+posture+"}} {{Actions Declared = "+actionPenalty+"}}", (diceroll) => {
            finishRoll(diceroll.rollId, { 
                roll: 0
            });
        });
    });
});
//initiative button
on("clicked:initiative_start", function () { //
    console.log("initiative button");
    getAttrs(["whisper","initiative"] , (values) => {
        let initiative = parseInt(values["initiative"]);
        console.log("initiative:"+initiative);
        startRoll(values["whisper"]+"&{template:custom} {{@{character_name} Initiative=[["+initiative+" &{tracker}]]}}", (diceroll) => {
            finishRoll(diceroll.rollId, {
                roll: initiative
            });
        });
    });
});

    
//old roller function
/*const roller = (getskillname,getdomainname,getskilllevel,getexpertise,getbonus,gettn,gettnBonus,getReliable,getFamilar) => {
    getAttrs([getskillname,getdomainname,getskilllevel,getexpertise,getbonus,gettn,gettnBonus,getReliable,getFamilar], (values) => {
        let skillname = values[getskillname];
        let domain = values[getdomainname];
        let skilllevel = parseInt(values[getskilllevel]);
        let expertise = parseInt(values[getexpertise]);
        let bonus = parseInt(values[getbonus]);
        let tn = parseInt(values[gettn]);
        let tnBonus = parseInt(values[gettnBonus]);
        tnBonus = tnBonus*-1;//make negative
        let reliable =  parseInt(values[getReliable]);
        let familiar = parseInt(values[getFamilar]);
        reliable = reliable + familiar;//add familiar to reliable dice
        let reliableRoll = Math.abs(reliable);//need to make positive
        tn = tn + tnBonus;
        if (expertise == 3){ // expertise 3 TN bonus
            tn--;
            console.log("TN reduced due to Expertise 3");
        }; 
        if (tn > 6) { //TN over 6 is converted to bonus dice at 1:2
            bonus = bonus - Math.floor((tn - 6)/2);
            tn = 6;
        };
        console.log("skilllevel:"+skilllevel);
        if (skilllevel == 0) {
            bonus--;
            console.log("bonus reduced due to skill level 0",bonus,skilllevel);
        }; 
        // if skillevel+bonus+reliable is less than 1, roll 2d6kl1
        let pooldice = Math.abs(skilllevel + bonus);
        console.log("pooldice:"+pooldice);
        let rolldice = "d6k1";

        if (skilllevel + bonus < 1) {
            console.log("skilllevel + bonus < 1");
            let rolldice = "d6kl1";
        } else {
            let rolldice = "d6k1";  
        };

        console.log(skillname, domain, "lv:"+ skilllevel, "Ex:"+ expertise,bonus,"tn:"+ tn,tnBonus,"Rel:"+ reliable);
        startRoll("&{template:diceroll} {{title=@{character_name} using "+skillname+"}} {{subtitle= Expertise ("+domain+"):"+expertise+" TN("+tn+")| Skill="+skilllevel+"+Bonus="+bonus+"(Reliable="+reliable+")}}  {{roll=[[("+pooldice+"+"+reliableRoll+"+1)"+rolldice+"]] }} {{MOS=[[0]]}} {{doubles=[["+expertise+"]]}} {{reliable=[["+reliable+"]]}} {{six=[[6]]}} {{five=[[5]]}} {{four=[[4]]}} {{three=[[3]]}} {{two=[[2]]}} {{one=[[1]]}}  {{changedsix=[[6]]}} {{changedfive=[[5]]}} {{changedfour=[[4]]}} {{changedthree=[[3]]}} {{changedtwo=[[2]]}} {{changedone=[[1]]}}" , (diceroll) => {
            let total = diceroll.results.roll.result;
            let dice = diceroll.results.roll.dice;
            let MOS = 0;
            let doubles = 0;
            const total6s = dice.filter(d => d === 6).length;
            const total5s = dice.filter(d => d === 5).length;
            const total4s = dice.filter(d => d === 4).length;
            const total3s = dice.filter(d => d === 3).length;
            const total2s = dice.filter(d => d === 2).length;
            const total1s = dice.filter(d => d === 1).length;

            const targetArray = [0,total1s,total2s,total3s,total4s,total5s,total6s];
            const reliableArray = [reliable,0,0,0,0,0,0];//records reliable dice
            console.log(targetArray,total);
            let tempArray = targetArray;
            
            //remove x reliable dice
            //if reliable is greater than 1, remove x lowest 
            if (reliableArray[0] > 0) {
                console.log("reliable is greater than 1");
                while (reliableArray[0] > 0) {
                    for (i=1;i<7;i++) {
                        if (tempArray[i] > 0) {
                            tempArray[i]--;
                            reliableArray[i]--;
                            reliableArray[0]--;
                            i = 7;
                        };
                    };
                };
            };

            //if reliable is less than 1, remove x highest
            if (reliableArray[0] < 0) {
                console.log("reliable is less than 1");
                while (reliableArray[0] < 0) {
                    for (i=6;i>0;i--) {
                        if (tempArray[i] > 0) {
                            tempArray[i]--;
                            reliableArray[i]--;
                            reliableArray[0]++;
                            i = 0;
                        };
                    };
                };
            };
            //calculate total
            //if (skilllevel + bonus) is >0 find highest number
            if ((skilllevel + bonus) > 0) { 
                for (i=6;i>0;i--) {
                    if (tempArray[i] > 0) {
                        console.log("calculate high total :"+i);
                        total = i;
                        i = 0;
                    };
                };
            };            
            //if (skilllevel + bonus) is <1 find lowest number
            if ((skilllevel + bonus) < 1) {
                for (i=1;i<7;i++) {
                    if (tempArray[i] > 0) {
                        console.log("calculate low total :"+i);
                        total = i;
                        i = 7;
                    };
            };
        };
            tempArray[total]--;//take out the total from the array

            if (total < tn) { //TN is bigger, calculate MOF
            } else {  //tn is smaller, calculate MOS
                for (i=tn;i<=total;i++) {
                    MOS = MOS + tempArray[i];
                };
            };

            if (expertise > 1) {
                for (i=1;i<tn;i++) {
                    if (tempArray[i] > 1){
                        tempArray[i] = tempArray[i] - 2;
                        doubles = i;
                        total++;
                        i = tn;
                        
                        console.log("doubles:"+doubles+" added " + tempArray);
                    };
                };
            };
                
                total = total + MOS;
                MOS = total - tn;
                
                console.log("temp:"+tempArray,"reliable+:"+reliableArray);

            finishRoll(diceroll.rollId, {
                roll: total,
                MOS:    MOS,
                six:    total6s,
                five:   total5s,
                four:   total4s,
                three:  total3s,
                two:    total2s,
                one:    total1s,
                changedsix:    reliableArray[6],
                changedfive:   reliableArray[5],
                changedfour:   reliableArray[4],
                changedthree:  reliableArray[3],
                changedtwo:    reliableArray[2],
                changedone:    reliableArray[1],
                doubles: doubles
            });
        });
    });
};*/

   /*  ======================================================
            BEGIN MULTIVERSAL SHEET WORKER GENERATOR
    ======================================================
    Use this script to build sheet workers automatically.
    Place this section in your script block, preferably at the end. 
    Fill the two data objects, multistats and multifunctions, with your details.
    VERSION 1.
    READMORE: https://app.roll20.net/forum/permalink/7664925/
    ======================================================*/

const multistats = {
    damage_total: {rule: 'sum', attributes: ['damage_shell','damage_system']},
    burden_total: {rule: 'sum', attributes: ['personal_equipment_burden_total','weapon_burden_total']},
    gear_gunnery: {rule: 'sum', attributes: ['gear_gunnery_base','gear_maintainance_penalty']},
    gear_pilot: {rule: 'sum', attributes: ['gear_pilot_base','gear_maintainance_penalty']},
    gear_electronicwarfare: {rule: 'sum', attributes: ['gear_electronicwarfare_base','gear_maintainance_penalty']},
    skill_total: {rule: 'sum', attributes: ['domain_expertise_athletics','domain_expertise_awareness','domain_expertise_business','domain_expertise_craft','domain_expertise_culture','domain_expertise_electronicwarfare','domain_expertise_electronics','domain_expertise_gunnery','domain_expertise_hardscience','domain_expertise_influence','domain_expertise_institutions','domain_expertise_investigation','domain_expertise_mechanics','domain_expertise_medicine','domain_expertise_melee','domain_expertise_pilot','domain_expertise_showmanship','domain_expertise_socialscience','domain_expertise_survival','domain_expertise_tactics']},

};
domains.forEach(domains => {
    multistats[`expertise_${domains}`] = {rule: 'calc_expertise', attributes: [`domain_expertise_${domains}`]};
});



const multifunctions = {
    sum: (arr) => arr.reduce((total, add) => total + add),  // add up any number of attributes
    pick_from_list: (arr) => arr[ arr[0] ], // get the value of an attribute, from a select.



    calc_expertise: function(arr) { // calculate expertise based on total skill level
        if (arr[0] < 6){
            return 0;
        } else if (arr[0] < 9) {
            return 1;
        } else if (arr[0] < 13) {
            return 2;
        } else if (arr[0] > 12) {
            return 3;
        } else {
            return 0;}
    },

};

// ======================================================*/
//           DO NOT EDIT BELOW THIS LINE                 //
// ======================================================*/
const mvlog = (title, text, color = 'green', style='font-size:12px; font-weight:normal;', headerstyle = 'font-size:13px; font-weight:bold;') => {
    let titleStyle = `color:${color}; ${headerstyle} text-decoration:underline;`;
    let textStyle = `color:${color}; ${style}`;
    const output = `%c${title}:%c ${text}`;
    console.log(output,titleStyle,textStyle);
};
// can use $ placeholder in attribute names. This converts '$_stat' to 'repeating_section_stat'
const rep = '$'; //placeholder for repeating_section_
const makeRepeatingName = (attribute, section) => attribute.startsWith(rep) ? attribute.replace(rep, `repeating_${section}_`) : attribute;
const makeRepeatingAttributes = (attributes, section) => attributes.map(a => makeRepeatingName(a, section));
const makeRepeatingID = (a, section, id) => a.replace(`repeating_${section}_`,`repeating_${section}_${id}_`);
// given array of attributes, find if any have repeating_ and return the section name
// section name will be 2nd element of name split on "_"
const findSection = (arr) => {
    const s = arr.find(a => a.includes('repeating_'));
    const section = (s ? s.split('_')[1] : null);
    return section;
};

// check if attribute is one where a repeating section attribute depends on attributes both inside and outside the repeating section
const isMixed = (attributes, destination) => {
    const some = someRepeating(attributes);
    const all = allRepeating(attributes);
    const repeatingdestination = destination.startsWith('repeating_');
    return (some && !all && repeatingdestination);
};
const allRepeating = attributes => attributes.every(r => r.startsWith('repeating_'));
const someRepeating = attributes => attributes.some(r => r.startsWith('repeating_'));

const defaultDataType = 'array'; // might change this to object
const getData = (values, data = 'a', isnumbers = 0) => {
    // only a is functional right now, so this function is redundant.
    switch(data.charAt(0).toLowerCase()) {
        case 'o': return values;
        case 'a': return Object.values(values).map(i => 1 === isnumbers ? parseInt(i) ||0 : (0 === isnumbers ? +i || 0 : i));
        case 'v': return Object.values(values)[0];
    }
};

const processMax = (destination, result, max) => {
    const settings = {};
    if(max === 'current' || max === 'both') settings[destination] = result;
    if(max === 'max' || max === 'both') settings[`${destination}_max`] = result;
    return settings;
};

const isFunction = value => value && (Object.prototype.toString.call(value) === '[object Function]' || 'function' === typeof value || value instanceof Function);

const processFunction = (destination, values, section) => {
    const rule = multistats[destination].rule;
    const func = isFunction(rule) ? rule:  multifunctions[rule]; // need to test if this works for arrow functions
    const data = multistats[destination].data || defaultDataType;
    const v = getData(values, data);
    const modifier = multistats[destination].modifier || null;
    const result = func(v, modifier);
    mvlog(`${makeRepeatingName(destination,section).toUpperCase()} MULTIFUNCTION`, `RULE: ${rule}; VALUES: ${JSON.stringify(values)}; RESULT: ${result}`);
    return result;
};

Object.keys(multistats).forEach(destination => {
    // get the section name if it exists. It is needed for mixed workers
    const attributes_base = multistats[destination].attributes;
    const section = multistats[destination].section || findSection(attributes_base) || null;
    const attributes = makeRepeatingAttributes(attributes_base, section);
    const realdestination = makeRepeatingName(destination, section); // needed in case of $ in destination
    mvlog(`MULTIVERSAL- ${realdestination}`,`${attributes.join(', ')}`,'green');
    if (isMixed(attributes, realdestination)) {
        const changes = attributes.reduce((change, step) => `${change} change:${step.replace('repeating_' + section + '_','repeating_' +section + ':')}`,
            `remove:repeating_${section} sheet:opened`);
        on(changes.toLowerCase(), function (event) {
            const trigger = event.sourceAttribute || '';
            const triggerRow = (trigger && trigger.includes('_') && trigger.length >2) ? trigger.split('_')[2] : '';
            // if triggerRow, only update initial row
            getSectionIDs(`repeating_${section}`, function (ids) {
                const sectionAtts = attributes.filter(f => f.startsWith(`repeating_${section}`));
                const fixedAtts = attributes.filter(f => !f.startsWith(`repeating_${section}`));
                if (triggerRow) ids = [triggerRow];
                const fieldNames = ids.reduce( (m,id) => [...m, ...(sectionAtts.map(field => makeRepeatingID(field,section,id) ))],[]);
                getAttrs([...fieldNames,...fixedAtts], function (values) {
                    let settings = {};
                    const max = multistats[destination].max || 'current';
                    const fixedValues = fixedAtts.reduce((obj, a) => {
                        obj[a] = values[a];
                        return obj;
                    }, {});
                    ids.forEach(id => {
                        // first get all relevant attributes for this row of the section
                        const sectionValues = sectionAtts.reduce((obj, a) => {
                            const att = makeRepeatingID(a, section, id);
                            obj[att] = values[att]; 
                            return obj;}, {});
                        // now apply the formula for this row and add to settings
                        const combinedValues = {...sectionValues,...fixedValues};
                        const result = processFunction(destination,combinedValues, section);
                        const tempDestination = makeRepeatingID(realdestination,section,id); 
                        const tempSettings = processMax(tempDestination, result, max);
                        settings = Object.assign({}, settings, tempSettings);
                    });
                    setAttrs(settings);
                });
            });
        });
    } else {
        const changes = attributes.reduce((change, step) => `${change} change:${step.replace('repeating_' + section + '_','repeating_' +section + ':')}`,
            `${someRepeating([...attributes,realdestination]) ? '' : 'sheet:opened '}${section ? `remove:repeating_${section}` : ''}`);
        on(changes.toLowerCase(), function () {
            getAttrs(attributes, function (values) {
                const result = processFunction(destination,values, section);
                const max = multistats[destination].max || 'current';
                const settings = processMax(realdestination, result, max);
                setAttrs(settings);
            });
        });
    }
});
/* ===== Repearing Sum PARAMETERS ==========
destinations = the name of the attribute that stores the total quantity
section = name of repeating fieldset, without the repeating_
fields = the name of the attribute field to be summed
      can be a single attribute: 'weight'
      or an array of attributes: ['weight','number','equipped']
extras: everything after the fields parameter is optional and can be in any order:
    'ceil'
    'round'
    'floor'
    'ceil: 3'
    'round: -2'
    'round: equipment_weight, equipment_cost|2
        you want to round the final total. 
        If you supply a field name, it will round just that total. You can supply multiple fields, separated by commas.
        If you supply a number, it will round to that many digits. 
        round:1 rounds to tenths; floor:-3 rounds down to thousands, so 3567 would be shown as 3000.
        If you dont supply a number, it assumes 0, and returns an integer (whole numbers).
        IMPORTANT: if you list ANY field, then ALL fields to be rounded must be specifically stated.
        Don't do this: floor:equipment_weight|2, round,
    
    'multiplier: 2'
    'multiplier:equipment_weight|2'
    'multiplier: equipment_weight|2, equipment_cost|3'
        Multiplier will apply a multiple to the final total. You can multiple all fields, or specific fields.
        It doesnt apply to attributes being added from outside the repeating section.
        Multiplier can be negative, representing a subtraction.

    'an_attribute'
    'an_attribute:-1'
    'an_attribute:0.5'
    'an_attribute:equipment_cost'
    'an_attribute:equipment_cost|-1'
    'an_attribute:equipment_cost|-1,equipment_weight|2'
        You can also list attributes from outside the repeating section. Don't try to add attributes from other repeating sections.
        by default, the listed attribute will be added to all fields.
        You can list one or more fields, and it will only be added to those fields.
        You can list a number: the attribute will be multiplied by that amount. So -1 subtracts the attribute.
    */
    const repeatingSum = (destinations, section, fields, ...extras) => {
        const isNumber = value => parseFloat(value).toString() === value.toString();
        const isOption = value => [...checks.valid, ...checks.roundtypes].includes(value);
        const isRounding = value => checks.roundtypes.includes(value);
        const isFraction = value => value.includes('/') && !(value.includes(',') || value.includes('|'));
        const getTrimmed = value => value.toLowerCase().replace(/\s/g, '');
        const getRounded = (type, value, pow) => (Math[type](value * Math.pow(10, pow)) / Math.pow(10, pow)).toFixed(Math.max(0, pow));
        const getFraction = (value) => /*{ console.log(`value: ${value}`); */
            parseInt(value.split('/')[0]) / parseInt(value.split('/')[1]);
        const getMultiplier = (value, rounding = 1) => 'undefined' === typeof value ? (rounding ? 0: 1) : (
            isNumber(value) ? parseFloat(value) : (isFraction(value) ? getFraction(value) : value));
        if (!Array.isArray(destinations)) destinations = [getTrimmed(destinations)];
        if (!Array.isArray(fields)) fields = [getTrimmed(fields)];
        const fields_trimmed = fields.map(field => getTrimmed(field).split(':')[0]);
        const subfields = fields_trimmed.slice(0,destinations.length);
        const checks = { valid: ['multiplier'], roundtypes: ['ceil', 'round', 'floor'] };
        let properties = {attributes: {}, options: {}};
        extras.forEach(extra => {
            const [prop, v] = getTrimmed(extra).split(':');
            const multiplier_maybe = getMultiplier(v, isRounding(prop));
            const obj = isNumber(multiplier_maybe) ? subfields.reduce((obj,field) => {
                obj[field] = multiplier_maybe;
                return obj;
            },{}) : multiplier_maybe.split(',').reduce((obj, item) => {
                const [stat, value] = item.split('|');
                const multiplier = getMultiplier(value, isRounding(prop));
                obj[stat] = multiplier;
                return obj;
            }, {});
            properties[isOption(prop) ? 'options' : 'attributes'][prop] = obj;
        });
        getSectionIDs(`repeating_${section}`, idArray => {
            const attrArray = idArray.reduce((m, id) => [...m, ...(fields_trimmed.map(field => `repeating_${section}_${id}_${field}`))], []);
            getAttrs([...attrArray, ...Object.keys(properties.attributes)], v => {
                const getValue = (section, id, field) => v[`repeating_${section}_${id}_${field}`] === 'on' ? 1 : parseFloat(v[`repeating_${section}_${id}_${field}`]) || 0;
                const commonMultipliers = (fields.length <= destinations.length) ? [] : fields.splice(destinations.length, fields.length - destinations.length);
                const output = destinations.reduce((obj, destination, index) => {
                    let sumTotal = idArray.reduce((total, id) => total + getValue(section, id, fields_trimmed[index]) * commonMultipliers.reduce((subtotal, mult) => subtotal * ((!mult.includes(':') || mult.split(':')[1].split(',').includes(fields_trimmed[index])) ? getValue(section, id, mult.split(':')[0]) : 1), 1), 0);
                    sumTotal *= (properties.options.hasOwnProperty('multiplier') && Object.keys(properties.options.multiplier).includes(fields_trimmed[index])) ? (parseFloat(properties.options.multiplier[fields_trimmed[index]]) || 0): 1;
                    sumTotal += Object.entries(properties.attributes).reduce((total, [key, value]) => 
                        total += (value.hasOwnProperty(fields_trimmed[index]) ? parseFloat(v[key] || 0) * (parseFloat(value[fields_trimmed[index]]) || 1): 0) , 0);
                    checks.roundtypes.forEach(type => {
                        if (properties.options.hasOwnProperty(type)) {
                            if (Object.keys(properties.options[type]).includes(fields_trimmed[index])) {
                                sumTotal = getRounded(type, sumTotal, (+properties.options[type][fields_trimmed[index]] || 0));
                            } else if (properties.options[type] == '0' || !isNaN(+properties.options[type] || 'x') ) {
                                sumTotal = getRounded(type, sumTotal, +properties.options[type]);
                            } 
                        } 
                    });
                    obj[destination] = sumTotal;
                    return obj;
                }, {});
                setAttrs(output);
            }); 
        }); 
    };

</script>