
<!-- 
<div>
    <button type="action" name="act_character" >Character</button>
    <button type="action" name="act_journal" >Journal</button>
    <button type="action" name="act_configuration" >Configuration</button>
</div>
<input type="hidden" class="sheet-tabstoggle" name="attr_sheetTab"  value="character"  />
 -->
<!--  --------------------------------------------------------------------------------- -->
<!--  --------------------------- PAGE 1 ---------------------------------------------- -->
<!--  --------------------------------------------------------------------------------- -->
<div class="sheet-character">

<!-- NAME SECTION -->
  <div class="name section columnflex nowrap">

    <div class="rowflex nowrap spaced">

      <div class="columnflex nowrap">
        <label>Char name</label>
        <input name="attr_character_name" type="text">
      </div>
      <div class="columnflex nowrap">
        <label style="width:80px;">Player name</label>
        <input name="attr_player_name" type="text">
      </div>
      <div class="columnflex nowrap">
        <label>Campaign</label>
        <input name="attr_campaign" type="text">
      </div>   

    </div>

    <div class="rowflex nowrap spaced">

      <div class="columnflex nowrap">
        <label>Race</label>
        <input name="attr_race" type="text">
      </div>
      <div class="columnflex nowrap">
        <label>Origin</label>
        <input name="attr_origin" type="text">
      </div>
      <div class="columnflex nowrap">
        <label>Class</label>
        <input name="attr_class" type="text">
      </div>
      <div class="columnflex nowrap">
        <label>Rank</label>
        <input name="attr_rank" type="text" class="w40">
      </div>
      <div class="columnflex nowrap">
        <label>HD</label>
        <input name="attr_hd" type="text" class="w40">
      </div>

    </div>

  </div>


<!-- ATTRIBUTES SECTION -->

  <div class="attr columnflex nowrap spaced center">
    <div class="stat columnflex nowrap center middle">
      <span>STR</span>
      <input name="attr_str" type="number" value="10">
      <span class="mod" name="attr_str_mod"></span>
    </div>
    <div class="stat columnflex nowrap center middle">
      <span>DEX</span>
      <input name="attr_dex" type="number" value="10">
      <span class="mod" name="attr_dex_mod"></span>
    </div>
    <div class="stat columnflex nowrap center middle">
      <span>CON</span>
      <input name="attr_con" type="number" value="10">
      <span class="mod" name="attr_con_mod"></span>
    </div>
    <div class="stat columnflex nowrap center middle">
      <span>INT</span>
      <input name="attr_int" type="number" value="10">
      <span class="mod" name="attr_int_mod"></span>
    </div>
    <div class="stat columnflex nowrap center middle">
      <span>WIS</span>
      <input name="attr_wis" type="number" value="10">
      <span class="mod" name="attr_wis_mod"></span>
    </div>
    <div class="stat columnflex nowrap center middle">
      <span>CHA</span>
      <input name="attr_cha" type="number" value="10">
      <span class="mod" name="attr_cha_mod"></span>
    </div>
    
  </div>


<!-- Skills (20)-->

  <div class="skills section columnflex nowrap spaced">
    <h3>Skills</h3>

    <div class="rowflex nowrap">
      <input name="attr_acrobatics_c" type="checkbox" value="">
      <span name="attr_acrobatics" class="mod"></span>
      <span>Acrobatics(dex)</span>
    </div>

    <div class="rowflex nowrap">
      <input name="attr_animalhandling_c" type="checkbox" value="">
      <span name="attr_animalhandling" class="mod" style="width: 30px;"></span>
      <span>animal handling(wis)</span>
    </div>

    <div class="rowflex nowrap">
      <input name="attr_athletics_c" type="checkbox" value="">
      <span name="attr_athletics" class="mod"></span>
      <span>athletics(str)</span>
    </div>

    <div class="rowflex nowrap">
      <input name="attr_culture_c" type="checkbox" value="">
      <span name="attr_culture" class="mod"></span>
      <span>culture(wis)</span>
    </div>

    <div class="rowflex nowrap">
      <input name="attr_deception_c" type="checkbox" value="">
      <span name="attr_deception" class="mod"></span>
      <span>deception(cha)</span>
    </div>

    <div class="rowflex nowrap">
      <input name="attr_engineering_c" type="checkbox" value="">
      <span name="attr_engineering" class="mod"></span>
      <span>engineering(int</span>
    </div>

    <div class="rowflex nowrap">
      <input name="attr_history_c" type="checkbox" value="">
      <span name="attr_history" class="mod"></span>
      <span>history(int)</span>
    </div>

    <div class="rowflex nowrap">
      <input name="attr_insight_c" type="checkbox" value="">
      <span name="attr_insight" class="mod"></span>
      <span>insight(wis)</span>
    </div>

    <div class="rowflex nowrap">
      <input name="attr_intimidation_c" type="checkbox" value="">
      <span name="attr_intimidation" class="mod"></span>
      <span>intimidation</span>
    </div>

    <div class="rowflex nowrap">
      <input name="attr_investigation_c" type="checkbox" value="">
      <span name="attr_investigation" class="mod"></span>
      <span>investigation</span>
    </div>



    <div class="rowflex nowrap">
      <input name="attr_medicine_c" type="checkbox" value="">
      <span name="attr_medicine" class="mod"></span>
      <span>medicine</span>
    </div>

    <div class="rowflex nowrap">
      <input name="attr_nature_c" type="checkbox" value="">
      <span name="attr_nature" class="mod"></span>
      <span>nature</span>
    </div>

    <div class="rowflex nowrap">
      <input name="attr_perception_c" type="checkbox" value="">
      <span name="attr_perception" class="mod"></span>
      <span>perception</span>
    </div>

    <div class="rowflex nowrap">
      <input name="attr_performance_c" type="checkbox" value="">
      <span name="attr_performance" class="mod"></span>
      <span>performance</span>
    </div>

    <div class="rowflex nowrap">
      <input name="attr_percuation_c" type="checkbox" value="">
      <span name="attr_percuation" class="mod"></span>
      <span>percuation</span>
    </div>

    <div class="rowflex nowrap">
      <input name="attr_pilot_c" type="checkbox" value="">
      <span name="attr_pilot" class="mod"></span>
      <span>pilot</span>
    </div>

    <div class="rowflex nowrap">
      <input name="attr_science_c" type="checkbox" value="">
      <span name="attr_science" class="mod"></span>
      <span>science</span>
    </div>

    <div class="rowflex nowrap">
      <input name="attr_sleight_c" type="checkbox" value="">
      <span name="attr_sleight" class="mod"></span>
      <span>sleight</span>
    </div>

    <div class="rowflex nowrap">
      <input name="attr_stealth_c" type="checkbox" value="">
      <span name="attr_stealth" class="mod"></span>
      <span>stealth</span>
    </div>

    <div class="rowflex nowrap">
      <input name="attr_survival_c" type="checkbox" value="">
      <span name="attr_survival" class="mod"></span>
      <span>survival</span>
    </div>

  </div>


<!-- hp -->

  <div class="hp rowflex nowrap">
    <div class="section columnflex nowrap middle center">
      <label class=" txtcenter">HP</label>
      <input name="attr_hp" type="number" value="20" class="stat w40">
    </div>
    <div class="section columnflex nowrap middle center">
      <label class="">determination</label>
      <input name="attr_determination" type="number" value="" class="stat w40">
    </div>
  </div>


<!-- condition -->

  <div class="condition section columnflex nowrap spaced">
    <h3>condition</h3>
    <div class="rowflex nowrap">
      <input name="attr_condition" type="radio" value="0" checked="true">
      <span>Normal</span>
    </div>
    <div class="rowflex nowrap">
      <input name="attr_condition" type="radio" value="1">
      <span>Disadv ability checks</span>
    </div>
    <div class="rowflex nowrap">
      <input name="attr_condition" type="radio" value="2">
      <span>speed halved</span>
    </div>
    <div class="rowflex nowrap">
      <input name="attr_condition" type="radio" value="3">
      <span>disadv attacks saves</span>
    </div>
    <div class="rowflex nowrap">
      <input name="attr_condition" type="radio" value="4">
      <span>HP max halved</span>
    </div>
    <div class="rowflex nowrap">
      <input name="attr_condition" type="radio" value="5">
      <span>speed zero</span>
    </div>
    <div class="rowflex nowrap">
      <input name="attr_condition" type="radio" value="6">
      <span>death</span>
    </div>
  </div>


<!-- prof -->

  <div class="prof rowflex nowrap">
    <div class="section columnflex nowrap middle center">
      <label class="wide">Prof Bonus</label>
      <input name="attr_prof" type="number" value="2" class="stat w40">
    </div>
    <div class="section columnflex nowrap middle center">
      <label class="txtcenter">Initiative</label>
      <input name="attr_init" type="number" value="0" class="stat w40">
    </div>
    <div class="section columnflex nowrap middle center moxie">
      <label class="txtcenter">Moxie</label>
      <input name="attr_moxie" type="number" value="0" class="stat w40">
    </div>
  </div>


<!-- ac -->

  <div class="ac rowflex nowrap">
    <div class="section columnflex nowrap middle center">
      <label class="wide">Armor Class</label>
      <input name="attr_ac" type="number" value="10" class="stat w70">
    </div>
    <div class="section columnflex nowrap middle center">
      <label class="">AC extra</label>
      <input name="attr_ac_extra" type="number" value="10" class="stat w70">
    </div>
  </div>


<!-- speed -->

  <div class="speed rowflex nowrap">
    <div class="section columnflex nowrap middle center">
      <label class="bold">Speed</label>
      <input name="attr_speed" type="text" value="5m" class="w70 stat">
    </div>
    <div class="section columnflex nowrap middle center">
      <label class="bold">Death Saves</label>
    </div>
  </div>


<!-- saves -->

  <div class="saves section columnflex nowrap spaced">
    <h3>Saves</h3>
    <div class="rowflex nowrap">
      <input name="attr_str_save_c" type="checkbox" value="">
      <span name="attr_str_save" class="mod"></span>
      <span class="bold">Strength</span>
    </div>
    <div class="rowflex nowrap">
      <input name="attr_dex_save_c" type="checkbox" value="">
      <span name="attr_dex_save" class="mod"></span>
      <span class="bold">Dexterity</span>
    </div>
    <div class="rowflex nowrap">
      <input name="attr_con_save_c" type="checkbox" value="">
      <span name="attr_con_save" class="mod"></span>
      <span class="bold">Constitution</span>
    </div>
    <div class="rowflex nowrap">
      <input name="attr_int_save_c" type="checkbox" value="">
      <span name="attr_int_save" class="mod"></span>
      <span class="bold">Intelligence</span>
    </div>
    <div class="rowflex nowrap">
      <input name="attr_wis_save_c" type="checkbox" value="">
      <span name="attr_wis_save" class="mod"></span>
      <span class="bold">Wisdom</span>
    </div>
    <div class="rowflex nowrap">
      <input name="attr_cha_save_c" type="checkbox" value="">
      <span name="attr_cha_save" class="mod"></span>
      <span class="bold">Charisma</span>
    </div>
  </div>


<!-- ammo -->

  <div class="ammo grid">
    <div class="section columnflex nowrap middle center">
      <label>Ammo Weapon 1</label>
      <input name="attr_ammo1" type="number" value="0">
    </div>
    <div class="section columnflex nowrap middle center">
      <label>Ammo Weapon 2</label>
      <input name="attr_ammo2" type="number" value="0">
    </div>
    <div class="section columnflex nowrap middle center">
      <label>Ammo Weapon 3</label>
      <input name="attr_ammo3" type="number" value="0">
    </div>
    <div class="section columnflex nowrap middle center">
      <label>Ammo Weapon 4</label>
      <input name="attr_ammo4" type="number" value="0">
    </div>
  </div>


<!-- attacks -->

  <div class="attacks section">
    <span class="name bold">Attack name</span>
    <span class="bold">to hit</span>
    <span class="bold">dmg</span>
    <span class="bold">range</span>
    <span class="bold">reload</span>
    <span class="bold">special</span>

<!-- attack1 -->
    <div class="rowflex nowrap">
      <button name="roll_attack1" type="roll" value="/r d20+@{str_mod}"></button>
      <input name="attr_attack1" type="text">
    </div>
    <div>
      <input name="attr_attack1_to_hit" type="text" class="w40">
    </div>
    <div>
      <input name="attr_attack1_dmg" type="text" class="w40">
    </div>
    <div>
      <input name="attr_attack1_range" type="text" class="w40">
    </div>
    <div>
      <input name="attr_attack1_reload" type="text" class="w40">
    </div>
    <div>
      <input name="attr_attack1_special" type="text" class="w70">
    </div>

<!-- attack2 -->
    <div class="rowflex nowrap">
      <button name="roll_attack2" type="roll" value="/r d20+@{str_mod}"></button>
      <input name="attr_attack2" type="text">
    </div>
    <div>
      <input name="attr_attack2_to_hit" type="text" class="w40">
    </div>
    <div>
      <input name="attr_attack2_dmg" type="text" class="w40">
    </div>
    <div>
      <input name="attr_attack2_range" type="text" class="w40">
    </div>
    <div>
      <input name="attr_attack2_reload" type="text" class="w40">
    </div>
    <div>
      <input name="attr_attack2_special" type="text" class="w70">
    </div>

<!-- attack3 -->
    <div class="rowflex nowrap">
      <button name="roll_attack3" type="roll" value="/r d20+@{str_mod}"></button>
      <input name="attr_attack3" type="text">
    </div>
    <div>
      <input name="attr_attack3_to_hit" type="text" class="w40">
    </div>
    <div>
      <input name="attr_attack3_dmg" type="text" class="w40">
    </div>
    <div>
      <input name="attr_attack3_range" type="text" class="w40">
    </div>
    <div>
      <input name="attr_attack3_reload" type="text" class="w40">
    </div>
    <div>
      <input name="attr_attack3_special" type="text" class="w70">
    </div>

<!-- attack4 -->
    <div class="rowflex nowrap">
      <button name="roll_attack4" type="roll" value="/r d20+@{str_mod}"></button>
      <input name="attr_attack4" type="text">
    </div>
    <div>
      <input name="attr_attack4_to_hit" type="text" class="w40">
    </div>
    <div>
      <input name="attr_attack4_dmg" type="text" class="w40">
    </div>
    <div>
      <input name="attr_attack4_range" type="text" class="w40">
    </div>
    <div>
      <input name="attr_attack4_reload" type="text" class="w40">
    </div>
    <div>
      <input name="attr_attack4_special" type="text" class="w70">
    </div>

<!-- attack5 -->
    <div class="rowflex nowrap">
      <button name="roll_attack5" type="roll" value="/r d20+@{str_mod}"></button>
      <input name="attr_attack5" type="text">
    </div>
    <div>
      <input name="attr_attack5_to_hit" type="text" class="w40">
    </div>
    <div>
      <input name="attr_attack5_dmg" type="text" class="w40">
    </div>
    <div>
      <input name="attr_attack5_range" type="text" class="w40">
    </div>
    <div>
      <input name="attr_attack5_reload" type="text" class="w40">
    </div>
    <div>
      <input name="attr_attack5_special" type="text" class="w70">
    </div>

  </div>

</div>

<!--  --------------------------------------------------------------------------------- -->
<!--  --------------------------- PAGE 2 ---------------------------------------------- -->
<!--  --------------------------------------------------------------------------------- -->
<div class="sheet-journal">

</div>

<!--  --------------------------------------------------------------------------------- -->
<!--  --------------------------- PAGE 3 ---------------------------------------------- -->
<!--  --------------------------------------------------------------------------------- -->
<div class="sheet-config">
    <h2>Config/Settings</h2>
    <span>Sheet Config/Settings goes here</span> 
</div>

<!--  --------------------------------------------------------------------------------- -->
<!--  --------------------------- Sheet workers --------------------------------------- -->
<!--  --------------------------------------------------------------------------------- -->

<input name="attr_str_mod" type="hidden" value="+0">
<input name="attr_dex_mod" type="hidden" value="+0">
<input name="attr_con_mod" type="hidden" value="+0">
<input name="attr_wis_mod" type="hidden" value="+0">
<input name="attr_int_mod" type="hidden" value="+0">
<input name="attr_cha_mod" type="hidden" value="+0">

<input name="attr_str_save" type="hidden" value="+0">
<input name="attr_dex_save" type="hidden" value="+0">
<input name="attr_con_save" type="hidden" value="+0">
<input name="attr_int_save" type="hidden" value="+0">
<input name="attr_wis_save" type="hidden" value="+0">
<input name="attr_cha_save" type="hidden" value="+0">

<input name="attr_acro" type="hidden" value="+0">
<input name="attr_animal" type="hidden" value="+0">

<script type="text/worker">

// Tab management
/*
const buttonlist = ["character","journal","configuration"];
buttonlist.forEach(button => {
    on(`clicked:${button}`, function() {
        setAttrs({
            sheetTab: button
        });
    });
});*/


// Calculate Stat modifier
const int = score => parseInt(score, 10) || 0;
const stats = ["str", "dex", "con", "wis", "int", "cha"];
stats.forEach(stat => {
    on(`change:${stat}`, () => {
        getAttrs([stat], values => {
            const stat_base = int(values[stat]);
            //console.log(stat_base);
            let stat_mod = 0;
            if (stat_base >= 30) stat_mod = "+10";
            else if (stat_base >= 28) stat_mod = "+9";
            else if (stat_base >= 26) stat_mod = "+8";
            else if (stat_base >= 24) stat_mod = "+7";
            else if (stat_base >= 22) stat_mod = "+6";
            else if (stat_base >= 20) stat_mod = "+5";
            else if (stat_base >= 18) stat_mod = "+4";
            else if (stat_base >= 16) stat_mod = "+3";
            else if (stat_base >= 14) stat_mod = "+2";
            else if (stat_base >= 12) stat_mod = "+1";
            else if (stat_base >= 10) stat_mod = "+0";
            else if (stat_base >= 8) stat_mod = "-1";
            else if (stat_base >= 6) stat_mod = "-2";
            else if (stat_base >= 4) stat_mod = "-3";
            else if (stat_base >= 2) stat_mod = "-4";
            else if (stat_base <= 1) stat_mod = "-5";
            else stat_mod = "+0";
            
            setAttrs({
                [`${stat}_mod`]: stat_mod
            });
        });
    });
});

stats.forEach(stat => {
    on(`change:${stat}_mod`, () => {
        getAttrs([stat]_mod, values => {
            const stat_mod = int(values[stat]);
            //console.log(stat_base);
            let stat_mod = 0;
            if (`${stat}` === "str"){

            } 
            else if (stat_base >= 28) stat_mod = "+9";
            else if (stat_base >= 26) stat_mod = "+8";
            else if (stat_base >= 24) stat_mod = "+7";
            else if (stat_base >= 22) stat_mod = "+6";
            else if (stat_base >= 20) stat_mod = "+5";
            else if (stat_base >= 18) stat_mod = "+4";
            else if (stat_base >= 16) stat_mod = "+3";
            else if (stat_base >= 14) stat_mod = "+2";
            else if (stat_base >= 12) stat_mod = "+1";
            else if (stat_base >= 10) stat_mod = "+0";
            else if (stat_base >= 8) stat_mod = "-1";
            else if (stat_base >= 6) stat_mod = "-2";
            else if (stat_base >= 4) stat_mod = "-3";
            else if (stat_base >= 2) stat_mod = "-4";
            else if (stat_base <= 1) stat_mod = "-5";
            else stat_mod = "+0";
            
            setAttrs({
                [`${stat}_mod`]: stat_mod
            });
        });
    });
});

</script>