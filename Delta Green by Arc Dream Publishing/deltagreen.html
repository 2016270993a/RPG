
<!--VERSION-->
<!-- =============================-->
<input name="attr_version" type="hidden" value="1"/>
<!-- TABS-->
<!-- =============================-->
<input class="type" name="attr_sheet_type" type="hidden" value="character"/>
<input class="display_string" name="attr_character_settings" type="hidden" value=""/>
<!--TABS & LOGO-->
<!-- =============================-->
<div class="tabs grid">
  <!-- Buttons to toggle on GM whisper-->
  <input class="whisper-toggle" name="attr_gm_toggle" type="hidden" value=" "/>
  <button data-i18n-title="gm-whisper-toggle" name="act_whisper" title="gm whisper toggle" type="action"> <span data-i18n="whisper-gm">Whisper GM</span></button>
  <!-- LOGO--><img alt="Delta Green" src="https://raw.githubusercontent.com/clevett/roll20-character-sheets/deltagreen/Delta%20Green%20by%20Arc%20Dream%20Publishing/img/deltagreenlogo.jpg"/>
  <!-- CHARACTER SHEETS-->
  <button data-i18n-title="sheet-settings" name="act_sheet_select" title="sheet settings" type="action"> <span class="pictos">y </span></button>
</div>
<!-- NPC SHEET-->
<!-- =============================-->
<div class="npc">
  <div class="box npc-flex">
    <p>NPC STUFF</p>
  </div>
  <div class="box npc-flex">
    <p>MORE NPC STUFF </p>
  </div>
</div>
<!--PC SHEET-->
<!-- =============================-->
<div class="pc">
  <!--PERSONAL DATA-->
  <div class="grid personal-data border">
    <div class="section-header">
      <h1 data-i18n="personal-data">personal data</h1>
    </div>
    <div class="section-body">
      <div class="grid section border-bottom">
        <h2 class="aligned-left" data-i18n="1-last-name">1. last name, first name (and alias or code name if applicable)</h2>
        <label data-i18-title="1-last-name" title="1. last name, first name (and alias or code name if applicable)">
          <input data-i18-placeholder="name" name="attr_name" placeholder="name" title="${name}" type="text"/>
        </label>
        <div class="vert-line"></div>
        <h2 class="aligned-left" data-i18n="2-profession">2. profession (rank if applicable)</h2>
        <label data-i18-title="2-profession" title="2. profession (rank if applicable)">
          <input data-i18-placeholder="" name="attr_profession" placeholder="profession" title="${profession}" type="text"/>
        </label>
      </div>
      <div class="grid section border-bottom">
        <h2 class="aligned-left" data-i18n="3-employer">3. employer</h2>
        <label data-i18-title="3-employer" title="3. employer">
          <input data-i18-placeholder="employer" name="attr_employer" placeholder="employer" title="${employer}" type="text"/>
        </label>
        <div class="vert-line"></div>
        <h2 class="aligned-left" data-i18n="4-nationality">4. nationality</h2>
        <label data-i18-title="4-nationality" title="4. nationality">
          <input data-i18-placeholder="nationality" name="attr_nationality" placeholder="nationality" title="${nationality}" type="text"/>
        </label>
      </div>
      <div class="grid section">
        <h2 class="aligned-left" data-i18n="5-sex">5. sex</h2>
        <label data-i18-title="5-sex" title="5. sex">
          <input data-i18-placeholder="sex" name="attr_sex" placeholder="sex" title="${sex}" type="text"/>
        </label>
        <div class="vert-line"></div>
        <h2 class="aligned-left" data-i18n="6-age">6. age and d.o.b.</h2>
        <label data-i18-title="6-age" title="age and d.o.b.">
          <input data-i18-placeholder="age" name="attr_age" placeholder="age and d.o.b." title="${age}" type="text"/>
        </label>
        <div class="vert-line"></div>
        <h2 class="aligned-left" data-i18n="7-education">7. education and occupational history</h2>
        <label data-i18-title="7-education" title="7. education and occupational history">
          <input data-i18-placeholder="education" name="attr_education" placeholder="education and occupational history" title="${education}" type="text"/>
        </label>
      </div>
    </div>
  </div>
  <!--STATISTICAL DATA-->
  <div class="grid statistical-data border">
    <div class="section-header">
      <h1>statistical data</h1>
    </div>
    <!--STATISTICS-->
    <div class="grid section-body">
      <div class="grid section-stats">
        <div class="grid section border-bottom">
          <h2 class="aligned-left">8. statistics</h2>
          <div class="vert-line"></div>
          <h2 class="center">score</h2>
          <div class="vert-line"></div>
          <h2 class="center">x5</h2>
          <div class="vert-line"></div>
          <h2 class="aligned-left">distinguishing features</h2>
        </div>
        <div class="grid section border-bottom">
          <button name="strength" title="strength roll" type="roll" value="">
            <h3 class="aligned-left">strength</h3><span>(STR)</span>
          </button>
          <div class="vert-line"></div>
          <label title="strength score">
            <input name="attr_strength_score" placeholder="10" title="@{strength_score}" type="number"/>
          </label>
          <div class="vert-line"></div><span class="center" name="attr_strength" title="@{strength}"></span>
          <div class="vert-line"></div>
          <label title="strength distinguishing features">
            <input name="attr_strength_features" placeholder="distinguishing features" title="@{strength_features}" type="text"/>
          </label>
          <input name="attr_strength" type="hidden" value="50"/>
        </div>
        <div class="grid section border-bottom">
          <button name="constitution" title="constitution roll" type="roll" value="">
            <h3 class="aligned-left">constitution</h3><span>(CON)</span>
          </button>
          <div class="vert-line"></div>
          <label title="constitution score">
            <input name="attr_constitution_score" placeholder="10" title="@{constitution_score}" type="number"/>
          </label>
          <div class="vert-line"></div><span class="center" name="attr_constitution" title="@{constitution}"></span>
          <div class="vert-line"></div>
          <label title="constitution distinguishing features">
            <input name="attr_constitution_features" placeholder="distinguishing features" title="@{constitution_features}" type="text"/>
          </label>
          <input name="attr_constitution" type="hidden" value="50"/>
        </div>
        <div class="grid section border-bottom">
          <button name="dexterity" title="dexterity roll" type="roll" value="">
            <h3 class="aligned-left">dexterity</h3><span>(DEX)</span>
          </button>
          <div class="vert-line"></div>
          <label title="dexterity score">
            <input name="attr_dexterity_score" placeholder="10" title="@{dexterity_score}" type="number"/>
          </label>
          <div class="vert-line"></div><span class="center" name="attr_dexterity" title="@{dexterity}"></span>
          <div class="vert-line"></div>
          <label title="dexterity distinguishing features">
            <input name="attr_dexterity_features" placeholder="distinguishing features" title="@{dexterity_features}" type="text"/>
          </label>
          <input name="attr_dexterity" type="hidden" value="50"/>
        </div>
        <div class="grid section border-bottom">
          <button name="intelligence" title="intelligence roll" type="roll" value="">
            <h3 class="aligned-left">intelligence</h3><span>(INT)</span>
          </button>
          <div class="vert-line"></div>
          <label title="intelligence score">
            <input name="attr_intelligence_score" placeholder="10" title="@{intelligence_score}" type="number"/>
          </label>
          <div class="vert-line"></div><span class="center" name="attr_intelligence" title="@{intelligence}"></span>
          <div class="vert-line"></div>
          <label title="intelligence distinguishing features">
            <input name="attr_intelligence_features" placeholder="distinguishing features" title="@{intelligence_features}" type="text"/>
          </label>
          <input name="attr_intelligence" type="hidden" value="50"/>
        </div>
        <div class="grid section border-bottom">
          <button name="power" title="power roll" type="roll" value="">
            <h3 class="aligned-left">power</h3><span>(POW)</span>
          </button>
          <div class="vert-line"></div>
          <label title="power score">
            <input name="attr_power_score" placeholder="10" title="@{power_score}" type="number"/>
          </label>
          <div class="vert-line"></div><span class="center" name="attr_power" title="@{power}"></span>
          <div class="vert-line"></div>
          <label title="power distinguishing features">
            <input name="attr_power_features" placeholder="distinguishing features" title="@{power_features}" type="text"/>
          </label>
          <input name="attr_power" type="hidden" value="50"/>
        </div>
        <div class="grid section border-bottom">
          <button name="charisma" title="charisma roll" type="roll" value="">
            <h3 class="aligned-left">charisma</h3><span>(CHA)</span>
          </button>
          <div class="vert-line"></div>
          <label title="charisma score">
            <input name="attr_charisma_score" placeholder="10" title="@{charisma_score}" type="number"/>
          </label>
          <div class="vert-line"></div><span class="center" name="attr_charisma" title="@{charisma}"></span>
          <div class="vert-line"></div>
          <label title="charisma distinguishing features">
            <input name="attr_charisma_features" placeholder="distinguishing features" title="@{charisma_features}" type="text"/>
          </label>
          <input name="attr_charisma" type="hidden" value="50"/>
        </div>
      </div>
      <!--DERIVED ATTRIBUTES-->
      <div class="grid section-derived">
        <div class="grid section border-bottom">
          <h2 class="aligned-left">9. derived attributes</h2>
          <div class="vert-line"></div>
          <h2 class="center">maximum</h2>
          <div class="vert-line"></div>
          <h2 class="center">current</h2>
        </div>
        <div class="grid section border-bottom">
          <div class="derived-attr">
            <h3 class="aligned-left">hit points</h3><span>(HP)</span>
          </div>
          <div class="vert-line"></div><span class="center" name="attr_hit_points_max" title="@{hit_points_max}"></span>
          <div class="vert-line"></div>
          <label title="hit points">
            <input name="attr_hit_points" placeholder="10" title="@{hit_points}" type="number"/>
          </label>
        </div>
        <div class="grid section border-bottom">
          <div class="derived-attr">
            <h3 class="aligned-left">willpower points</h3><span>(WP)</span>
          </div>
          <div class="vert-line"></div><span class="center" name="attr_willpower_points_max" title="@{willpower_points_max}"></span>
          <div class="vert-line"></div>
          <label title="willpower points">
            <input name="attr_willpower_points" placeholder="10" title="@{willpower_points}" type="number"/>
          </label>
        </div>
        <div class="grid section border-bottom">
          <div class="derived-attr">
            <h3 class="aligned-left">sanity points</h3><span>(SAN)</span>
          </div>
          <div class="vert-line"></div><span class="center" name="attr_sanity_points_max" title="@{sanity_points_max}"></span>
          <div class="vert-line"></div>
          <label title="sanity points">
            <input name="attr_sanity_points" placeholder="10" title="@{sanity_points}" type="number"/>
          </label>
        </div>
        <div class="grid section border-bottom">
          <div class="derived-attr">
            <h3 class="aligned-left">breaking points</h3><span>(BP)</span>
          </div>
          <div class="vert-line"></div><span class="center" name="attr_breaking_points_max" title="@{breaking_points_max}"></span>
          <div class="vert-line"></div>
          <label title="breaking points">
            <input name="attr_breaking_points" placeholder="10" title="@{breaking_points}" type="number"/>
          </label>
        </div>
      </div>
      <!--PHYSICAL DESCRIPTION-->
      <div class="grid section-physical">
        <h2 class="aligned-left">9. physical description</h2>
        <textarea name="attr_physical_description" placeholder="physical description" title="@{physical_description}"></textarea>
      </div>
    </div>
  </div>
  <!--PSYCHOLOGICAL DATA-->
  <div class="grid pyschological-data border">
    <div class="section-header">
      <h1>pyschological data </h1>
    </div>
    <div class="grid section-body">
      <div class="grid section-bonds">
        <div class="grid section border-bottom max-height">
          <h2 class="aligned-left">11. bonds</h2>
          <div class="vert-line"></div>
          <h2 class="center">score</h2>
        </div>
        <div class="grid section">
          <fieldset class="repeating_bonds">
            <div class="grid section border-bottom">
              <label title="bond name">
                <input name="attr_name" placeholder="bond" title="@{repeating_bonds_${x}_name}" type="text"/>
              </label>
              <div class="vert-line"></div>
              <label title="bond score">
                <input name="attr_score" placeholder="10" title="@{repeating_bonds_${x}_score}" type="number"/>
              </label>
            </div>
          </fieldset>
        </div>
      </div>
      <div class="grid section-motivations">
        <div class="grid section border-bottom">
          <h2 class="aligned-left">12. motivations and mental disorders</h2>
          <textarea name="attr_motivations"></textarea>
        </div>
      </div>
      <div class="grid section-incidents">
        <div class="grid section border-bottom">
          <h2 class="aligned-left">13. incidents of san loss without going insane</h2>
          <div class="grid section border-bottom">
            <label title="violence checkbox 1">
              <input name="attr_violence" title="@{repeating_bonds_${x}_violence}" type="checkbox" value="1"/><span></span>
            </label>
            <label title="violence checkbox 2">
              <input name="attr_violence" title="@{repeating_bonds_${x}_violence}" type="checkbox" value="2"/><span></span>
            </label>
            <label title="violence checkbox 3">
              <input name="attr_violence" title="@{repeating_bonds_${x}_violence}" type="checkbox" value="3"/><span></span>
            </label>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<!--NOTES SHEET-->
<!-- =============================-->
<div class="notes"></div>
<!--SETTINGS SHEET-->
<!-- =============================-->
<div class="settings">
  <select name="attr_sheet_select" title="character sheet select" selected="selected">
    <option data-i18n="" value="character">character</option>
    <option data-i18n="" value="npc">npc</option>
  </select>
</div>
<!--FOOTER-->
<!-- =============================-->
<footer><span>Version </span><span name="attr_version"></span></footer>
<!--HIDDEN ATTRIBUTES-->
<!-- =============================-->
<!--ROLL TEMPLATE-->
<!-- =============================-->
<!--include src/pug/rolltemplate.pug-->
<!--SHEETWORKERS-->
<!-- =============================-->
<script type="text/worker">
	// === SHARED FUNCTIONS
	const setAttributes = (update, silent) => { 
		(silent === true) ? setAttrs(update, {silent:true}) : setAttrs(update); 
	};

	// === ATTRIBUTE ARRAYS
		const arrays = {
			attributes: [""], 
			repeating_settings: [""],
			sheets: ["sheet_select"],
			toggles: ["attributes"]
		};

	// === SWITCH BETWEEN SHEETS
	    arrays["sheets"].forEach(attr => {
	        on(`clicked:${attr} change:${attr}`, (eventinfo) => {
	        	console.log(`%c SHEETS`, "color: blue; font-weight:bold");
	        	console.log(eventinfo);
	        	//setAttrs({sheet_type: `${attr}`}, true);
	        });
	    });


	// === TOGGLE INPUT SETTINGS
	    arrays["toggles"].forEach(attr => {
	        on(`clicked:toggle_${attr}`, () => {
	        	getAttrs(["toggles"], (v) => {
	 				let string = toggleBuilder(attr, v["toggles"]);
	                setAttributes({toggles: string}, true);
	        	});
	        });
	    });

	// === UPDATE TOGGLE STRING
		const toggleBuilder = (attr, oldString) => {
	        let newString = (oldString.includes(`${attr}`)) ? oldString.replace(`${attr},`, "") : `${oldString}${attr},`;
	        return newString
		};

	// === GM WHISPER TOGGLES
		on("clicked:whisper", (eventinfo) => {
			getAttrs(["gm_toggle"], (v) => {
				setAttributes({gm_toggle: (v.gm_toggle.includes("gm")) ?  " " : "/w gm"}, true);
			});
		});

	// === SHEET VERSIONING
		on("sheet:opened", () => {
			getAttrs(["version"], (v) => { versioning(parseFloat(v.version) || 1); });
		});			

		const versioning = (version) => {
		   console.log(`%c Versioning, ${version}`, "color: blue; font-weight:bold");
		   if (version >= 1) {
				console.log(`%c Version is update to date`, "color: maroon; font-weight:bold");
		    } else {
				setAttrs({version: 1}, () => {versioning(1)});
			};
		};



</script>