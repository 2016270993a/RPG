<div class="main">
    <div class="header flex-center section">
        <input type="hidden" name="attr_version" value="1" />
        <h1><em>Cyberpunk Red</em></h1>
        <span data-i18n="character-sheet">Character Sheet</span>
        <div>&nbsp;</div>
        <label><span data-i18n="roll-initiative">Roll initiative:</span><input name="attr_initiative_bonus" type="number" /><button type="roll" name="roll_initiative" value="&{template:generic} {{name=@{character_name}}} {{rollname=Initiative}} {{theroll=[[1d10+@{ref}+@{initreact}+@{initiative_bonus} &{tracker}]]}}" class="skillroll"></button></label>
    </div>
    <div class="common section">
        <span><label data-i18n="character-name">Character name</label><input name="attr_character_name" type="text" /></span>
        <span><label data-i18n="total-assets">Total Assets</label><input name="attr_total_assets" type="number" /></span>
        <span><label data-i18n="remaining-money">Remaining Money</label><input name="attr_remaining_money" type="number" /></span>

    </div>
    <div class="roles section">
        <ul class="roleslist">
            <li class="roleslist">
                <input name="attr_rockerboycheck" class="rockerboycheck" type="checkbox" value='1' /><span><label data-i18n="Rockerboy">Rockerboy </label></span>
                <div class="rockerboy">
                    <span><label data-i18n="roll-charismatic-impact">Charismatic Impact </label><input type="number" name="attr_charimpact" value="" class="inputstats" min="0" /></span>
                    <button type="roll" name="roll_skill" value="&{template:cprskill} {{name=@{character_name}}} {{rollname='Charismatic Impact'}} {{theroll=[[1d10]]}} {{normalroll=[[1d8+1+@{charimpact}]]}} {{critroll=[[10+1d10+@{charimpact}]]}} {{fumbleroll=[[1-1d10+@{charimpact}]]}}"
                        class="skillroll"></button>
    </div>
    </li><li class="roleslist">
    <input name="attr_solocheck" class="solocheck" type="checkbox" value='1'/><span><label data-i18n="Solo">Solo </label></span>
    <div class="solo">
      <span class="combaware"><label data-i18n="combat-awareness">Combat Awareness </label><input type="number" name="attr_combaware" value="" class="inputstats" min="0"  title="points" /></span>
      <div class="roleskills">
        <span  data-i18n="point-assignments">Point Assignments</span>
      
      <span><label data-i18n="damage-deflection">Damage Deflection </label><input type="number" name="attr_damdef" class="inputstats" min="0" title="points" step="2" /></span>
      <span><label data-i18n="fumble-recovery">Fumble Recovery </label><input type="checkbox" name="attr_fumrecov"  class="inputstats"  value="4" />(4 points)</span>
      <span><label data-i18n="initiative-reaction">Initiative Reaction </label><input type="number" name="attr_initreact" class="inputstats" min="0"  title="points" /></span>
      <span><label data-i18n="precision-attack">Precision Attack </label><input type="number" name="attr_precatt" class="inputstats" min="0" title="points" step="3" /></span>
      <span><label data-i18n="spot-weakness">Spot Weakness </label><input type="number" name="attr_spotweak"  class="inputstats" min="0" title="points" /></span>
      <span><label data-i18n="threat-detection">Threat Detection </label><input type="number" name="attr_threatdetect" class="inputstats" min="0" title="points" /></span>
    </div>
    </div>
  </li><li class="roleslist">
    <input name="attr_netrunnercheck" class="netrunnercheck" type="checkbox" value='1'/><span><label data-i18n="Netrunner">Netrunner </label></span>
    <div class="netrunner">
      <span><label data-i18n="interface">Interface </label><input type="number" name="attr_interface" value="" class="inputstats" min="0" /><span data-i18n="bonus">Bonus</span>:&nbsp;<input type="number" name="attr_interfacebonus" value="" placeholder="bonus" title="bonus" class="inputstats" min="0" /></span>
      <button type="roll" name="roll_skill" value="&{template:cprskill} {{name=@{character_name}}} {{rollname='Interface'}} {{theroll=[[1d10]]}} {{normalroll=[[1d8+1+@{interface}+@{interfacebonus}]]}} {{critroll=[[10+1d10+@{interface}+@{interfacebonus}]]}} {{fumbleroll=[[1-1d10+@{interface}+@{interfacebonus}]]}}" class="skillroll"
      ></button>
                </div>
            </li>
            <li class="roleslist">
                <input name="attr_techcheck" class="techcheck" type="checkbox" value='1' /><span><label data-i18n="Tech">Tech </label></span>
                <div class="tech">
                    <span class="maker"><label data-i18n="maker">Maker </label><input type="number" name="attr_maker" value="" class="inputstats" min="0" /></span>
                    <div class="roleskills">
                        <span data-i18n="point-assignments">Point Assignments (x 2 Maker)</span>

                        <span><label data-i18n="field-expertise">Field Expertise</label><input type="number" name="attr_fieldexper" value="" class="inputstats" min="0" title="points" /></span>
                        <span><label data-i18n="upgrade-expertise">Upgrade Expertise</label><input type="number" name="attr_upexp" value="" class="inputstats" min="0"  title="points" /></span>
                        <span><label data-i18n="fabrication-expertise">Fabrication Expertise</label><input type="number" name="attr_fabexp" value="" class="inputstats" min="0" title="points"/></span>
                        <span><label data-i18n="invention-expertise">Invention Expertise</label><input type="number" name="attr_invexp" value="" class="inputstats" min="0" title="points"/></span>
                    </div>
                </div>
            </li>
            <li class="roleslist">
                <input name="attr_medtechcheck" class="medtechcheck" type="checkbox" value='1' /><span><label data-i18n="Medtech">Medtech </label></span>
                <div class="medtech">
                    <span class="medicine"><label data-i18n="medicine">Medicine </label><input type="number" name="attr_med" value="" class="inputstats" min="0" /></span>
                    <div class="roleskills">
                        <span data-i18n="point-assignments">Point Assignments</span>

                        <span><label data-i18n="surgery">Surgery</label><input type="number" name="attr_surg" value="" class="inputstats" min="0" title="points" /></span>
                        <button type="roll" name="roll_skill" value="&{template:cprskill} {{name=@{character_name}}} {{rollname='Surgery'}} {{theroll=[[1d10]]}} {{normalroll=[[1d8+1+@{surg}]]}} {{critroll=[[10+1d10+@{surg}]]}} {{fumbleroll=[[1-1d10+@{surg}]]}}" class="skillroll"></button>
                        <span><label data-i18n="pharmaceuticals">Pharmaceuticals</label><input type="number" name="attr_pharma" value="" class="inputstats" min="0"  title="points" /></span>
                        <button type="roll" name="roll_skill" value="&{template:cprskill} {{name=@{character_name}}} {{rollname='Pharmaceuticals'}} {{theroll=[[1d10]]}} {{normalroll=[[1d8+1+@{pharma}]]}} {{critroll=[[10+1d10+@{pharma}]]}} {{fumbleroll=[[1-1d10+@{pharma}]]}}"
                            class="skillroll"></button>
                        <span><label data-i18n="cryosystem-operation">Cryosystem Operation</label><input type="number" name="attr_cryo" value="" class="inputstats" min="0" title="points"/></span>
                        <button type="roll" name="roll_skill" value="&{template:cprskill} {{name=@{character_name}}} {{rollname='Cryosystem Operation'}} {{theroll=[[1d10]]}} {{normalroll=[[1d8+1+@{cryo}]]}} {{critroll=[[10+1d10+@{cryo}]]}} {{fumbleroll=[[1-1d10+@{cryo}]]}}"
                            class="skillroll"></button>
                    </div>
                </div>
            </li>
            <li class="roleslist">
                <input name="attr_mediacheck" class="mediacheck" type="checkbox" value='1' /><span><label data-i18n="media">Media </label></span>
                <div class="media">
                    <span><label data-i18n="credibility">Credibility </label><input type="number" name="attr_cred" value="" class="inputstats" min="0" /></span>
                </div>
            </li>
            <li class="roleslist">
                <input name="attr_execcheck" class="execcheck" type="checkbox" value='1' /><span><label data-i18n="exec">Exec </label></span>
                <div class="exec">
                    <span><label data-i18n="teamwork">Teamwork </label><input type="number" name="attr_team" value="" class="inputstats" min="0" /></span>
                </div>
            </li>
            <li class="roleslist">
                <input name="attr_lawcheck" class="lawcheck" type="checkbox" value='1' /><span><label data-i18n="lawman">Lawman </label></span>
                <div class="law">
                    <span><label data-i18n="backup">Backup </label><input type="number" name="attr_back" value="" class="inputstats" min="0" /></span>
                </div>
            </li>
            <li class="roleslist">
                <input name="attr_fixcheck" class="fixcheck" type="checkbox" value='1' /><span><label data-i18n="fixer">Fixer </label></span>
                <div class="fix">
                    <span><label data-i18n="operator">Operator </label><input type="number" name="attr_oper" value="" class="inputstats" min="0" /></span>
                </div>
            </li>
            <li class="roleslist">
                <input name="attr_nomadcheck" class="nomadcheck" type="checkbox" value='1' /><span><label data-i18n="nomad">Nomad </label></span>
                <div class="nomad">
                    <span><label data-i18n="moto">Moto </label><input type="number" name="attr_moto" value="" class="inputstats" min="0" /></span>
                </div>
            </li>
        </ul>

    </div>
    <div class="stats section flex-row">
        <span><br/><label data-i18n="base">Base </label><br/><label data-i18n="current">Current </label></span>
        <span><label data-i18n="INT">INT </label><input type="number" name="attr_int" value="" class="inputstats" min="0" /><br/><input type="number" name="attr_curr_int" value="" class="inputstats"  min="0"/></span>
        <span><label data-i18n="REF">REF </label><input type="number" name="attr_ref" value="" class="inputstats"  min="0"/><br/><input type="number" name="attr_curr_ref" value="" class="inputstats"  min="0"/></span>
        <span><label data-i18n="DEX">DEX </label><input type="number" name="attr_dex" value="" class="inputstats"  min="0"/><br/><input type="number" name="attr_curr_dex" value="" class="inputstats"  min="0"/></span>
        <span><label data-i18n="TECH">TECH </label><input type="number" name="attr_tech" value="" class="inputstats"  min="0"/></span>
        <span><label data-i18n="COOL">COOL </label><input type="number" name="attr_cool" value="" class="inputstats"  min="0"/></span>
        <span><label data-i18n="WILL">WILL </label><input type="number" name="attr_will" value="" class="inputstats" min="0" /><br/><input type="number" name="attr_curr_will" value="" class="inputstats"  min="0"/></span>
        <span><label data-i18n="LUCK">LUCK </label><input type="number" name="attr_luck_max" value="" class="inputstats" min="0" /><br/><input type="number" name="attr_luck" value="" class="inputstats"  min="0"/></span>
        <span><label data-i18n="MOVE">MOVE </label><input type="number" name="attr_move" value="" class="inputstats"  min="0"/><br/><input type="number" name="attr_curr_move" value="" class="inputstats"  min="0"/></span>
        <span><label data-i18n="BODY">BODY </label><input type="number" name="attr_body" value="" class="inputstats" min="0" /><br/><label data-i18n="humanity">Humanity</label></span>
        <span><label data-i18n="EMP">EMP </label><input type="number" name="attr_emp" value="" class="inputstats"  min="0"/><br/><input name="attr_humanity" type="number" /></span>
        <span class="totalstats"><label data-i18n="total">Total </label><input type="number" name="attr_totalstats"  /></span>

    </div>
    <div class="hits section flex-row">
        <span><label data-i18n="current-hp">Current HP</label><input name="attr_hp" type="number" style="font-weight:bold" /></span>

        <span><label data-i18n="starting-hp">Starting HP</label><input name="attr_hp_max" type="number" /></span>

        <span><label data-i18n="seriously-wounded">Seriously Wounded</label><input name="attr_seriouslywounded" type="number" /></span>

        <span><label data-i18n="death-penalty">Death Save Penalty</label><input name="attr_deathsave_penalty" type="number" /></span>
        <span><label data-i18n="death-saves">Death Saves</label><input name="attr_deathsaves" type="number" /></span>
        <span><button type="roll" name="act_deathsave" value="&{template:cprdeathsave} {{name=@{character_name}}} {{rollname=Death Save}} {{theroll=[[1d10+@{deathsaves}+@{deathsave_penalty}]]}} {{bodystat=[[@{body}]]}}" class="skillroll"></button></span>

        <span></span>
    </div>
    <div class="skills section">
        <label data-i18n="skills">Skills</label>
        <fieldset class="repeating_skills">
            <input name="attr_skill" class="skill" type="text" />
            <select name="attr_skillstat" class="skillstat">
        <option value="0">-</option>
        <option data-i18n="INT" value="@{curr_int}">INT</option>
        <option data-i18n="REF" value="@{curr_ref}">REF</option>
        <option data-i18n="DEX" value="@{curr_dex}">DEX</option>
        <option data-i18n="TECH" value="@{tech}">TECH</option>
        <option data-i18n="COOL" value="@{cool}">COOL</option>
        <option data-i18n="WILL" value="@{curr_will}">WILL</option>
        <option data-i18n="LUCK" value="@{luck}">LUCK</option>
        <option data-i18n="MOVE" value="@{curr_move}">MOVE</option>
        <option data-i18n="BODY" value="@{body}">BODY</option>
        <option data-i18n="EMP" value="@{emp}">EMP</option>
      </select>
            <select name="attr_skillrole" class="skillrole">
        <option value="0">-</option>
        <optgroup label="Solo">
          <option data-i18n="precision-attack-fumble-recovery" value="(@{precatt}/3)">Precision Attack / Fumble Recovery</option>
          <option data-i18n="threat-detection" value="@{threatdetect}">Threat Detection</option>
        </optgroup>
        <optgroup label="Tech">
          <option data-i18n="field-expertise" value="@{fieldexper}">Field Expertise</option>
          <option data-i18n="upgrade-expertise" value="@{upexp}">Upgrade Expertise</option>
          <option data-i18n="fabrication-expertise" value="@{fabexp}">Fabrication Expertise</option>
          <option data-i18n="invention-expertise" value="@{invexp}">Invention Expertise</option>
        </optgroup>
        <optgroup  label="Media">
          <option data-i18n="credibility" value="@{cred}">Credibility</option>
        </optgroup>
        <optgroup  label="Fixer">
          <option data-i18n="operator" value="@{oper}">Operator</option>
        </optgroup>
        <optgroup  label="Nomad">
          <option data-i18n="moto" value="@{moto}">Moto</option>
        </optgroup>
      </select>
            <input type="hidden" name="attr_fumble-recovery-possible" class="skillrole" />
            <select name="attr_skillpenalty" class="skillrole">
        <option value="0">-</option>
        <option data-i18n="action_penalty" value="@{action_penalty}">Action Penalty</option>
        <option data-i18n="melee_penalty" value="@{melee_penalty}">Melee Penalty</option>
        <option data-i18n="range_penalty" value="@{range_penalty}">Range/Perception Penalty</option>
        <option data-i18n="speech_penalty" value="@{speech_penalty}">Speech Penalty</option>
        <option data-i18n="hearing_penalty" value="@{hearing_penalty}">Hearing Penalty</option>
      </select>
            <input name="attr_skillbonus" type="number" value="0" title="Skill Ranks" placeholder="Ranks" />
            <input name="attr_skillmod" type="number" value="0" title="Skill Mod" placeholder="Mod" />
            <input type="checkbox" name="attr_skillcostdouble" title="x2" value="1" />
            <button type="roll" name="roll_skill" value="&{template:cprskill} {{name=@{character_name}}} {{rollname=@{skill}}} {{theroll=[[1d10]]}} {{normalroll=[[1d8+1+@{skillstat}+@{skillrole}+@{skillpenalty}+@{skillbonus}+@{skillmod}]]}} {{critroll=[[10+1d10+@{skillstat}+@{skillrole}+@{skillpenalty}+@{skillbonus}+@{skillmod}]]}} {{fumbleroll=[[1-((1 - (@{fumble-recovery-possible} * @{fumrecov} / 4))*(1d10))+@{skillstat}+@{skillrole}+@{skillbonus}+@{skillmod}]]}}"
                class="skillroll">
      </button>
        </fieldset>
        <span class="totalstats"><label data-i18n="total">Total </label><input type="number" name="attr_totalskills"  /></span>
    </div>
    <div class="conditions section">
        <label data-i18n="conditions">Conditions</label>
        <div> <span data-i18n="seriously-wounded">Seriously Wounded</span> <input type="checkbox" name="attr_condition_seriously_wounded" value="1" /></div>
        <div><span data-i18n="mortally-wounded">Mortally Wounded</span> <input type="checkbox" name="attr_condition_mortally_wounded" value="1" /> </div>
        <br/><br/>
        <label data-i18n="armor-body">Body</label>
        <div><span data-i18n="dismembered-arm">Dismembered Arm</span> <input type="checkbox" name="attr_contition_dismembered_arm" value="1" /></div>
        <div><span data-i18n="dismembered-hand">Dismembered Hand</span> <input type="checkbox" name="attr_contition_dismembered_hand" value="1" /></div>
        <div><span data-i18n="collapsed-lung">Collapsed Lung</span> <input type="checkbox" name="attr_contition_collapsed_lung" value="1" /></div>
        <div><span data-i18n="broken-ribs">Broken Ribs</span> <input type="checkbox" name="attr_contition_broken_ribs" value="1" /></div>
        <div><span data-i18n="broken-arm">Broken Arm</span> <input type="checkbox" name="attr_contition_broken_arm" value="1" /></div>
        <div><span data-i18n="foreign-object">Foreign Object</span> <input type="checkbox" name="attr_contition_body_foreign_object" value="1" /></div>
        <div><span data-i18n="broken-leg">Broken Leg</span> <input type="checkbox" name="attr_contition_broken_leg" value="1" /></div>
        <div><span data-i18n="torn-muscle">Torn Muscle</span> <input type="checkbox" name="attr_contition_torn_muscle" value="1" /></div>
        <div><span data-i18n="spinal-injury">Spinal Injury</span> <input type="checkbox" name="attr_contition_spinal_injury" value="1" /></div>
        <div><span data-i18n="crushed-fingers">Crushed Fingers</span> <input type="checkbox" name="attr_contition_crushed_fingers" value="1" /></div>
        <div><span data-i18n="dismembered-leg">Dismembered Leg</span> <input type="checkbox" name="attr_contition_dismembered_leg" value="1" /></div>
        <br/><br/>
        <label data-i18n="armor-head">Head</label>
        <div><span data-i18n="lost-eye">Lost Eye</span> <input type="checkbox" name="attr_contition_lost_eye" value="1" /></div>
        <div><span data-i18n="brain-injury">Brain Injury</span> <input type="checkbox" name="attr_contition_brain_injury" value="1" /></div>
        <div><span data-i18n="damaged-eye">Damaged Eye</span> <input type="checkbox" name="attr_contition_damaged_eye" value="1" /></div>
        <div><span data-i18n="concussion">Concussion</span> <input type="checkbox" name="attr_contition_concussion" value="1" /></div>
        <div><span data-i18n="broken-jaw">Broken Jaw</span> <input type="checkbox" name="attr_contition_broken_jaw" value="1" /></div>
        <div><span data-i18n="foreign-object">Foreign Object</span> <input type="checkbox" name="attr_contition_head_foreign_object" value="1" /></div>
        <div><span data-i18n="whiplash">Whiplash</span> <input type="checkbox" name="attr_contition_whiplash" value="1" /></div>
        <div><span data-i18n="cracked-skull">Cracked Skull</span> <input type="checkbox" name="attr_contition_cracked_skull" value="1" /></div>
        <div><span data-i18n="damaged-ear">Damaged Ear</span> <input type="checkbox" name="attr_contition_damaged_ear" value="1" /></div>
        <div><span data-i18n="crushed-windpipe">Crushed Windpipe</span> <input type="checkbox" name="attr_contition_crushed_windpipe" value="1" /></div>
        <div><span data-i18n="lost-ear">Lost Ear</span> <input type="checkbox" name="attr_contition_lost_ear" value="1" /></div>
        <br/><br/>
        <label data-i18n="action_penalty">Action Penalty</label><input type="number" name="attr_action_penalty" />
        <label data-i18n="melee_penalty">Melee Penalty</label><input type="number" name="attr_melee_penalty" />
        <label data-i18n="range_penalty">Range/Perception Penalty</label><input type="number" name="attr_range_penalty" />
        <label data-i18n="speech_penalty">Speech Penalty</label><input type="number" name="attr_speech_penalty" />
        <label data-i18n="hearing_penalty">Hearing Penalty</label><input type="number" name="attr_hearing_penalty" />
    </div>
    <div class="weapons section">
        <label data-i18n="weapons" class="weapon">Weapons</label>
        <span data-i18n="damage" class="weapondamage">Damage</span>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
        <span data-i18n="magazine" class="magazine">Mag</span>
        <span data-i18n="remaining" class="remaining">Rem</span>
        <span data-i18n="weaponrateoffire" class="weaponrateoffire">ROF</span>
        <span data-i18n="weaponhands" class="weaponhands">hands</span>
        <span data-i18n="autofire" class="autofire">auto</span>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
        <span data-i18n="weaponconcealable" class="weaponconcealable">c</span>
        <span data-i18n="cost" class="cost">Cost</span>
        <span data-i18n="count" class="count" value="1">Count</span>
        <fieldset class="repeating_weapon">
            <input name="attr_weapon" type="text" class="weapon" />
            <select name="attr_weapondamage" type="text" class="weapondamage">
        <option value="0">-</option>
        <option value="1d6">1d6</option>
        <option value="2d6">2d6</option>
        <option value="3d6">3d6</option>
        <option value="4d6">4d6</option>
        <option value="5d6">5d6</option>
        <option value="6d6">6d6</option>
        <option value="7d6">7d6</option>
        <option value="8d6">8d6</option>
        <option value="9d6">9d6</option>
      </select>
      <button type="roll" name="roll_damage" value="&{template:damage} {{name=@{character_name} @{weapon}}} {{damage=[[@{weapondamage}+@{spotweak}]]}} {{criticalInjury=[[2d6]]}}" class="damageroll"></button>
            <input type="number" name="attr_magazine" title="magazine" class="magazine" />
            <input type="number" name="attr_remaining" title="remaining" class="remaining" />
            <select name="attr_weaponrateoffire" class="weaponrateoffire" title="ROF">
        <option value="0">-</option>
        <option value="1">1</option>
        <option value="2">2</option>
      </select>
            <select name="attr_weaponhands" class="weaponhands" title="Hands">
        <option value="0">-</option>
        <option value="1">1</option>
        <option value="2">2</option>
      </select>
      <select name="attr_autofire" class="autofire" title="autofire">
        <option value="0">-</option>
        <option value="3">3</option>
        <option value="4">4</option>
      </select>
      <button type="roll" name="roll_damage" value="&{template:damage} {{name=@{character_name} @{weapon} autofire}} {{damage=[[2d6*@{autofire}+@{spotweak}]]}} {{criticalInjury=[[2d6]]}}" class="damageroll"></button>
        <input type="checkbox" name="attr_weaponconcealable" class="weaponconcealable" title="Concealable" value="1" />
        <input type="number" name="attr_cost" title="cost" class="cost" />
        <input type="number" name="attr_count" title="count" class="count" value="1" />
        
        </fieldset>
    </div>

    <div class="life section">
        <span><label data-i18n="lifepath">Lifepath</label></span>
        <p>
            <span><label data-i18n="cultural-origins">Cultural Origins</label>
      <input type="text" name="attr_cultorig"/></span><span>
      <label data-i18n="personality">Personality</label>
      <input type="text" name="attr_personality"/></span><span>
      <label data-i18n="clothing">Clothing</label>
      <input type="text"  name="attr_clothing"/></span><span>
      <label data-i18n="hairstyle">Hairstyle</label>
      <input type="text" name="attr_hairstyle"/></span><span>
      <label data-i18n="affectation">Affectation</label>
      <input type="text"  name="attr_Affectation"/></span><span>
      <label data-i18n="originalback">Original Family Background</label>
      <input type="text" name="attr_originalback"/></span><span>
      <label data-i18n="environment">Environment</label>
      <textarea name="attr_environment"></textarea></span><span>
            <label data-i18n="familycrisis">Family Crisis</label>
            <textarea name="attr_familycrisis"></textarea></span><span>
            <label data-i18n="friends">Friends</label>
            <textarea name="attr_friends"></textarea></span><span>
            <label data-i18n="enemies">Enemies</label>
            <textarea name="attr_enemies"></textarea></span><span>
            <label data-i18n="lovers">Lovers</label>
            <textarea name="attr_lovers"></textarea></span><span>
            <label data-i18n="goal">Goal</label>
      <textarea name="attr_goal"></textarea></span><span>
            <label data-i18n="careerpath">Career Path</label>
      <textarea name="attr_careerpath"></textarea></span>
        </p>
    </div>

    <div class="armor section">
        <label data-i18n="Armor">Armor</label>
        <fieldset class="repeating_armor">
            <input name="attr_armor" type="text" class="armorname" />
            <div class="flex-row">
                <label><span data-i18n="armor-head">Head:</span>: <input name="attr_armorhead" type="number" style="display:inline"></label>
                <label><span data-i18n="armor-body">Body:</span>: <input name="attr_armorbody" type="number" style="display:inline"></label>
                <label><span data-i18n="cost">Cost:</span>: <input name="attr_cost" type="number" style="display:inline" class="sheet-cost"></label>
                <label><span data-i18n="count">Count:</span>: <input name="attr_count" type="number" style="display:inline" class="sheet-count" value="1"></label>
            </div>
        </fieldset>
    </div>
    <div class="cyberware section">

        <label data-i18n="cyberware">Cyberware</label>
        <fieldset class="repeating_cyberware">
            <input type="text" name="attr_cyberware" class="armorname" />
            <div class="flex-row">
                <label><span data-i18n="humanity">Humanity</span>: <input name="attr_humanity" type="number" style="display:inline" class="humanity"></label>
                <label><span data-i18n="cost">Cost</span>: <input name="attr_cost" type="number" style="display:inline" class="sheet-cost"></label>
                <label><span data-i18n="count">Count</span>: <input name="attr_count" type="number" style="display:inline" class="sheet-count" value="1"></label></div>
        </fieldset>

    </div>

    <div class="equipment section">
        <label data-i18n="gear">Gear</label>
        <span data-i18n="cost" class="cost">Cost</span>
        <span data-i18n="count" class="count" >Count</span>
        <fieldset class="repeating_gear">
            <input type="text" name="attr_gear"  class="gear" /> 
            <input name="attr_cost" type="number" style="display:inline" class="sheet-cost" title="Cost">
            <input name="attr_count" type="number" style="display:inline" class="sheet-count" value="1"  title="Count">
        </fieldset>

    </div>

    <div class="programs section">
      <label data-i18n="programs" class=program>Programs</label>
      <span data-i18n="perception" class="perception">PER</span>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      <span data-i18n="speed" class="speed">SPD</span>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      <span data-i18n="attack" class="attack">ATK</span>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      <span data-i18n="defence" class="defence">DEF</span>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      <span data-i18n="rez" class="rez">REZ</span>
      <span data-i18n="damage" class="programdamage" >Damage</span>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      <span data-i18n="cost" class="cost">Cost</span>
      <span data-i18n="count" class="count" >Count</span>
      <span data-i18n="slotted" class="slotted">Slotted</span>

      <fieldset class="repeating_programs">
          <input type="text" name="attr_program"  class="program" />
          <input type="number" name="attr_perception"  class="perception" />
          <button type="roll" name="roll_perception" value="&{template:default} {{name=@{character_name} @{program} perception }} {{perception=[[@{perception}+1d10]]}} " class="roll"></button>
          <input type="number" name="attr_speed"  class="speed" />
          <button type="roll" name="roll_speed" value="&{template:default} {{name=@{character_name} @{program} speed }} {{speed=[[@{speed}+1d10]]}} " class="roll"></button>
          <input type="number" name="attr_attack"  class="attack" />
          <button type="roll" name="roll_attack" value="&{template:default} {{name=@{character_name} @{program} attack }} {{attack=[[@{interface}+@{attack}+1d10]]}} " class="roll"></button>
          <input type="number" name="attr_defence"  class="defence" />
          <button type="roll" name="roll_defence" value="&{template:default} {{name=@{character_name} @{program} defence }} {{defence=[[@{defence}+1d10]]}} " class="roll"></button>
          <input type="number" name="attr_rez"  class="rez" />
          <select name="attr_programdamage" class="programdamage">
            <option value="0">-</option>
            <option value="1d6">1d6</option>
            <option value="2d6">2d6</option>
            <option value="3d6">3d6</option>
            <option value="4d6">4d6</option>
            <option value="5d6">5d6</option>
            <option value="6d6">6d6</option>
            <option value="7d6">7d6</option>
            <option value="8d6">8d6</option>
            <option value="9d6">9d6</option>
          </select>
          <button type="roll" name="roll_damage" value="&{template:damage} {{name=@{character_name} @{program}}} {{damage=[[@{programdamage}+@{spotweak}]]}} {{criticalInjury=[[2d6]]}}" class="damageroll"></button>
          <input name="attr_cost" type="number" class="cost">
          <input name="attr_count" type="number" class="count" value="1">
          <input type="number" name="attr_slotted" class="slotted" title="Slotted" value="1" />
          <br/>
          <input type="text" name="attr_effects"  class="effects" title="Effects" placeholder="Effects" />
        </fieldset>

  </div>
</div>
<rolltemplate class="sheet-rolltemplate-generic">
    <table class="template-container">
        <caption class="template-header">{{name}} rolls{{#rollname}} {{rollname}}{{/rollname}}</caption>
        <tr class="roll">
            <td class="normalroll">
                {{theroll}}
            </td>
        </tr>
    </table>
</rolltemplate>
<rolltemplate class="sheet-rolltemplate-cprskill">
    <table class="template-container">
        <caption class="template-header">{{name}} rolls {{rollname}}</caption>

        {{#rollWasCrit() theroll}}
        <tr class="roll">
            <td class="critroll">
                {{critroll}}
            </td>
        </tr>
        {{/rollWasCrit() theroll}} {{#rollWasFumble() theroll}}
        <tr class="roll">
            <td class="fumbleroll">
                {{fumbleroll}}
            </td>
        </tr>
        {{/rollWasFumble() theroll}} {{#rollBetween() theroll 2 9}}
        <tr class="roll">
            <td class="normalroll">
                {{normalroll}}
            </td>
        </tr>
        {{/rollBetween() theroll 2 9}}
        </tr>

    </table>
</rolltemplate>
<rolltemplate class="sheet-rolltemplate-damage">
    <table class="template-container">
        <caption class="template-header">{{name}}</caption>
        <tr class="roll">
            <td class="normalroll">
                Damage {{damage}}
            </td>
        </tr>
        <tr class="roll">
            {{#rollTotal() criticalInjury 2}}
            <td class="normalroll">
                Dismembered Arm or Lost Eye (and 5 Bonus Damage if critical)
            </td>
            {{/rollTotal() criticalInjury 2 }} {{#rollTotal() criticalInjury 3}}
            <td class="normalroll">
                Dismembered Hand or Brain Injury (and 5 Bonus Damage if critical)
            </td>
            {{/rollTotal() criticalInjury 3 }} {{#rollTotal() criticalInjury 4}}
            <td class="normalroll">
                Collapsed Lung or Damaged Eye (and 5 Bonus Damage if critical)
            </td>
            {{/rollTotal() criticalInjury 4 }} {{#rollTotal() criticalInjury 5}}
            <td class="normalroll">
                Broken Ribs or Concussion (and 5 Bonus Damage if critical)
            </td>
            {{/rollTotal() criticalInjury 5 }} {{#rollTotal() criticalInjury 6}}
            <td class="normalroll">
                Broken Arm or Broken Jaw (and 5 Bonus Damage if critical)
            </td>
            {{/rollTotal() criticalInjury 6 }} {{#rollTotal() criticalInjury 7}}
            <td class="normalroll">
                Foreign Object (and 5 Bonus Damage if critical)
            </td>
            {{/rollTotal() criticalInjury 7 }} {{#rollTotal() criticalInjury 8}}
            <td class="normalroll">
                Broken Leg or Whiplash (and 5 Bonus Damage if critical)
            </td>
            {{/rollTotal() criticalInjury 8 }} {{#rollTotal() criticalInjury 9}}
            <td class="normalroll">
                Torn Muscle or Cracked Skull (and 5 Bonus Damage if critical)
            </td>
            {{/rollTotal() criticalInjury 9 }} {{#rollTotal() criticalInjury 10}}
            <td class="normalroll">
                Spinal Injury or Damaged Ear (and 5 Bonus Damage if critical)
            </td>
            {{/rollTotal() criticalInjury 10 }} {{#rollTotal() criticalInjury 11}}
            <td class="normalroll">
                Crushed Fingers or Crushed Windpipe (and 5 Bonus Damage if critical)
            </td>
            {{/rollTotal() criticalInjury 11 }} {{#rollTotal() criticalInjury 12}}
            <td class="normalroll">
                Dismembered Leg or Lost Ear (and 5 Bonus Damage if critical)
            </td>
            {{/rollTotal() criticalInjury 12 }}

        </tr>
    </table>
</rolltemplate>
<rolltemplate class="sheet-rolltemplate-cprdeathsave">
    <table class="template-container">
        <caption class="template-header">{{rollname}}</caption>
        <tr class="roll">
            <td class="normalroll">
                {{#^rollWasCrit() theroll }} {{#rollLess() theroll bodystat}} {{theroll}} <span class="alive">{{name}} is still alive!</span> {{/rollLess() theroll bodystat}} {{#^rollLess() theroll bodystat}} {{theroll}} <span class="dead">{{name}} is DEAD ☠️</span>                {{/^rollLess() theroll bodystat}} {{/^rollWasCrit() theroll }} {{#rollWasCrit() theroll}} {{theroll}} <span class="dead">{{name}} is DEAD ☠️</span> {{/rollWasCrit() theroll}}
            </td>
        </tr>
    </table>
</rolltemplate>
<script type="text/worker">
    var currentVersion = 1;
    on('sheet:opened', function() {
      getAttrs(["version"], function(values) {
        v = values.version;
        if (v < currentVersion) {
          setAttrs({
            "version": currentVersion,
          });
        }
      });
    
    });
    on("change:int change:ref change:dex change:tech change:cool change:will change:luck_max change:move change:body change:emp", function() { 
      getAttrs(["int","ref","dex","tech","cool","will","luck_max","move","body","emp", "humanity"], function(values) {
        var attrs = {
          curr_int : parseInt(values.int),
          curr_ref : parseInt(values.ref),
          curr_dex : parseInt(values.dex),
          curr_tech : parseInt(values.tech),
          curr_cool : parseInt(values.cool),
          curr_will : parseInt(values.will),
          luck : parseInt(values.luck_max),
          curr_move : parseInt(values.move),
          curr_body : parseInt(values.body),
          humanity :  (parseInt(values.emp) * 10) + 9 < values.humanity || (parseInt(values.emp) * 10) > values.humanity ? parseInt(values.emp) * 10 : values.humanity,
          'hp_max': (10 + (5*Math.ceil((parseInt( values.will)+parseInt( values.body))/2))),
          'totalstats': 0 + parseInt( values.int ) + parseInt( values.ref ) + parseInt( values.dex ) + parseInt( values.tech ) + parseInt( values.cool ) + parseInt( values.will ) + parseInt( values.luck_max ) + parseInt( values.move ) + parseInt( values.body ) + parseInt( values.emp)
        };
        attrs['seriouslywounded'] = Math.ceil(attrs['hp_max'] / 2);

        setAttrs(attrs);
      });
    });
    on("change:skillrole", function() {
      getSectionIDs("repeating_skills", function(idarray) {
        for(var i=0; i < idarray.length; i++) {
          getAttrs(["repeating_skills_" + idarray[i] + "_skillrole"], function(values){
            var skillRoleName = Object.keys(values)[0];
            var fumbRecoveryPossibleName = skillRoleName.replace("_skillrole","_fumble-recovery-possible");
            values[fumbRecoveryPossibleName] = values[skillRoleName] =="(@{precatt}/3)" ? 1 : 0;
            setAttrs(values);
          });
        }
      });
    });
    on("change:skillbonus change:skillcostdouble sheet:opened", function() {
      getSectionIDs("repeating_skills", function(idarray) {
        var props =[];
        for(var i=0; i < idarray.length; i++) {
          props.push("repeating_skills_"+ idarray[i] + "_skillbonus");
          props.push("repeating_skills_"+ idarray[i] + "_skillcostdouble");         
        }
       
        getAttrs(props,function(skills){
          var totalpoints = 0;
          for(const key in skills) {
            
            if (key.includes("_skillbonus")) {
              totalpoints +=  parseInt(  skills[key] ) * (skills[key.replace("_skillbonus","_skillcostdouble")] == '1' ? 2 : 1);
            }
          }
          totalpoints -= 4; //Language (Cultural Origin) (x0)
         setAttrs({totalskills: totalpoints});
        });
      });
    });
  
    on("sheet:open change:hp change:int change:ref change:dex change:tech change:cool change:will change:luck change:move change:body change:emp change:condition_seriously_wounded change:condition_mortally_wounded change:contition_dismembered_arm change:contition_dismembered_hand change:contition_collapsed_lung change:contition_broken_ribs change:contition_broken_arm change:contition_body_foreign_object change:contition_broken_leg change:contition_torn_muscle change:contition_spinal_injury change:contition_crushed_fingers change:contition_dismembered_leg change:contition_lost_eye change:contition_brain_injury change:contition_damaged_eye change:contition_concussion change:contition_broken_jaw change:contition_head_foreign_object change:contition_whiplash change:contition_cracked_skull change:contition_damaged_ear change:contition_crushed_windpipe change:contition_lost_ear ",
      function() {
      getAttrs(["hp","seriouslywounded","int","ref","dex","tech","cool","will","luck","move","body","emp",
      "condition_seriously_wounded","condition_mortally_wounded","contition_dismembered_arm","contition_dismembered_hand","contition_collapsed_lung","contition_broken_ribs",
      "contition_broken_arm","contition_body_foreign_object","contition_broken_leg","contition_torn_muscle","contition_spinal_injury","contition_crushed_fingers","contition_dismembered_leg",
      "contition_lost_eye","contition_brain_injury","contition_damaged_eye","contition_concussion","contition_broken_jaw","contition_head_foreign_object","contition_whiplash",
      "contition_cracked_skull","contition_damaged_ear","contition_crushed_windpipe","contition_lost_ear"]
        ,function(values) {
  
          values.hp = parseInt(values.hp);
          values.seriouslywounded = parseInt(values.seriouslywounded);
          values.int = parseInt(values.int);
          values.ref = parseInt(values.ref);
          values.dex = parseInt(values.dex);
          values.tech = parseInt(values.tech);
          values.cool = parseInt(values.cool);
          values.will = parseInt(values.will);
          values.luck = parseInt(values.luck);
          values.move = parseInt(values.move);
          values.body = parseInt(values.body);
          values.emp = parseInt(values.emp);
          values.condition_seriously_wounded = parseInt(values.condition_seriously_wounded);
          values.condition_mortally_wounded = parseInt(values.condition_mortally_wounded);
          values.contition_dismembered_arm = parseInt(values.contition_dismembered_arm);
          values.contition_dismembered_hand = parseInt(values.contition_dismembered_hand);
          values.contition_collapsed_lung = parseInt(values.contition_collapsed_lung);
          values.contition_broken_ribs = parseInt(values.contition_broken_ribs);
          values.contition_broken_arm = parseInt(values.contition_broken_arm);
          values.contition_body_foreign_object = parseInt(values.contition_body_foreign_object);
          values.contition_broken_leg = parseInt(values.contition_broken_leg);
          values.contition_torn_muscle = parseInt(values.contition_torn_muscle);
          values.contition_spinal_injury = parseInt(values.contition_spinal_injury);
          values.contition_crushed_fingers = parseInt(values.contition_crushed_fingers);
          values.contition_dismembered_leg = parseInt(values.contition_dismembered_leg);
          values.contition_lost_eye = parseInt(values.contition_lost_eye);
          values.contition_brain_injury = parseInt(values.contition_brain_injury);
          values.contition_damaged_eye = parseInt(values.contition_damaged_eye);
          values.contition_concussion = parseInt(values.contition_concussion);
          values.contition_broken_jaw = parseInt(values.contition_broken_jaw);
          values.contition_head_foreign_object = parseInt(values.contition_head_foreign_object);
          values.contition_whiplash = parseInt(values.contition_whiplash);
          values.contition_cracked_skull = parseInt(values.contition_cracked_skull);
          values.contition_damaged_ear = parseInt(values.contition_damaged_ear);
          values.contition_crushed_windpipe = parseInt(values.contition_crushed_windpipe);
          values.contition_lost_ear = parseInt(values.contition_lost_ear);

          attrs = {};
          if (values.hp < 1) {
            attrs['condition_seriously_wounded'] = 0;
            attrs['condition_mortally_wounded'] = 1;
          } else if (values.hp < values.seriouslywounded) {
            attrs['condition_seriously_wounded'] = 1;
          }
          if (values.condition_seriously_wounded && values.condition_mortally_wounded) {
            attrs['condition_seriously_wounded'] = 0;
          }
  
          var actionPenalty =  0 + (values.condition_mortally_wounded ? -4 : 0) + (values.condition_seriously_wounded ? -2 : 0) + (values.contition_brain_injury ? -2 : 0) + (values.contition_concussion_injury ? -2 : 0);
          var movePenalty =  0 + (values.condition_mortally_wounded ? -6 : 0) + (values.contition_collapsed_lung ? -2 : 0) + (values.contition_broken_leg ? -4 : 0) + (values.contition_dismembered_leg ? -6 : 0);
          var meleePenalty = 0 + values.contition_torn_muscle ? -2 : 0;
          var rangePenalty = 0 + (values.contition_lost_eye ? -4 : 0) + (values.contition_damaged_eye ? -2 : 0);
          var speechPenalty = 0 + (values.contition_broken_jaw ? -2 : 0) - (values.contition_crushed_windpipe ? -99 : 0);
          var hearingPenalty = 0 + (values.contition_damaged_ear ? -2 : 0) - (values.contition_lost_ear ? -4 : 0);
          var deathSavePenalty = 0 + values.condition_mortally_wounded + values.contition_dismembered_arm + values.contition_dismembered_hand + values.contition_collapsed_lung + values.contition_spinal_injury 
            + values.contition_broken_leg + values.contition_lost_eye + values.contition_brain_injury + values.contition_whiplash + values.contition_cracked_skull + values.contition_crushed_windpipe
            + values.contition_lost_ear;
  
          
          attrs['action_penalty'] = actionPenalty;
          attrs['melee_penalty'] = meleePenalty;
          attrs['range_penalty'] = rangePenalty;
          attrs['speech_penalty'] = speechPenalty;
          attrs['hearing_penalty'] = hearingPenalty;
          attrs['deathsave_penalty'] = deathSavePenalty;
          attrs['curr_move'] = Math.max(1, values.move + movePenalty);
  
          setAttrs(attrs);

      });
  
    });
    on("change:cost change:count sheet:opened", function() {
      getSectionIDs("repeating_weapon", function(idarray) {
        var costs =[];
        for(var i=0; i < idarray.length; i++) {
          costs.push("repeating_weapon_"+ idarray[i] + "_cost");    
          costs.push("repeating_weapon_"+ idarray[i] + "_count");    
        }
        getSectionIDs("repeating_armor", function(idarray) {
          for(var i=0; i < idarray.length; i++) {
            costs.push("repeating_armor_"+ idarray[i] + "_cost");    
            costs.push("repeating_armor_"+ idarray[i] + "_count");    
          }
          getSectionIDs("repeating_cyberware", function(idarray) {
            for(var i=0; i < idarray.length; i++) {
              costs.push("repeating_cyberware_"+ idarray[i] + "_cost");    
              costs.push("repeating_cyberware_"+ idarray[i] + "_count");    
            }
            getSectionIDs("repeating_gear", function(idarray) {
              for(var i=0; i < idarray.length; i++) {
                costs.push("repeating_gear_"+ idarray[i] + "_cost");    
                costs.push("repeating_gear_"+ idarray[i] + "_count");    
              }
              getSectionIDs("repeating_programs", function(idarray) {
                for(var i=0; i < idarray.length; i++) {
                  costs.push("repeating_programs_"+ idarray[i] + "_cost");    
                  costs.push("repeating_programs_"+ idarray[i] + "_count");    
                }
                getAttrs(costs,function(values){
                  var totalpoints = 0;
                  for(const key in values) {
                    if (key.includes('_cost')) {
                      totalpoints += ( values[key] ? parseInt( values[key] ) : 0 ) * ( values[key.replace('_cost','_count')] ? parseInt( values[key.replace('_cost','_count')]  ) : 0 ) ;
                    }
                  }
                setAttrs({total_assets: totalpoints});
                });
              });
            });
          });
        });
      });
    });
  
  
  </script>
  