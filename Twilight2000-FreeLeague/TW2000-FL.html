<div>
    <button type="action" name="act_main">PC</button>
<!--    <button type="action" name="act_NPC">NPC</button>-->
</div>

<input type="hidden" class="sheet-tabstoggle" name="attr_sheetTab" value="main">

<div class="sheet-main">
    <div class="headergraphic">
        <img src="https://i.imgur.com/1SELtcv.png" width="201px">
    </div>
    <div class="headerpanel">
        <input type="text" class="identlabel" value="NAME" disabled style="width:5em;">
        <input class="identinput" Type="text" name="attr_character_name" style="width:15em;">
        <input type="text" class="identlabel" value="NATIONALITY" disabled style="width:10em;">
        <input class="identinput" Type="text" name="attr_nationality" style="width:15em;">

        <button type="roll" class="vaesend66" title="d66" value="&{template:vaesen-skill}{{playername=@{character_name}}}{{skillname=D66 Roll}}{{result=[[[[d6]][[d6]]]]}}" name="roll_protection"></button>

    </div>
    <div class="characterident">

                    <input type="text" class="identlabel" value="BRANCH" disabled>
                    <input class="identinput"  Type="text" name="attr_branch">

                    <input type="text" class="identlabel" value="APPEARANCE" disabled>
                    <input class="identinput"  Type="text" name="attr_appearance">
                    <BR>

                    <input type="text" class="identlabel" value="MILITARY RANK" disabled>
                    <input class="identinput"  Type="text" name="attr_rank">
 
                    <input type="text" class="identlabel" value="MORAL CODE" disabled>
                    <input class="identinput"  Type="text" name="attr_moralcode">
                    <br>
                    <input type="text" class="identlabel" value="BUDDY" disabled>  
                    <input class="identinput"  Type="text" name="attr_buddy">

                    <input type="text" class="identlabel" value="BIG DREAM" disabled>
                    <input class="identinput"  Type="text" name="attr_bigdream">
                    <br>

                    <input type="text" class="identlabel" value="HOW YOU MET THE GROUP" disabled>
                    <input class="identinput" Type="text" name="attr_met" style="width:30em;">
                </Td>
            </tr>
        </table>
    </div>
<!--
    <div class="rightstats">
        <br><BR>
        <textarea class="vaesentextarea" name="attr_trauma"></textarea><Label class="attriblabel">Trauma</Label>
        <textarea class="vaesentextarea" name="attr_darksecret"></textarea><label class="attriblabel">Dark Secret</label>
    </div>

    <div class="mainspanning">
        <hr class="break"> 
    </div>

    <div class="leftbody">
        <h2 class="areaheader">Relationships</h2>
        <table>
            <fieldset class="repeating_relationships">
                <input class="tinytext" type="text" name="attr_RelationPC">
                <input class="shorttext2" type="text" name="attr_Relation" >
            </fieldset>
        </table>
        <h2 class="areaheader">Talents</h2>

        <fieldset class="repeating_Talents">
            <input class="medtext" type="text" name="attr_Talent1" >
        </fieldset>
    </div>
    
    <div class="rightbody">
        <h2 class="areaheader">Insights & Defects</h2>
        <fieldset class="repeating_insights">
            <input class="medtext" type="text" name="attr_insights" >
        </fieldset>
        <h2 class="areaheader">Advantages</h2>
        <fieldset class="repeating_advantages">
            <input class="medtext" type="text" name="attr_advantages" >
        </fieldset>    
      </div>
    
    <div class="wideequipment">
        <hr class="break">
        <h2 class="areaheader">Equipment</h2>
        <fieldset class="repeating_equipment">
            <input class="med2text" type="text" name="attr_equipment" >
            <input class="attribtext"type="number" name="attr_equbonus">
            <button type="action" name="act_equip">Use</button>
        </fieldset>
        <h2 class="areaheader">Mementos</h2>
        <fieldset class="repeating_mementos">
            <input class="longtext2" type="text" name="attr_Mementos" >
        </fieldset>   
        <h2 class="areaheader">Armor</h2>
        <table class="table2">
            <th>Name</th><th>Protect</th><th>Agility</th>
            <tr>
              <td><input class="med2text" Type="text" name="attr_armor"></td>
              <td><input class="attribtext" Type="number" name="attr_armorprotection" value="0"></td>
              <td><input class="atrribtext" Type="number" name="attr_armoragility" value="0"><button type="roll" class="twilightdie" value="&{template:vaesen-attrib}{{playername=@{character_name}}}{{attribname=@{armor} Check}}{{attribvalue=@{armorprotection}}}{{bonus=@{equipedbonus}}}{{result=[[(@{armorprotection}+@{equipedbonus})d6>6]]}}" name="roll_protection"></button></td>
            </tr>
        </table>
        <h2 class="areaheader">Weapons</h2>
        <table>
            <tr>
                <TD class="medtext" >Name</TD><td class="attribtext">Range</td><td class="attribtext">Damage</td><td class="tinytext">Type</td><td class="attribtext">  Bonus</td>
            </tr>
        </table>
        <fieldset class="repeating_weapons"> 
            <input class="medtext" type="text" name="attr_weapon">
            <input class="attribtext" type="text" name="attr_range">
            <input class="attribtext" type="number" name="attr_damage">
            <select class="tinytext" name="attr_weatype" class="dtype">
                <option value="@{force}+@{physique}" >Unarmed</option>
                <option value="@{closecombat}+@{physique}" selected="selected">Melee</option>
                <option value="@{rangedcombat}+@{precision}">Ranged</option>
            </select>
            <input class="attribtext" type="number" name="attr_bonus">
            <button type="roll" class="twilightdie"  value="&{template:vaesen-attack}{{playername=@{character_name}}}{{attribname=@{weapon} attack!}}{{attribvalue=@{weatype}}}{{weabonus=@{bonus}}}{{bonus=@{equipedbonus}}}{{damage=@{damage}}}{{result=[[(@{weatype}+@{bonus}+@{equipedbonus})d6>6]]}}" name="roll_attack"></button>
        </fieldset>
    </div>
-->
    <div class="skillstitle">
        <Span class="twilighttitle">Skills & Attributes</Span>
    </div>
    <div class="strengthpanel">
        <table class="attribtable">
            <tr>
                <td>
                    <span class="normallabel">Strength</span>
                </td>
                <td>
                    <select class="width5" name="attr_strength" >
                        <option value="12">A</option>
                        <option value="10">B</option>
                        <option value="8">C</option>
                        <option value="6">D</option>
                        <option value="0" selected="selected">-</option>
                    </select>
                </td>
                <td>
                    <input type="number" name="attr_strengthdie" class="width5" hidden>
                    <button class="twilightdie" type="roll" value="&{template:twilight-skill}{{playername=@{character_name}}}{{baseattrib=@{strength}}}{{modifier=@{strengthmod}}}{{attribname=Strength}}{{attribdie=@{strengthdie}}}{{result=[[1d@{strengthdie}>6cs>10]]}}" name="roll_strength"></button>
                </td>
            </tr>
            <tr>
                <td>
                    <span class="skilllabel">Heavy Weapons</span>
                </td>
                <td>
                    <select class="width5" name="attr_heavyweapons" >
                        <option value="12" title="D12">A</option>
                        <option value="10" title="D10">B</option>
                        <option value="8" title="D8">C</option>
                        <option value="6" title="D6">D</option>
                        <option value="0" >F</option>
                        <option value="0" selected="selected">-</option>
                    </select>
                </td>
                <td>
                    <input type="number" name="attr_heavyweaponsattribdie" class="width5" hidden>
                    <input type="number" name="attr_heavyweaponsskilldie" class="width5" hidden>
                <!--    <button class="twilightdie" type="roll" value="&{template:vaesen-attrib}{{playername=@{character_name}}}{{attribname=Strength Check}}{{attribvalue=@{strength}}}{{result=[[1d@{strength}>6cs>10]]}}" name="roll_strength"></button>-->
                    <button class="twilightdie" type="roll" value="&{template:twilight-skill}{{playername=@{character_name}}}{{baseattrib=@{strength}}}{{baseskill=@{heavyweapons}}}{{modifier=@{strengthmod}}}{{attribname=Heavy Weapons}}{{attribdie=@{heavyweaponsattribdie}}}{{skilldie=@{heavyweaponsskilldie}}}{{result=[[1d@{heavyweaponsattribdie}>6cs>10]]+[[1d@{heavyweaponsskilldie}>6cs>10]]}}" name="roll_strength"></button>

                </td>
            </tr>
            <tr>
                <Td>
                    <span class="skilllabel">Melee</span>
                </Td>
                <td>
                    <select class="width5" name="attr_melee" >
                        <option value="12" >A</option>
                        <option value="10" >B</option>
                        <option value="8">C</option>
                        <option value="6" >D</option>
                        <option value="0" >F</option>
                        <option value="0" selected="selected">-</option>
                    </select>
                </td>
                <td>
                    <input type="number" name="attr_meleeattribdie" class="width5" hidden>
                    <input type="number" name="attr_meleeskilldie" class="width5" hidden>
                    <button class="twilightdie" type="roll" value="&{template:twilight-skill}{{playername=@{character_name}}}{{baseattrib=@{strength}}}{{baseskill=@{melee}}}{{modifier=@{strengthmod}}}{{attribname=Melee}}{{attribdie=@{meleeattribdie}}}{{skilldie=@{meleeskilldie}}}{{result=[[1d@{meleeattribdie}>6cs>10]]+[[1d@{meleeskilldie}>6cs>10]]}}" name="roll_strength"></button>
                </td>    
            </tr>
            <tr>
                <td>
                    <span class="skilllabel">Stamina</span>
                </td>
                <td>
                    <select class="width5" name="attr_stamina" >
                        <option value="12" >A</option>
                        <option value="10" >B</option>
                        <option value="8">C</option>
                        <option value="6" >D</option>
                        <option value="0" >F</option>
                        <option value="0" selected="selected">-</option>
                    </select>
                </td>
                <td>
                    <input type="number" name="attr_staminaattribdie" class="width5" hidden>
                    <input type="number" name="attr_staminaskilldie" class="width5" hidden>
                    <button class="twilightdie" type="roll" value="&{template:twilight-skill}{{playername=@{character_name}}}{{baseattrib=@{strength}}}{{baseskill=@{stamina}}}{{modifier=@{strengthmod}}}{{attribname=Stamina}}{{attribdie=@{staminaattribdie}}}{{skilldie=@{staminaskilldie}}}{{result=[[1d@{staminaattribdie}>6cs>10]]+[[1d@{staminaskilldie}>6cs>10]]}}" name="roll_strength"></button>
                </td>
            </tr>
            <tr>
                <td colspan="3" style="border: 1px solid #74675b; text-align:center;">
                    <button type="action" name="act_subtractmod" title="Subtract Modifier">-</button>
                    <input type="number" class="attriblabel" name="attr_strengthmod" value="0" readonly>
                    <button type="action" name="act_addmod" title="Add Modifier">+</button>
                    <button type="action" name="act_resetmod" title="Reset Modifiers">R</button>
                </td>
            </tr>
        </table>
    </div>
    <div class="agilitypanel">
        <table class="attribtable">
            <tr>
                <td>
                    <span class="normallabel">Agility</span>
                </td>
                <td>
                    <select class="width5" name="attr_agility" >
                        <option value="12">A</option>
                        <option value="10">B</option>
                        <option value="8">C</option>
                        <option value="6" >D</option>
                        <option value="0" selected="selected">-</option>
                    </select>
                </td>
                <Td>
                    <input type="number" name="attr_agilitydie" class="width5" hidden>
                    <button class="twilightdie" type="roll" value="&{template:twilight-skill}{{playername=@{character_name}}}{{baseattrib=@{agility}}}{{attribname=Agility}}{{attribdie=@{agilitydie}}}{{modifier=@{agilitymod}}}{{result=[[1d@{agilitydie}>6cs>10]]}}" name="roll_strength"></button>
                </td>
            </tr>
            <tr>
                <td>
                    <span class="skilllabel">Driving</span>
                </td>
                <td>
                    <select class="width5" name="attr_driving" >
                        <option value="12" title="D12">A</option>
                        <option value="10" title="D10">B</option>
                        <option value="8" title="D8">C</option>
                        <option value="6" title="D6">D</option>
                        <option value="0" >F</option>
                        <option value="0" selected="selected">-</option>
                    </select>
                </td>
                <td>
                    <input type="number" name="attr_drivingattribdie" class="width5" hidden>
                    <input type="number" name="attr_drivingskilldie" class="width5" hidden>
                    <button class="twilightdie" type="roll" value="&{template:twilight-skill}{{playername=@{character_name}}}{{baseattrib=@{agility}}}{{baseskill=@{driving}}}{{modifier=@{agilitymod}}}{{attribname=Driving}}{{attribdie=@{drivingattribdie}}}{{skilldie=@{drivingskilldie}}}{{result=[[1d@{drivingattribdie}>6cs>10]]+[[1d@{drivingskilldie}>6cs>10]]}}" name="roll_strength"></button>
                </td>
            </tr>
            <tr>
                <td>
                    <span class="skilllabel">Mobility</span>
                </td>
                <td>
                    <select class="width5" name="attr_mobility" >
                        <option value="12" >A</option>
                        <option value="10" >B</option>
                        <option value="8">C</option>
                        <option value="6" >D</option>
                        <option value="0" >F</option>
                        <option value="0" selected="selected">-</option>
                    </select>
                </td>
                <td>
                    <input type="number" name="attr_mobilityattribdie" class="width5" hidden>
                    <input type="number" name="attr_mobilityskilldie" class="width5" hidden>
                    <button class="twilightdie" type="roll" value="&{template:twilight-skill}{{playername=@{character_name}}}{{baseattrib=@{agility}}}{{baseskill=@{mobility}}}{{modifier=@{agilitymod}}}{{attribname=Mobility}}{{attribdie=@{mobilityattribdie}}}{{skilldie=@{mobilityskilldie}}}{{result=[[1d@{mobilityattribdie}>6cs>10]]+[[1d@{mobilityskilldie}>6cs>10]]}}" name="roll_strength"></button>
                </td>
            </tr>
            <tr>
                <td>
                    <span class="skilllabel">Ranged Weapons</span>
                </td>
                <td>
                    <select class="width5" name="attr_ranged" >
                        <option value="12" >A</option>
                        <option value="10" >B</option>
                        <option value="8">C</option>
                        <option value="6">D</option>
                        <option value="0" >F</option>
                        <option value="0" selected="selected">-</option>
                    </select>
                </td>
                <td>
                    <input type="number" name="attr_rangedattribdie" class="width5" hidden>
                    <input type="number" name="attr_rangedskilldie" class="width5" hidden>
                    <button class="twilightdie" type="roll" value="&{template:twilight-skill}{{playername=@{character_name}}}{{baseattrib=@{agility}}}{{baseskill=@{ranged}}}{{modifier=@{agilitymod}}}{{attribname=Ranged Weapons}}{{attribdie=@{rangedattribdie}}}{{skilldie=@{rangedskilldie}}}{{result=[[1d@{rangedattribdie}>6cs>10]]+[[1d@{rangedskilldie}>6cs>10]]}}" name="roll_strength"></button>
                </td>
            <tr>
            <tr>
                <td colspan="3" style="border: 1px solid #74675b; text-align:center;">
                    <button type="action" name="act_subtractmod" title="Subtract Modifier">-</button>
                    <input type="number" class="attriblabel" name="attr_agilitymod" value="0" readonly>
                    <button type="action" name="act_addmod" title="Add Modifier">+</button>
                    <button type="action" name="act_resetmod" title="Reset Modifiers">R</button>
                </td>
            </tr>
        </table><br>
    </div>
    <div class="intelligencepanel">
        <table class="attribtable">
            <tr>
                <td>
                    <span class="normallabel">Intelligence</span>
                </td>
                <td>
                    <select class="width5" name="attr_intelligence" >
                        <option value="12">A</option>
                        <option value="10">B</option>
                        <option value="8">C</option>
                        <option value="6" >D</option>
                        <option value="0" selected="selected">-</option>
                    </select>
                </td>
                <td>
                    <input type="number" name="attr_intelligencedie" class="width5" hidden>
                    <button class="twilightdie" type="roll" value="&{template:twilight-skill}{{playername=@{character_name}}}{{baseattrib=@{intelligence}}}{{modifier=@{intelligencemod}}}{{attribname=Intelligence}}{{attribdie=@{intelligencedie}}}{{result=[[1d@{intelligencedie}>6cs>10]]}}" name="roll_strength"></button>
                    <br>
                </td>
            </tr>
            <tr>
                <td>
                    <span class="skilllabel">Recon</span>
                </td>
                <td>
                    <select class="width5" name="attr_recon" >
                        <option value="12" title="D12">A</option>
                        <option value="10" title="D10">B</option>
                        <option value="8" title="D8">C</option>
                        <option value="6" title="D6">D</option>
                        <option value="0" >F</option>
                        <option value="0" selected="selected">-</option>
                    </select>
                </td>
                <td>
                    <input type="number" name="attr_reconattribdie" class="width5" hidden>
                    <input type="number" name="attr_reconskilldie" class="width5" hidden>
                    <button class="twilightdie" type="roll" value="&{template:twilight-skill}{{playername=@{character_name}}}{{attribname=Recon}}{{baseattrib=@{intelligence}}}{{baseskill=@{recon}}}{{modifier=@{intelligencemod}}}{{attribdie=@{reconattribdie}}}{{skilldie=@{reconskilldie}}}{{result=[[1d@{reconattribdie}>6cs>10]]+[[1d@{reconskilldie}>6cs>10]]}}" name="roll_strength"></button>
                </td>
            </tr>
            <tr>
                <td>
                <span class="skilllabel">Survival</span>
                </td>
                <td>
                    <select class="width5" name="attr_survival" >
                        <option value="12" >A</option>
                        <option value="10" >B</option>
                        <option value="8">C</option>
                        <option value="6" >D</option>
                        <option value="0" >F</option>
                        <option value="0" selected="selected">-</option>
                    </select>
                </td>
                <td>
                    <input type="number" name="attr_survivalattribdie" class="width5" hidden>
                    <input type="number" name="attr_survivalskilldie" class="width5" hidden>
                    <button class="twilightdie" type="roll" value="&{template:twilight-skill}{{playername=@{character_name}}}{{attribname=Survival}}{{baseattrib=@{intelligence}}}{{baseskill=@{survival}}}{{modifier=@{intelligencemod}}}{{attribdie=@{survivalattribdie}}}{{skilldie=@{survivalskilldie}}}{{result=[[1d@{survivalattribdie}>6cs>10]]+[[1d@{survivalskilldie}>6cs>10]]}}" name="roll_strength"></button>
                </td>
            </tr>
            <tr>
                <td>
                    <span class="skilllabel">Tech</span>
                </td>
                <td>
                    <select class="width5" name="attr_tech" >
                        <option value="12" >A</option>
                        <option value="10" >B</option>
                        <option value="8">C</option>
                        <option value="6" >D</option>
                        <option value="0" >F</option>
                        <option value="0" selected="selected">-</option>
                    </select>
                </td>
                <td>
                    <input type="number" name="attr_techattribdie" class="width5" hidden>
                    <input type="number" name="attr_techskilldie" class="width5" hidden>
                    <button class="twilightdie" type="roll" value="&{template:twilight-skill}{{playername=@{character_name}}}{{baseattrib=@{intelligence}}}{{baseskill=@{tech}}}{{modifier=@{intelligencemod}}}{{attribname=Tech}}{{attribdie=@{techattribdie}}}{{skilldie=@{techskilldie}}}{{result=[[1d@{techattribdie}>6cs>10]]+[[1d@{techskilldie}>6cs>10]]}}" name="roll_strength"></button>
                </td>
            <tr>
            <tr>
                <td colspan="3" style="border: 1px solid #74675b; text-align:center;">
                    <button type="action" name="act_subtractmod" title="Subtract Modifier">-</button>
                    <input type="number" class="attriblabel" name="attr_intelligencemod" value="0" readonly>
                    <button type="action" name="act_addmod" title="Add Modifier">+</button>
                    <button type="action" name="act_resetmod" title="Reset Modifiers">R</button>
                </td>
            </tr>
        </table><br>
    </div>
    <div class="empathypanel">
        <table class="attribtable">
            <tr>
                <td>
                    <span class="normallabel">Empathy</span>
                </td>
                <td>
                    <select class="width5" name="attr_empathy" >
                        <option value="12">A</option>
                        <option value="10">B</option>
                        <option value="8">C</option>
                        <option value="6" >D</option>
                        <option value="0" selected="selected">-</option>
                    </select>
                </td>
                <td>
                    <input type="number" name="attr_empathydie" class="width5" hidden>
                    <button class="twilightdie" type="roll" value="&{template:twilight-skill}{{playername=@{character_name}}}{{baseattrib=@{empathy}}}{{modifier=@{empathymod}}}{{attribname=Empathy}}{{attribdie=@{empathydie}}}{{result=[[1d@{empathydie}>6cs>10]]}}" name="roll_strength"></button>
                </td>
            </tr>
            <tr>
                <td>
                    <span class="skilllabel">Command</span>
                </td>
                <td>
                    <select class="width5" name="attr_command" >
                        <option value="12" title="D12">A</option>
                        <option value="10" title="D10">B</option>
                        <option value="8" title="D8">C</option>
                        <option value="6" title="D6">D</option>
                        <option value="0" >F</option>
                        <option value="0" selected="selected">-</option>
                    </select>
                </td>
                <td>
                    <input type="number" name="attr_commandattribdie" class="width5" hidden>
                    <input type="number" name="attr_commandskilldie" class="width5" hidden>
                    <button class="twilightdie" type="roll" value="&{template:twilight-skill}{{playername=@{character_name}}}{{baseattrib=@{empathy}}}{{baseskill=@{command}}}{{modifier=@{empathymod}}}{{attribname=Command}}{{attribdie=@{commandattribdie}}}{{skilldie=@{commandskilldie}}}{{result=[[1d@{commandattribdie}>6cs>10]]+[[1d@{commandskilldie}>6cs>10]]}}" name="roll_strength"></button>
                </td>
            </tr>
            <tr>
                <td>
                    <span class="skilllabel">Manipulation</span>
                </td>
                <td>
                    <select class="width5" name="attr_manipulation" >
                        <option value="12" >A</option>
                        <option value="10" >B</option>
                        <option value="8">C</option>
                        <option value="6">D</option>
                        <option value="0" >F</option>
                        <option value="0" selected="selected">-</option>
                    </select>
                </td>
                <td>
                    <input type="number" name="attr_manipulationattribdie" class="width5" hidden>
                    <input type="number" name="attr_manipulationskilldie" class="width5" hidden>
                    <button class="twilightdie" type="roll" value="&{template:twilight-skill}{{playername=@{character_name}}}{{baseattrib=@{empathy}}}{{baseskill=@{manipulation}}}{{modifier=@{empathymod}}}{{attribname=Manipulation}}{{attribdie=@{manipulationattribdie}}}{{skilldie=@{manipulationskilldie}}}{{result=[[1d@{manipulationattribdie}>6cs>10]]+[[1d@{manipulationskilldie}>6cs>10]]}}" name="roll_strength"></button>
                </td>
            </tr>
            <tr>
                <td>
                    <span class="skilllabel">Medical</span>
                </td>
                <td>
                    <select class="width5" name="attr_medical" >
                        <option value="12" >A</option>
                        <option value="10" >B</option>
                        <option value="8">C</option>
                        <option value="6" >D</option>
                        <option value="0" >F</option>
                        <option value="0" selected="selected">-</option>
                    </select>
                </td>
                <td>
                    <input type="number" name="attr_medicalattribdie" class="width5" hidden>
                    <input type="number" name="attr_medicalskilldie" class="width5" hidden>
                    <button class="twilightdie" type="roll" value="&{template:twilight-skill}{{playername=@{character_name}}}{{baseattrib=@{empathy}}}{{baseskill=@{medical}}}{{modifier=@{empathymod}}}{{attribname=Medical}}{{attribdie=@{medicalattribdie}}}{{skilldie=@{medicalskilldie}}}{{result=[[1d@{medicalattribdie}>6cs>10]]+[[1d@{medicalskilldie}>6cs>10]]}}" name="roll_strength"></button>
                </td>
            <tr>
            <tr>
                <td colspan="3" style="border: 1px solid #74675b; text-align:center;">
                    <button type="action" name="act_subtractmod" title="Subtract Modifier">-</button>
                    <input type="number" class="attriblabel" name="attr_empathymod" value="0" readonly>
                    <button type="action" name="act_addmod" title="Add Modifier">+</button>
                    <button type="action" name="act_resetmod" title="Reset Modifiers">R</button>
                </td>
            </tr>
        </table><br>
    </div>
    <div class="specialtiespanel">
        <input type="text" value="SPECIALTIES" class="identlabel2" disabled style="width:10em;">
        <fieldset class="repeating_specialties">
            <input type="text" value="NAME" class="identlabel2" disabled>
            <input type="text" value="name" class="identinput" name="attr_specname">
            <select class="identinput" name="attr_specskill"  style="width:10em;">
                <option value="0" selected="selected">-</option>
                <option value="strength" >Strength</option>
                <option value="heavyweapons" >-Heavy Weapons</option>
                <option value="melee">-Melee</option>
                <option value="stamina" >-Stamina</option>
                <option value="agility" >Agility</option>
                <option value="driving" >-Driving</option>
                <option value="mobiity">-Mobility</option>
                <option value="ranged" >-Ranged Weapons</option>
                <option value="agility" >Intelligence</option>
                <option value="driving" >-Recon</option>
                <option value="mobiity">-Survival</option>
                <option value="ranged" >-Tech</option>
                <option value="agility" >Empathy</option>
                <option value="driving" >-Command</option>
                <option value="mobiity">-Manipulation</option>
                <option value="ranged" >-Medical</option>

            </select>
            <input type="number" class="identinput" value="0" name="attr_specvalue">
            <button type="action" name="act_applyspec" title="Add to current modifier.">apply</button>
        </fieldset>
    </div>
    <div class="combattitle">
        <Span class="twilighttitle">Combat</Span>
    </div>
    <div class="damagepanel">
        <input type="text" value="DAMAGE" class="damagelabel" disabled><br>
        <input type="checkbox" name="attr_damage1" value=1>
        <input type="checkbox" name="attr_damage2" value=1>
        <input type="checkbox" name="attr_damage3" value=1>
        <input type="checkbox" name="attr_damage4" value=1>
        <input type="checkbox" name="attr_damage5" value=1>
        <input type="checkbox" name="attr_damage6" value=1>
        <br>
        <input type="checkbox" name="attr_damage7" value=1>
        <input type="checkbox" name="attr_damage8" value=1>
        <input type="checkbox" name="attr_damage9" value=1>
        <input type="checkbox" name="attr_damage10" value=1>
        <input type="checkbox" name="attr_damage11" value=1>
        <input type="checkbox" name="attr_damage12" value=1>
        <br>
        <input type="text" value="HIT CAPACITY" class="damagelabel" disabled><input type="number" name="attr_hitcap" value="0" readonly><br>
        <input type="text" value="STRESS CAPACITY" class="damagelabel" disabled><input type="number" name="attr_stresscap" value="0" readonly><br>
        <input type="text" value="COOLNESS UNDER FIRE" class="damagelabel" disabled>
        <select class="width5" name="attr_coolunderfire" >
            <option value="12" >A</option>
            <option value="10" >B</option>
            <option value="8">C</option>
            <option value="6" >D</option>
            <option value="0" selected="selected">-</option>
        </select>
        <input type="text" value="UNIT MORALE" class="damagelabel" disabled>
        <select class="width5" name="attr_unitmorale" >
            <option value="12" >A</option>
            <option value="10" >B</option>
            <option value="8">C</option>
            <option value="6" >D</option>
            <option value="0" >F</option>
            <option value="0" selected="selected">-</option>
        </select><br>

    </div>
    <div class="stresspanel">
        <input type="text" value="STRESS" class="damagelabel" disabled><br>
        <input type="checkbox" name="attr_stress1" value=1>
        <input type="checkbox" name="attr_stress2" value=1>
        <input type="checkbox" name="attr_stress3" value=1>
        <input type="checkbox" name="attr_stress4" value=1>
        <input type="checkbox" name="attr_stress5" value=1>
        <input type="checkbox" name="attr_stress6" value=1>
        <br>
        <input type="checkbox" name="attr_stress7" value=1>
        <input type="checkbox" name="attr_stress8" value=1>
        <input type="checkbox" name="attr_stress9" value=1>
        <input type="checkbox" name="attr_stress10" value=1>
        <input type="checkbox" name="attr_stress11" value=1>
        <input type="checkbox" name="attr_stress12" value=1><br>
        <input type="text" value="CRITICAL INJURIES" class="damagelabel" disabled>
        <fieldset class="repeating_criticalinjuries">
            <input type="text" class="width15" name="attr_injury">
        </fieldset>
        <input type="text" value="DISEASE" class="damagelabel" disabled>
        <fieldset class="repeating_disease">
            <input type="text" class="width15" name="attr_disease">
        </fieldset>
        </div>
    <div class="armortitle">
        <Span class="twilighttitle">Armor</Span>
    </div>
    <div class="armorpanel">
        <input type="text" value="HEAD" class="armorlabel" disabled>
        <input type="number" class="width5" name="attr_headarmor" value="0">
        <br>
        <input type="text" value="ARMS" class="armorlabel" disabled>
        <input type="number" class="width5" name="attr_armsarmor" value="0">
        <br>
        <input type="text" value="TORSO" class="armorlabel" disabled>
        <input type="number" class="width5" name="attr_torsoarmor" value="0">
        <br>
        <input type="text" value="LEGS" class="armorlabel" disabled>
        <input type="number" class="width5" name="attr_legarmor" value="0">

    </div>
    <div class="conditionstitle">
        <Span class="twilighttitle">Conditions</Span>
    </div>
    <div class="conditionspanel">

        <input type="text" value="STARVING" class="armorlabel" disabled>
        <input type="checkbox" name="attr_starving" value=1>
        <br>
        <input type="text" value="DEHYDRATED" class="armorlabel" disabled>
        <input type="checkbox" name="attr_dehydrated" value=1>
        <br>
        <input type="text" value="SLEEP DEPRIVED" class="armorlabel" disabled>
        <input type="checkbox" name="attr_sleepdeprived" value=1>
        <br>
        <input type="text" value="HYPOTHERMIC" class="armorlabel" disabled>
        <input type="checkbox" name="attr_hypothermic" value=1>

    </div>
    <div class="radiationtitle">
        <Span class="twilighttitle">Radiation</Span>
    </div>
    <div class="radiationtemporary">
        <input type="text" value="TEMPORARY" class="radiationlabel" disabled><br>
        <input type="checkbox" name="attr_temprad1" value=1>
        <input type="checkbox" name="attr_temprad2" value=1>
        <input type="checkbox" name="attr_temprad3" value=1>
        <input type="checkbox" name="attr_temprad4" value=1>
        <input type="checkbox" name="attr_temprad5" value=1>
        <input type="checkbox" name="attr_temprad6" value=1>
        <input type="checkbox" name="attr_temprad7" value=1>
        <input type="checkbox" name="attr_temprad8" value=1>
        <input type="checkbox" name="attr_temprad9" value=1>
        <input type="checkbox" name="attr_temprad10" value=1>
    </div>
    <div class="radiationpermanent">
        <input type="text" value="PERMANENT" class="radiationlabel" disabled><br>
        <input type="checkbox" name="attr_permrad1" value=1>
        <input type="checkbox" name="attr_permrad2" value=1>
        <input type="checkbox" name="attr_permrad3" value=1>
        <input type="checkbox" name="attr_permrad4" value=1>
        <input type="checkbox" name="attr_permrad5" value=1>
        <input type="checkbox" name="attr_permrad6" value=1>
        <input type="checkbox" name="attr_permrad7" value=1>
        <input type="checkbox" name="attr_permrad8" value=1>
        <input type="checkbox" name="attr_permrad9" value=1>
        <input type="checkbox" name="attr_permrad10" value=1>   
    </div>
    <div class="gearpaneltitle">
        <Span class="twilighttitle">Gear</Span>
    </div>
    <div class="combatgearpanel">
        <input type="text" value="COMBAT GEAR" class="radiationlabel" disabled>
        <fieldset class="repeating_combatgear">
            <input type="text" value="NAME" class="identlabel2" disabled>
            <input type="text" value="name" class="identinput" name="attr_combatgear">
        </fieldset>
    </div>
    <div class="backpackgearpanel">
        <input type="text" value="BACKPACK GEAR" class="radiationlabel" disabled>
        <fieldset class="repeating_backpackgear">
            <input type="text" value="NAME" class="identlabel2" disabled>
            <input type="text" value="name" class="identinput" name="attr_backpackgear">
        </fieldset>
    </div>
    <div class="tinyitemspanel">
        <input type="text" value="TINY ITEMS" class="radiationlabel" disabled>
        <fieldset class="repeating_tinyitems">
            <input type="text" value="NAME" class="identlabel2" disabled>
            <input type="text" value="name" class="identinput" name="attr_tinyitems">
        </fieldset> 
    </div>
    <div class="weaponspaneltitle">
        <Span class="twilighttitle">Weapons</Span>
    </div>
    <div class="weaponspanel">
        <input type="text" value="Name" class="width15-nb" disabled>
        <input type="text" value="TYP" title="Melee or Ranged" class="weaponslabelsb-nb" disabled>   
        <input type="text" value="ROF" title="Rate of Fire" class="weaponslabel-nb" disabled>
        <input type="text" value="DMG" title="Damage" class="weaponslabel-nb" disabled>
        <input type="text" value="ARMR" title="Armor" class="weaponslabel-nb" disabled>
        <input type="text" value="RNGE" title="Range" class="weaponslabel-nb" disabled>
        <input type="text" value="MAG" title="Magazine" class="weaponslabel-nb" disabled>
        <input type="text" value="REL" title="Reliability" class="weaponslabel-nb" disabled>
        <input type="text" value="BLST" title="Blast" class="weaponslabel-nb" disabled>
        <input type="text" value="WGT" title="Weight" class="weaponslabel-nb" disabled>
        <input type="text" value="SPNT" title="Spent Ammo" class="weaponslabel-nb" disabled>
        <fieldset class="repeating_weapons">
            <input type="text" value="name" class="identinput" name="attr_weaponname" style="width:15em;">
            <select name="attr_weatype" class="weaponsnumber" style="width:5em;">
                <option value="&{template:twilight-skill}{{playername=@{character_name}}}{{baseattrib=@{strength}}}{{baseskill=@{melee}}}{{modifier=@{strengthmod}}}{{attribname=Melee}}{{attribdie=@{meleeattribdie}}}{{skilldie=@{meleeskilldie}}}{{result=[[[[1d@{meleeattribdie}>6cs>10]]+[[1d@{meleeskilldie}>6cs>10]]]]}}">M</option>
                <option value="&{template:twilight-skill}{{playername=@{character_name}}}{{baseattrib=@{strength}}}{{baseskill=@{heavyweapons}}}{{modifier=@{strengthmod}}}{{attribname=Heavy Weapons}}{{ammo=[[?{ammo|0}d6>6cf<1]]}}{{mag=@{mag}}}{{attribdie=@{heavyweaponsattribdie}}}{{skilldie=@{heavyweaponsskilldie}}}{{result=[[[[1d@{heavyweaponsattribdie}>6cs>10]]+[[1d@{heavyweaponsskilldie}>6cs>10]]]]}}">HW</option>
                <option value="&{template:twilight-skill}{{playername=@{character_name}}}{{baseattrib=@{agility}}}{{baseskill=@{ranged}}}{{modifier=@{agilitymod}}}{{attribname=Ranged Weapons}}{{ammo=[[?{ammo|0}d6>6cf<1]]}}{{mag=@{mag}}}{{attribdie=@{rangedattribdie}}}{{skilldie=@{rangedskilldie}}}{{result=[[[[1d@{rangedattribdie}>6cs>10]]+[[1d@{rangedskilldie}>6cs>10]]]]}}">R</option>
                <option value="0" selected="selected">-</option>
            <input type="number" value="0" class="weaponsnumber" name="attr_rof" title="Rate of Fire">
            <input type="number" value="0" class="weaponsnumber" name="attr_dmg" title="Damage">
            <input type="number" value="0" class="weaponsnumber" name="attr_armor" title="Armor">
            <input type="number" value="0" class="weaponsnumber" name="attr_rng" title="Range">
            <input type="number" value="0" class="weaponsnumber" name="attr_mag" title="Magazine">
            <input type="number" value="0" class="weaponsnumber" name="attr_reliability" title="Reliability">
            <input type="number" value="0" class="weaponsnumber" name="attr_blast" title="Blast">
            <input type="number" value="0" class="weaponsnumber" name="attr_weight" title="Weight">
            <input type="number" value="0" class="weaponsnumber" name="attr_spentammo" title="Spent Ammo">
            <button type="roll" class="twilightdie" value="@{weatype}" readonly></button>
        </fieldset>   
    </div>

</div>



<rolltemplate class="sheet-rolltemplate-twilight-skill">
<div class="sheet-twilight-container">
    <div class="sheet-twilight-header">
        {{playername}}
    </div>
    <div class="sheet-twilight-subheader">
        {{attribname}}<BR>
        {{#baseattrib}}
        D{{baseattrib}}
        {{/baseattrib}}
        {{#baseskill}}
        + D{{baseskill}}
        {{/baseskill}}
    </div>
    <div class="sheet-twilight-type">
        {{#modifier}}
        Modifier: {{modifier}}<br>
        {{/modifier}}
    </div>
    <div class="sheet-twilight-subheader">
        D{{attribdie}} 
        {{#skilldie}}
        + D{{skilldie}}
        {{/skilldie}}

        {{#condition}}
        Condition Penalty: {{condition}}
        {{/condition}}
    </div>
    <div class="sheet-twilight-result">{{result}}</div>
    {{#ammo}}
    <div class="sheet-twilight-resultammo">
        Ammo: {{ammo}} vs Mag: {{mag}}
    </div>
    {{/ammo}}

</div>
</rolltemplate>

<rolltemplate class="sheet-rolltemplate-vaesen-skill">
<div class="sheet-vaesen-container">
    <div class="sheet-vaesen-header">
        {{playername}}
    </div>
    <div class="sheet-vaesen-subheader">
        {{skillname}}
    </div>
    {{#attribvalue}}
    <div class="sheet-vaesen-type">
        Atrribute Dice: {{attribvalue}}
    </div>
    {{/attribvalue}}
    {{#skillvalue}}
    <div class="sheet-vaesen-type">
        Skill Dice: {{skillvalue}}
    </div>
    {{/skillvalue}}
    {{#bonus}}
    <div class="sheet-vaesen-type">
        Extra Dice: {{bonus}}
    </div>
    {{/bonus}}
    {{#agility}}
    <div class="sheet-vaesen-type">
        Armor Penalty: {{agility}}
    </div>
    {{/agility}}
    {{#condition}}
    <div class="sheet-vaesen-type">
        Condition Penalty: {{condition}}
    </div>
    {{/condition}}
    <div class="sheet-vaesen-result">{{result}}</div>
</div>
</rolltemplate>

<rolltemplate class="sheet-rolltemplate-vaesen-attack">
<div class="sheet-vaesen-container">
    <div class="sheet-vaesen-header">
        {{playername}}
    </div>
    <div class="sheet-vaesen-subheader">
        {{attribname}}
    </div>
    <div class="sheet-vaesen-type">Attribute Dice: {{attribvalue}}</div>
    <div class="sheet-vaesen-type">
        Weapon Bonus: {{weabonus}}
    </div>
    <div class="sheet-vaesen-type">
        Extra Dice: {{bonus}}
    </div>
    <div class="sheet-vaesen-subheader">
        Damage: {{damage}}
    </div>
    <div class="sheet-vaesen-result">{{result}}</div>
</div>
</rolltemplate>



<script type="text/worker">

const buttonlist = ["main","NPC","HQ"];
const bonusfields =["strbonus"];
const attributes=["strength","agility","intelligence","empathy"];
const strengthskills=["heavyweapons","melee","stamina"];
const intelligenceskills=["recon","survival","tech"];
const agilityskills=["driving","mobility","ranged"];
const empathyskills=["command","manipulation","medical"];
const skills=["heavyweapons","melee","stamina","recon","survival","tech","driving","mobility","ranged","command","manipulation","medical"];

on("clicked:resetmod", function(){
    setAttrs({
        strengthmod:0,
        agilitymod:0,
        intelligencemod:0,
        empathymod:0
    });
});

on("clicked:repeating_specialties:applyspec", function(){
    console.log("clicked");
    getAttrs(["repeating_specialties_specvalue","strengthmod","agilitymod","intelligencemod","empathymod"], function(values){
        var specadjust=parseInt(values.repeating_specialties_specvalue);
        var strmod=parseInt(values.strengthmod)+specadjust;
        var agimod=parseInt(values.agilitymod)+specadjust;
        var intmod=parseInt(values.intelligencemod)+specadjust;
        var empmod=parseInt(values.empathymod)+specadjust;
        setAttrs({
            strengthmod:strmod,
            agilitymod:agimod,
            intelligencemod:intmod,
            empathymod:empmod
        });
    });
});

on("clicked:addmod", function(){
    getAttrs(["strengthmod","agilitymod","intelligencemod","empathymod"], function(values){
        var strmod=parseInt(values.strengthmod)+1;
        var agimod=parseInt(values.agilitymod)+1;
        var intmod=parseInt(values.intelligencemod)+1;
        var empmod=parseInt(values.empathymod)+1;
        setAttrs({
            strengthmod:strmod,
            agilitymod:agimod,
            intelligencemod:intmod,
            empathymod:empmod
        });
    });
});
on("clicked:subtractmod", function(){
    getAttrs(["strengthmod","agilitymod","intelligencemod","empathymod"], function(values){
        var strmod=parseInt(values.strengthmod)-1;
        var agimod=parseInt(values.agilitymod)-1;
        var intmod=parseInt(values.intelligencemod)-1;
        var empmod=parseInt(values.empathymod)-1;
        setAttrs({
            strengthmod:strmod,
            agilitymod:agimod,
            intelligencemod:intmod,
            empathymod:empmod
        });
    });
});

skills.forEach(skill => {
    on(`change:${skill}`, function() {
        getAttrs([skill], function(values){
            console.log("Setting: "+skill)
            var skillval=values[skill];
            var skillname=skill+"skilldie";
            setAttrs({
                [skillname]:skillval,
                strengthmod:0,
                agilitymod:0,
                intelligencemod:0,
                empathymod:0
            });
        });
    });
});

attributes.forEach(attrib=> {
    on(`change:${attrib}`, function() {
        getAttrs(attributes, function(values){
            var attribdie=attrib+"die";
            var die=values[attrib];
            var mod=attrib+"mod";
            console.log("Setting die");
            console.log("attribdie: "+attribdie);
            console.log("die "+die);
            var str=parseInt(values.strength);
            var agi=parseInt(values.agility);
            var int=parseInt(values.intelligence);
            var emp=parseInt(values.empathy);
            var hit=Math.round(((str+agi)/2)/2);
            var stress=Math.round(((emp+int)/2)/2);

            setAttrs({
                [attribdie]:die,
                [mod]:0,
                hitcap:hit,
                stresscap:stress,
                heavyweaponsattribdie:die,
                meleeattribdie:die,
                staminaattribdie:die,
                drivingattribdie:die,
                mobilityattribdie:die,
                rangedattribdie:die,
                reconattribdie:die,
                survivalattribdie:die,
                techattribdie:die,
                commandattribdie:die,
                manipulationattribdie:die,
                medicalattribdie:die
            })
        })
    })
})

on("change:strengthmod", function(){
    getAttrs(["strengthmod","strength","heavyweapons","melee","stamina"], function(values){
        var mod=parseInt(values.strengthmod);
        var strength=parseInt(values.strength);
        var heavyweapons=parseInt(values.heavyweapons);
        var melee=parseInt(values.melee);
        var stamina=parseInt(values.stamina);
        console.log("mod: "+mod);
        console.log("str: "+strength);
        console.log("hwea: "+heavyweapons);
        console.log("mel: "+melee);
        console.log("sta: "+stamina);
        var dice={};
        var newskillarray=[];
        var basestrength;
        if (mod>0){
            basestrength=strength+mod*2;
            if (basestrength>12){
                basestrength=12;
            }
        } else {
            basestrength=strength+mod*2;
            if (basestrength<6){
                basestrength=0;
            }
        }
        for (var i=0;i<strengthskills.length;i++){
            console.log(strengthskills[i]);
            skillvalue=parseInt(values[strengthskills[i]]);
            console.log(skillvalue);
            var attribdie=strengthskills[i]+"attribdie";
            var skilldie=strengthskills[i]+"skilldie";
      
            if (strength>skillvalue){
                dice={bigdie:strength,smalldie:skillvalue,bigattrib:attribdie,smallattrib:skilldie};
            } else {
                dice={bigdie:skillvalue,smalldie:strength,bigattrib:skilldie,smallattrib:attribdie};
            }
            console.log(dice);
            if (mod>0) {
                var maxsteps=(12-dice.bigdie)/2;
                console.log("maxsteps: "+maxsteps);
                if (mod>maxsteps){
                    var shift=mod-maxsteps;
                    dice.bigdie=12;
                    dice.smalldie=dice.smalldie+shift*2;
                    if (dice.smalldie>12){
                        dice.smalldie=12;
                    }
                } else {
                    dice.bigdie=dice.bigdie+mod*2;
                }
            } else if (mod<0) {
                var maxsteps=(dice.smalldie-6)/2+1;
                console.log(skilldie);
                console.log("maxsteps: "+maxsteps);
                if (Math.abs(mod)>maxsteps){
                    var shift=Math.abs(mod)-maxsteps;
                    dice.smalldie=0
                    dice.bigdie=dice.bigdie-shift*2;
                    if (dice.bigdie<6){
                        dice.bigdie=0;
                    }
                } else {
                    dice.smalldie=dice.smalldie-Math.abs(mod)*2;
                    if (dice.smalldie<6){
                        dice.smalldie=0;
                    }
                } 
            }
        newskillarray.push(dice);
        }

        if (newskillarray.length>0){
            setAttrs({
                strengthdie:basestrength,
                [newskillarray[0].bigattrib]:newskillarray[0].bigdie,
                [newskillarray[0].smallattrib]:newskillarray[0].smalldie,
                [newskillarray[1].bigattrib]:newskillarray[1].bigdie,
                [newskillarray[1].smallattrib]:newskillarray[1].smalldie,
                [newskillarray[2].bigattrib]:newskillarray[2].bigdie,
                [newskillarray[2].smallattrib]:newskillarray[2].smalldie
            })
        }
    });
});

on("change:agilitymod", function(){
    getAttrs(["agilitymod","agility","driving","mobility","ranged"], function(values){
        var mod=parseInt(values.agilitymod);
        var attrib=parseInt(values.agility);
        var driving=parseInt(values.driving);
        var mobility=parseInt(values.mobility);
        var ranged=parseInt(values.ranged);
        var dice={};
        var newskillarray=[];
        var baseattrib;
        if (mod>0){
            baseattrib=attrib+mod*2;
            if (baseattrib>12){
                baseattrib=12;
            }
        } else {
            baseattrib=attrib+mod*2;
            if (baseattrib<6){
                baseattrib=0;
            }
        }
        for (var i=0;i<agilityskills.length;i++){
            skillvalue=parseInt(values[agilityskills[i]]);

            var attribdie=agilityskills[i]+"attribdie";
            var skilldie=agilityskills[i]+"skilldie";
      
            if (attrib>skillvalue){
                dice={bigdie:attrib,smalldie:skillvalue,bigattrib:attribdie,smallattrib:skilldie};
            } else {
                dice={bigdie:skillvalue,smalldie:attrib,bigattrib:skilldie,smallattrib:attribdie};
            }
            if (mod>0) {
                var maxsteps=(12-dice.bigdie)/2;
                if (mod>maxsteps){
                    var shift=mod-maxsteps;
                    dice.bigdie=12;
                    dice.smalldie=dice.smalldie+shift*2;

                    if (dice.smalldie>12){
                        dice.smalldie=12;
                    }
                } else {
                    dice.bigdie=dice.bigdie+mod*2;
                }
            } else if (mod<0) {
                var maxsteps=(dice.smalldie-6)/2+1;
                console.log(skilldie);
                console.log("maxsteps: "+maxsteps);
                if (Math.abs(mod)>maxsteps){
                    var shift=Math.abs(mod)-maxsteps;
                    dice.smalldie=0
                    dice.bigdie=dice.bigdie-shift*2;
                    if (dice.bigdie<6){
                        dice.bigdie=0;
                    }
                } else {
                    dice.smalldie=dice.smalldie-Math.abs(mod)*2;
                    if (dice.smalldie<6){
                        dice.smalldie=0;
                    }
                } 
            }
        newskillarray.push(dice);
        }

        if (newskillarray.length>0){
            setAttrs({
                agilitydie:baseattrib,
                [newskillarray[0].bigattrib]:newskillarray[0].bigdie,
                [newskillarray[0].smallattrib]:newskillarray[0].smalldie,
                [newskillarray[1].bigattrib]:newskillarray[1].bigdie,
                [newskillarray[1].smallattrib]:newskillarray[1].smalldie,
                [newskillarray[2].bigattrib]:newskillarray[2].bigdie,
                [newskillarray[2].smallattrib]:newskillarray[2].smalldie
            })
        }
    });
});

on("change:intelligencemod", function(){
    getAttrs(["intelligencemod","intelligence","recon","survival","tech"], function(values){
        var mod=parseInt(values.intelligencemod);
        var attrib=parseInt(values.intelligence);
        var recon=parseInt(values.recon);
        var survival=parseInt(values.survival);
        var tech=parseInt(values.tech);

        var newskillarray=[];
        var baseattrib;
        if (mod>0){
            baseattrib=attrib+mod*2;
            if (baseattrib>12){
                baseattrib=12;
            }
        } else {
            baseattrib=attrib+mod*2;
            if (baseattrib<6){
                baseattrib=0;
            }
        }
        for (var i=0;i<intelligenceskills.length;i++){
            var dice={};
            skillvalue=parseInt(values[intelligenceskills[i]]);
            var attribdie=intelligenceskills[i]+"attribdie";
            var skilldie=intelligenceskills[i]+"skilldie";
            console.log("Int: "+attrib);
            console.log("skill: "+recon);
            console.log("skill: "+skilldie+" "+skillvalue);
            console.log("shifts: "+mod);
            if (attrib>skillvalue){
                dice={bigdie:attrib,smalldie:skillvalue,bigattrib:attribdie,smallattrib:skilldie};
            } else {
                dice={bigdie:skillvalue,smalldie:attrib,bigattrib:skilldie,smallattrib:attribdie};
            }
            if (mod>0) {
                var maxsteps=(12-dice.bigdie)/2;

                if (mod>maxsteps){

                    var shift=mod-maxsteps;
                    dice.bigdie=12;
                    dice.smalldie=dice.smalldie+shift*2;
                    if (dice.smalldie>12){
                        dice.smalldie=12;
                    }
                } else {

                    dice.bigdie=dice.bigdie+(mod*2);
                }
            } else if (mod<0) {
                var maxsteps=(dice.smalldie-6)/2+1;
                console.log(skilldie);
                console.log("maxsteps: "+maxsteps);
                if (Math.abs(mod)>maxsteps){
                    var shift=Math.abs(mod)-maxsteps;
                    dice.smalldie=0
                    dice.bigdie=dice.bigdie-shift*2;
                    if (dice.bigdie<6){
                        dice.bigdie=0;
                    }
                   } else {
                    dice.smalldie=dice.smalldie-Math.abs(mod)*2;
                    if (dice.smalldie<6){
                        dice.smalldie=0;
                    }
                } 
            }
            newskillarray.push(dice);
        }

        if (newskillarray.length>0){
            setAttrs({
                intelligencedie:baseattrib,
                [newskillarray[0].bigattrib]:newskillarray[0].bigdie,
                [newskillarray[0].smallattrib]:newskillarray[0].smalldie,
                [newskillarray[1].bigattrib]:newskillarray[1].bigdie,
                [newskillarray[1].smallattrib]:newskillarray[1].smalldie,
                [newskillarray[2].bigattrib]:newskillarray[2].bigdie,
                [newskillarray[2].smallattrib]:newskillarray[2].smalldie
            })
        }
    });
});

on("change:empathymod", function(){
    getAttrs(["empathymod","empathy","command","manipulation","medical"], function(values){
        var mod=parseInt(values.empathymod);
        var attrib=parseInt(values.empathy);
        var command=parseInt(values.command);
        var manipulation=parseInt(values.manipulation);
        var medical=parseInt(values.medical);
        var dice={};
        var newskillarray=[];
        var baseattrib;
        if (mod>0){
            baseattrib=attrib+mod*2;
            if (baseattrib>12){
                baseattrib=12;
            }
        } else {
            baseattrib=attrib+mod*2;
            if (baseattrib<6){
                baseattrib=0;
            }
        }
        for (var i=0;i<empathyskills.length;i++){
            skillvalue=parseInt(values[empathyskills[i]]);

            var attribdie=empathyskills[i]+"attribdie";
            var skilldie=empathyskills[i]+"skilldie";
      
            if (attrib>skillvalue){
                dice={bigdie:attrib,smalldie:skillvalue,bigattrib:attribdie,smallattrib:skilldie};
            } else {
                dice={bigdie:skillvalue,smalldie:attrib,bigattrib:skilldie,smallattrib:attribdie};
            }
            if (mod>0) {
                var maxsteps=(12-dice.bigdie)/2;
                if (mod>maxsteps){
                    var shift=mod-maxsteps;
                    dice.bigdie=12;
                    dice.smalldie=dice.smalldie+shift*2;

                    if (dice.smalldie>12){
                        dice.smalldie=12;
                    }
                } else {
                    dice.bigdie=dice.bigdie+mod*2;
                }
            } else if (mod<0) {
                var maxsteps=(dice.smalldie-6)/2+1;
                console.log(skilldie);
                console.log("maxsteps: "+maxsteps);
                if (Math.abs(mod)>maxsteps){
                    var shift=Math.abs(mod)-maxsteps;
                    dice.smalldie=0
                    dice.bigdie=dice.bigdie-shift*2;
                    if (dice.bigdie<0){
                        dice.bigdie=0;
                    }
                } else {
                    dice.smalldie=dice.smalldie-Math.abs(mod)*2;
                    if (dice.smalldie<6){
                        dice.smalldie=0;
                    }
                } 
            }
            newskillarray.push(dice);
        }

        if (newskillarray.length>0){
            setAttrs({
                empathydie:baseattrib,
                [newskillarray[0].bigattrib]:newskillarray[0].bigdie,
                [newskillarray[0].smallattrib]:newskillarray[0].smalldie,
                [newskillarray[1].bigattrib]:newskillarray[1].bigdie,
                [newskillarray[1].smallattrib]:newskillarray[1].smalldie,
                [newskillarray[2].bigattrib]:newskillarray[2].bigdie,
                [newskillarray[2].smallattrib]:newskillarray[2].smalldie
            })
        }
    });
});







bonusfields.forEach(bonus => {
    on(`change:${bonus}`, function() {
        getAttrs([bonus], function(values){
            stepvalue=values[bonus]*2;
            console.log("bonus step="+stepvalue);
        });
    });
});


on("clicked:clearequ", function() {
let resetvalue=0;
setAttrs({
    "equipedbonus": resetvalue
});
});

on("clicked:repeating_equipment:equip", function(eventInfo) {
    getAttrs(["repeating_equipment_equbonus","equipedbonus"], function(values){
        let newbonus=parseInt(values.repeating_equipment_equbonus)||0;
        let bonus=parseInt(values.equipedbonus)||0;
        setAttrs({
            "equipedbonus": newbonus+bonus
        });
    });
    });



on("clicked:lifestyle", function(eventInfo) {
getAttrs(["lifestyle","equipedbonus"], function(values){
    let newbonus=parseInt(values.lifestyle)||0;
    let bonus=parseInt(values.equipedbonus)||0;
    setAttrs({
        "equipedbonus": newbonus+bonus
    });
});
});

on("clicked:increasebonus", function(eventInfo) {
getAttrs(["equipedbonus"], function(values){
    let newbonus=parseInt(values.equipedbonus)+1||0;
    setAttrs({
        "equipedbonus": newbonus
    });
});
});

on("clicked:decreasebonus", function(eventInfo) {
getAttrs(["equipedbonus"], function(values){
    let newbonus=parseInt(values.equipedbonus)-1||0;
    setAttrs({
        "equipedbonus": newbonus
    });
});
});


buttonlist.forEach(button => {
on(`clicked:${button}`, function() {
    setAttrs({
        sheetTab: button
    });
});
});
</script>
