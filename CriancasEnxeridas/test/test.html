<!DOCTYPE html>
<html lang="en">

<head>

  <!--  Meta  -->
  <meta charset="UTF-8" />
  <title>My New Pen!</title>

  <!--  Styles  -->
  <link rel="stylesheet" href="test.css">
</head>

<body>
  <div class="sheet-main-container sheet-flex-column">

    <!-- Header -->
    <div class="sheet-header sheet-flex-row">

      <h1 data-i18n="game-title">Crianças<br>Enxeridas</h1>

      <div class="sheet-flex-column sheet-grow">

        <div class="sheet-flex-row sheet-header-box sheet-box-border">
          <span class="sheet-main-font" data-i18n="name">Nome:</span>
          <input name="attr_character_name" type="text" title="{@character_name}" />
        </div>

        <div class="sheet-flex-row sheet-header-box sheet-box-border">
          <span class="sheet-main-font" data-i18n="archetype">Arquétipo:</span>
          <input name="attr_archetype" type="text" title="{@archetype}" />
        </div>
      </div>

    </div>

    <div class="sheet-middle-row">

      <div class="sheet-flex-column">
        <!-- Attributes -->
        <div class="sheet-attributes sheet-box-border">

          <span class="sheet-main-font sheet-black-title" data-i18n="attributes">Atributos</span>

          <div class="sheet-attributes-container">

            <div class="sheet-attribute-box">
              <div class="sheet-attribute-circle-size sheet-circle">
                <input class="sheet-attribute-value" type="number" name="attr_charbody" title="{@charbody}" max="13" />
              </div>

              <span class="sheet-main-font sheet-attribute-label" data-i18n="body">Corpo</span>
              <input type="hidden" class="sheet-rollbuttoncontrol" name="attr_woundedcontrol" value="normal" />
              <button type="roll" class="sheet-normal-button" name="roll_body_check" title="{@body_check}"
                value="&{template:default} {{name=@{character_name} }} {{ @{check}=@{body} }} {{ @{result} = [[ ?{ @{advantagedisadvantage} | @{no}, 1d20 | @{advantage}, 2d20kh1 | @{disadvantage}, 2d20kl1 } + @{charbody} ]] }}"></button>
              <button type="roll" class="sheet-disadvantage-button" name="roll_body_disadvantage" title="{@body_disadvantage}"
                value="&{template:default} {{name=@{character_name} }} {{ @{check}=@{body} }} {{ @{result} = [[ 2d20kl1 + @{charbody} ]] }}"></button>

            </div>

            <div class="sheet-attribute-separator">
              +
            </div>

            <div class="sheet-attribute-box">
              <div class="sheet-attribute-circle-size sheet-circle">
                <input class="sheet-attribute-value" type="number" name="attr_charmind" title="{@charmind}" max="13" />
              </div>

              <span class="sheet-main-font sheet-attribute-label" data-i18n="mind">Mente</span>
              <input type="hidden" class="sheet-rollbuttoncontrol" name="attr_shakencontrol" value="normal" />
              <button type="roll" class="sheet-normal-button" name="roll_mind_check" title="{@mind_check}"
                value="&{template:default} {{name=@{character_name} }} {{ @{check}=@{mind} }} {{ @{result} = [[ ?{ @{advantagedisadvantage} | @{no}, 1d20 | @{advantage}, 2d20kh1 | @{disadvantage}, 2d20kl1 } + @{charmind} ]] }}"></button>
              <button type="roll" class="sheet-disadvantage-button" name="roll_mind_disadvantage" title="{@mind_disadvantage}"
                value="&{template:default} {{name=@{character_name} }} {{ @{check}=@{mind} }} {{ @{result} = [[ 2d20kl1 + @{charmind} ]] }}"></button>

            </div>

            <div class="sheet-attribute-separator">
              +
            </div>

            <div class="sheet-attribute-box">
              <div class="sheet-attribute-circle-size sheet-circle">
                <input class="sheet-attribute-value" type="number" name="attr_charcharisma" title="{@charcharisma}"
                  max="13" />
              </div>

              <span class="sheet-main-font sheet-attribute-label" data-i18n="charisma">Carisma</span>
              <input type="hidden" class="sheet-rollbuttoncontrol" name="attr_ashamedcontrol" value="normal" />
              <button type="roll" class="sheet-normal-button" name="roll_charisma_check" title="{@charisma_check}"
                value="&{template:default} {{name=@{character_name} }} {{ @{check}=@{charisma} }} {{ @{result} = [[ ?{ @{advantagedisadvantage} | @{no}, 1d20 | @{advantage}, 2d20kh1 | @{disadvantage}, 2d20kl1 } + @{charcharisma} ]] }}"></button>
              <button type="roll" class="sheet-disadvantage-button" name="roll_charisma_disadvantage" title="{@charisma_disadvantage}"
                value="&{template:default} {{name=@{character_name} }} {{ @{check}=@{charisma} }} {{ @{result} = [[ 2d20kl1 + @{charcharisma} ]] }}"></button>

            </div>

            <div class="sheet-attribute-separator">
              +
            </div>

            <div class="sheet-attribute-box">
              <div class="sheet-attribute-white-bg sheet-attribute-circle-size sheet-circle">
                <input class="sheet-attribute-value" type="number" name="attr_charsurvival" title="{@charsurvival}"
                  max="13" />
              </div>

              <div class="sheet-survival-used-box sheet-circle">
                <input class="sheet-attribute-value sheet-survival-used-value" type="number"
                  name="attr_charsurvivalused" title="{@charsurvivalused}" />
              </div>

              <span class="sheet-main-font sheet-attribute-label" data-i18n="survival">Sobrevivência</span>

            </div>

            <div class="sheet-attribute-separator">
              +
            </div>

            <div class="sheet-attribute-box">
              <div class="sheet-attribute-circle-size sheet-circle">
                <input class="sheet-attribute-value" type="number" name="attr_charcuriosity" title="{@charcuriosity}"
                  max="13" />
              </div>

              <span class="sheet-main-font sheet-attribute-label" data-i18n="curiosity">Curiosidade</span>
              <button type="roll" name="roll_curiosity_check" title="{@curiosity_check}"
                value="&{template:default} {{name=@{character_name} }} {{ @{check}=@{curiosity} }} {{ @{result} = [[ ?{ @{advantagedisadvantage} | @{no}, 1d20 | @{advantage}, 2d20kl1 | @{disadvantage}, 2d20kh1 } + @{charcuriosity} ]] }}"></button>

            </div>

            <div class="sheet-attribute-separator">
              =
            </div>

            <div class="sheet-attribute-box">
              <div class="sheet-attribute-black-bg sheet-circle">
                25
              </div>

              <span class="sheet-main-font sheet-attribute-label" data-i18n="total">Total</span>
            </div>

          </div>

        </div>

      </div>

      <div class="sheet-flex-column sheet-grow">
        <!-- Equipments -->
        <div class="sheet-section-box">
          <span class="sheet-main-font sheet-light-title" data-i18n="equipments">Equipamentos</span>

          <fieldset class="repeating_equipments">
            <div class="sheet-flex-row sheet-repeatable-item">
              <input name="attr_equipment" type="text" data-i18n-placeholder="equipment" placeholder="Equipamento" />
            </div>
          </fieldset>

        </div>
      </div>

      <div class="sheet-flex-column sheet-grow">
        <!-- Consequences -->
        <div class="sheet-section-box">
          <span class="sheet-main-font sheet-light-title" data-i18n="consequences">Consequências</span>

          <fieldset class="repeating_consequences">
            <div class="sheet-flex-row sheet-repeatable-item">
              <input name="attr_consequence" type="text" data-i18n-placeholder="consequence"
                placeholder="Consequência" />
            </div>
          </fieldset>

        </div>
      </div>

      <div class="sheet-flex-column sheet-grow">
        <!-- Notes -->
        <div class="sheet-section-box">

          <span class="sheet-main-font sheet-light-title" data-i18n="notes">Anotações</span>

          <textarea name="attr_notes" title="{@notes}"></textarea>

        </div>

      </div>

    </div>

    <!-- Conditions -->
    <div class="sheet-flex-column sheet-box-border">

      <span class="sheet-main-font sheet-black-title" data-i18n="conditions">Condições</span>
      <div class="sheet-conditions-row">

        <div class="sheet-condition-box">
          <div class="sheet-condition-circle-size">
            <input class="sheet-condition-checkbox" type="checkbox" name="attr_wounded" title="{@wounded}" />
            <div class="sheet-blank-circle sheet-condition-circle-size sheet-circle"></div>
            <div class="sheet-black-circle sheet-condition-circle-size sheet-circle"></div>
          </div>
          <span class="sheet-main-font sheet-condition-label" data-i18n="wounded">Ferido</span>
        </div>

        <div class="sheet-condition-box">
          <div class="sheet-condition-circle-size">
            <input class="sheet-condition-checkbox" type="checkbox" name="attr_shaken" title="{@shaken}" />
            <div class="sheet-blank-circle sheet-condition-circle-size sheet-circle"></div>
            <div class="sheet-black-circle sheet-condition-circle-size sheet-circle"></div>
          </div>
          <span class="sheet-main-font sheet-condition-label" data-i18n="shaken">Abalado</span>
        </div>

        <div class="sheet-condition-box">
          <div class="sheet-condition-circle-size">
            <input class="sheet-condition-checkbox" type="checkbox" name="attr_ashamed" title="{@ashamed}" />
            <div class="sheet-blank-circle sheet-condition-circle-size sheet-circle"></div>
            <div class="sheet-black-circle sheet-condition-circle-size sheet-circle"></div>
          </div>
          <span class="sheet-main-font sheet-condition-label" data-i18n="ashamed">Envergonhado</span>
        </div>

        <div class="sheet-condition-box">
          <div class="sheet-condition-circle-size">
            <input class="sheet-condition-checkbox" type="checkbox" name="attr_defeated" title="{@defeated}" />
            <div class="sheet-blank-circle sheet-condition-circle-size sheet-circle"></div>
            <div class="sheet-black-circle sheet-condition-circle-size sheet-circle"></div>
          </div>
          <span class="sheet-main-font sheet-condition-label" data-i18n="defeated">Derrotado</span>
        </div>
      </div>
    </div>

    <div class="sheet-main-font  sheet-footer">
      <span data-i18n="copyright">Crianças Enxeridas é um jogo escrito por Raphael Lima.</span>
    </div>
  </div>

  <!-- end of sheet -->

  <!-- Strings translations for Roll Queries-->
  <div style="display: none;">
    <span data-i18n="advantagedisadvantage">Possui vantagem ou desvantagem?</span>
    <span data-i18n="no">Não</span>
    <span data-i18n="advantage">Vantagem</span>
    <span data-i18n="disadvantage">Desvantagem</span>
    <span data-i18n="result">Resultado</span>
    <span data-i18n="check">Teste</span>
  </div>

  <!--Sheet Workers -->
  <script type="text/worker">

    /*config Roll Queries translations */
    on("sheet:opened", function(eventInfo){
        
        setAttrs({
            advantagedisadvantage: getTranslationByKey("advantagedisadvantage"),
            no: getTranslationByKey("no"),
            advantage: getTranslationByKey("advantage"),
            disadvantage: getTranslationByKey("disadvantage"),
            result: getTranslationByKey("result"),
            check: getTranslationByKey("check"),
            body: getTranslationByKey("body"),
            mind: getTranslationByKey("mind"),
            charisma: getTranslationByKey("charisma"),
            survival: getTranslationByKey("survival"),
            curiosity: getTranslationByKey("curiosity")
        });     
        
    });

    /*keep attributes values at 13 max*/
    on("change:charbody change:charmind change:charcharisma change:charcuriosity change:charsurvival", function(eventInfo) {  
      const maxValue = 13;
      let oldValue = parseInt(eventInfo.previousValue)||0;
      let newValue = parseInt(eventInfo.newValue)||0;
      let attribute = eventInfo.sourceAttribute;
      let changedAttributes = new Object();
      
      changedAttributes[attribute] = maxValue;
      
      if (newValue > maxValue) {
    
        changedAttributes[attribute] = maxValue;
        setAttrs(changedAttributes);
      }
       
    });

    /*controls roll buttons when char has a condition checked*/
    on("change:wounded change:shaken change:ashamed", function(eventInfo) {  
      const disadvantage = "disadvantage";
      const normal = "normal";
      const sourceAttribute = eventInfo.sourceAttribute;
      const newValue = eventInfo.newValue;
      let changedAttributes = new Object();
      let controlToUpdate = sourceAttribute + "control";
      
      changedAttributes[controlToUpdate] = normal;

      switch(newValue) {
        case "on":
          changedAttributes[controlToUpdate] = disadvantage;
          break;
        default:
          changedAttributes[controlToUpdate] = normal;
      }
      
      setAttrs(changedAttributes);
       
    });
    
    
  </script>
</body>

</html>