<!-- @formatter:off -->
<input name="attr_rollStatisticIntelligence"             type="hidden" value="&{template:roll-with-difficulty}           {{characterName=@{character_name}}} {{rollName=Intelligence}}                      {{roll= [[1d10]]}} {{rollNormal= [[1 + 1d8 + @{statisticIntelligenceSum}]]}} {{rollSuccess= [[10 + 1d10 + @{statisticIntelligenceSum}]]}} {{rollFailure= [[1 - 1d10 + @{statisticIntelligenceSum}]]}}"/>
<input name="attr_rollStatisticReflexes"                 type="hidden" value="&{template:roll-with-difficulty}           {{characterName=@{character_name}}} {{rollName=Reflexes}}                          {{roll= [[1d10]]}} {{rollNormal= [[1 + 1d8 + @{statisticReflexesSum}    ]]}} {{rollSuccess= [[10 + 1d10 + @{statisticReflexesSum}    ]]}} {{rollFailure= [[1 - 1d10 + @{statisticReflexesSum}    ]]}}"/>
<input name="attr_rollStatisticDexterity"                type="hidden" value="&{template:roll-with-difficulty}           {{characterName=@{character_name}}} {{rollName=Dexterity}}                         {{roll= [[1d10]]}} {{rollNormal= [[1 + 1d8 + @{statisticDexteritySum}   ]]}} {{rollSuccess= [[10 + 1d10 + @{statisticDexteritySum}   ]]}} {{rollFailure= [[1 - 1d10 + @{statisticDexteritySum}   ]]}}"/>
<input name="attr_rollStatisticTechnique"                type="hidden" value="&{template:roll-with-difficulty}           {{characterName=@{character_name}}} {{rollName=Technique}}                         {{roll= [[1d10]]}} {{rollNormal= [[1 + 1d8 + @{statisticTechniqueSum}   ]]}} {{rollSuccess= [[10 + 1d10 + @{statisticTechniqueSum}   ]]}} {{rollFailure= [[1 - 1d10 + @{statisticTechniqueSum}   ]]}}"/>
<input name="attr_rollStatisticCool"                     type="hidden" value="&{template:roll-with-difficulty}           {{characterName=@{character_name}}} {{rollName=Cool}}                              {{roll= [[1d10]]}} {{rollNormal= [[1 + 1d8 + @{statisticCoolSum}        ]]}} {{rollSuccess= [[10 + 1d10 + @{statisticCoolSum}        ]]}} {{rollFailure= [[1 - 1d10 + @{statisticCoolSum}        ]]}}"/>
<input name="attr_rollStatisticWill"                     type="hidden" value="&{template:roll-with-difficulty}           {{characterName=@{character_name}}} {{rollName=Will}}                              {{roll= [[1d10]]}} {{rollNormal= [[1 + 1d8 + @{statisticWillSum}        ]]}} {{rollSuccess= [[10 + 1d10 + @{statisticWillSum}        ]]}} {{rollFailure= [[1 - 1d10 + @{statisticWillSum}        ]]}}"/>
<input name="attr_rollStatisticLuck"                     type="hidden" value="&{template:roll-with-difficulty}           {{characterName=@{character_name}}} {{rollName=Luck}}                              {{roll= [[1d10]]}} {{rollNormal= [[1 + 1d8 + @{statisticLuckSum}        ]]}} {{rollSuccess= [[10 + 1d10 + @{statisticLuckSum}        ]]}} {{rollFailure= [[1 - 1d10 + @{statisticLuckSum}        ]]}}"/>
<input name="attr_rollStatisticMove"                     type="hidden" value="&{template:roll-with-difficulty}           {{characterName=@{character_name}}} {{rollName=Move}}                              {{roll= [[1d10]]}} {{rollNormal= [[1 + 1d8 + @{statisticMoveSum}        ]]}} {{rollSuccess= [[10 + 1d10 + @{statisticMoveSum}        ]]}} {{rollFailure= [[1 - 1d10 + @{statisticMoveSum}        ]]}}"/>
<input name="attr_rollStatisticBody"                     type="hidden" value="&{template:roll-with-difficulty}           {{characterName=@{character_name}}} {{rollName=Body}}                              {{roll= [[1d10]]}} {{rollNormal= [[1 + 1d8 + @{statisticBodySum}        ]]}} {{rollSuccess= [[10 + 1d10 + @{statisticBodySum}        ]]}} {{rollFailure= [[1 - 1d10 + @{statisticBodySum}        ]]}}"/>
<input name="attr_rollStatisticEmpathy"                  type="hidden" value="&{template:roll-with-difficulty}           {{characterName=@{character_name}}} {{rollName=Empathy}}                           {{roll= [[1d10]]}} {{rollNormal= [[1 + 1d8 + @{statisticEmpathySum}     ]]}} {{rollSuccess= [[10 + 1d10 + @{statisticEmpathySum}     ]]}} {{rollFailure= [[1 - 1d10 + @{statisticEmpathySum}     ]]}}"/>

<input name="attr_rollSkillAthletics"                    type="hidden" value="&{template:roll-with-difficulty}           {{characterName=@{character_name}}} {{rollName=Athletics}}                         {{roll= [[1d10]]}} {{rollNormal= [[1 + 1d8 + @{skillAthleticsSum}       ]]}} {{rollSuccess= [[10 + 1d10 + @{skillAthleticsSum}       ]]}} {{rollFailure= [[1 - 1d10 + @{skillAthleticsSum}       ]]}}"/>
<input name="attr_rollSkillBasicTech"                    type="hidden" value="&{template:roll-with-difficulty}           {{characterName=@{character_name}}} {{rollName=Basic Tech}}                        {{roll= [[1d10]]}} {{rollNormal= [[1 + 1d8 + @{skillBasicTechSum}       ]]}} {{rollSuccess= [[10 + 1d10 + @{skillBasicTechSum}       ]]}} {{rollFailure= [[1 - 1d10 + @{skillBasicTechSum}       ]]}}"/>
<input name="attr_rollSkillBrawling"                     type="hidden" value="&{template:roll-with-difficulty}           {{characterName=@{character_name}}} {{rollName=Brawling}}                          {{roll= [[1d10]]}} {{rollNormal= [[1 + 1d8 + @{skillBrawlingSum}        ]]}} {{rollSuccess= [[10 + 1d10 + @{skillBrawlingSum}        ]]}} {{rollFailure= [[1 - 1d10 + @{skillBrawlingSum}        ]]}}"/>
<input name="attr_rollSkillBribery"                      type="hidden" value="&{template:roll-with-difficulty}           {{characterName=@{character_name}}} {{rollName=Bribery}}                           {{roll= [[1d10]]}} {{rollNormal= [[1 + 1d8 + @{skillBriberySum}         ]]}} {{rollSuccess= [[10 + 1d10 + @{skillBriberySum}         ]]}} {{rollFailure= [[1 - 1d10 + @{skillBriberySum}         ]]}}"/>
<input name="attr_rollSkillConcentration"                type="hidden" value="&{template:roll-with-difficulty}           {{characterName=@{character_name}}} {{rollName=Concentration}}                     {{roll= [[1d10]]}} {{rollNormal= [[1 + 1d8 + @{skillConcentrationSum}   ]]}} {{rollSuccess= [[10 + 1d10 + @{skillConcentrationSum}   ]]}} {{rollFailure= [[1 - 1d10 + @{skillConcentrationSum}   ]]}}"/>
<input name="attr_rollSkillConversation"                 type="hidden" value="&{template:roll-with-difficulty}           {{characterName=@{character_name}}} {{rollName=Conversation}}                      {{roll= [[1d10]]}} {{rollNormal= [[1 + 1d8 + @{skillConversationSum}    ]]}} {{rollSuccess= [[10 + 1d10 + @{skillConversationSum}    ]]}} {{rollFailure= [[1 - 1d10 + @{skillConversationSum}    ]]}}"/>
<input name="attr_rollSkillCyberTech"                    type="hidden" value="&{template:roll-with-difficulty}           {{characterName=@{character_name}}} {{rollName=Cyber Tech}}                        {{roll= [[1d10]]}} {{rollNormal= [[1 + 1d8 + @{skillCyberTechSum}       ]]}} {{rollSuccess= [[10 + 1d10 + @{skillCyberTechSum}       ]]}} {{rollFailure= [[1 - 1d10 + @{skillCyberTechSum}       ]]}}"/>
<input name="attr_rollSkillDriving"                      type="hidden" value="&{template:roll-with-difficulty}           {{characterName=@{character_name}}} {{rollName=Driving}}                           {{roll= [[1d10]]}} {{rollNormal= [[1 + 1d8 + @{skillDrivingSum}         ]]}} {{rollSuccess= [[10 + 1d10 + @{skillDrivingSum}         ]]}} {{rollFailure= [[1 - 1d10 + @{skillDrivingSum}         ]]}}"/>
<input name="attr_rollSkillEducation"                    type="hidden" value="&{template:roll-with-difficulty}           {{characterName=@{character_name}}} {{rollName=Education}}                         {{roll= [[1d10]]}} {{rollNormal= [[1 + 1d8 + @{skillEducationSum}       ]]}} {{rollSuccess= [[10 + 1d10 + @{skillEducationSum}       ]]}} {{rollFailure= [[1 - 1d10 + @{skillEducationSum}       ]]}}"/>
<input name="attr_rollSkillEvasion"                      type="hidden" value="&{template:roll-with-difficulty}           {{characterName=@{character_name}}} {{rollName=Evasion}}                           {{roll= [[1d10]]}} {{rollNormal= [[1 + 1d8 + @{skillEvasionSum}         ]]}} {{rollSuccess= [[10 + 1d10 + @{skillEvasionSum}         ]]}} {{rollFailure= [[1 - 1d10 + @{skillEvasionSum}         ]]}}"/>
<input name="attr_rollSkillFirstAid"                     type="hidden" value="&{template:roll-with-difficulty-first-aid} {{characterName=@{character_name}}} {{rollName=First Aid}}                         {{roll= [[1d10]]}} {{rollNormal= [[1 + 1d8 + @{skillFirstAidSum}        ]]}} {{rollSuccess= [[10 + 1d10 + @{skillFirstAidSum}        ]]}} {{rollFailure= [[1 - 1d10 + @{skillFirstAidSum}        ]]}}"/>
<input name="attr_rollSkillHumanPerception"              type="hidden" value="&{template:roll-with-difficulty}           {{characterName=@{character_name}}} {{rollName=Human Perception}}                  {{roll= [[1d10]]}} {{rollNormal= [[1 + 1d8 + @{skillHumanPerceptionSum} ]]}} {{rollSuccess= [[10 + 1d10 + @{skillHumanPerceptionSum} ]]}} {{rollFailure= [[1 - 1d10 + @{skillHumanPerceptionSum} ]]}}"/>
<input name="attr_rollSkillInterrogation"                type="hidden" value="&{template:roll-with-difficulty}           {{characterName=@{character_name}}} {{rollName=Interrogation}}                     {{roll= [[1d10]]}} {{rollNormal= [[1 + 1d8 + @{skillInterrogationSum}   ]]}} {{rollSuccess= [[10 + 1d10 + @{skillInterrogationSum}   ]]}} {{rollFailure= [[1 - 1d10 + @{skillInterrogationSum}   ]]}}"/>
<input name="attr_rollSkillLocalExpert"                  type="hidden" value="&{template:roll-with-difficulty}           {{characterName=@{character_name}}} {{rollName=Local Expert}}                      {{roll= [[1d10]]}} {{rollNormal= [[1 + 1d8 + @{skillLocalExpertSum}     ]]}} {{rollSuccess= [[10 + 1d10 + @{skillLocalExpertSum}     ]]}} {{rollFailure= [[1 - 1d10 + @{skillLocalExpertSum}     ]]}}"/>
<input name="attr_rollSkillMarksmanship"                 type="hidden" value="&{template:roll-with-difficulty}           {{characterName=@{character_name}}} {{rollName=Marksmanship}}                      {{roll= [[1d10]]}} {{rollNormal= [[1 + 1d8 + @{skillMarksmanshipSum}    ]]}} {{rollSuccess= [[10 + 1d10 + @{skillMarksmanshipSum}    ]]}} {{rollFailure= [[1 - 1d10 + @{skillMarksmanshipSum}    ]]}}"/>
<input name="attr_rollSkillMeleeWeapon"                  type="hidden" value="&{template:roll-with-difficulty}           {{characterName=@{character_name}}} {{rollName=Melee Weapon}}                      {{roll= [[1d10]]}} {{rollNormal= [[1 + 1d8 + @{skillMeleeWeaponSum}     ]]}} {{rollSuccess= [[10 + 1d10 + @{skillMeleeWeaponSum}     ]]}} {{rollFailure= [[1 - 1d10 + @{skillMeleeWeaponSum}     ]]}}"/>
<input name="attr_rollSkillPerception"                   type="hidden" value="&{template:roll-with-difficulty}           {{characterName=@{character_name}}} {{rollName=Perception}}                        {{roll= [[1d10]]}} {{rollNormal= [[1 + 1d8 + @{skillPerceptionSum}      ]]}} {{rollSuccess= [[10 + 1d10 + @{skillPerceptionSum}      ]]}} {{rollFailure= [[1 - 1d10 + @{skillPerceptionSum}      ]]}}"/>
<input name="attr_rollSkillPersuasion"                   type="hidden" value="&{template:roll-with-difficulty}           {{characterName=@{character_name}}} {{rollName=Persuasion}}                        {{roll= [[1d10]]}} {{rollNormal= [[1 + 1d8 + @{skillPersuasionSum}      ]]}} {{rollSuccess= [[10 + 1d10 + @{skillPersuasionSum}      ]]}} {{rollFailure= [[1 - 1d10 + @{skillPersuasionSum}      ]]}}"/>
<input name="attr_rollSkillPlayInstrument"               type="hidden" value="&{template:roll-with-difficulty}           {{characterName=@{character_name}}} {{rollName=Play Instrument}}                   {{roll= [[1d10]]}} {{rollNormal= [[1 + 1d8 + @{skillPlayInstrumentSum}  ]]}} {{rollSuccess= [[10 + 1d10 + @{skillPlayInstrumentSum}  ]]}} {{rollFailure= [[1 - 1d10 + @{skillPlayInstrumentSum}  ]]}}"/>
<input name="attr_rollSkillStealth"                      type="hidden" value="&{template:roll-with-difficulty}           {{characterName=@{character_name}}} {{rollName=Stealth}}                           {{roll= [[1d10]]}} {{rollNormal= [[1 + 1d8 + @{skillStealthSum}         ]]}} {{rollSuccess= [[10 + 1d10 + @{skillStealthSum}         ]]}} {{rollFailure= [[1 - 1d10 + @{skillStealthSum}         ]]}}"/>
<input name="attr_rollSkillTracking"                     type="hidden" value="&{template:roll-with-difficulty}           {{characterName=@{character_name}}} {{rollName=Tracking}}                          {{roll= [[1d10]]}} {{rollNormal= [[1 + 1d8 + @{skillTrackingSum}        ]]}} {{rollSuccess= [[10 + 1d10 + @{skillTrackingSum}        ]]}} {{rollFailure= [[1 - 1d10 + @{skillTrackingSum}        ]]}}"/>

<input name="attr_rollAttackInitiative"                  type="hidden" value="&{template:roll}                           {{characterName=@{character_name}}} {{rollName=Initiative}}                        {{roll= [[1d10 + @{attackInitiativeSum} &{tracker}]]}}"/>
<input name="attr_rollAttackReputation"                  type="hidden" value="&{template:roll}                           {{characterName=@{character_name}}} {{rollName=Reputation}}                        {{roll= [[1d10 + @{attackReputationSum}           ]]}}"/>
<input name="attr_rollAttackGrappling"                   type="hidden" value="&{template:roll-without-difficulty}        {{characterName=@{character_name}}} {{rollName=Grappling Attack}}                  {{roll= [[1d10]]}} {{rollNormal= [[1 + 1d8 + @{attackGrapplingSum}]]}} {{rollSuccess=[[10 + 1d10 + @{attackGrapplingSum}]]}} {{rollFailure= [[1 - 1d10 + @{attackGrapplingSum}]]}}"/>
<input name="attr_rollAttackChoking"                     type="hidden" value="&{template:roll}                           {{characterName=@{character_name}}} {{rollName=Choking Damage}}                    {{roll= @{attackChokingSum}}}"/>
<input name="attr_rollAttackThrowing"                    type="hidden" value="&{template:roll}                           {{characterName=@{character_name}}} {{rollName=Throwing Damage}}                   {{roll= @{attackThrowingSum}}}"/>

<input name="attr_rollAttackBrawlingBody"                type="hidden" value="&{template:roll-attack-melee}              {{characterName=@{character_name}}} {{rollName=Brawling Attack on Body}}            {{roll1=[[1d10]]}} {{rollNormal1=[[1 + 1d8 + @{skillBrawlingSum}        ]]}} {{rollSuccess1=[[10 + 1d10 + @{skillBrawlingSum}        ]]}} {{rollFailure1=[[1 - 1d10 + @{skillBrawlingSum}        ]]}} {{rollDamage1=[[@{attackBrawlingDamage}d6]]}} {{roll2=[[1d10]]}} {{rollNormal2=[[1 + 1d8 + @{skillBrawlingSum}       ]]}} {{rollSuccess2=[[10 + 1d10 + @{skillBrawlingSum}       ]]}} {{rollFailure2=[[1 - 1d10 + @{skillBrawlingSum}       ]]}} {{rollDamage2=[[@{attackBrawlingDamage}d6]]}}"/>
<input name="attr_rollAttackBrawlingHead"                type="hidden" value="&{template:roll-attack-melee}              {{characterName=@{character_name}}} {{rollName=Brawling Attack on Head}}            {{roll1=[[1d10]]}} {{rollNormal1=[[1 + 1d8 + @{skillBrawlingSum}     - 6]]}} {{rollSuccess1=[[10 + 1d10 + @{skillBrawlingSum}     - 6]]}} {{rollFailure1=[[1 - 1d10 + @{skillBrawlingSum}     - 6]]}} {{rollDamage1=[[@{attackBrawlingDamage}d6]]}} {{roll2=[[1d10]]}} {{rollNormal2=[[1 + 1d8 + @{skillBrawlingSum}    - 6]]}} {{rollSuccess2=[[10 + 1d10 + @{skillBrawlingSum}    - 6]]}} {{rollFailure2=[[1 - 1d10 + @{skillBrawlingSum}    - 6]]}} {{rollDamage2=[[@{attackBrawlingDamage}d6]]}}"/>

<input name="attr_rollDeathSave"                         type="hidden" value="&{template:roll-death-save}                {{characterName=@{character_name}}} {{rollName=Death Save}}                        {{roll= [[1d10]]}} {{body=[[@{statisticBody}]]}} {{deathSave=[[@{deathSave}]]}} {{target=[[@{statisticBody} - @{deathSave}]]}}"/>
<!-- @formatter:on -->

<div class="sheet">
    <div class="sheet-handle">
        <div class="sheet-handle-status">
            <div>
                <input
                        name="attr_hit"
                        placeholder=""
                        readonly
                        tabindex="-1"
                        title="Hit Points"
                        type="text"/>
            </div>
            <div>
                <input
                        name="attr_armorHeadStoppingPower"
                        placeholder=""
                        readonly
                        tabindex="-1"
                        title="Head Armor Stopping Power"
                        type="text"/>
            </div>
            <div>
                <input
                        name="attr_armorBodyStoppingPower"
                        placeholder=""
                        readonly
                        tabindex="-1"
                        title="Body Armor Stopping Power"
                        type="text"/>
            </div>
        </div>
        <div class="sheet-handle-name">
            <input
                    name="attr_character_name"
                    placeholder="Name"
                    type="text"/>
        </div>
        <div class="sheet-handle-status">
            <div>
                <input
                        name="attr_hit"
                        placeholder=""
                        readonly
                        tabindex="-1"
                        title="Hit Points"
                        type="text"/>
            </div>
            <div>
                <input
                        name="attr_armorHeadStoppingPower"
                        placeholder=""
                        readonly
                        tabindex="-1"
                        title="Head Armor Stopping Power"
                        type="text"/>
            </div>
            <div>
                <input
                        name="attr_armorBodyStoppingPower"
                        placeholder=""
                        readonly
                        tabindex="-1"
                        title="Body Armor Stopping Power"
                        type="text"/>
            </div>
        </div>
    </div>
    <div class="sheet-tab-set">
        <div class="sheet-tab">
            <input class="sheet-tab-radio" type="radio" id="sheet-tab-1" name="attr_sheet" value="1">
            <label class="sheet-tab-1-label" for="sheet-tab-1" title="Statistics, Skills, and Luck">Skills</label>
            <div class="sheet-tab-content">
                <div class="sheet-tab-block sheet-tab-block-statistic">
                    <div class="sheet-tab-block-head">
                        Statistics
                    </div>
                    <div class="sheet-tab-block-body">
                        <div class="sheet-tab-block-body-part">
                            <div class="sheet-tab-block-body-part-roll-button">
                                <button
                                        name="roll_statisticIntelligence"
                                        tabindex="-1"
                                        title="Roll Intelligence"
                                        type="roll"
                                        value="@{rollStatisticIntelligence}"></button>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-sum">
                                <input
                                        name="attr_statisticIntelligenceSum"
                                        readonly
                                        tabindex="-1"
                                        title="Intelligence Total"
                                        type="text"
                                        value=""/>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-summand">
                                <input
                                        name="attr_statisticIntelligence"
                                        placeholder="0"
                                        title="Intelligence"
                                        type="text"
                                        value=""/>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-name">
                                <div>Intelligence</div>
                            </div>
                        </div>
                        <div class="sheet-tab-block-body-part">
                            <div class="sheet-tab-block-body-part-roll-button">
                                <button
                                        name="roll_statisticReflexes"
                                        tabindex="-1"
                                        title="Roll Reflexes"
                                        type="roll"
                                        value="@{rollStatisticReflexes}"></button>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-sum">
                                <input
                                        name="attr_statisticReflexesSum"
                                        readonly
                                        tabindex="-1"
                                        title="Reflexes Total"
                                        type="text"
                                        value=""/>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-summand">
                                <input
                                        name="attr_statisticReflexes"
                                        placeholder="0"
                                        title="Reflexes"
                                        type="text"
                                        value=""/>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-name">
                                <div>Reflexes</div>
                            </div>
                        </div>
                        <div class="sheet-tab-block-body-part">
                            <div class="sheet-tab-block-body-part-roll-button">
                                <button
                                        name="roll_statisticDexterity"
                                        tabindex="-1"
                                        title="Roll Dexterity"
                                        type="roll"
                                        value="@{rollStatisticDexterity}"></button>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-sum">
                                <input
                                        name="attr_statisticDexteritySum"
                                        readonly
                                        tabindex="-1"
                                        title="Dexterity Total"
                                        type="text"
                                        value=""/>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-summand">
                                <input
                                        name="attr_statisticDexterity"
                                        placeholder="0"
                                        title="Dexterity"
                                        type="text"
                                        value=""/>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-name">
                                <div>Dexterity</div>
                            </div>
                        </div>
                        <div class="sheet-tab-block-body-part">
                            <div class="sheet-tab-block-body-part-roll-button">
                                <button
                                        name="roll_statisticTechnique"
                                        tabindex="-1"
                                        title="Roll Technique"
                                        type="roll"
                                        value="@{rollStatisticTechnique}"></button>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-sum">
                                <input
                                        name="attr_statisticTechniqueSum"
                                        readonly
                                        tabindex="-1"
                                        title="Technique Total"
                                        type="text"
                                        value=""/>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-summand">
                                <input
                                        title="Technique"
                                        name="attr_statisticTechnique"
                                        placeholder="0"
                                        type="text"
                                        value=""/>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-name">
                                <div>Technique</div>
                            </div>
                        </div>
                        <div class="sheet-tab-block-body-part">
                            <div class="sheet-tab-block-body-part-roll-button">
                                <button
                                        name="roll_statisticCool"
                                        tabindex="-1"
                                        title="Roll Cool"
                                        type="roll"
                                        value="@{rollStatisticCool}"></button>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-sum">
                                <input
                                        name="attr_statisticCoolSum"
                                        readonly
                                        tabindex="-1"
                                        title="Cool Total"
                                        type="text"
                                        value=""/>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-summand">
                                <input
                                        name="attr_statisticCool"
                                        placeholder="0"
                                        title="Cool"
                                        type="text"
                                        value=""/>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-name">
                                <div>Cool</div>
                            </div>
                        </div>
                        <div class="sheet-tab-block-body-part">
                            <div class="sheet-tab-block-body-part-roll-button">
                                <button
                                        name="roll_statisticWill"
                                        tabindex="-1"
                                        title="Roll Will"
                                        type="roll"
                                        value="@{rollStatisticWill}"></button>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-sum">
                                <input
                                        name="attr_statisticWillSum"
                                        readonly
                                        tabindex="-1"
                                        title="Will Total"
                                        type="text"
                                        value=""/>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-summand">
                                <input
                                        name="attr_statisticWill"
                                        placeholder="0"
                                        title="Will"
                                        type="text"
                                        value=""/>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-name">
                                <div>Will</div>
                            </div>
                        </div>
                        <div class="sheet-tab-block-body-part">
                            <div class="sheet-tab-block-body-part-roll-button">
                                <button
                                        name="roll_statisticLuck"
                                        tabindex="-1"
                                        title="Roll Luck"
                                        type="roll"
                                        value="@{rollStatisticLuck}"></button>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-sum">
                                <input
                                        name="attr_statisticLuckSum"
                                        readonly
                                        tabindex="-1"
                                        title="Luck Total"
                                        type="text"
                                        value=""/>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-summand">
                                <input
                                        name="attr_statisticLuck"
                                        placeholder="0"
                                        title="Luck"
                                        type="text"
                                        value=""/>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-name">
                                <div>Luck</div>
                            </div>
                        </div>
                        <div class="sheet-tab-block-body-part">
                            <div class="sheet-tab-block-body-part-roll-button">
                                <button
                                        name="roll_statisticMove"
                                        tabindex="-1"
                                        title="Roll Move"
                                        type="roll"
                                        value="@{rollStatisticMove}"></button>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-sum">
                                <input
                                        name="attr_statisticMoveSum"
                                        readonly
                                        tabindex="-1"
                                        title="Move Total"
                                        type="text"
                                        value=""/>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-summand">
                                <input
                                        name="attr_statisticMove"
                                        placeholder="0"
                                        title="Move"
                                        type="text"
                                        value=""/>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-name">
                                <div>Move</div>
                            </div>
                        </div>
                        <div class="sheet-tab-block-body-part">
                            <div class="sheet-tab-block-body-part-roll-button">
                                <button
                                        name="roll_statisticBody"
                                        tabindex="-1"
                                        title="Roll Body"
                                        type="roll"
                                        value="@{rollStatisticBody}"></button>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-sum">
                                <input
                                        name="attr_statisticBodySum"
                                        readonly
                                        tabindex="-1"
                                        title="Body Total"
                                        type="text"
                                        value=""/>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-summand">
                                <input
                                        name="attr_statisticBody"
                                        placeholder="0"
                                        title="Body"
                                        type="text"
                                        value=""/>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-name">
                                <div>Body</div>
                            </div>
                        </div>
                        <div class="sheet-tab-block-body-part">
                            <div class="sheet-tab-block-body-part-roll-button">
                                <button
                                        name="roll_statisticEmpathy"
                                        tabindex="-1"
                                        title="Roll Empathy"
                                        type="roll"
                                        value="@{rollStatisticEmpathy}"></button>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-sum">
                                <input
                                        name="attr_statisticEmpathySum"
                                        readonly
                                        tabindex="-1"
                                        title="Empathy Total"
                                        type="text"
                                        value=""/>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-summand">
                                <input
                                        name="attr_statisticEmpathy"
                                        placeholder="0"
                                        title="Empathy"
                                        type="text"
                                        value=""/>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-name">
                                <div>Empathy</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="sheet-tab-block sheet-tab-block-skill">
                    <div class="sheet-tab-block-head">
                        Skills
                    </div>
                    <div class="sheet-tab-block-body">
                        <div class="sheet-tab-block-body-part">
                            <div class="sheet-tab-block-body-part-roll-button">
                                <button
                                        name="roll_skillAthletics"
                                        tabindex="-1"
                                        title="Roll Athletics"
                                        type="roll"
                                        value="@{rollSkillAthletics}"></button>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-sum">
                                <input
                                        name="attr_skillAthleticsSum"
                                        readonly
                                        tabindex="-1"
                                        title="Athletics Total"
                                        type="text"
                                        value=""/>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-summand">
                                <input
                                        name="attr_skillAthletics"
                                        placeholder="0"
                                        title="Athletics"
                                        type="text"
                                        value=""/>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-name">
                                <div>Athletics</div>
                            </div>
                        </div>
                        <div class="sheet-tab-block-body-part">
                            <div class="sheet-tab-block-body-part-roll-button">
                                <button
                                        name="roll_skillBasicTech"
                                        tabindex="-1"
                                        title="Roll Basic Tech"
                                        type="roll"
                                        value="@{rollSkillBasicTech}"></button>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-sum">
                                <input
                                        name="attr_skillBasicTechSum"
                                        readonly
                                        tabindex="-1"
                                        title="Basic Tech Total"
                                        type="text"
                                        value=""/>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-summand">
                                <input
                                        name="attr_skillBasicTech"
                                        placeholder="0"
                                        title="Basic Tech"
                                        type="text"
                                        value=""/>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-name">
                                <div>Basic Tech</div>
                            </div>
                        </div>
                        <div class="sheet-tab-block-body-part">
                            <div class="sheet-tab-block-body-part-roll-button">
                                <button
                                        name="roll_skillBrawling"
                                        tabindex="-1"
                                        title="Roll Brawling"
                                        type="roll"
                                        value="@{rollSkillBrawling}"></button>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-sum">
                                <input
                                        name="attr_skillBrawlingSum"
                                        readonly
                                        tabindex="-1"
                                        title="Brawling Total"
                                        type="text"
                                        value=""/>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-summand">
                                <input
                                        name="attr_skillBrawling"
                                        placeholder="0"
                                        title="Brawling"
                                        type="text"
                                        value=""/>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-name">
                                <div>Brawling</div>
                            </div>
                        </div>
                        <div class="sheet-tab-block-body-part">
                            <div class="sheet-tab-block-body-part-roll-button">
                                <button
                                        name="roll_skillBribery"
                                        tabindex="-1"
                                        title="Roll Bribery"
                                        type="roll"
                                        value="@{rollSkillBribery}"></button>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-sum">
                                <input
                                        name="attr_skillBriberySum"
                                        readonly
                                        tabindex="-1"
                                        title="Bribery Total"
                                        type="text"
                                        value=""/>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-summand">
                                <input
                                        name="attr_skillBribery"
                                        placeholder="0"
                                        title="Bribery"
                                        type="text"
                                        value=""/>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-name">
                                <div>Bribery</div>
                            </div>
                        </div>
                        <div class="sheet-tab-block-body-part">
                            <div class="sheet-tab-block-body-part-roll-button">
                                <button
                                        name="roll_skillConcentration"
                                        tabindex="-1"
                                        title="Roll Concentration"
                                        type="roll"
                                        value="@{rollSkillConcentration}"></button>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-sum">
                                <input
                                        name="attr_skillConcentrationSum"
                                        readonly
                                        tabindex="-1"
                                        title="Concentration Total"
                                        type="text"
                                        value=""/>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-summand">
                                <input
                                        name="attr_skillConcentration"
                                        placeholder="0"
                                        title="Concentration"
                                        type="text"
                                        value=""/>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-name">
                                <div>Concentration</div>
                            </div>
                        </div>
                        <div class="sheet-tab-block-body-part">
                            <div class="sheet-tab-block-body-part-roll-button">
                                <button
                                        name="roll_skillConversation"
                                        tabindex="-1"
                                        title="Roll Conversation"
                                        type="roll"
                                        value="@{rollSkillConversation}"></button>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-sum">
                                <input
                                        name="attr_skillConversationSum"
                                        readonly
                                        tabindex="-1"
                                        title="Conversation Total"
                                        type="text"
                                        value=""/>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-summand">
                                <input
                                        name="attr_skillConversation"
                                        placeholder="0"
                                        title="Conversation"
                                        type="text"
                                        value=""/>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-name">
                                <div>Conversation</div>
                            </div>
                        </div>
                        <div class="sheet-tab-block-body-part">
                            <div class="sheet-tab-block-body-part-roll-button">
                                <button
                                        name="roll_skillCyberTech"
                                        tabindex="-1"
                                        title="Roll Cyber Tech"
                                        type="roll"
                                        value="@{rollSkillCyberTech}"></button>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-sum">
                                <input
                                        name="attr_skillCyberTechSum"
                                        readonly
                                        tabindex="-1"
                                        title="Cyber Tech Total"
                                        type="text"
                                        value=""/>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-summand">
                                <input
                                        name="attr_skillCyberTech"
                                        placeholder="0"
                                        title="Cyber Tech"
                                        type="text"
                                        value=""/>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-name">
                                <div>Cyber Tech</div>
                            </div>
                        </div>
                        <div class="sheet-tab-block-body-part">
                            <div class="sheet-tab-block-body-part-roll-button">
                                <button
                                        name="roll_skillDriving"
                                        tabindex="-1"
                                        title="Roll Driving"
                                        type="roll"
                                        value="@{rollSkillDriving}"></button>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-sum">
                                <input
                                        name="attr_skillDrivingSum"
                                        readonly
                                        tabindex="-1"
                                        title="Driving Total"
                                        type="text"
                                        value=""/>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-summand">
                                <input
                                        name="attr_skillDriving"
                                        placeholder="0"
                                        title="Driving"
                                        type="text"
                                        value=""/>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-name">
                                <div>Driving</div>
                            </div>
                        </div>
                        <div class="sheet-tab-block-body-part">
                            <div class="sheet-tab-block-body-part-roll-button">
                                <button
                                        name="roll_skillEducation"
                                        tabindex="-1"
                                        title="Roll Education"
                                        type="roll"
                                        value="@{rollSkillEducation}"></button>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-sum">
                                <input
                                        name="attr_skillEducationSum"
                                        readonly
                                        tabindex="-1"
                                        title="Education Total"
                                        type="text"
                                        value=""/>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-summand">
                                <input
                                        name="attr_skillEducation"
                                        placeholder="0"
                                        title="Education"
                                        type="text"
                                        value=""/>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-name">
                                <div>Education</div>
                            </div>
                        </div>
                        <div class="sheet-tab-block-body-part">
                            <div class="sheet-tab-block-body-part-roll-button">
                                <button
                                        name="roll_skillEvasion"
                                        tabindex="-1"
                                        title="Roll Evasion"
                                        type="roll"
                                        value="@{rollSkillEvasion}"></button>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-sum">
                                <input
                                        name="attr_skillEvasionSum"
                                        readonly
                                        tabindex="-1"
                                        title="Evasion Total"
                                        type="text"
                                        value=""/>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-summand">
                                <input
                                        name="attr_skillEvasion"
                                        placeholder="0"
                                        title="Evasion"
                                        type="text"
                                        value=""/>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-name">
                                <div>Evasion</div>
                            </div>
                        </div>
                        <div class="sheet-tab-block-body-part">
                            <div class="sheet-tab-block-body-part-roll-button">
                                <button
                                        name="roll_skillFirstAid"
                                        tabindex="-1"
                                        title="Roll First Aid"
                                        type="roll"
                                        value="@{rollSkillFirstAid}"></button>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-sum">
                                <input
                                        name="attr_skillFirstAidSum"
                                        readonly
                                        tabindex="-1"
                                        title="First Aid Total"
                                        type="text"
                                        value=""/>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-summand">
                                <input
                                        name="attr_skillFirstAid"
                                        placeholder="0"
                                        title="First Aid"
                                        type="text"
                                        value=""/>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-name">
                                <div>First Aid</div>
                            </div>
                        </div>
                        <div class="sheet-tab-block-body-part">
                            <div class="sheet-tab-block-body-part-roll-button">
                                <button
                                        name="roll_skillHumanPerception"
                                        tabindex="-1"
                                        title="Roll Human Perception"
                                        type="roll"
                                        value="@{rollSkillHumanPerception}"></button>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-sum">
                                <input
                                        name="attr_skillHumanPerceptionSum"
                                        readonly
                                        tabindex="-1"
                                        title="Human Perception Total"
                                        type="text"
                                        value=""/>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-summand">
                                <input
                                        name="attr_skillHumanPerception"
                                        placeholder="0"
                                        title="Human Perception"
                                        type="text"
                                        value=""/>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-name">
                                <div>Human Perception</div>
                            </div>
                        </div>
                        <div class="sheet-tab-block-body-part">
                            <div class="sheet-tab-block-body-part-roll-button">
                                <button
                                        name="roll_skillInterrogation"
                                        tabindex="-1"
                                        title="Roll Interrogation"
                                        type="roll"
                                        value="@{rollSkillInterrogation}"></button>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-sum">
                                <input
                                        name="attr_skillInterrogationSum"
                                        readonly
                                        tabindex="-1"
                                        title="Interrogation Total"
                                        type="text"
                                        value=""/>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-summand">
                                <input
                                        name="attr_skillInterrogation"
                                        placeholder="0"
                                        title="Interrogation"
                                        type="text"
                                        value=""/>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-name">
                                <div>Interrogation</div>
                            </div>
                        </div>
                        <div class="sheet-tab-block-body-part">
                            <div class="sheet-tab-block-body-part-roll-button">
                                <button
                                        name="roll_skillLocalExpert"
                                        tabindex="-1"
                                        title="Roll Local Expert"
                                        type="roll"
                                        value="@{rollSkillLocalExpert}"></button>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-sum">
                                <input
                                        name="attr_skillLocalExpertSum"
                                        readonly
                                        tabindex="-1"
                                        title="Local Expert Total"
                                        type="text"
                                        value=""/>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-summand">
                                <input
                                        name="attr_skillLocalExpert"
                                        placeholder="0"
                                        title="Local Expert"
                                        type="text"
                                        value=""/>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-name">
                                <div>Local Expert</div>
                            </div>
                        </div>
                        <div class="sheet-tab-block-body-part">
                            <div class="sheet-tab-block-body-part-roll-button">
                                <button
                                        name="roll_skillMarksmanship"
                                        tabindex="-1"
                                        title="Roll Marksmanship"
                                        type="roll"
                                        value="@{rollSkillMarksmanship}"></button>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-sum">
                                <input
                                        name="attr_skillMarksmanshipSum"
                                        readonly
                                        tabindex="-1"
                                        title="Marksmanship Total"
                                        type="text"
                                        value=""/>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-summand">
                                <input
                                        name="attr_skillMarksmanship"
                                        placeholder="0"
                                        title="Marksmanship"
                                        type="text"
                                        value=""/>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-name">
                                <div>Marksmanship</div>
                            </div>
                        </div>
                        <div class="sheet-tab-block-body-part">
                            <div class="sheet-tab-block-body-part-roll-button">
                                <button
                                        name="roll_skillMeleeWeapon"
                                        tabindex="-1"
                                        title="Roll Melee Weapon"
                                        type="roll"
                                        value="@{rollSkillMeleeWeapon}"></button>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-sum">
                                <input
                                        name="attr_skillMeleeWeaponSum"
                                        readonly
                                        tabindex="-1"
                                        title="Melee Weapon Total"
                                        type="text"
                                        value=""/>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-summand">
                                <input
                                        name="attr_skillMeleeWeapon"
                                        placeholder="0"
                                        title="Melee Weapon"
                                        type="text"
                                        value=""/>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-name">
                                <div>Melee Weapon</div>
                            </div>
                        </div>
                        <div class="sheet-tab-block-body-part">
                            <div class="sheet-tab-block-body-part-roll-button">
                                <button
                                        name="roll_skillPerception"
                                        tabindex="-1"
                                        title="Roll Perception"
                                        type="roll"
                                        value="@{rollSkillPerception}"></button>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-sum">
                                <input
                                        name="attr_skillPerceptionSum"
                                        readonly
                                        tabindex="-1"
                                        title="Perception Total"
                                        type="text"
                                        value=""/>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-summand">
                                <input
                                        name="attr_skillPerception"
                                        placeholder="0"
                                        title="Perception"
                                        type="text"
                                        value=""/>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-name">
                                <div>Perception</div>
                            </div>
                        </div>
                        <div class="sheet-tab-block-body-part">
                            <div class="sheet-tab-block-body-part-roll-button">
                                <button
                                        name="roll_skillPersuasion"
                                        tabindex="-1"
                                        title="Roll Persuasion"
                                        type="roll"
                                        value="@{rollSkillPersuasion}"></button>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-sum">
                                <input
                                        name="attr_skillPersuasionSum"
                                        readonly
                                        tabindex="-1"
                                        title="Persuasion Total"
                                        type="text"
                                        value=""/>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-summand">
                                <input
                                        name="attr_skillPersuasion"
                                        placeholder="0"
                                        title="Persuasion"
                                        type="text"
                                        value=""/>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-name">
                                <div>Persuasion</div>
                            </div>
                        </div>
                        <div class="sheet-tab-block-body-part">
                            <div class="sheet-tab-block-body-part-roll-button">
                                <button
                                        name="roll_skillPlayInstrument"
                                        tabindex="-1"
                                        title="Roll Play Instrument"
                                        type="roll"
                                        value="@{rollSkillPlayInstrument}"></button>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-sum">
                                <input
                                        name="attr_skillPlayInstrumentSum"
                                        readonly
                                        tabindex="-1"
                                        title="Play Instrument Total"
                                        type="text"
                                        value=""/>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-summand">
                                <input
                                        name="attr_skillPlayInstrument"
                                        placeholder="0"
                                        title="Play Instrument"
                                        type="text"
                                        value=""/>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-name">
                                <div>Play Instrument</div>
                            </div>
                        </div>
                        <div class="sheet-tab-block-body-part">
                            <div class="sheet-tab-block-body-part-roll-button">
                                <button
                                        name="roll_skillStealth"
                                        tabindex="-1"
                                        title="Roll Stealth"
                                        type="roll"
                                        value="@{rollSkillStealth}"></button>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-sum">
                                <input
                                        name="attr_skillStealthSum"
                                        readonly
                                        tabindex="-1"
                                        title="Stealth Total"
                                        type="text"
                                        value=""/>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-summand">
                                <input
                                        name="attr_skillStealth"
                                        placeholder="0"
                                        title="Stealth"
                                        type="text"
                                        value=""/>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-name">
                                <div>Stealth</div>
                            </div>
                        </div>
                        <div class="sheet-tab-block-body-part">
                            <div class="sheet-tab-block-body-part-roll-button">
                                <button
                                        name="roll_skillTracking"
                                        tabindex="-1"
                                        title="Roll Tracking"
                                        type="roll"
                                        value="@{rollSkillTracking}"></button>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-sum">
                                <input
                                        name="attr_skillTrackingSum"
                                        readonly
                                        tabindex="-1"
                                        title="Tracking Total"
                                        type="text"
                                        value=""/>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-summand">
                                <input
                                        name="attr_skillTracking"
                                        placeholder="0"
                                        title="Tracking"
                                        type="text"
                                        value=""/>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-name">
                                <div>Tracking</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="sheet-tab-block sheet-tab-block-luck-point">
                    <div class="sheet-tab-block-head">
                        Luck Points
                    </div>
                    <div class="sheet-tab-block-body">
                        <div class="sheet-tab-block-body-part">
                            <div class="sheet-tab-block-body-part-value">
                                <input
                                        name=attr_luck"
                                        placeholder="&#x1F340;"
                                        title="Luck Points"
                                        type="text"
                                        value=""/>
                            </div>
                            <div class="sheet-tab-block-body-part-value-max">
                                <input
                                        name=attr_luck_max"
                                        readonly
                                        tabindex="-1"
                                        title="Luck Points (Maximum)"
                                        type="text"
                                        value=""/>
                            </div>
                            <div class="sheet-tab-block-body-part-value-name">
                                <div>Luck Points</div>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-sum-button-reset">
                                <button
                                        name="act_luckDecrement"
                                        tabindex="-1"
                                        title="Decrement Luck Points"
                                        type="action">
                                    &#x2796;
                                </button>
                            </div>
                            <div class="sheet-tab-block-body-part-value-button-reset">
                                <button
                                        name="act_luckReset"
                                        tabindex="-1"
                                        title="Reset Luck Points"
                                        type="action">
                                    &#x267B;
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="sheet-tab">
            <input class="sheet-tab-radio" type="radio" id="sheet-tab-2" name="attr_sheet" value="2">
            <label class="sheet-tab-2-label" for="sheet-tab-2"
                   title="Initiative; Reputation; Grappling, Choking, and Throwing; Melee Attacks; Ranged Attacks">Attacks</label>
            <div class="sheet-tab-content">
                <div class="sheet-tab-block sheet-tab-block-attack-initiative">
                    <div class="sheet-tab-block-head">
                        Initiative
                    </div>
                    <div class="sheet-tab-block-body">
                        <div class="sheet-tab-block-body-part">
                            <div class="sheet-tab-block-body-part-roll-button sheet-tab-block-body-part-roll-button-body">
                                <button
                                        name="roll_attackInitiative"
                                        tabindex="-1"
                                        title="Initiative"
                                        type="roll"
                                        value="@{rollAttackInitiative}">
                                </button>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-sum">
                                <input
                                        name="attr_attackInitiativeSum"
                                        readonly
                                        tabindex="-1"
                                        title="Initiative Total"
                                        type="text"
                                        value=""/>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-name">
                                <div>Initiative</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="sheet-tab-block sheet-tab-block-attack-reputation">
                    <div class="sheet-tab-block-head">
                        Reputation
                    </div>
                    <div class="sheet-tab-block-body">
                        <div class="sheet-tab-block-body-part">
                            <div class="sheet-tab-block-body-part-roll-button sheet-tab-block-body-part-roll-button-body">
                                <button
                                        name="roll_attackReputation"
                                        tabindex="-1"
                                        title="Roll Reputation"
                                        type="roll"
                                        value="@{rollAttackReputation}">
                                </button>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-sum">
                                <input
                                        name="attr_attackReputationSum"
                                        readonly
                                        tabindex="-1"
                                        title="Reputation Total"
                                        type="text"
                                        value=""/>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-summand">
                                <input
                                        name="attr_attackReputation"
                                        placeholder="0"
                                        title="Reputation"
                                        type="text"
                                        value=""/>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-name">
                                <div>Reputation</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="sheet-tab-block sheet-tab-block-attack-action">
                    <div class="sheet-tab-block-head">
                        Action
                    </div>
                    <div class="sheet-tab-block-body">
                        <div class="sheet-tab-block-body-part">
                            <div class="sheet-tab-block-body-part-roll-button sheet-tab-block-body-part-roll-button-body">
                                <button
                                        name="roll_attackGrappling"
                                        tabindex="-1"
                                        title="Grappling Attack"
                                        type="roll"
                                        value="@{rollAttackGrappling}">
                                </button>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-sum">
                                <input
                                        name="attr_attackGrapplingSum"
                                        readonly
                                        tabindex="-1"
                                        title="Grappling Total"
                                        type="text"
                                        value=""/>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-name">
                                <div>Grappling</div>
                            </div>
                        </div>
                        <div class="sheet-tab-block-body-part">
                            <div class="sheet-tab-block-body-part-roll-button sheet-tab-block-body-part-roll-button-bicep">
                                <button
                                        name="roll_attackChoking"
                                        tabindex="-1"
                                        title="Choking Attack"
                                        type="roll"
                                        value="@{rollAttackChoking}">
                                    &#x1F4AA;
                                </button>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-sum">
                                <input
                                        name="attr_attackChokingSum"
                                        readonly
                                        tabindex="-1"
                                        title="Choking Damage"
                                        type="text"
                                        value=""/>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-name">
                                <div>Choking</div>
                            </div>
                        </div>
                        <div class="sheet-tab-block-body-part">
                            <div class="sheet-tab-block-body-part-roll-button sheet-tab-block-body-part-roll-button-bicep">
                                <button
                                        name="roll_attackThrowing"
                                        tabindex="-1"
                                        title="Throwing Attack"
                                        type="roll"
                                        value="@{rollAttackThrowing}">
                                    &#x1F4AA;
                                </button>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-sum">
                                <input
                                        name="attr_attackThrowingSum"
                                        readonly
                                        tabindex="-1"
                                        title="Throwing Damage"
                                        type="text"
                                        value=""/>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-name">
                                <div>Throwing</div>
                            </div>
                        </div>
                    </div>
                    <div class="sheet-tab-block sheet-tab-block-attack-melee">
                        <div class="sheet-tab-block-head">
                            Melee
                        </div>
                        <div class="sheet-tab-block-body-part">
                            <div class="sheet-tab-block-body-part-roll-button sheet-tab-block-body-part-roll-button-body">
                                <button
                                        name="roll_attackBrawlingBody"
                                        tabindex="-1"
                                        title="Brawling Attack on Body"
                                        type="roll"
                                        value="@{rollAttackBrawlingBody}">
                                </button>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-button sheet-tab-block-body-part-roll-button-head">
                                <button
                                        name="roll_attackBrawlingHead"
                                        tabindex="-1"
                                        title="Brawling Attack on Head"
                                        type="roll"
                                        value="@{rollAttackBrawlingHead}">
                                    &#x1F915;
                                </button>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-d6-count">
                                <input
                                        name="attr_attackBrawlingDamage"
                                        placeholder="d6"
                                        title="Damage in # of d6"
                                        type="text"
                                        value=""/>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-name">
                                <div>Brawling</div>
                            </div>
                        </div>
                        <fieldset class="repeating_attackMelee">
                            <input name="attr_rollAttackMeleeHead" type="hidden"
                                   value="&{template:roll-attack-melee} {{characterName=@{character_name}}} {{rollName=@{attackMeleeName} Attack on Head}} {{roll1=[[1d10]]}} {{rollNormal1=[[1 + 1d8 + @{skillMeleeWeaponSum}  - 6]]}} {{rollSuccess1=[[10 + 1d10 + @{skillMeleeWeaponSum}  - 6]]}} {{rollFailure1=[[1 - 1d10 + @{skillMeleeWeaponSum}  - 6]]}} {{rollDamage1=[[@{attackMeleeDamage}d6   ]]}} {{roll2=[[1d10]]}} {{rollNormal2=[[1 + 1d8 + @{skillMeleeWeaponSum} - 6]]}} {{rollSuccess2=[[10 + 1d10 + @{skillMeleeWeaponSum} - 6]]}} {{rollFailure2=[[1 - 1d10 + @{skillMeleeWeaponSum} - 6]]}} {{rollDamage2=[[@{attackMeleeDamage}d6   ]]}}"/>
                            <input name="attr_rollAttackMeleeBody" type="hidden"
                                   value="&{template:roll-attack-melee} {{characterName=@{character_name}}} {{rollName=@{attackMeleeName} Attack on Body}} {{roll1=[[1d10]]}} {{rollNormal1=[[1 + 1d8 + @{skillMeleeWeaponSum}     ]]}} {{rollSuccess1=[[10 + 1d10 + @{skillMeleeWeaponSum}     ]]}} {{rollFailure1=[[1 - 1d10 + @{skillMeleeWeaponSum}     ]]}} {{rollDamage1=[[@{attackMeleeDamage}d6   ]]}} {{roll2=[[1d10]]}} {{rollNormal2=[[1 + 1d8 + @{skillMeleeWeaponSum}    ]]}} {{rollSuccess2=[[10 + 1d10 + @{skillMeleeWeaponSum}    ]]}} {{rollFailure2=[[1 - 1d10 + @{skillMeleeWeaponSum}    ]]}} {{rollDamage2=[[@{attackMeleeDamage}d6   ]]}}"/>
                            <div class="sheet-tab-block-body-part">
                                <div class="sheet-tab-block-body-part-roll-button sheet-tab-block-body-part-roll-button-body">
                                    <button
                                            name="roll_attackMeleeBody"
                                            tabindex="-1"
                                            title="Melee Attack on Body"
                                            type="roll"
                                            value="@{rollAttackMeleeBody}">
                                    </button>
                                </div>
                                <div class="sheet-tab-block-body-part-roll-button sheet-tab-block-body-part-roll-button-head">
                                    <button
                                            name="roll_attackMeleeHead"
                                            tabindex="-1"
                                            title="Melee Attack on Head"
                                            type="roll"
                                            value="@{rollAttackMeleeHead}">
                                        &#x1F915;
                                    </button>
                                </div>
                                <div class="sheet-tab-block-body-part-roll-d6-count">
                                    <input
                                            name="attr_attackMeleeDamage"
                                            placeholder="d6"
                                            title="Damage in # of d6"
                                            type="text"
                                            value=""/>
                                </div>
                                <div class="sheet-tab-block-body-part-roll-name">
                                    <input
                                            name="attr_attackMeleeName"
                                            placeholder="Melee Weapon Name"
                                            type="text"
                                            value=""/>
                                </div>
                            </div>
                        </fieldset>
                    </div>
                </div>
                <div class="sheet-tab-block sheet-tab-block-attack-ranged-1">
                    <div class="sheet-tab-block-head">
                        Ranged
                    </div>
                    <div class="sheet-tab-block-body">
                        <fieldset class="repeating_attackRanged1">
                            <input name="attr_rollAttackRangedBody" type="hidden"
                                   value="&{template:roll-attack-ranged-1}    {{characterName=@{character_name}}} {{rollName=@{attackRangedName} Attack on Body}}    {{roll= [[1d10]]}} {{rollNormal= [[1 + 1d8 + @{skillMarksmanshipSum}    ]]}} {{rollSuccess= [[10 + 1d10 + @{skillMarksmanshipSum}    ]]}} {{rollFailure= [[1 - 1d10 + @{skillMarksmanshipSum}    ]]}} {{rollDamage1=[[@{attackRangedDamage}d6  ]]}} {{rollDamage2=[[@{attackRangedDamage}d6]]}} {{rollDamage3=[[@{attackRangedDamage}d6]]}} {{rollDifficulty012=@{attackRangedDifficulty012}}} {{rollDifficulty025=@{attackRangedDifficulty025}}} {{rollDifficulty050=@{attackRangedDifficulty050}}} {{rollDifficulty100=@{attackRangedDifficulty100}}} {{rollDifficulty200=@{attackRangedDifficulty200}}} {{rollDifficulty400=@{attackRangedDifficulty400}}} {{rollDifficulty800=@{attackRangedDifficulty800}}}"/>
                            <input name="attr_rollAttackRangedHead" type="hidden"
                                   value="&{template:roll-attack-ranged-1}    {{characterName=@{character_name}}} {{rollName=@{attackRangedName} Attack on Head}}    {{roll= [[1d10]]}} {{rollNormal= [[1 + 1d8 + @{skillMarksmanshipSum} - 6]]}} {{rollSuccess= [[10 + 1d10 + @{skillMarksmanshipSum} - 6]]}} {{rollFailure= [[1 - 1d10 + @{skillMarksmanshipSum} - 6]]}} {{rollDamage1=[[@{attackRangedDamage}d6  ]]}} {{rollDamage2=[[@{attackRangedDamage}d6]]}} {{rollDamage3=[[@{attackRangedDamage}d6]]}} {{rollDifficulty012=@{attackRangedDifficulty012}}} {{rollDifficulty025=@{attackRangedDifficulty025}}} {{rollDifficulty050=@{attackRangedDifficulty050}}} {{rollDifficulty100=@{attackRangedDifficulty100}}} {{rollDifficulty200=@{attackRangedDifficulty200}}} {{rollDifficulty400=@{attackRangedDifficulty400}}} {{rollDifficulty800=@{attackRangedDifficulty800}}}"/>
                            <div class="sheet-tab-block-body-part">
                                <div class="sheet-tab-block-body-part-roll-button sheet-tab-block-body-part-roll-button-body sheet-tab-block-body-part-roll-button-1-body">
                                    <button
                                            name="roll_attackRangedBody"
                                            tabindex="-1"
                                            title="Single-Round Ranged Attack on Body"
                                            type="roll"
                                            value="@{rollAttackRangedBody}">
                                    </button>
                                </div>
                                <div class="sheet-tab-block-body-part-roll-button sheet-tab-block-body-part-roll-button-head sheet-tab-block-body-part-roll-button-1-head">
                                    <button
                                            name="roll_attackRangedHead"
                                            tabindex="-1"
                                            title="Single-Round Ranged Attack on Head"
                                            type="roll"
                                            value="@{rollAttackRangedHead}">
                                        &#x1F915;
                                    </button>
                                </div>
                                <div class="sheet-tab-block-body-part-roll-d6-count">
                                    <input
                                            name="attr_attackRangedDamage"
                                            placeholder="d6"
                                            title="Damage in # of d6"
                                            type="text"/>
                                </div>
                                <div class="sheet-tab-block-body-part-roll-name">
                                    <input
                                            name="attr_attackRangedName"
                                            placeholder="Ranged Weapon Name"
                                            type="text"/>
                                </div>
                                <div class="sheet-tab-block-body-part-roll-difficulty sheet-tab-block-body-part-roll-1-difficulty">
                                    <div class="sheet-tab-block-body-part-roll-difficulty-value">
                                        <input
                                                name="attr_attackRangedDifficulty012"
                                                placeholder="12m"
                                                title="Single-Round Ranged Attack Difficulty Value at 12m"
                                                type="text"/>
                                    </div>
                                    <div class="sheet-tab-block-body-part-roll-difficulty-value">
                                        <input
                                                name="attr_attackRangedDifficulty025"
                                                placeholder="25m"
                                                title="Single-Round Ranged Attack Difficulty Value at 25m"
                                                type="text"/>
                                    </div>
                                    <div class="sheet-tab-block-body-part-roll-difficulty-value">
                                        <input
                                                name="attr_attackRangedDifficulty050"
                                                placeholder="50m"
                                                title="Single-Round Ranged Attack Difficulty Value at 50m"
                                                type="text"/>
                                    </div>
                                    <div class="sheet-tab-block-body-part-roll-difficulty-value">
                                        <input
                                                name="attr_attackRangedDifficulty100"
                                                placeholder="100m"
                                                title="Single-Round Ranged Attack Difficulty Value at 100m"
                                                type="text"/>
                                    </div>
                                    <div class="sheet-tab-block-body-part-roll-difficulty-value">
                                        <input
                                                name="attr_attackRangedDifficulty200"
                                                placeholder="200m"
                                                title="Single-Round Ranged Attack Difficulty Value at 200m"
                                                type="text"/>
                                    </div>
                                    <div class="sheet-tab-block-body-part-roll-difficulty-value">
                                        <input
                                                name="attr_attackRangedDifficulty400"
                                                placeholder="400m"
                                                title="Single-Round Ranged Attack Difficulty Value at 400m"
                                                type="text"/>
                                    </div>
                                    <div class="sheet-tab-block-body-part-roll-difficulty-value">
                                        <input
                                                name="attr_attackRangedDifficulty800"
                                                placeholder="800m"
                                                title="Single-Round Ranged Attack Difficulty Value at 800m"
                                                type="text"/>
                                    </div>
                                </div>
                            </div>
                        </fieldset>
                    </div>
                </div>
                <div class="sheet-tab-block sheet-tab-block-attack-ranged-3">
                    <div class="sheet-tab-block-head">
                        Ranged (Capable of Three-Round Burst)
                    </div>
                    <div class="sheet-tab-block-body">
                        <fieldset class="repeating_attackRanged3">
                            <input name="attr_rollAttackRangedBody" type="hidden"
                                   value="&{template:roll-attack-ranged-1}    {{characterName=@{character_name}}} {{rollName=@{attackRangedName} Attack on Body}}   {{roll= [[1d10]]}} {{rollNormal= [[1 + 1d8 + @{skillMarksmanshipSum}    ]]}} {{rollSuccess= [[10 + 1d10 + @{skillMarksmanshipSum}    ]]}} {{rollFailure= [[1 - 1d10 + @{skillMarksmanshipSum}    ]]}} {{rollDamage1=[[@{attackRangedDamage}d6  ]]}} {{rollDamage2=[[@{attackRangedDamage}d6]]}} {{rollDamage3=[[@{attackRangedDamage}d6]]}} {{rollDifficulty012=@{attackRanged1Difficulty012}}} {{rollDifficulty025=@{attackRanged1Difficulty025}}} {{rollDifficulty050=@{attackRanged1Difficulty050}}} {{rollDifficulty100=@{attackRanged1Difficulty100}}} {{rollDifficulty200=@{attackRanged1Difficulty200}}} {{rollDifficulty400=@{attackRanged1Difficulty400}}} {{rollDifficulty800=@{attackRanged1Difficulty800}}}"/>
                            <input name="attr_rollAttackRangedHead" type="hidden"
                                   value="&{template:roll-attack-ranged-1}    {{characterName=@{character_name}}} {{rollName=@{attackRangedName} Attack on Head}}   {{roll= [[1d10]]}} {{rollNormal= [[1 + 1d8 + @{skillMarksmanshipSum} - 6]]}} {{rollSuccess= [[10 + 1d10 + @{skillMarksmanshipSum} - 6]]}} {{rollFailure= [[1 - 1d10 + @{skillMarksmanshipSum} - 6]]}} {{rollDamage1=[[@{attackRangedDamage}d6  ]]}} {{rollDamage2=[[@{attackRangedDamage}d6]]}} {{rollDamage3=[[@{attackRangedDamage}d6]]}} {{rollDifficulty012=@{attackRanged1Difficulty012}}} {{rollDifficulty025=@{attackRanged1Difficulty025}}} {{rollDifficulty050=@{attackRanged1Difficulty050}}} {{rollDifficulty100=@{attackRanged1Difficulty100}}} {{rollDifficulty200=@{attackRanged1Difficulty200}}} {{rollDifficulty400=@{attackRanged1Difficulty400}}} {{rollDifficulty800=@{attackRanged1Difficulty800}}}"/>
                            <input name="attr_rollAttackRanged3" type="hidden"
                                   value="&{template:roll-attack-ranged-3}    {{characterName=@{character_name}}} {{rollName=@{attackRangedName} Attack on Body}}   {{roll= [[1d10]]}} {{rollNormal= [[1 + 1d8 + @{skillMarksmanshipSum}    ]]}} {{rollSuccess= [[10 + 1d10 + @{skillMarksmanshipSum}    ]]}} {{rollFailure= [[1 - 1d10 + @{skillMarksmanshipSum}    ]]}} {{rollDamage1=[[@{attackRangedDamage}d6  ]]}} {{rollDamage2=[[@{attackRangedDamage}d6]]}} {{rollDamage3=[[@{attackRangedDamage}d6]]}} {{rollDifficulty012=@{attackRanged3Difficulty012}}} {{rollDifficulty025=@{attackRanged3Difficulty025}}} {{rollDifficulty050=@{attackRanged3Difficulty050}}} {{rollDifficulty100=@{attackRanged3Difficulty100}}}"/>
                            <input name="attr_rollAttackRangedSuppressive" type="hidden"
                                   value="&{template:roll-without-difficulty} {{characterName=@{character_name}}} {{rollName=@{attackRangedName} Suppressive Fire}} {{roll= [[1d10]]}} {{rollNormal= [[1 + 1d8 + @{skillMarksmanshipSum}    ]]}} {{rollSuccess= [[10 + 1d10 + @{skillMarksmanshipSum}    ]]}} {{rollFailure= [[1 - 1d10 + @{skillMarksmanshipSum}    ]]}}"/>
                            <div class="sheet-tab-block-body-part">
                                <div class="sheet-tab-block-body-part-roll-button sheet-tab-block-body-part-roll-button-body sheet-tab-block-body-part-roll-button-1-body">
                                    <button
                                            name="roll_attackRanged3Body"
                                            tabindex="-1"
                                            title="Single-Round Ranged Attack on Body"
                                            type="roll"
                                            value="@{rollAttackRangedBody}">
                                    </button>
                                </div>
                                <div class="sheet-tab-block-body-part-roll-button sheet-tab-block-body-part-roll-button-head sheet-tab-block-body-part-roll-button-1-head">
                                    <button
                                            name="roll_attackRanged3Head"
                                            tabindex="-1"
                                            title="Single-Round Ranged Attack on Head"
                                            type="roll"
                                            value="@{rollAttackRangedHead}">
                                        &#x1F915;
                                    </button>
                                </div>
                                <div class="sheet-tab-block-body-part-roll-button sheet-tab-block-body-part-roll-button-3">
                                    <button
                                            name="roll_attackRanged3"
                                            tabindex="-1"
                                            title="Three-Round Ranged Attack on Body"
                                            type="roll"
                                            value="@{rollAttackRanged3}">
                                        &#x2728;
                                    </button>
                                </div>
                                <div class="sheet-tab-block-body-part-roll-button sheet-tab-block-body-part-roll-button-suppressive">
                                    <button
                                            name="roll_attackRangedSuppressive"
                                            tabindex="-1"
                                            title="Suppressive Fire"
                                            type="roll"
                                            value="@{rollAttackRangedSuppressive}">
                                        &#x1F647;
                                    </button>
                                </div>
                                <div class="sheet-tab-block-body-part-roll-d6-count">
                                    <input
                                            name="attr_attackRangedDamage"
                                            placeholder="d6"
                                            title="Damage in # of d6"
                                            type="text"/>
                                </div>
                                <div class="sheet-tab-block-body-part-roll-name">
                                    <input
                                            name="attr_attackRangedName"
                                            placeholder="Ranged Weapon Name"
                                            type="text"/>
                                </div>
                                <div class="sheet-tab-block-body-part-roll-difficulty sheet-tab-block-body-part-roll-1-difficulty">
                                    <div class="sheet-tab-block-body-part-roll-difficulty-value">
                                        <input
                                                name="attr_attackRanged1Difficulty012"
                                                placeholder="12m"
                                                title="Single-Round Ranged Attack Difficulty Value at 12m"
                                                type="text"/>
                                    </div>
                                    <div class="sheet-tab-block-body-part-roll-difficulty-value">
                                        <input
                                                name="attr_attackRanged1Difficulty025"
                                                placeholder="25m"
                                                title="Single-Round Ranged Attack Difficulty Value at 25m"
                                                type="text"/>
                                    </div>
                                    <div class="sheet-tab-block-body-part-roll-difficulty-value">
                                        <input
                                                name="attr_attackRanged1Difficulty050"
                                                placeholder="50m"
                                                title="Single-Round Ranged Attack Difficulty Value at 50m"
                                                type="text"/>
                                    </div>
                                    <div class="sheet-tab-block-body-part-roll-difficulty-value">
                                        <input
                                                name="attr_attackRanged1Difficulty100"
                                                placeholder="100m"
                                                title="Single-Round Ranged Attack Difficulty Value at 100m"
                                                type="text"/>
                                    </div>
                                    <div class="sheet-tab-block-body-part-roll-difficulty-value">
                                        <input
                                                name="attr_attackRanged1Difficulty200"
                                                placeholder="200m"
                                                title="Single-Round Ranged Attack Difficulty Value at 200m"
                                                type="text"/>
                                    </div>
                                    <div class="sheet-tab-block-body-part-roll-difficulty-value">
                                        <input
                                                name="attr_attackRanged1Difficulty400"
                                                placeholder="400m"
                                                title="Single-Round Ranged Attack Difficulty Value at 400m"
                                                type="text"/>
                                    </div>
                                    <div class="sheet-tab-block-body-part-roll-difficulty-value">
                                        <input
                                                name="attr_attackRanged1Difficulty800"
                                                placeholder="800m"
                                                title="Single-Round Ranged Attack Difficulty Value at 800m"
                                                type="text"/>
                                    </div>
                                </div>
                                <div class="sheet-tab-block-body-part-roll-difficulty sheet-tab-block-body-part-roll-3-difficulty">
                                    <div class="sheet-tab-block-body-part-roll-difficulty-value">
                                        <input
                                                name="attr_attackRanged3Difficulty012"
                                                placeholder="12m"
                                                title="Three-Round Ranged Attack Difficulty Value at 12m"
                                                type="text"/>
                                    </div>
                                    <div class="sheet-tab-block-body-part-roll-difficulty-value">
                                        <input
                                                name="attr_attackRanged3Difficulty025"
                                                placeholder="25m"
                                                title="Three-Round Ranged Attack Difficulty Value at 25m"
                                                type="text"/>
                                    </div>
                                    <div class="sheet-tab-block-body-part-roll-difficulty-value">
                                        <input
                                                name="attr_attackRanged3Difficulty050"
                                                placeholder="50m"
                                                title="Three-Round Ranged Attack Difficulty Value at 50m"
                                                type="text"/>
                                    </div>
                                    <div class="sheet-tab-block-body-part-roll-difficulty-value">
                                        <input
                                                name="attr_attackRanged3Difficulty100"
                                                placeholder="100m"
                                                title="Three-Round Ranged Attack Difficulty Value at 100m"
                                                type="text"/>
                                    </div>
                                </div>
                            </div>
                        </fieldset>
                    </div>
                </div>
            </div>
        </div>
        <div class="sheet-tab">
            <input class="sheet-tab-radio" type="radio" id="sheet-tab-3" name="attr_sheet" value="3">
            <label class="sheet-tab-3-label" for="sheet-tab-3"
                   title="Hit Points; Armor; Concentration, Evasion, and First Aid; Conditions; Death Save; Damage">Defenses</label>
            <div class="sheet-tab-content">
                <div class="sheet-tab-block sheet-tab-block-hit-point">
                    <div class="sheet-tab-block-head">
                        Hit Points
                    </div>
                    <div class="sheet-tab-block-body">
                        <div class="sheet-tab-block-body-part">
                            <div class="sheet-tab-block-body-part-value">
                                <input
                                        name=attr_hit"
                                        placeholder="HP"
                                        title="Hit Points"
                                        type="text"
                                        value=""/>
                            </div>
                            <div class="sheet-tab-block-body-part-value-max">
                                <input
                                        name=attr_hit_max"
                                        readonly
                                        tabindex="-1"
                                        title="Hit Points (Maximum)"
                                        type="text"
                                        value=""/>
                            </div>
                            <div class="sheet-tab-block-body-part-value-name">
                                <div>Hit Points</div>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-sum-button-reset">
                                <button
                                        name="act_hitDecrement"
                                        tabindex="-1"
                                        title="Decrement Hit Points"
                                        type="action">
                                    &#x2796;
                                </button>
                            </div>
                            <div class="sheet-tab-block-body-part-value-button-reset">
                                <button
                                        name="act_hitReset"
                                        tabindex="-1"
                                        title="Reset Hit Points"
                                        type="action">
                                    &#x267B;
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="sheet-tab-block sheet-tab-block-armor">
                    <div class="sheet-tab-block-head">
                        Armor
                    </div>
                    <div class="sheet-tab-block-body">
                        <div class="sheet-tab-block-body-part">
                            <div class="sheet-tab-block-body-part-value">
                                <input
                                        name="attr_armorHeadStoppingPower"
                                        placeholder="SP"
                                        title="Head Armor Stopping Power"
                                        type="text"
                                        value=""/>
                            </div>
                            <div class="sheet-tab-block-body-part-value-max">
                                <input
                                        name="attr_armorHeadStoppingPower_max"
                                        placeholder="SP"
                                        title="Head Armor Stopping Power (Maximum)"
                                        type="text"
                                        value=""/>
                            </div>
                            <div class="sheet-tab-block-body-part-value-name">
                                <input
                                        name="attr_armorHeadName"
                                        placeholder="Head Armor Name"
                                        title="Head Armor Name"
                                        type="text"
                                        value=""/>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-sum-button-reset">
                                <button
                                        name="act_armorHeadStoppingPowerDecrement"
                                        tabindex="-1"
                                        title="Decrement Head Armor Stopping Power"
                                        type="action">
                                    &#x2796;
                                </button>
                            </div>
                            <div class="sheet-tab-block-body-part-value-button-reset">
                                <button
                                        name="act_armorHeadStoppingPowerReset"
                                        tabindex="-1"
                                        title="Reset Head Armor Stopping Power"
                                        type="action">
                                    &#x267B;
                                </button>
                            </div>
                        </div>
                        <div class="sheet-tab-block-body-part">
                            <div class="sheet-tab-block-body-part-value">
                                <input
                                        name="attr_armorBodyStoppingPower"
                                        placeholder="SP"
                                        title="Body Armor Stopping Power"
                                        type="text"
                                        value=""/>
                            </div>
                            <div class="sheet-tab-block-body-part-value-max">
                                <input
                                        name="attr_armorBodyStoppingPower_max"
                                        placeholder="SP"
                                        title="Body Armor Stopping Power (Maximum)"
                                        type="text"
                                        value=""/>
                            </div>
                            <div class="sheet-tab-block-body-part-value-name">
                                <input
                                        name="attr_armorBodyName"
                                        placeholder="Body Armor Name"
                                        title="Body Armor Name"
                                        type="text"
                                        value=""/>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-sum-button-reset">
                                <button
                                        name="act_armorBodyStoppingPowerDecrement"
                                        tabindex="-1"
                                        title="Decrement Body Armor Stopping Power"
                                        type="action">
                                    &#x2796;
                                </button>
                            </div>
                            <div class="sheet-tab-block-body-part-value-button-reset">
                                <button
                                        name="act_armorBodyStoppingPowerReset"
                                        tabindex="-1"
                                        title="Reset Body Armor Stopping Power"
                                        type="action">
                                    &#x267B;
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="sheet-tab-block sheet-tab-block-defense">
                    <div class="sheet-tab-block-head">
                        Defenses
                    </div>
                    <div class="sheet-tab-block-body">
                        <div class="sheet-tab-block-body-part">
                            <div class="sheet-tab-block-body-part-roll-button">
                                <button
                                        name="roll_skillConcentration"
                                        tabindex="-1"
                                        title="Roll Concentration"
                                        type="roll"
                                        value="@{rollSkillConcentration}"></button>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-sum">
                                <input
                                        name="attr_skillConcentrationSum"
                                        readonly
                                        tabindex="-1"
                                        title="Concentration Total"
                                        type="text"
                                        value=""/>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-summand">
                                <input
                                        name="attr_skillConcentration"
                                        placeholder="0"
                                        title="Concentration"
                                        type="text"
                                        value=""/>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-name">
                                <div>Concentration</div>
                            </div>
                        </div>
                        <div class="sheet-tab-block-body-part">
                            <div class="sheet-tab-block-body-part-roll-button">
                                <button
                                        name="roll_skillEvasion"
                                        tabindex="-1"
                                        title="Roll Evasion"
                                        type="roll"
                                        value="@{rollSkillEvasion}"></button>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-sum">
                                <input
                                        name="attr_skillEvasionSum"
                                        readonly
                                        tabindex="-1"
                                        title="Evasion Total"
                                        type="text"
                                        value=""/>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-summand">
                                <input
                                        name="attr_skillEvasion"
                                        readonly
                                        placeholder="0"
                                        title="Evasion"
                                        type="text"
                                        value=""/>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-name">
                                <div>Evasion</div>
                            </div>
                        </div>
                        <div class="sheet-tab-block-body-part">
                            <div class="sheet-tab-block-body-part-roll-button">
                                <button
                                        name="roll_skillFirstAid"
                                        tabindex="-1"
                                        title="Roll First Aid"
                                        type="roll"
                                        value="@{rollSkillFirstAid}"></button>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-sum">
                                <input
                                        name="attr_skillFirstAidSum"
                                        readonly
                                        tabindex="-1"
                                        title="First Aid Total"
                                        type="text"
                                        value=""/>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-summand">
                                <input
                                        name="attr_skillFirstAid"
                                        placeholder="0"
                                        title="First Aid"
                                        type="text"
                                        value=""/>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-name">
                                <div>First Aid</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="sheet-tab-block sheet-tab-block-condition">
                    <div class="sheet-tab-block-head">
                        Conditions
                    </div>
                    <div class="sheet-tab-block-body">
                        <div class="sheet-tab-block-body-part">
                            <div class="sheet-tab-block-body-part-checkbox">
                                <input
                                        id="attr_conditionGrappled"
                                        name="attr_conditionGrappled"
                                        type="checkbox"
                                        title="If Grappled, Check"
                                        value="true"
                                />
                            </div>
                            <div class="sheet-tab-block-body-part-checkbox-name">
                                <div><label for="attr_conditionGrappled">Grappled</label></div>
                            </div>
                        </div>
                        <div class="sheet-tab-block-body-part">
                            <div class="sheet-tab-block-body-part-checkbox">
                                <input
                                        id="attr_conditionProne"
                                        name="attr_conditionProne"
                                        type="checkbox"
                                        title="If Prone, Check"
                                        value="true"
                                />
                            </div>
                            <div class="sheet-tab-block-body-part-checkbox-name">
                                <div><label for="attr_conditionProne">Prone</label></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="sheet-tab-block sheet-tab-block-death">
                    <div class="sheet-tab-block-head">
                        Death Save
                    </div>
                    <div class="sheet-tab-block-body">
                        <div class="sheet-tab-block-body-part">
                            <div class="sheet-tab-block-body-part-roll-button">
                                <button
                                        name="roll_deathSave"
                                        tabindex="-1"
                                        title="Roll Death Save"
                                        type="roll"
                                        value="@{rollDeathSave}"></button>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-sum">
                                <input
                                        name="attr_deathSave"
                                        placeholder="0"
                                        title="# of Death Saves"
                                        type="text"
                                        value="0"/>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-name">
                                <div>Death Save</div>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-sum-button-reset">
                                <button
                                        name="act_deathSaveIncrement"
                                        tabindex="-1"
                                        title="Increment Death Save"
                                        type="action">
                                    &#x2795;
                                </button>
                            </div>
                            <div class="sheet-tab-block-body-part-roll-sum-button-reset">
                                <button
                                        name="act_deathSaveReset"
                                        tabindex="-1"
                                        title="Reset Death Saves"
                                        type="action">
                                    &#x267B;
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="sheet-tab-block sheet-tab-block-damage">
                    <div class="sheet-tab-block-head">
                        Damage Calculator
                    </div>
                    <div class="sheet-tab-block-body">
                        <div class="sheet-tab-block-body-damage-value">
                            <div class="sheet-tab-block-body-part">
                                <div class="sheet-tab-block-body-part-value">
                                    <input
                                            name="attr_damage1"
                                            title="Damage, Hit 1"
                                            type="text"
                                            value=""/>
                                </div>
                                <div class="sheet-tab-block-body-part-value-name">
                                    <div>Hit 1</div>
                                </div>
                            </div>
                            <div class="sheet-tab-block-body-part">
                                <div class="sheet-tab-block-body-part-value">
                                    <input
                                            name="attr_damage2"
                                            title="Damage, Hit 2"
                                            type="text"
                                            value=""/>
                                </div>
                                <div class="sheet-tab-block-body-part-value-name">
                                    <div>Hit 2</div>
                                </div>
                            </div>
                            <div class="sheet-tab-block-body-part">
                                <div class="sheet-tab-block-body-part-value">
                                    <input
                                            name="attr_damage3"
                                            title="Damage, Hit 3"
                                            type="text"
                                            value=""/>
                                </div>
                                <div class="sheet-tab-block-body-part-value-name">
                                    <div>Hit 3</div>
                                </div>
                            </div>
                        </div>
                        <div class="sheet-tab-block-body-damage-type">
                            <div class="sheet-tab-block-body-part">
                                <div class="sheet-tab-block-body-part-radio">
                                    <input
                                            id="damageTypeBrawling"
                                            type="radio"
                                            title="If Brawling, Check"
                                            name="attr_damageType"
                                            value="damageTypeBrawling"/>
                                </div>
                                <div class="sheet-tab-block-body-part-radio-name">
                                    <div><label for="damageTypeBrawling">Brawling</label></div>
                                </div>
                            </div>
                            <div class="sheet-tab-block-body-part">
                                <div class="sheet-tab-block-body-part-radio">
                                    <input
                                            id="damageTypeMelee"
                                            type="radio"
                                            title="If Melee, Check"
                                            name="attr_damageType"
                                            value="damageTypeMelee"/>
                                </div>
                                <div class="sheet-tab-block-body-part-radio-name">
                                    <div><label for="damageTypeMelee">Melee</label></div>
                                </div>
                            </div>
                            <div class="sheet-tab-block-body-part">
                                <div class="sheet-tab-block-body-part-radio">
                                    <input
                                            id="damageTypeRanged"
                                            type="radio"
                                            title="If Ranged, Check"
                                            name="attr_damageType"
                                            value="damageTypeRanged"/>
                                </div>
                                <div class="sheet-tab-block-body-part-radio-name">
                                    <div><label for="damageTypeRanged">Ranged</label></div>
                                </div>
                            </div>
                        </div>
                        <div class="sheet-tab-block-body-damage-location">
                            <div class="sheet-tab-block-body-part">
                                <div class="sheet-tab-block-body-part-radio">
                                    <input
                                            id="damageLocationBody"
                                            type="radio"
                                            title="If Body, Check"
                                            name="attr_damageLocation"
                                            value="damageLocationBody"/>
                                </div>
                                <div class="sheet-tab-block-body-part-radio-name">
                                    <div><label for="damageLocationBody">Body</label></div>
                                </div>
                            </div>
                            <div class="sheet-tab-block-body-part">
                                <div class="sheet-tab-block-body-part-radio">
                                    <input
                                            id="damageLocationHead"
                                            type="radio"
                                            title="If Head, Check"
                                            name="attr_damageLocation"
                                            value="damageLocationHead"/>
                                </div>
                                <div class="sheet-tab-block-body-part-radio-name">
                                    <div><label for="damageLocationHead">Head</label></div>
                                </div>
                            </div>
                            <div class="sheet-tab-block-body-part">
                                <div class="sheet-tab-block-body-part-button">
                                    <button
                                            name="act_damage"
                                            title="Calculate and Subtract Damage from Hit Points and Armor"
                                            type="action">
                                        Calculate and Subtract Damage
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="sheet-tab">
            <input class="sheet-tab-radio" type="radio" id="sheet-tab-4" name="attr_sheet" value="4">
            <label class="sheet-tab-4-label" for="sheet-tab-4" title="Cyberware">Cyberware</label>
            <div class="sheet-tab-content">
                <div class="sheet-tab-block sheet-tab-block-cyberware">
                    <div class="sheet-tab-block-head">
                        Cyberware
                    </div>
                    <div class="sheet-tab-block-body">
                        <fieldset class="repeating_cyberwareAll">
                            <!--                            @formatter:off-->
                            <input name="attr_rollCyberware"                       type="hidden" value=""/>
                            <input name="attr_rollCyberwareWithDifficulty"         type="hidden" value="&{template:roll-with-difficulty}            {{characterName=@{character_name}}} {{rollName=@{cyberwareTargetName}}}           {{roll= [[1d10]]}} {{rollNormal= [[1 + 1d8 + @{cyberwareSum}]]}}             {{rollSuccess= [[10 + 1d10 + @{cyberwareSum}]]}} {{rollFailure=[[1 - 1d10 + @{cyberwareSum}]]}}"/>
                            <input name="attr_rollCyberwareWithDifficultyFirstAid" type="hidden" value="&{template:roll-with-difficulty-first-aid}  {{characterName=@{character_name}}} {{rollName=@{cyberwareTargetName}}}           {{roll= [[1d10]]}} {{rollNormal= [[1 + 1d8 + @{cyberwareSum}]]}}             {{rollSuccess= [[10 + 1d10 + @{cyberwareSum}]]}} {{rollFailure=[[1 - 1d10 + @{cyberwareSum}]]}}"/>
                            <input name="attr_rollCyberwareInitiative"             type="hidden" value="&{template:roll}                            {{characterName=@{character_name}}} {{rollName=@{cyberwareTargetName}}}           {{roll= [[1d10 + @{cyberwareSum} &{tracker}]]}}"/>
                            <input name="attr_rollCyberwareReputation"             type="hidden" value="&{template:roll}                            {{characterName=@{character_name}}} {{rollName=@{cyberwareTargetName}}}           {{roll= [[1d10 + @{cyberwareSum} &{tracker}]]}}"/>
                            <!--                            @formatter:on -->
                            <div class="sheet-tab-block-body-part">
                                <div class="sheet-tab-block-body-part-roll-button">
                                    <button
                                            name="roll_cyberware"
                                            tabindex="-1"
                                            title="Roll Statistic or Skill"
                                            type="roll"
                                            value="@{rollCyberware}">
                                    </button>
                                </div>
                                <div class="sheet-tab-block-body-part-roll-sum">
                                    <input
                                            name="attr_cyberwareSum"
                                            readonly
                                            tabindex="-1"
                                            title="Statistic or Skill Total"
                                            type="text"
                                            value=""/>
                                </div>
                                <div class="sheet-tab-block-body-part-roll-summand">
                                    <input
                                            name="attr_cyberware"
                                            placeholder="0"
                                            title="Cyberware Enhancement"
                                            type="text"
                                            value=""/>
                                </div>
                                <div class="sheet-tab-block-body-part-roll-skill">
                                    <input name="attr_cyberwareTargetName" type="hidden"/>
                                    <select name="attr_cyberwareTarget">
                                        <optgroup label="Statistic">
                                            <option value="statisticIntelligenceSum">Statistic - Intelligence</option>
                                            <option value="statisticReflexesSum">Statistic - Reflexes</option>
                                            <option value="statisticDexteritySum">Statistic - Dexterity</option>
                                            <option value="statisticTechniqueSum">Statistic - Technique</option>
                                            <option value="statisticCoolSum">Statistic - Cool</option>
                                            <option value="statisticWillSum">Statistic - Will</option>
                                            <option value="statisticLuckSum">Statistic - Luck</option>
                                            <option value="statisticMoveSum">Statistic - Move</option>
                                            <option value="statisticBodySum">Statistic - Body</option>
                                            <option value="statisticEmpathySum">Statistic - Empathy</option>
                                        </optgroup>
                                        <optgroup label="Skill">
                                            <option value="skillAthleticsSum">Skill - Athletics</option>
                                            <option value="skillBasicTechSum">Skill - Basic Tech</option>
                                            <option value="skillBrawlingSum">Skill - Brawling</option>
                                            <option value="skillBriberySum">Skill - Bribery</option>
                                            <option value="skillConcentrationSum">Skill - Concentration</option>
                                            <option value="skillConversationSum">Skill - Conversation</option>
                                            <option value="skillCyberTechSum">Skill - Cyber Tech</option>
                                            <option value="skillDrivingSum">Skill - Driving</option>
                                            <option value="skillEducationSum">Skill - Education</option>
                                            <option value="skillEvasionSum">Skill - Evasion</option>
                                            <option value="skillFirstAidSum">Skill - First Aid</option>
                                            <option value="skillHumanPerceptionSum">Skill - Human Perception</option>
                                            <option value="skillInterrogationSum">Skill - Interrogation</option>
                                            <option value="skillLocalExpertSum">Skill - Local Expert</option>
                                            <option value="skillMarksmanshipSum">Skill - Marksmanship</option>
                                            <option value="skillMeleeWeaponSum">Skill - Melee Weapon</option>
                                            <option value="skillPerceptionSum">Skill - Perception</option>
                                            <option value="skillPersuasionSum">Skill - Persuasion</option>
                                            <option value="skillPlayInstrumentSum">Skill - Play Instrument</option>
                                            <option value="skillStealthSum">Skill - Stealth</option>
                                            <option value="skillTrackingSum">Skill - Tracking</option>
                                        </optgroup>
                                        <optgroup label="Attack">
                                            <option value="attackInitiativeSum">Attack - Initiative</option>
                                            <option value="attackReputationSum">Attack - Reputation</option>
                                        </optgroup>
                                    </select>
                                </div>
                                <div class="sheet-tab-block-body-part-roll-name">
                                    <input
                                            name="attr_cyberwareName"
                                            placeholder="Cyberware (that enhances ALL uses of the selected statistic or skill)"
                                            type="text"
                                            value=""/>
                                </div>
                            </div>
                        </fieldset>
                    </div>
                </div>
                <div class="sheet-tab-block sheet-tab-block-cyberware">
                    <div class="sheet-tab-block-head">
                        Cyberware (Situational)
                    </div>
                    <div class="sheet-tab-block-body">
                        <fieldset class="repeating_cyberwareSome">
                            <!--                            @formatter:off-->
                            <input name="attr_rollCyberware"                       type="hidden" value=""/>
                            <input name="attr_rollCyberwareWithDifficulty"         type="hidden" value="&{template:roll-with-difficulty}            {{characterName=@{character_name}}} {{rollName=@{cyberwareName}}}                 {{roll= [[1d10]]}} {{rollNormal= [[1 + 1d8 + @{cyberwareSum}]]}}             {{rollSuccess= [[10 + 1d10 + @{cyberwareSum}]]}} {{rollFailure=[[1 - 1d10 + @{cyberwareSum}]]}}"/>
                            <input name="attr_rollCyberwareWithDifficultyFirstAid" type="hidden" value="&{template:roll-with-difficulty-first-aid}  {{characterName=@{character_name}}} {{rollName=@{cyberwareName}}}                 {{roll= [[1d10]]}} {{rollNormal= [[1 + 1d8 + @{cyberwareSum}]]}}             {{rollSuccess= [[10 + 1d10 + @{cyberwareSum}]]}} {{rollFailure=[[1 - 1d10 + @{cyberwareSum}]]}}"/>
                            <input name="attr_rollCyberwareInitiative"             type="hidden" value="&{template:roll}                            {{characterName=@{character_name}}} {{rollName=@{cyberwareName}}}                 {{roll= [[1d10 + @{cyberwareSum} &{tracker}]]}}"/>
                            <input name="attr_rollCyberwareReputation"             type="hidden" value="&{template:roll}                            {{characterName=@{character_name}}} {{rollName=@{cyberwareName}}}                 {{roll= [[1d10 + @{cyberwareSum} &{tracker}]]}}"/>
                            <!--                            @formatter:on -->
                            <div class="sheet-tab-block-body-part">
                                <div class="sheet-tab-block-body-part-roll-button">
                                    <button
                                            name="roll_cyberware"
                                            tabindex="-1"
                                            title="Roll Cyberware-Enhanced Statistic or Skill"
                                            type="roll"
                                            value="@{rollCyberware}">
                                    </button>
                                </div>
                                <div class="sheet-tab-block-body-part-roll-sum">
                                    <input
                                            name="attr_cyberwareSum"
                                            readonly
                                            tabindex="-1"
                                            title="Cyberware-Enhanced Statistic or Skill Total"
                                            type="text"
                                            value=""/>
                                </div>
                                <div class="sheet-tab-block-body-part-roll-summand">
                                    <input
                                            name="attr_cyberware"
                                            placeholder="0"
                                            title="Cyberware Enhancement"
                                            type="text"
                                            value=""/>
                                </div>
                                <div class="sheet-tab-block-body-part-roll-skill">
                                    <select name="attr_cyberwareTarget">
                                        <optgroup label="Statistic">
                                            <option value="statisticIntelligenceSum">Statistic - Intelligence</option>
                                            <option value="statisticReflexesSum">Statistic - Reflexes</option>
                                            <option value="statisticDexteritySum">Statistic - Dexterity</option>
                                            <option value="statisticTechniqueSum">Statistic - Technique</option>
                                            <option value="statisticCoolSum">Statistic - Cool</option>
                                            <option value="statisticWillSum">Statistic - Will</option>
                                            <option value="statisticLuckSum">Statistic - Luck</option>
                                            <option value="statisticMoveSum">Statistic - Move</option>
                                            <option value="statisticBodySum">Statistic - Body</option>
                                            <option value="statisticEmpathySum">Statistic - Empathy</option>
                                        </optgroup>
                                        <optgroup label="Skill">
                                            <option value="skillAthleticsSum">Skill - Athletics</option>
                                            <option value="skillBasicTechSum">Skill - Basic Tech</option>
                                            <option value="skillBrawlingSum">Skill - Brawling</option>
                                            <option value="skillBriberySum">Skill - Bribery</option>
                                            <option value="skillConcentrationSum">Skill - Concentration</option>
                                            <option value="skillConversationSum">Skill - Conversation</option>
                                            <option value="skillCyberTechSum">Skill - Cyber Tech</option>
                                            <option value="skillDrivingSum">Skill - Driving</option>
                                            <option value="skillEducationSum">Skill - Education</option>
                                            <option value="skillEvasionSum">Skill - Evasion</option>
                                            <option value="skillFirstAidSum">Skill - First Aid</option>
                                            <option value="skillHumanPerceptionSum">Skill - Human Perception</option>
                                            <option value="skillInterrogationSum">Skill - Interrogation</option>
                                            <option value="skillLocalExpertSum">Skill - Local Expert</option>
                                            <option value="skillMarksmanshipSum">Skill - Marksmanship</option>
                                            <option value="skillMeleeWeaponSum">Skill - Melee Weapon</option>
                                            <option value="skillPerceptionSum">Skill - Perception</option>
                                            <option value="skillPersuasionSum">Skill - Persuasion</option>
                                            <option value="skillPlayInstrumentSum">Skill - Play Instrument</option>
                                            <option value="skillStealthSum">Skill - Stealth</option>
                                            <option value="skillTrackingSum">Skill - Tracking</option>
                                        </optgroup>
                                        <optgroup label="Attack">
                                            <option value="attackInitiativeSum">Attack - Initiative</option>
                                            <option value="attackReputationSum">Attack - Reputation</option>
                                        </optgroup>
                                    </select>
                                </div>
                                <div class="sheet-tab-block-body-part-roll-name">
                                    <input
                                            name="attr_cyberwareName"
                                            placeholder="Cyberware (that enhances SOME uses of the selected statistic or skill)"
                                            type="text"
                                            value=""/>
                                </div>
                            </div>
                        </fieldset>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<rolltemplate class="sheet-rolltemplate-roll-death-save">
    <div class="roll-container">
        <div class="roll-character">
            {{#characterName}}{{characterName}}{{/characterName}}
        </div>
        <div class="roll-value-head">
            {{#rollName}}{{rollName}}{{/rollName}}
        </div>
        <div class="roll-value-body">
            <div class="roll-value-body-calculation">
                {{#rollLess() roll target}}
                <div>Success</div>
                {{/rollLess() roll target}}
                {{#^rollLess() roll target}}
                <div>Failure</div>
                {{/^rollLess() roll target}}
            </div>
            <div class="roll-value-body-description">
                {{#rollLess() roll target}}
                <div>{{roll}} < {{body}} - {{deathSave}}</div>
                {{/rollLess() roll target}}
                {{#^rollLess() roll target}}
                <div>{{roll}} &#x2265; {{body}} - {{deathSave}}</div>
                {{/^rollLess() roll target}}
            </div>
        </div>
    </div>
</rolltemplate>
<rolltemplate class="sheet-rolltemplate-roll-with-difficulty">
    <div class="roll-container">
        <div class="roll-character">
            {{#characterName}}{{characterName}}{{/characterName}}
        </div>
        <div class="roll-value-head">
            {{#rollName}}{{rollName}}{{/rollName}}
        </div>
        {{#rollWasCrit() roll}}
        <div class="roll-value-body roll-value-body-success">
            {{rollSuccess}}
        </div>
        <div class="roll-difficulty-head">
            Difficulty
        </div>
        <div class="roll-difficulty-body">
            {{#rollLess() rollSuccess 11}}
            Very, Very Easy
            {{/rollLess() rollSuccess 11}}
            {{#rollBetween() rollSuccess 11 14}}
            Very Easy
            {{/rollBetween() rollSuccess 11 14}}
            {{#rollBetween() rollSuccess 15 18}}
            Easy
            {{/rollBetween() rollSuccess 15 18}}
            {{#rollBetween() rollSuccess 19 22}}
            Medium
            {{/rollBetween() rollSuccess 19 22}}
            {{#rollBetween() rollSuccess 23 25}}
            Hard
            {{/rollBetween() rollSuccess 23 25}}
            {{#rollBetween() rollSuccess 26 30}}
            Very Hard
            {{/rollBetween() rollSuccess 26 30}}
            {{#rollGreater() rollSuccess 30}}
            Very, Very Hard
            {{/rollGreater() rollSuccess 30}}
        </div>
        {{/rollWasCrit() roll}}
        {{#rollWasFumble() roll}}
        <div class="roll-value-body roll-value-body-failure">
            {{rollFailure}}
        </div>
        <div class="roll-difficulty-head">
            Difficulty
        </div>
        <div class="roll-difficulty-body">
            {{#rollLess() rollFailure 11}}
            Very, Very Easy
            {{/rollLess() rollFailure 11}}
            {{#rollBetween() rollFailure 11 14}}
            Very Easy
            {{/rollBetween() rollFailure 11 14}}
            {{#rollBetween() rollFailure 15 18}}
            Easy
            {{/rollBetween() rollFailure 15 18}}
            {{#rollBetween() rollFailure 19 22}}
            Medium
            {{/rollBetween() rollFailure 19 22}}
            {{#rollBetween() rollFailure 23 25}}
            Hard
            {{/rollBetween() rollFailure 23 25}}
            {{#rollBetween() rollFailure 26 30}}
            Very Hard
            {{/rollBetween() rollFailure 26 30}}
            {{#rollGreater() rollFailure 30}}
            Very, Very Hard
            {{/rollGreater() rollFailure 30}}
        </div>
        {{/rollWasFumble() roll}}
        {{#rollBetween() roll 2 9}}
        <div class="roll-value-body">
            {{rollNormal}}
        </div>
        <div class="roll-difficulty-head">
            Difficulty
        </div>
        <div class="roll-difficulty-body">
            {{#rollLess() rollNormal 11}}
            Very, Very Easy
            {{/rollLess() rollNormal 11}}
            {{#rollBetween() rollNormal 11 14}}
            Very Easy
            {{/rollBetween() rollNormal 11 14}}
            {{#rollBetween() rollNormal 15 18}}
            Easy
            {{/rollBetween() rollNormal 15 18}}
            {{#rollBetween() rollNormal 19 22}}
            Medium
            {{/rollBetween() rollNormal 19 22}}
            {{#rollBetween() rollNormal 23 25}}
            Hard
            {{/rollBetween() rollNormal 23 25}}
            {{#rollBetween() rollNormal 26 30}}
            Very Hard
            {{/rollBetween() rollNormal 26 30}}
            {{#rollGreater() rollNormal 30}}
            Very, Very Hard
            {{/rollGreater() rollNormal 30}}
        </div>
        {{/rollBetween() roll 2 9}}
    </div>
</rolltemplate>
<rolltemplate class="sheet-rolltemplate-roll-with-difficulty-first-aid">
    <div class="roll-container">
        <div class="roll-character">
            {{#characterName}}{{characterName}}{{/characterName}}
        </div>
        <div class="roll-value-head">
            {{#rollName}}{{rollName}}{{/rollName}}
        </div>
        {{#rollWasCrit() roll}}
        <div class="roll-value-body roll-value-body-success">
            {{rollSuccess}}
        </div>
        <div class="roll-difficulty-head">
            Difficulty
        </div>
        <div class="roll-difficulty-body">
            {{#rollLess() rollSuccess 11}}
            Very, Very Easy
            {{/rollLess() rollSuccess 11}}
            {{#rollBetween() rollSuccess 11 14}}
            Very Easy
            {{/rollBetween() rollSuccess 11 14}}
            {{#rollBetween() rollSuccess 15 18}}
            Easy
            {{/rollBetween() rollSuccess 15 18}}
            {{#rollBetween() rollSuccess 19 22}}
            Medium
            {{/rollBetween() rollSuccess 19 22}}
            {{#rollBetween() rollSuccess 23 25}}
            Hard
            {{/rollBetween() rollSuccess 23 25}}
            {{#rollBetween() rollSuccess 26 30}}
            Very Hard
            {{/rollBetween() rollSuccess 26 30}}
            {{#rollGreater() rollSuccess 30}}
            Very, Very Hard
            {{/rollGreater() rollSuccess 30}}
            {{#rollLess() rollSuccess 11}}
            / Heals No Wounds
            {{/rollLess() rollSuccess 11}}
            {{#rollBetween() rollSuccess 11 13}}
            / Heals Light Wounds
            {{/rollBetween() rollSuccess 11 13}}
            {{#rollBetween() rollSuccess 14 15}}
            / Heals Serious Wounds
            {{/rollBetween() rollSuccess 14 15}}
            {{#rollGreater() rollSuccess 15}}
            / Heals Mortal Wounds
            {{/rollGreater() rollSuccess 15}}
        </div>
        {{/rollWasCrit() roll}}
        {{#rollWasFumble() roll}}
        <div class="roll-value-body roll-value-body-failure">
            {{rollFailure}}
        </div>
        <div class="roll-difficulty-head">
            Difficulty
        </div>
        <div class="roll-difficulty-body">
            {{#rollLess() rollFailure 11}}
            Very, Very Easy
            {{/rollLess() rollFailure 11}}
            {{#rollBetween() rollFailure 11 14}}
            Very Easy
            {{/rollBetween() rollFailure 11 14}}
            {{#rollBetween() rollFailure 15 18}}
            Easy
            {{/rollBetween() rollFailure 15 18}}
            {{#rollBetween() rollFailure 19 22}}
            Medium
            {{/rollBetween() rollFailure 19 22}}
            {{#rollBetween() rollFailure 23 25}}
            Hard
            {{/rollBetween() rollFailure 23 25}}
            {{#rollBetween() rollFailure 26 30}}
            Very Hard
            {{/rollBetween() rollFailure 26 30}}
            {{#rollGreater() rollFailure 30}}
            Very, Very Hard
            {{/rollGreater() rollFailure 30}}

            {{#rollLess() rollFailure 11}}
            / Heals No Wounds
            {{/rollLess() rollFailure 11}}
            {{#rollBetween() rollFailure 11 13}}
            / Heals Light Wounds
            {{/rollBetween() rollFailure 11 13}}
            {{#rollBetween() rollFailure 14 15}}
            / Heals Serious Wounds
            {{/rollBetween() rollFailure 14 15}}
            {{#rollGreater() rollFailure 15}}
            / Heals Mortal Wounds
            {{/rollGreater() rollFailure 15}}
        </div>
        {{/rollWasFumble() roll}}
        {{#rollBetween() roll 2 9}}
        <div class="roll-value-body">
            {{rollNormal}}
        </div>
        <div class="roll-difficulty-head">
            Difficulty
        </div>
        <div class="roll-difficulty-body">
            {{#rollLess() rollNormal 11}}
            Very, Very Easy
            {{/rollLess() rollNormal 11}}
            {{#rollBetween() rollNormal 11 14}}
            Very Easy
            {{/rollBetween() rollNormal 11 14}}
            {{#rollBetween() rollNormal 15 18}}
            Easy
            {{/rollBetween() rollNormal 15 18}}
            {{#rollBetween() rollNormal 19 22}}
            Medium
            {{/rollBetween() rollNormal 19 22}}
            {{#rollBetween() rollNormal 23 25}}
            Hard
            {{/rollBetween() rollNormal 23 25}}
            {{#rollBetween() rollNormal 26 30}}
            Very Hard
            {{/rollBetween() rollNormal 26 30}}
            {{#rollGreater() rollNormal 30}}
            Very, Very Hard
            {{/rollGreater() rollNormal 30}}

            {{#rollLess() rollNormal 11}}
            / Heals No Wounds
            {{/rollLess() rollNormal 11}}
            {{#rollBetween() rollNormal 11 13}}
            / Heals Light Wounds
            {{/rollBetween() rollNormal 11 13}}
            {{#rollBetween() rollNormal 14 15}}
            / Heals Serious Wounds
            {{/rollBetween() rollNormal 14 15}}
            {{#rollGreater() rollNormal 15}}
            / Heals Mortal Wounds
            {{/rollGreater() rollNormal 15}}
        </div>
        {{/rollBetween() roll 2 9}}
    </div>
</rolltemplate>
<rolltemplate class="sheet-rolltemplate-roll-without-difficulty">
    <div class="roll-container">
        <div class="roll-character">
            {{#characterName}}{{characterName}}{{/characterName}}
        </div>
        <div class="roll-value-head">
            {{#rollName}}{{rollName}}{{/rollName}}
        </div>
        {{#rollWasCrit() roll}}
        <div class="roll-value-body roll-value-body-success">
            {{rollSuccess}}
        </div>
        {{/rollWasCrit() roll}}
        {{#rollWasFumble() roll}}
        <div class="roll-value-body roll-value-body-failure">
            {{rollFailure}}
        </div>
        {{/rollWasFumble() roll}}
        {{#rollBetween() roll 2 9}}
        <div class="roll-value-body">
            {{rollNormal}}
        </div>
        {{/rollBetween() roll 2 9}}
    </div>
</rolltemplate>
<rolltemplate class="sheet-rolltemplate-roll">
    <div class="roll-container">
        <div class="roll-character">
            {{#characterName}}{{characterName}}{{/characterName}}
        </div>
        <div class="roll-value-head">
            {{#rollName}}{{rollName}}{{/rollName}}
        </div>
        <div class="roll-value-body">
            {{roll}}
        </div>
    </div>
</rolltemplate>
<rolltemplate class="sheet-rolltemplate-roll-attack-melee">
    <div class="roll-container">
        <div class="roll-character">
            {{#characterName}}{{characterName}}{{/characterName}}
        </div>
        <div class="roll-value-head">
            {{#rollName}}{{rollName}}{{/rollName}}
        </div>
        <div class="roll-value-body-container">
            {{#rollWasCrit() roll1}}
            <div class="roll-value-body roll-value-body-success">
                {{rollSuccess1}}
            </div>
            {{/rollWasCrit() roll1}}
            {{#rollWasFumble() roll1}}
            <div class="roll-value-body roll-value-body-failure">
                {{rollFailure1}}
            </div>
            {{/rollWasFumble() roll1}}
            {{#rollBetween() roll1 2 9}}
            <div class="roll-value-body">
                {{rollNormal1}}
            </div>
            {{/rollBetween() roll1 2 9}}
            {{#rollWasCrit() roll2}}
            <div class="roll-value-body roll-value-body-success">
                {{rollSuccess2}}
            </div>
            {{/rollWasCrit() roll2}}
            {{#rollWasFumble() roll2}}
            <div class="roll-value-body roll-value-body-failure">
                {{rollFailure2}}
            </div>
            {{/rollWasFumble() roll2}}
            {{#rollBetween() roll2 2 9}}
            <div class="roll-value-body">
                {{rollNormal2}}
            </div>
            {{/rollBetween() roll2 2 9}}
        </div>
        <div class="roll-damage-head">
            Damage
        </div>
        <div class="roll-damage-body">
            <div class="roll-damage">
                {{rollDamage1}}
            </div>
            <div class="roll-damage">
                {{rollDamage2}}
            </div>
        </div>
    </div>
</rolltemplate>
<rolltemplate class="sheet-rolltemplate-roll-attack-ranged-1">
    <div class="roll-container">
        <div class="roll-character">
            {{#characterName}}{{characterName}}{{/characterName}}
        </div>
        <div class="roll-value-head">
            {{#rollName}}{{rollName}}{{/rollName}}
        </div>
        {{#rollWasCrit() roll}}
        <div class="roll-value-body roll-value-body-success">
            {{rollSuccess}}
        </div>
        {{/rollWasCrit() roll}}
        {{#rollWasFumble() roll}}
        <div class="roll-value-body roll-value-body-failure">
            {{rollFailure}}
        </div>
        {{/rollWasFumble() roll}}
        {{#rollBetween() roll 2 9}}
        <div class="roll-value-body">
            {{rollNormal}}
        </div>
        {{/rollBetween() roll 2 9}}
        <div class="roll-difficulty-head">
            Difficulty
        </div>
        <div class="roll-difficulty-body">
            <div class="roll-difficulty-range">
                <div class="roll-difficulty-range-head">
                    12
                </div>
                <div class="roll-difficulty-range-body">
                    {{rollDifficulty012}}
                </div>
            </div>
            <div class="roll-difficulty-range">
                <div class="roll-difficulty-range-head">
                    25
                </div>
                <div class="roll-difficulty-range-body">
                    {{rollDifficulty025}}
                </div>
            </div>
            <div class="roll-difficulty-range">
                <div class="roll-difficulty-range-head">
                    50
                </div>
                <div class="roll-difficulty-range-body">
                    {{rollDifficulty050}}
                </div>
            </div>
            <div class="roll-difficulty-range">
                <div class="roll-difficulty-range-head">
                    100
                </div>
                <div class="roll-difficulty-range-body">
                    {{rollDifficulty100}}
                </div>
            </div>
            <div class="roll-difficulty-range">
                <div class="roll-difficulty-range-head">
                    200
                </div>
                <div class="roll-difficulty-range-body">
                    {{rollDifficulty200}}
                </div>
            </div>
            <div class="roll-difficulty-range">
                <div class="roll-difficulty-range-head">
                    400
                </div>
                <div class="roll-difficulty-range-body">
                    {{rollDifficulty400}}
                </div>
            </div>
            <div class="roll-difficulty-range">
                <div class="roll-difficulty-range-head">
                    800
                </div>
                <div class="roll-difficulty-range-body">
                    {{rollDifficulty800}}
                </div>
            </div>
        </div>
        <div class="roll-damage-head">
            Damage
        </div>
        <div class="roll-damage-body">
            <div class="roll-damage">
                {{rollDamage1}}
            </div>
        </div>
    </div>
</rolltemplate>
<rolltemplate class="sheet-rolltemplate-roll-attack-ranged-3">
    <div class="roll-container">
        <div class="roll-character">
            {{#characterName}}{{characterName}}{{/characterName}}
        </div>
        <div class="roll-value-head">
            {{#rollName}}{{rollName}}{{/rollName}}
        </div>
        {{#rollWasCrit() roll}}
        <div class="roll-value-body roll-value-body-success">
            {{rollSuccess}}
        </div>
        {{/rollWasCrit() roll}}
        {{#rollWasFumble() roll}}
        <div class="roll-value-body roll-value-body-failure">
            {{rollFailure}}
        </div>
        {{/rollWasFumble() roll}}
        {{#rollBetween() roll 2 9}}
        <div class="roll-value-body">
            {{rollNormal}}
        </div>
        {{/rollBetween() roll 2 9}}
        <div class="roll-difficulty-head">
            Difficulty
        </div>
        <div class="roll-difficulty-body">
            <div class="roll-difficulty-range">
                <div class="roll-difficulty-range-head">
                    12
                </div>
                <div class="roll-difficulty-range-body">
                    {{rollDifficulty012}}
                </div>
            </div>
            <div class="roll-difficulty-range">
                <div class="roll-difficulty-range-head">
                    25
                </div>
                <div class="roll-difficulty-range-body">
                    {{rollDifficulty025}}
                </div>
            </div>
            <div class="roll-difficulty-range">
                <div class="roll-difficulty-range-head">
                    50
                </div>
                <div class="roll-difficulty-range-body">
                    {{rollDifficulty050}}
                </div>
            </div>
            <div class="roll-difficulty-range">
                <div class="roll-difficulty-range-head">
                    100
                </div>
                <div class="roll-difficulty-range-body">
                    {{rollDifficulty100}}
                </div>
            </div>
        </div>
        <div class="roll-damage-head">
            Damage
        </div>
        <div class="roll-damage-body">
            <div class="roll-damage">
                {{rollDamage1}}
            </div>
            <div class="roll-damage">
                {{rollDamage2}}
            </div>
            <div class="roll-damage">
                {{rollDamage3}}
            </div>
        </div>
    </div>
</rolltemplate>
<script type="text/worker">
"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({__proto__: []} instanceof Array && function (d, b) {
                d.__proto__ = b;
            }) ||
            function (d, b) {
                for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];
            };
        return extendStatics(d, b);
    };
    return function (d, b) {
        if (typeof b !== "function" && b !== null)
            throw new TypeError("Class extends value " + String(b) + " is not a constructor or null");
        extendStatics(d, b);

        function __() {
            this.constructor = d;
        }

        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var Utility;
(function (Utility) {
    function require(value, message) {
        if (value === undefined || value === null) {
            throw new Error(message);
        } else {
            return value;
        }
    }

    Utility.require = require;
    var Ordering;
    (function (Ordering) {
        Ordering[Ordering["LT"] = -1] = "LT";
        Ordering[Ordering["GT"] = 1] = "GT";
        Ordering[Ordering["EQ"] = 0] = "EQ";
    })(Ordering = Utility.Ordering || (Utility.Ordering = {}));

    function stringOrd(v1, v2) {
        require(v1, "v1");
        require(v2, "v2");
        return v1.localeCompare(v2);
    }

    Utility.stringOrd = stringOrd;
    var Maybe = /** @class */ (function () {
        function Maybe() {
        }

        Maybe.Eq = function (eq) {
            require(eq, "eq");
            return function (v1, v2) {
                require(v1, "v1");
                require(v2, "v2");
                return v1.match(function () {
                    return v2.match(function () {
                        return true;
                    }, function (valueInner) {
                        return false;
                    });
                }, function (value) {
                    return v2.match(function () {
                        return false;
                    }, function (valueInner) {
                        return eq(value, valueInner);
                    });
                });
            };
        };
        Maybe.prototype.map = function (f) {
            require(f, "f");
            return this.match(function () {
                return nothing();
            }, function (value) {
                return just(f(value));
            });
        };
        Maybe.prototype.bind = function (f) {
            require(f, "f");
            return this.match(function () {
                return nothing();
            }, function (value) {
                return f(value);
            });
        };
        Maybe.prototype.orValue = function (value) {
            return this.match(function () {
                return value;
            }, function (value) {
                return value;
            });
        };
        Maybe.prototype.orMaybe = function (maybe) {
            require(maybe, "maybe");
            return this.match(function () {
                return maybe;
            }, function (value) {
                return just(value);
            });
        };
        Maybe.prototype.sequenceRight = function (f) {
            return f(this);
        };
        Maybe.prototype.sequenceLeft = function (f) {
            f(this);
            return this;
        };
        return Maybe;
    }());
    Utility.Maybe = Maybe;
    var Nothing = /** @class */ (function (_super) {
        __extends(Nothing, _super);

        function Nothing() {
            return _super !== null && _super.apply(this, arguments) || this;
        }

        Nothing.prototype.match = function (fNothing, fJust) {
            require(fNothing, "fNothing");
            require(fJust, "fJust");
            return fNothing();
        };
        return Nothing;
    }(Maybe));
    Utility.Nothing = Nothing;

    function nothing() {
        return new Nothing();
    }

    Utility.nothing = nothing;
    var Just = /** @class */ (function (_super) {
        __extends(Just, _super);

        function Just(value) {
            var _this = _super.call(this) || this;
            _this.value = value;
            return _this;
        }

        Just.prototype.match = function (fNothing, fJust) {
            require(fNothing, "fNothing");
            require(fJust, "fJust");
            return fJust(this.value);
        };
        return Just;
    }(Maybe));
    Utility.Just = Just;

    function just(value) {
        return new Just(value);
    }

    Utility.just = just;

    function deduplicate(arrayOuter, ord) {
        require(arrayOuter, "arrayOuter");
        require(ord, "ord");
        return arrayOuter
            .sort(ord)
            .reduce(function (array, element) {
                return array.length === 0 || ord(array[array.length - 1], element) !== Ordering.EQ ?
                    array.concat(element) :
                    array;
            }, []);
    }

    Utility.deduplicate = deduplicate;

    function assign(record, key, value) {
        require(record, "record");
        require(key, "key");
        record[key] = value;
        return record;
    }

    Utility.assign = assign;

    function serializerDeserializer(serialize, deserialize) {
        require(serialize, "serialize");
        require(deserialize, "deserialize");
        return new /** @class */ (function () {
            function class_1() {
            }

            class_1.prototype.deserialize = function (value) {
                return deserialize(value);
            };
            class_1.prototype.serialize = function (value) {
                return serialize(value);
            };
            return class_1;
        }());
    }

    Utility.serializerDeserializer = serializerDeserializer;
    Utility.serializerDeserializerInteger = serializerDeserializer(function (number) {
        return just(number.toString());
    }, function (string) {
        return isNaN(parseInt(string)) ? nothing() : just(parseInt(string));
    });
    Utility.serializerDeserializerString = serializerDeserializer(function (string) {
        return just(string);
    }, function (string) {
        return just(string);
    });
    Utility.serializerDeserializerBoolean = serializerDeserializer(function (boolean) {
        return just(boolean.toString());
    }, function (string) {
        return string === "true" ? just(true) : string === "false" ? just(false) : nothing();
    });
})(Utility || (Utility = {}));
/// <reference path="./utility.ts"/>
/// <reference path="./roll20.d.ts"/>
var __assign = (this && this.__assign) || function () {
    __assign = Object.assign || function (t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
var Roll20Layer1;
(function (Roll20Layer1) {
    var Ordering = Utility.Ordering;
    var assign = Utility.assign;
    var deduplicate = Utility.deduplicate;
    var just = Utility.just;
    var nothing = Utility.nothing;
    var require = Utility.require;

    function onOpen(callback) {
        require(callback, "callback");
        on("sheet:opened", callback);
    }

    Roll20Layer1.onOpen = onOpen;

    function onDrop(callback) {
        require(callback, "callback");
        on("sheet:compendium_drop", callback);
    }

    Roll20Layer1.onDrop = onDrop;

    function ReferenceSourceValueEq(v1, v2) {
        require(v1, "v1");
        require(v2, "v2");
        return v1.matchSourceValue(function (attributeName) {
            return v2.matchSourceValue(function (attributeNameInner) {
                return ReferenceAttribute.eq(referenceAttribute(attributeName), referenceAttribute(attributeNameInner));
            }, function (repeatingName, repeatingId, attributeName) {
                return false;
            });
        }, function (repeatingName, repeatingId, attributeName) {
            return v2.matchSourceValue(function (attributeNameInner) {
                return false;
            }, function (repeatingNameInner, repeatingIdInner, attributeNameInner) {
                return ReferenceRepeatingIdAttribute.eq(referenceRepeatingIdAttribute(repeatingName, repeatingId, attributeName), referenceRepeatingIdAttribute(repeatingNameInner, repeatingIdInner, attributeNameInner));
            });
        });
    }

    Roll20Layer1.ReferenceSourceValueEq = ReferenceSourceValueEq;

    function ReferenceSourceValueOrd(v1, v2) {
        require(v1, "v1");
        require(v2, "v2");
        return v1.matchSourceValue(function (attributeName) {
            return v2.matchSourceValue(function (attributeNameInner) {
                return ReferenceAttribute.ord(referenceAttribute(attributeName), referenceAttribute(attributeNameInner));
            }, function (repeatingName, repeatingId, attributeName) {
                return Ordering.LT;
            });
        }, function (repeatingName, repeatingId, attributeName) {
            return v2.matchSourceValue(function (attributeNameInner) {
                return Ordering.GT;
            }, function (repeatingNameInner, repeatingIdInner, attributeNameInner) {
                return ReferenceRepeatingIdAttribute.ord(referenceRepeatingIdAttribute(repeatingName, repeatingId, attributeName), referenceRepeatingIdAttribute(repeatingNameInner, repeatingIdInner, attributeNameInner));
            });
        });
    }

    Roll20Layer1.ReferenceSourceValueOrd = ReferenceSourceValueOrd;
    var ReferenceAttribute = /** @class */ (function () {
        function ReferenceAttribute(attributeName) {
            require(attributeName, "attributeName");
            this.attributeName = attributeName.toLowerCase();
        }

        ReferenceAttribute.prototype.matchSourceChange = function (fReferenceAttribute, fReferenceRepeating, fReferenceRepeatingAttribute, fReferenceRepeatingIdAttribute) {
            require(fReferenceAttribute, "fReferenceAttribute");
            require(fReferenceRepeating, "fReferenceRepeating");
            require(fReferenceRepeatingAttribute, "fReferenceRepeatingAttribute");
            require(fReferenceRepeatingIdAttribute, "fReferenceRepeatingIdAttribute");
            return fReferenceAttribute(this.attributeName);
        };
        ReferenceAttribute.prototype.matchSourceValue = function (fReferenceAttribute, fReferenceRepeatingIdAttribute) {
            require(fReferenceAttribute, "fReferenceAttribute");
            require(fReferenceRepeatingIdAttribute, "fReferenceRepeatingIdAttribute");
            return fReferenceAttribute(this.attributeName);
        };
        ReferenceAttribute.prototype.toReferenceRepeatingAttribute = function (repeatingName) {
            require(repeatingName, "repeatingName");
            return referenceRepeatingAttribute(repeatingName, this.attributeName);
        };
        ReferenceAttribute.eq = function (v1, v2) {
            require(v1, "v1");
            require(v2, "v2");
            return v1.attributeName === v2.attributeName;
        };
        ReferenceAttribute.ord = function (v1, v2) {
            require(v1, "v1");
            require(v2, "v2");
            return (function (value) {
                return value === -1 ?
                    Ordering.LT :
                    value === 0 ?
                        Ordering.EQ :
                        Ordering.GT;
            })(v1.attributeName.localeCompare(v2.attributeName));
        };
        return ReferenceAttribute;
    }());
    Roll20Layer1.ReferenceAttribute = ReferenceAttribute;

    function referenceAttribute(attributeName) {
        return new ReferenceAttribute(attributeName);
    }

    Roll20Layer1.referenceAttribute = referenceAttribute;
    var ReferenceRepeating = /** @class */ (function () {
        function ReferenceRepeating(repeatingName) {
            require(repeatingName, "repeatingName");
            this.repeatingName = repeatingName.toLowerCase();
        }

        ReferenceRepeating.prototype.matchSourceChange = function (fReferenceAttribute, fReferenceRepeating, fReferenceRepeatingAttribute, fReferenceRepeatingIdAttribute) {
            require(fReferenceAttribute, "fReferenceAttribute");
            require(fReferenceRepeating, "fReferenceRepeating");
            require(fReferenceRepeatingAttribute, "fReferenceRepeatingAttribute");
            require(fReferenceRepeatingIdAttribute, "fReferenceRepeatingIdAttribute");
            return fReferenceRepeating(this.repeatingName);
        };
        ReferenceRepeating.prototype.toReferenceRepeatingAttribute = function (attributeName) {
            require(attributeName, "attributeName");
            return referenceRepeatingAttribute(this.repeatingName, attributeName);
        };
        ReferenceRepeating.prototype.toReferenceRepeatingId = function (repeatingId) {
            require(repeatingId, "repeatingId");
            return referenceRepeatingId(this.repeatingName, repeatingId);
        };
        ReferenceRepeating.eq = function (v1, v2) {
            require(v1, "v1");
            require(v2, "v2");
            return v1.repeatingName === v2.repeatingName;
        };
        ReferenceRepeating.ord = function (v1, v2) {
            require(v1, "v1");
            require(v2, "v2");
            return (function (value) {
                return value === -1 ?
                    Ordering.LT :
                    value === 0 ?
                        Ordering.EQ :
                        Ordering.GT;
            })(v1.repeatingName.localeCompare(v2.repeatingName));
        };
        return ReferenceRepeating;
    }());
    Roll20Layer1.ReferenceRepeating = ReferenceRepeating;

    function referenceRepeating(repeatingName) {
        return new ReferenceRepeating(repeatingName);
    }

    Roll20Layer1.referenceRepeating = referenceRepeating;
    var ReferenceRepeatingAttribute = /** @class */ (function () {
        function ReferenceRepeatingAttribute(repeatingName, attributeName) {
            require(repeatingName, "repeatingName");
            require(attributeName, "attributeName");
            this.repeatingName = repeatingName.toLowerCase();
            this.attributeName = attributeName.toLowerCase();
        }

        ReferenceRepeatingAttribute.prototype.matchSourceChange = function (fReferenceAttribute, fReferenceRepeating, fReferenceRepeatingAttribute, fReferenceRepeatingIdAttribute) {
            require(fReferenceAttribute, "fReferenceAttribute");
            require(fReferenceRepeating, "fReferenceRepeating");
            require(fReferenceRepeatingAttribute, "fReferenceRepeatingAttribute");
            require(fReferenceRepeatingIdAttribute, "fReferenceRepeatingIdAttribute");
            return fReferenceRepeatingAttribute(this.repeatingName, this.attributeName);
        };
        ReferenceRepeatingAttribute.prototype.toReferenceAttribute = function () {
            return referenceAttribute(this.attributeName);
        };
        ReferenceRepeatingAttribute.prototype.toReferenceRepeating = function () {
            return referenceRepeating(this.repeatingName);
        };
        ReferenceRepeatingAttribute.prototype.toReferenceRepeatingIdAttribute = function (repeatingId) {
            require(repeatingId, "repeatingId");
            return referenceRepeatingIdAttribute(this.repeatingName, repeatingId, this.attributeName);
        };
        ReferenceRepeatingAttribute.eq = function (v1, v2) {
            require(v1, "v1");
            require(v2, "v2");
            return v1.repeatingName === v2.repeatingName &&
                v1.attributeName === v2.attributeName;
        };
        ReferenceRepeatingAttribute.ord = function (v1, v2) {
            require(v1, "v1");
            require(v2, "v2");
            return (function (value) {
                return value === 0 ?
                    (function (value) {
                        return value === -1 ?
                            Ordering.LT :
                            value === 0 ?
                                Ordering.EQ :
                                Ordering.GT;
                    })(v1.attributeName.localeCompare(v2.attributeName)) :
                    value;
            })(ReferenceRepeating.ord(v1.toReferenceRepeating(), v2.toReferenceRepeating()));
        };
        return ReferenceRepeatingAttribute;
    }());
    Roll20Layer1.ReferenceRepeatingAttribute = ReferenceRepeatingAttribute;

    function referenceRepeatingAttribute(repeatingName, attributeName) {
        return new ReferenceRepeatingAttribute(repeatingName, attributeName);
    }

    Roll20Layer1.referenceRepeatingAttribute = referenceRepeatingAttribute;
    var ReferenceRepeatingId = /** @class */ (function () {
        function ReferenceRepeatingId(repeatingName, repeatingId) {
            require(repeatingName, "repeatingName");
            require(repeatingId, "repeatingId");
            this.repeatingName = repeatingName.toLowerCase();
            this.repeatingId = repeatingId.toLowerCase();
        }

        ReferenceRepeatingId.prototype.toReferenceRepeating = function () {
            return referenceRepeating(this.repeatingName);
        };
        ReferenceRepeatingId.prototype.toReferenceRepeatingIdAttribute = function (attributeName) {
            require(attributeName, "attributeName");
            return referenceRepeatingIdAttribute(this.repeatingName, this.repeatingId, attributeName);
        };
        ReferenceRepeatingId.eq = function (v1, v2) {
            require(v1, "v1");
            require(v2, "v2");
            return v1.repeatingName === v2.repeatingName &&
                v1.repeatingId === v2.repeatingId;
        };
        ReferenceRepeatingId.ord = function (v1, v2) {
            require(v1, "v1");
            require(v2, "v2");
            return (function (value) {
                return value === 0 ?
                    (function (value) {
                        return value === -1 ?
                            Ordering.LT :
                            value === 0 ?
                                Ordering.EQ :
                                Ordering.GT;
                    })(v1.repeatingId.localeCompare(v2.repeatingId)) :
                    value;
            })(ReferenceRepeating.ord(v1.toReferenceRepeating(), v2.toReferenceRepeating()));
        };
        return ReferenceRepeatingId;
    }());
    Roll20Layer1.ReferenceRepeatingId = ReferenceRepeatingId;

    function referenceRepeatingId(repeatingName, repeatingId) {
        return new ReferenceRepeatingId(repeatingName, repeatingId);
    }

    Roll20Layer1.referenceRepeatingId = referenceRepeatingId;
    var ReferenceRepeatingIdAttribute = /** @class */ (function () {
        function ReferenceRepeatingIdAttribute(repeatingName, repeatingId, attributeName) {
            require(repeatingName, "repeatingName");
            require(repeatingId, "repeatingId");
            require(attributeName, "attributeName");
            this.repeatingName = repeatingName.toLowerCase();
            this.repeatingId = repeatingId.toLowerCase();
            this.attributeName = attributeName.toLowerCase();
        }

        ReferenceRepeatingIdAttribute.prototype.matchSourceChange = function (fReferenceAttribute, fReferenceRepeating, fReferenceRepeatingAttribute, fReferenceRepeatingIdAttribute) {
            require(fReferenceAttribute, "fReferenceAttribute");
            require(fReferenceRepeating, "fReferenceRepeating");
            require(fReferenceRepeatingAttribute, "fReferenceRepeatingAttribute");
            require(fReferenceRepeatingIdAttribute, "fReferenceRepeatingIdAttribute");
            return fReferenceRepeatingIdAttribute(this.repeatingName, this.repeatingId, this.attributeName);
        };
        ReferenceRepeatingIdAttribute.prototype.matchSourceValue = function (fReferenceAttribute, fReferenceRepeatingIdAttribute) {
            require(fReferenceAttribute, "fReferenceAttribute");
            require(fReferenceRepeatingIdAttribute, "fReferenceRepeatingIdAttribute");
            return fReferenceRepeatingIdAttribute(this.repeatingName, this.repeatingId, this.attributeName);
        };
        ReferenceRepeatingIdAttribute.prototype.toReferenceRepeatingId = function () {
            return referenceRepeatingId(this.repeatingName, this.repeatingId);
        };
        ReferenceRepeatingIdAttribute.prototype.toReferenceRepeatingAttribute = function () {
            return referenceRepeatingAttribute(this.repeatingName, this.attributeName);
        };
        ReferenceRepeatingIdAttribute.eq = function (v1, v2) {
            require(v1, "v1");
            require(v2, "v2");
            return v1.repeatingName === v2.repeatingName &&
                v1.repeatingId === v2.repeatingId &&
                v1.attributeName === v2.attributeName;
        };
        ReferenceRepeatingIdAttribute.ord = function (v1, v2) {
            require(v1, "v1");
            require(v2, "v2");
            return (function (value) {
                return value === 0 ?
                    (function (value) {
                        return value === -1 ?
                            Ordering.LT :
                            value === 0 ?
                                Ordering.EQ :
                                Ordering.GT;
                    })(v1.repeatingId.localeCompare(v2.repeatingId)) :
                    value;
            })(ReferenceRepeatingAttribute.ord(v1.toReferenceRepeatingAttribute(), v2.toReferenceRepeatingAttribute()));
        };
        return ReferenceRepeatingIdAttribute;
    }());
    Roll20Layer1.ReferenceRepeatingIdAttribute = ReferenceRepeatingIdAttribute;

    function referenceRepeatingIdAttributeFromString(string) {
        var beforeId = string.lastIndexOf("_", string.lastIndexOf("_") - 1);
        var beforeAttribute = string.lastIndexOf("_");
        return referenceRepeatingIdAttribute(string.substring("repeating_".length, beforeId), string.substring(beforeId + 1, beforeAttribute), string.substring(beforeAttribute + 1));
    }

    function referenceRepeatingIdAttribute(repeatingName, repeatingId, attributeName) {
        return new ReferenceRepeatingIdAttribute(repeatingName, repeatingId, attributeName);
    }

    Roll20Layer1.referenceRepeatingIdAttribute = referenceRepeatingIdAttribute;
    var ReferenceAct = /** @class */ (function () {
        function ReferenceAct(actName) {
            require(actName, "actName");
            this.actName = actName.toLowerCase();
        }

        ReferenceAct.eq = function (v1, v2) {
            require(v1, "v1");
            require(v2, "v2");
            return v1.actName === v2.actName;
        };
        ReferenceAct.ord = function (v1, v2) {
            require(v1, "v1");
            require(v2, "v2");
            return (function (value) {
                return value === -1 ?
                    Ordering.LT :
                    value === 0 ?
                        Ordering.EQ :
                        Ordering.GT;
            })(v1.actName.localeCompare(v2.actName));
        };
        return ReferenceAct;
    }());
    Roll20Layer1.ReferenceAct = ReferenceAct;

    function referenceAct(actName) {
        return new ReferenceAct(actName);
    }

    Roll20Layer1.referenceAct = referenceAct;
    var EventClick = /** @class */ (function () {
        function EventClick(source) {
            require(source, "source");
            this.source = source;
        }

        EventClick.prototype.withSource = function (source) {
            require(source, "source");
            return new EventClick(source);
        };
        return EventClick;
    }());
    Roll20Layer1.EventClick = EventClick;

    function eventClickString(reference) {
        return "clicked:" + reference.actName;
    }

    function onClick(reference, callback) {
        require(reference, "reference");
        require(callback, "callback");
        on(eventClickString(reference), function (event) {
            return callback(new EventClick(reference));
        });
    }

    Roll20Layer1.onClick = onClick;
    var EventReorder = /** @class */ (function () {
        function EventReorder(source, sourceType) {
            require(source, "source");
            require(sourceType, "sourceType");
            this.source = source;
            this.sourceType = sourceType;
        }

        EventReorder.prototype.withSource = function (source) {
            require(source, "source");
            return new EventReorder(source, this.sourceType);
        };
        return EventReorder;
    }());
    Roll20Layer1.EventReorder = EventReorder;

    function eventReorderString(reference) {
        return "change:_reporder:" + reference.repeatingName;
    }

    function onReorder(referenceArray, callback) {
        require(referenceArray, "referenceArray");
        require(callback, "callback");
        referenceArray.map(function (reference) {
            return on(eventReorderString(reference), function (event) {
                return callback(new EventReorder(reference, event.sourceType));
            });
        });
    }

    Roll20Layer1.onReorder = onReorder;
    var EventRemove = /** @class */ (function () {
        function EventRemove(source, sourceType, sourceRow) {
            require(source, "source");
            require(sourceType, "sourceType");
            require(sourceRow, "sourceRow");
            this.source = source;
            this.sourceType = sourceType;
            this.sourceRow = sourceRow;
        }

        EventRemove.prototype.withSource = function (source) {
            require(source, "source");
            return new EventRemove(source, this.sourceType, this.sourceRow);
        };
        EventRemove.prototype.map = function (f) {
            require(f, "f");
            return new EventRemove(this.source, this.sourceType, f(this.sourceRow));
        };
        return EventRemove;
    }());
    Roll20Layer1.EventRemove = EventRemove;

    function eventRemoveString(reference) {
        return "remove:repeating_" + reference.repeatingName;
    }

    function onRemove(referenceArray, callback) {
        require(referenceArray, "referenceArray");
        require(callback, "callback");

        function parseRepeatingId(string) {
            return string.substring(string.lastIndexOf("_") + 1);
        }

        referenceArray.map(function (reference) {
            return on(eventRemoveString(reference), function (event) {
                return callback(new EventRemove(reference.toReferenceRepeatingId(parseRepeatingId(event.sourceAttribute)), event.sourceType, ValueMap.fromObject(Object.keys(event.removedInfo).map(function (key) {
                    return referenceRepeatingIdAttributeFromString(key);
                }), event.removedInfo)));
            });
        });
    }

    Roll20Layer1.onRemove = onRemove;
    var EventChange = /** @class */ (function () {
        function EventChange(source, sourceType, valueOld, valueNew) {
            require(source, "source");
            require(sourceType, "sourceType");
            this.source = source;
            this.sourceType = sourceType;
            this.valueOld = valueOld;
            this.valueNew = valueNew;
        }

        EventChange.prototype.withSource = function (source) {
            require(source, "source");
            return new EventChange(source, this.sourceType, this.valueOld, this.valueNew);
        };
        EventChange.prototype.map = function (f) {
            require(f, "f");
            return new EventChange(this.source, this.sourceType, f(this.valueOld), f(this.valueNew));
        };
        return EventChange;
    }());
    Roll20Layer1.EventChange = EventChange;

    function eventChangeAttribute(event) {
        return new EventChange(referenceAttribute(event.sourceAttribute), event.sourceType, event.previousValue, event.newValue);
    }

    function eventChangeRepeating(event) {
        return new EventChange(referenceRepeatingIdAttributeFromString(event.sourceAttribute), event.sourceType, event.previousValue, event.newValue);
    }

    function eventChangeString(reference) {
        return reference
            .matchSourceChange(function (attributeName) {
                return "change:" + attributeName;
            }, function (repeatingName) {
                return "change:repeating_" + repeatingName;
            }, function (repeatingName, attributeName) {
                return "change:repeating_" + repeatingName + ":" + attributeName;
            }, function (repeatingName, repeatingId, attributeName) {
                return "change:repeating_" + repeatingName + ":" + repeatingId + ":" + attributeName;
            });
    }

    function onChangeAttribute(referenceArray, callback) {
        require(referenceArray, "referenceArray");
        require(callback, "callback");
        on(referenceArray.map(function (reference) {
            return eventChangeString(reference);
        }).join(" "), function (event) {
            return callback(eventChangeAttribute(event));
        });
    }

    Roll20Layer1.onChangeAttribute = onChangeAttribute;

    function onChangeRepeating(referenceArray, callback) {
        require(referenceArray, "referenceArray");
        require(callback, "callback");
        on(referenceArray.map(function (reference) {
            return eventChangeString(reference);
        }).join(" "), function (event) {
            return callback(eventChangeRepeating(event));
        });
    }

    Roll20Layer1.onChangeRepeating = onChangeRepeating;
    var ValueMap = /** @class */ (function () {
        function ValueMap(keys, record) {
            require(keys, "keys");
            require(record, "record");
            this.keys = keys;
            this.record = record;
        }

        ValueMap.prototype.get = function (key) {
            require(key, "key");
            return (function (value) {
                return value === undefined ? nothing() : just(value);
            })(this.record[nameString(key)]);
        };
        ValueMap.prototype.upsert = function (key, ord, value) {
            require(key, "key");
            return ValueMap.fromObject(deduplicate(this.keys.concat(key), ord), assign(__assign({}, this.record), nameString(key), value));
        };
        ValueMap.prototype.plus = function (valueMap, ord) {
            require(valueMap, "valueMap");
            require(ord, "ord");
            return ValueMap.fromObject(deduplicate(this.keys.concat(valueMap.keys), ord), __assign(__assign({}, this.record), valueMap.record));
        };
        ValueMap.fromObject = function (keys, record) {
            require(keys, "keys");
            require(record, "record");
            return new ValueMap(keys, keys.reduce(function (recordInner, key) {
                return assign(recordInner, nameString(key), record[nameString(key)]);
            }, {}));
        };
        ValueMap.empty = function () {
            return new ValueMap([], {});
        };
        ValueMap.fromFunction = function (keys, get) {
            require(keys, "keys");
            require(get, "get");
            return new ValueMap(keys, keys.reduce(function (record, key) {
                return assign(record, nameString(key), get(key));
            }, {}));
        };
        return ValueMap;
    }());
    Roll20Layer1.ValueMap = ValueMap;

    function nameString(reference) {
        return reference
            .matchSourceValue(function (attributeName) {
                return attributeName;
            }, function (repeatingName, repeatingId, attributeName) {
                return "repeating_" + repeatingName + "_" + repeatingId + "_" + attributeName;
            });
    }

    function readValueArray(referenceArray, callback) {
        require(referenceArray, "referenceArray");
        require(callback, "callback");
        getAttrs(referenceArray.map(function (reference) {
            return nameString(reference);
        }), function (object) {
            return callback(ValueMap.fromObject(referenceArray, object));
        });
    }

    Roll20Layer1.readValueArray = readValueArray;

    function writeValueArray(valueMap, callback) {
        require(valueMap, "valueMap");
        setAttrs(valueMap.record, undefined, callback);
    }

    Roll20Layer1.writeValueArray = writeValueArray;

    function readReferenceRepeatingIdArray(referenceArray, callback) {
        require(referenceArray, "referenceArray");
        require(callback, "callback");
        if (referenceArray.length === 0) {
            callback([]);
        } else if (referenceArray.length === 1) {
            readReferenceRepeatingIdArrayHelper(referenceArray[0], callback);
        } else {
            readReferenceRepeatingIdArrayHelper(referenceArray[0], function (referenceArrayInner1) {
                return readReferenceRepeatingIdArray(referenceArray.slice(1), function (referenceArrayInner2) {
                    return callback(deduplicate(referenceArrayInner1.concat(referenceArrayInner2), ReferenceRepeatingId.ord));
                });
            });
        }
    }

    Roll20Layer1.readReferenceRepeatingIdArray = readReferenceRepeatingIdArray;

    function readReferenceRepeatingIdArrayHelper(reference, callback) {
        getSectionIDs(reference.repeatingName, function (repeatingIdArray) {
            return callback(repeatingIdArray.map(function (repeatingId) {
                return referenceRepeatingId(reference.repeatingName, repeatingId);
            }));
        });
    }
})(Roll20Layer1 || (Roll20Layer1 = {}));
/// <reference path="./utility.ts"/>
/// <reference path="./roll20.d.ts"/>
/// <reference path="./roll20layer1.ts"/>
var Roll20Layer2;
(function (Roll20Layer2) {
    var EventChange = Roll20Layer1.EventChange;
    var ReferenceAttribute = Roll20Layer1.ReferenceAttribute;
    var ReferenceRepeating = Roll20Layer1.ReferenceRepeating;
    var ReferenceRepeatingAttribute = Roll20Layer1.ReferenceRepeatingAttribute;
    var ReferenceSourceValueOrd = Roll20Layer1.ReferenceSourceValueOrd;
    var ValueMap = Roll20Layer1.ValueMap;
    var assign = Utility.assign;
    var deduplicate = Utility.deduplicate;
    var onChangeAttribute = Roll20Layer1.onChangeAttribute;
    var onChangeRepeating = Roll20Layer1.onChangeRepeating;
    var onClick = Roll20Layer1.onClick;
    var onRemove = Roll20Layer1.onRemove;
    var readReferenceRepeatingIdArray = Roll20Layer1.readReferenceRepeatingIdArray;
    var readValueArray = Roll20Layer1.readValueArray;
    var referenceAct = Roll20Layer1.referenceAct;
    var referenceAttribute = Roll20Layer1.referenceAttribute;
    var referenceRepeatingAttribute = Roll20Layer1.referenceRepeatingAttribute;
    var require = Utility.require;
    var writeValueArray = Roll20Layer1.writeValueArray;
    var nothing = Utility.nothing;
    var just = Utility.just;
    var ReferenceRepeatingIdAttribute = Roll20Layer1.ReferenceRepeatingIdAttribute;
    var stringOrd = Utility.stringOrd;
    var serializerDeserializerInteger = Utility.serializerDeserializerInteger;
    var serializerDeserializerBoolean = Utility.serializerDeserializerBoolean;
    var serializerDeserializerString = Utility.serializerDeserializerString;

    function merge(record1Outer, record2Outer) {
        function from6(union1, union2) {
            return union1 === undefined ?
                union2 === undefined ?
                    undefined :
                    union2 :
                union2 === undefined ?
                    union1 :
                    union2;
        }

        function from5(record1, record2) {
            return deduplicate(Object.keys(record1).concat(Object.keys(record2)), stringOrd).reduce(function (record, attributeName) {
                return assign(record, attributeName, from6(record1[attributeName], record2[attributeName]));
            }, {});
        }

        function from4(union1, union2) {
            return union1 === undefined ?
                union2 === undefined ?
                    undefined :
                    union2 :
                union2 === undefined ?
                    union1 :
                    from5(union1, union2);
        }

        function from3(union1, union2) {
            return deduplicate(Object.keys(union1).concat(Object.keys(union2)), stringOrd).reduce(function (record, repeatingId) {
                return assign(record, repeatingId, from4(union1[repeatingId], union2[repeatingId]));
            }, {});
        }

        function from2(union1, union2) {
            return typeof union1 === "string" ?
                union2 :
                typeof union2 === "string" ?
                    union2 :
                    from3(union1, union2);
        }

        function from1(union1, union2) {
            return union1 === undefined ?
                union2 === undefined ?
                    undefined :
                    union2 :
                union2 === undefined ?
                    union1 :
                    from2(union1, union2);
        }

        return deduplicate(Object.keys(record1Outer).concat(Object.keys(record2Outer)), stringOrd).reduce(function (record, key) {
            return assign(record, key, from1(record1Outer[key], record2Outer[key]));
        }, {});
    }

    var Act = /** @class */ (function () {
        function Act(reference) {
            require(reference, "reference");
            this.reference = reference;
        }

        Act.prototype.onClick = function (callback) {
            var _this = this;
            require(callback, "callback");
            onClick(this.reference, function (event) {
                return callback(event.withSource(_this));
            });
        };
        return Act;
    }());
    Roll20Layer2.Act = Act;

    function act(actName) {
        return new Act(referenceAct(actName));
    }

    Roll20Layer2.act = act;
    var SourceValue = /** @class */ (function () {
        function SourceValue() {
        }

        SourceValue.prototype.getReferenceRepeating = function () {
            return deduplicate(this.getReferenceRepeatingAttributeArray()
                .map(function (reference) {
                    return reference.toReferenceRepeating();
                }), ReferenceRepeating.ord);
        };
        SourceValue.prototype.readReferenceArray = function (callback) {
            var _this = this;
            require(callback, "callback");
            var referenceRepeatingArray = deduplicate(this.getReferenceRepeatingAttributeArray()
                .map(function (referenceRepeatingAttribute) {
                    return referenceRepeatingAttribute.toReferenceRepeating();
                }), ReferenceRepeating.ord);
            readReferenceRepeatingIdArray(referenceRepeatingArray, function (referenceRepeatingIdArray) {
                return callback(_this.getReferenceAttributeArray().concat(referenceRepeatingIdArray.flatMap(function (referenceRepeatingId) {
                    return _this.getReferenceRepeatingAttributeArray().flatMap(function (referenceRepeatingAttribute) {
                        return ReferenceRepeating.eq(referenceRepeatingId.toReferenceRepeating(), referenceRepeatingAttribute.toReferenceRepeating()) ?
                            [referenceRepeatingAttribute.toReferenceRepeatingIdAttribute(referenceRepeatingId.repeatingId)] :
                            [];
                    });
                })));
            });
        };
        SourceValue.prototype.onChangeMaybe = function (callback) {
            var _this = this;
            require(callback, "callback");
            onChangeAttribute(this.getReferenceAttributeArray(), function (event) {
                return _this.readReferenceArray(function (referenceArray) {
                    return readValueArray(referenceArray, function (valueMap) {
                        return callback(new EventChange(_this, event.sourceType, _this.getSerializerDeserializerFromValueMap().deserialize(valueMap.upsert(event.source, ReferenceSourceValueOrd, event.valueOld)), _this.getSerializerDeserializerFromValueMap().deserialize(valueMap)));
                    });
                });
            });
            onChangeRepeating(this.getReferenceRepeatingAttributeArray(), function (event) {
                return _this.readReferenceArray(function (referenceArray) {
                    return readValueArray(referenceArray, function (valueMap) {
                        return callback(new EventChange(_this, event.sourceType, _this.getSerializerDeserializerFromValueMap().deserialize(valueMap.upsert(event.source, ReferenceSourceValueOrd, event.valueOld)), _this.getSerializerDeserializerFromValueMap().deserialize(valueMap)));
                    });
                });
            });
            onRemove(this.getReferenceRepeating(), function (event) {
                return _this.readReferenceArray(function (referenceArray) {
                    return readValueArray(referenceArray, function (valueMap) {
                        return callback(new EventChange(_this, event.sourceType, _this.getSerializerDeserializerFromValueMap().deserialize(valueMap.plus(event.sourceRow, ReferenceSourceValueOrd)), _this.getSerializerDeserializerFromValueMap().deserialize(valueMap)));
                    });
                });
            });
        };
        SourceValue.prototype.onChange = function (callback) {
            require(callback, "callback");
            this.onChangeMaybe(function (event) {
                return callback(event.map(function (source) {
                    return source.map(function (value) {
                        return value;
                    }).orValue(undefined);
                }));
            });
        };
        SourceValue.prototype.readMaybe = function (callback) {
            var _this = this;
            require(callback, "callback");
            this.readReferenceArray(function (referenceArray) {
                return readValueArray(referenceArray, function (valueMap) {
                    return callback(_this, _this.getSerializerDeserializerFromValueMap().deserialize(valueMap));
                });
            });
        };
        SourceValue.prototype.read = function (callback) {
            require(callback, "callback");
            this.readMaybe(function (sourceValue, value) {
                return callback(sourceValue, value.map(function (value) {
                    return value;
                }).orValue(undefined));
            });
        };
        SourceValue.prototype.writeMaybe = function (value, callback) {
            var _this = this;
            require(value, "value");
            writeValueArray(value.bind(function (value) {
                return _this.getSerializerDeserializerFromValueMap().serialize(value);
            }).orValue(ValueMap.empty()), callback);
        };
        SourceValue.prototype.write = function (value, callback) {
            require(value, "value");
            this.writeMaybe(value === undefined ? nothing() : just(value), callback);
        };
        SourceValue.prototype.plus = function (sourceValue) {
            require(sourceValue, "sourceValue");
            return sourceValueSum(this, sourceValue);
        };
        SourceValue.prototype.intersects = function (sourceValue) {
            require(sourceValue, "sourceValue");
            return this.getReferenceAttributeArray().some(function (reference) {
                    return sourceValue.getReferenceAttributeArray().some(function (referenceInner) {
                        return ReferenceAttribute.eq(reference, referenceInner);
                    });
                }) ||
                this.getReferenceRepeatingAttributeArray().some(function (reference) {
                    return sourceValue.getReferenceRepeatingAttributeArray().some(function (referenceInner) {
                        return ReferenceRepeatingAttribute.eq(reference, referenceInner);
                    });
                });
        };
        return SourceValue;
    }());
    Roll20Layer2.SourceValue = SourceValue;
    var SourceValueSum = /** @class */ (function (_super) {
        __extends(SourceValueSum, _super);

        function SourceValueSum(sourceValue1, sourceValue2) {
            var _this = _super.call(this) || this;
            require(sourceValue1, "sourceValue1");
            require(sourceValue2, "sourceValue2");
            _this.sourceValue1 = sourceValue1;
            _this.sourceValue2 = sourceValue2;
            return _this;
        }

        SourceValueSum.prototype.getReferenceAttributeArray = function () {
            return deduplicate(this.sourceValue1.getReferenceAttributeArray().concat(this.sourceValue2.getReferenceAttributeArray()), ReferenceAttribute.ord);
        };
        SourceValueSum.prototype.getReferenceRepeatingAttributeArray = function () {
            return deduplicate(this.sourceValue1.getReferenceRepeatingAttributeArray().concat(this.sourceValue2.getReferenceRepeatingAttributeArray()), ReferenceRepeatingAttribute.ord);
        };
        SourceValueSum.prototype.getSerializerDeserializerFromValueMap = function () {
            var that = this;
            return new /** @class */ (function () {
                function class_2() {
                }

                class_2.prototype.deserialize = function (valueMap) {
                    require(valueMap, "valueMap");
                    var record1Maybe = that.sourceValue1.getSerializerDeserializerFromValueMap().deserialize(valueMap).bind(function (value) {
                        return that.sourceValue1.getSerializerDeserializerFromObject().serialize(value);
                    });
                    var record2Maybe = that.sourceValue2.getSerializerDeserializerFromValueMap().deserialize(valueMap).bind(function (value) {
                        return that.sourceValue2.getSerializerDeserializerFromObject().serialize(value);
                    });
                    return record1Maybe
                        .map(function (record1) {
                            return record2Maybe
                                .map(function (record2) {
                                    return merge(record1, record2);
                                })
                                .orValue(record1);
                        })
                        .orMaybe(record2Maybe);
                };
                class_2.prototype.serialize = function (value) {
                    require(value, "value");
                    var valueMap1Maybe = that.sourceValue1.getSerializerDeserializerFromObject().deserialize(value).bind(function (value) {
                        return that.sourceValue1.getSerializerDeserializerFromValueMap().serialize(value);
                    });
                    var valueMap2Maybe = that.sourceValue2.getSerializerDeserializerFromObject().deserialize(value).bind(function (value) {
                        return that.sourceValue2.getSerializerDeserializerFromValueMap().serialize(value);
                    });
                    return valueMap1Maybe
                        .map(function (valueMap1) {
                            return valueMap2Maybe
                                .map(function (valueMap2) {
                                    return valueMap1.plus(valueMap2, ReferenceSourceValueOrd);
                                })
                                .orValue(valueMap1);
                        })
                        .orMaybe(valueMap2Maybe);
                };
                return class_2;
            }());
        };
        SourceValueSum.prototype.getSerializerDeserializerFromObject = function () {
            var that = this;
            return new /** @class */ (function () {
                function class_3() {
                }

                class_3.prototype.deserialize = function (value) {
                    require(value, "value");
                    return just(value);
                };
                class_3.prototype.serialize = function (value) {
                    require(value, "value");
                    return just(value);
                };
                return class_3;
            }());
        };
        return SourceValueSum;
    }(SourceValue));

    function sourceValueSum(sourceValue1, sourceValue2) {
        return new SourceValueSum(sourceValue1, sourceValue2);
    }

    Roll20Layer2.sourceValueSum = sourceValueSum;
    var Attribute = /** @class */ (function (_super) {
        __extends(Attribute, _super);

        function Attribute(reference, serializerDeserializerFromString) {
            var _this = _super.call(this) || this;
            require(reference, "reference");
            require(serializerDeserializerFromString, "serializerDeserializerFromString");
            _this.reference = reference;
            _this.serializerDeserializerFromString = serializerDeserializerFromString;
            _this.serializerDeserializerFromValueMap = new /** @class */ (function () {
                function class_4() {
                }

                class_4.prototype.deserialize = function (valueMap) {
                    require(valueMap, "valueMap");
                    return valueMap.get(reference)
                        .bind(function (value) {
                            return serializerDeserializerFromString.deserialize(value);
                        });
                };
                class_4.prototype.serialize = function (value) {
                    require(value, "value");
                    return serializerDeserializerFromString.serialize(value)
                        .map(function (value) {
                            return ValueMap.empty().upsert(reference, ReferenceSourceValueOrd, value);
                        });
                };
                return class_4;
            }());
            _this.serializerDeserializerFromObject = new /** @class */ (function () {
                function class_5() {
                }

                class_5.prototype.deserialize = function (value) {
                    require(value, "value");

                    function forRecord(recordOuter) {
                        return nothing();
                    }

                    function forString(string) {
                        return serializerDeserializerFromString.deserialize(string);
                    }

                    function forUnion(union) {
                        return union === undefined ?
                            nothing() :
                            typeof union === "string" ?
                                forString(union) :
                                forRecord(union);
                    }

                    return forUnion(value[reference.attributeName]);
                };
                class_5.prototype.serialize = function (value) {
                    require(value, "value");
                    return serializerDeserializerFromString.serialize(value)
                        .map(function (value) {
                            return assign({}, reference.attributeName, value);
                        });
                };
                return class_5;
            }());
            return _this;
        }

        Attribute.prototype.getReferenceAttributeArray = function () {
            return [this.reference];
        };
        Attribute.prototype.getReferenceRepeatingAttributeArray = function () {
            return [];
        };
        Attribute.prototype.getSerializerDeserializerFromValueMap = function () {
            return this.serializerDeserializerFromValueMap;
        };
        Attribute.prototype.getSerializerDeserializerFromObject = function () {
            return this.serializerDeserializerFromObject;
        };
        return Attribute;
    }(SourceValue));
    Roll20Layer2.Attribute = Attribute;

    function attribute(attributeName, serializerDeserializer) {
        return new Attribute(referenceAttribute(attributeName), serializerDeserializer);
    }

    Roll20Layer2.attribute = attribute;

    function attributeInteger(attributeName) {
        return new Attribute(referenceAttribute(attributeName), serializerDeserializerInteger);
    }

    Roll20Layer2.attributeInteger = attributeInteger;

    function attributeString(attributeName) {
        return new Attribute(referenceAttribute(attributeName), serializerDeserializerString);
    }

    Roll20Layer2.attributeString = attributeString;

    function attributeBoolean(attributeName) {
        return new Attribute(referenceAttribute(attributeName), serializerDeserializerBoolean);
    }

    Roll20Layer2.attributeBoolean = attributeBoolean;
    var RepeatingAttribute = /** @class */ (function (_super) {
        __extends(RepeatingAttribute, _super);

        function RepeatingAttribute(reference, serializerDeserializerFromString) {
            var _this = _super.call(this) || this;
            require(reference, "reference");
            require(serializerDeserializerFromString, "serializerDeserializerFromString");
            _this.reference = reference;
            _this.serializerDeserializerFromString = serializerDeserializerFromString;
            _this.serializerDeserializerFromValueMap = new /** @class */ (function () {
                function class_6() {
                }

                class_6.prototype.deserialize = function (valueMap) {
                    require(valueMap, "valueMap");
                    return just(valueMap.keys.reduce(function (record, referenceSourceValue) {
                        return referenceSourceValue.matchSourceValue(function (attributeName) {
                            return record;
                        }, function (repeatingName, repeatingId, attributeName) {
                            return ReferenceRepeatingAttribute.eq(reference, referenceRepeatingAttribute(repeatingName, attributeName)) ?
                                valueMap.get(reference.toReferenceRepeatingIdAttribute(repeatingId))
                                    .bind(function (value) {
                                        return serializerDeserializerFromString.deserialize(value).map(function (value) {
                                            return assign(record, repeatingId, value);
                                        });
                                    })
                                    .orValue(record) :
                                record;
                        });
                    }, {}));
                };
                class_6.prototype.serialize = function (value) {
                    require(value, "value");
                    return just(Object.keys(value)
                        .reduce(function (valueMap, repeatingId) {
                            return serializerDeserializerFromString.serialize(value[repeatingId])
                                .map(function (value) {
                                    return valueMap.upsert(reference.toReferenceRepeatingIdAttribute(repeatingId), ReferenceRepeatingIdAttribute.ord, value);
                                })
                                .orValue(valueMap);
                        }, ValueMap.empty()));
                };
                return class_6;
            }());
            _this.serializerDeserializerFromObject = new /** @class */ (function () {
                function class_7() {
                }

                class_7.prototype.deserialize = function (value) {
                    require(value, "value");

                    function forRecord(recordOuter) {
                        return just(Object.keys(recordOuter)
                            .reduce(function (record, repeatingId) {
                                return recordOuter[repeatingId][reference.attributeName] === undefined ?
                                    record :
                                    serializerDeserializerFromString.deserialize(recordOuter[repeatingId][reference.attributeName])
                                        .map(function (value) {
                                            return assign(record, repeatingId, value);
                                        })
                                        .orValue(record);
                            }, {}));
                    }

                    function forString(string) {
                        return nothing();
                    }

                    function forUnion(union) {
                        return union === undefined ?
                            nothing() :
                            typeof union === "string" ?
                                forString(union) :
                                forRecord(union);
                    }

                    return forUnion(value[reference.repeatingName]);
                };
                class_7.prototype.serialize = function (value) {
                    require(value, "value");
                    return just(assign({}, reference.repeatingName, Object.keys(value).reduce(function (record, repeatingId) {
                        return assign(record, repeatingId, assign({}, reference.attributeName, value[repeatingId]));
                    }, {})));
                };
                return class_7;
            }());
            return _this;
        }

        RepeatingAttribute.prototype.getReferenceAttributeArray = function () {
            return [];
        };
        RepeatingAttribute.prototype.getReferenceRepeatingAttributeArray = function () {
            return [this.reference];
        };
        RepeatingAttribute.prototype.getSerializerDeserializerFromValueMap = function () {
            return this.serializerDeserializerFromValueMap;
        };
        RepeatingAttribute.prototype.getSerializerDeserializerFromObject = function () {
            return this.serializerDeserializerFromObject;
        };
        return RepeatingAttribute;
    }(SourceValue));
    Roll20Layer2.RepeatingAttribute = RepeatingAttribute;

    function repeatingAttribute(repeatingName, attributeName, serializerDeserializer) {
        return new RepeatingAttribute(referenceRepeatingAttribute(repeatingName, attributeName), serializerDeserializer);
    }

    Roll20Layer2.repeatingAttribute = repeatingAttribute;

    function repeatingAttributeInteger(repeatingName, attributeName) {
        return new RepeatingAttribute(referenceRepeatingAttribute(repeatingName, attributeName), serializerDeserializerInteger);
    }

    Roll20Layer2.repeatingAttributeInteger = repeatingAttributeInteger;

    function repeatingAttributeString(repeatingName, attributeName) {
        return new RepeatingAttribute(referenceRepeatingAttribute(repeatingName, attributeName), serializerDeserializerString);
    }

    Roll20Layer2.repeatingAttributeString = repeatingAttributeString;

    function repeatingAttributeBoolean(repeatingName, attributeName) {
        return new RepeatingAttribute(referenceRepeatingAttribute(repeatingName, attributeName), serializerDeserializerBoolean);
    }

    Roll20Layer2.repeatingAttributeBoolean = repeatingAttributeBoolean;
    var Sheet = /** @class */ (function () {
        function Sheet(sourceValueReadonly, valueReadonly, sourceValue, value) {
            require(sourceValueReadonly, "sourceValueReadonly");
            require(valueReadonly, "valueReadonly");
            require(sourceValue, "sourceValue");
            require(value, "value");
            this.sourceValue = sourceValue;
            this.value = value;
            this.sourceValueReadonly = sourceValueReadonly;
            this.valueReadonly = valueReadonly;
        }

        Sheet.prototype.set = function (sourceValue, value) {
            var _this = this;
            require(sourceValue, "sourceValue");
            require(value, "value");
            return this.sourceValueReadonly.map(function (sourceValueReadonlyInner) {
                return sourceValueReadonlyInner.intersects(sourceValue);
            }).orValue(false) ?
                nothing() :
                just(this.sourceValue
                    .map(function (sourceValueInner) {
                        var recordOld = _this.value.bind(function (valueInner) {
                            return sourceValueInner.getSerializerDeserializerFromObject().serialize(valueInner);
                        });
                        var recordNew = value.bind(function (valueInner) {
                            return sourceValue.getSerializerDeserializerFromObject().serialize(valueInner);
                        });
                        var recordMerge = recordOld
                            .map(function (recordOldInner) {
                                return recordNew
                                    .map(function (recordNewInner) {
                                        return merge(recordOldInner, recordNewInner);
                                    })
                                    .orValue(recordOldInner);
                            })
                            .orMaybe(recordNew);
                        sourceValueSum(sourceValueInner, sourceValue);
                        return new Sheet(_this.sourceValueReadonly, _this.valueReadonly, just(sourceValueSum(sourceValueInner, sourceValue)), recordMerge);
                    })
                    .orValue(new Sheet(this.sourceValueReadonly, this.valueReadonly, just(sourceValue), value)));
        };
        Sheet.prototype.get = function (sourceValue) {
            var _this = this;
            require(sourceValue, "sourceValue");
            var recordReadonly = this.sourceValueReadonly.bind(function (sourceValueReadonlyInner) {
                return _this.valueReadonly.bind(function (valueReadonlyInner) {
                    return sourceValueReadonlyInner.getSerializerDeserializerFromObject().serialize(valueReadonlyInner);
                });
            });
            var record = this.sourceValue.bind(function (sourceValueInner) {
                return _this.value.bind(function (valueInner) {
                    return sourceValueInner.getSerializerDeserializerFromObject().serialize(valueInner);
                });
            });
            var recordMerge = recordReadonly
                .map(function (recordReadonlyInner) {
                    return record
                        .map(function (recordInner) {
                            return merge(recordReadonlyInner, recordInner);
                        })
                        .orValue(recordReadonlyInner);
                })
                .orMaybe(record);
            return recordMerge.bind(function (recordMergeInner) {
                return sourceValue.getSerializerDeserializerFromObject().deserialize(recordMergeInner);
            });
        };
        Sheet.prototype.write = function (callback) {
            var _this = this;
            this.sourceValue.map(function (sourceValue) {
                return sourceValue.writeMaybe(_this.value, callback);
            });
        };
        return Sheet;
    }());
    Roll20Layer2.Sheet = Sheet;

    function sheetReadonly(sourceValueReadonly, valueReadonly) {
        return new Sheet(just(sourceValueReadonly), valueReadonly, nothing(), nothing());
    }

    Roll20Layer2.sheetReadonly = sheetReadonly;

    function sheet(sourceValue, value) {
        return new Sheet(nothing(), nothing(), just(sourceValue), value);
    }

    Roll20Layer2.sheet = sheet;
})(Roll20Layer2 || (Roll20Layer2 = {}));
/// <reference path="./utility.ts"/>
/// <reference path="./roll20.d.ts"/>
/// <reference path="./roll20layer1.ts"/>
/// <reference path="./roll20layer2.ts"/>
var Maybe = Utility.Maybe;
var act = Roll20Layer2.act;
var attribute = Roll20Layer2.attribute;
var just = Utility.just;
var nothing = Utility.nothing;
var repeatingAttribute = Roll20Layer2.repeatingAttribute;
var serializerDeserializer = Utility.serializerDeserializer;
var Sheet = Roll20Layer2.Sheet;
var onOpen = Roll20Layer1.onOpen;
var sheet = Roll20Layer2.sheet;
var assign = Utility.assign;
var repeatingAttributeString = Roll20Layer2.repeatingAttributeString;
var attributeString = Roll20Layer2.attributeString;
var attributeInteger = Roll20Layer2.attributeInteger;
var attributeBoolean = Roll20Layer2.attributeBoolean;
var repeatingAttributeInteger = Roll20Layer2.repeatingAttributeInteger;
var DamageType;
(function (DamageType) {
    DamageType["Brawling"] = "damageTypeBrawling";
    DamageType["Melee"] = "damageTypeMelee";
    DamageType["Ranged"] = "damageTypeRanged";
})(DamageType || (DamageType = {}));

function damageTypeMatch(damageType, fDamageTypeBrawling, fDamageTypeMelee, fDamageTypeRanged) {
    return damageType === DamageType.Brawling ? fDamageTypeBrawling(damageType) :
        damageType === DamageType.Melee ? fDamageTypeMelee(damageType) :
            fDamageTypeRanged(damageType);
}

var serializerDeserializerDamageType = serializerDeserializer(function (damageType) {
    return just(damageType.toString());
}, function (string) {
    return string === DamageType.Brawling ? just(DamageType.Brawling) :
        string === DamageType.Melee ? just(DamageType.Melee) :
            string === DamageType.Ranged ? just(DamageType.Ranged) :
                nothing();
});
var DamageLocation;
(function (DamageLocation) {
    DamageLocation["Head"] = "damageLocationHead";
    DamageLocation["Body"] = "damageLocationBody";
})(DamageLocation || (DamageLocation = {}));

function damageLocationMatch(damageLocation, fDamageLocationHead, fDamageLocationBody) {
    return damageLocation === DamageLocation.Head ? fDamageLocationHead(damageLocation) :
        fDamageLocationBody(damageLocation);
}

var serializerDeserializerDamageLocation = serializerDeserializer(function (damageLocation) {
    return just(damageLocation.toString());
}, function (string) {
    return string === DamageLocation.Head ? just(DamageLocation.Head) :
        string === DamageLocation.Body ? just(DamageLocation.Body) :
            nothing();
});
var CyberwareTarget;
(function (CyberwareTarget) {
    CyberwareTarget["StatisticIntelligenceSum"] = "statisticIntelligenceSum";
    CyberwareTarget["StatisticReflexesSum"] = "statisticReflexesSum";
    CyberwareTarget["StatisticDexteritySum"] = "statisticDexteritySum";
    CyberwareTarget["StatisticTechniqueSum"] = "statisticTechniqueSum";
    CyberwareTarget["StatisticCoolSum"] = "statisticCoolSum";
    CyberwareTarget["StatisticWillSum"] = "statisticWillSum";
    CyberwareTarget["StatisticLuckSum"] = "statisticLuckSum";
    CyberwareTarget["StatisticMoveSum"] = "statisticMoveSum";
    CyberwareTarget["StatisticBodySum"] = "statisticBodySum";
    CyberwareTarget["StatisticEmpathySum"] = "statisticEmpathySum";
    CyberwareTarget["SkillAthleticsSum"] = "skillAthleticsSum";
    CyberwareTarget["SkillBasicTechSum"] = "skillBasicTechSum";
    CyberwareTarget["SkillBrawlingSum"] = "skillBrawlingSum";
    CyberwareTarget["SkillBriberySum"] = "skillBriberySum";
    CyberwareTarget["SkillConcentrationSum"] = "skillConcentrationSum";
    CyberwareTarget["SkillConversationSum"] = "skillConversationSum";
    CyberwareTarget["SkillCyberTechSum"] = "skillCyberTechSum";
    CyberwareTarget["SkillDrivingSum"] = "skillDrivingSum";
    CyberwareTarget["SkillEducationSum"] = "skillEducationSum";
    CyberwareTarget["SkillEvasionSum"] = "skillEvasionSum";
    CyberwareTarget["SkillFirstAidSum"] = "skillFirstAidSum";
    CyberwareTarget["SkillHumanPerceptionSum"] = "skillHumanPerceptionSum";
    CyberwareTarget["SkillInterrogationSum"] = "skillInterrogationSum";
    CyberwareTarget["SkillLocalExpertSum"] = "skillLocalExpertSum";
    CyberwareTarget["SkillMarksmanshipSum"] = "skillMarksmanshipSum";
    CyberwareTarget["SkillMeleeWeaponSum"] = "skillMeleeWeaponSum";
    CyberwareTarget["SkillPerceptionSum"] = "skillPerceptionSum";
    CyberwareTarget["SkillPersuasionSum"] = "skillPersuasionSum";
    CyberwareTarget["SkillPlayInstrumentSum"] = "skillPlayInstrumentSum";
    CyberwareTarget["SkillStealthSum"] = "skillStealthSum";
    CyberwareTarget["SkillTrackingSum"] = "skillTrackingSum";
    CyberwareTarget["AttackInitiativeSum"] = "attackInitiativeSum";
    CyberwareTarget["AttackReputationSum"] = "attackReputationSum";
})(CyberwareTarget || (CyberwareTarget = {}));

function cyberwareTargetMatch(cyberwareTarget, fCyberwareTargetStatisticIntelligenceSum, fCyberwareTargetStatisticReflexesSum, fCyberwareTargetStatisticDexteritySum, fCyberwareTargetStatisticTechniqueSum, fCyberwareTargetStatisticCoolSum, fCyberwareTargetStatisticWillSum, fCyberwareTargetStatisticLuckSum, fCyberwareTargetStatisticMoveSum, fCyberwareTargetStatisticBodySum, fCyberwareTargetStatisticEmpathySum, fCyberwareTargetSkillAthleticsSum, fCyberwareTargetSkillBasicTechSum, fCyberwareTargetSkillBrawlingSum, fCyberwareTargetSkillBriberySum, fCyberwareTargetSkillConcentrationSum, fCyberwareTargetSkillConversationSum, fCyberwareTargetSkillCyberTechSum, fCyberwareTargetSkillDrivingSum, fCyberwareTargetSkillEducationSum, fCyberwareTargetSkillEvasionSum, fCyberwareTargetSkillFirstAidSum, fCyberwareTargetSkillHumanPerceptionSum, fCyberwareTargetSkillInterrogationSum, fCyberwareTargetSkillLocalExpertSum, fCyberwareTargetSkillMarksmanshipSum, fCyberwareTargetSkillMeleeWeaponSum, fCyberwareTargetSkillPerceptionSum, fCyberwareTargetSkillPersuasionSum, fCyberwareTargetSkillPlayInstrumentSum, fCyberwareTargetSkillStealthSum, fCyberwareTargetSkillTrackingSum, fCyberwareTargetAttackInitiativeSum, fCyberwareTargetAttackReputationSum) {
    return cyberwareTarget === CyberwareTarget.StatisticIntelligenceSum ? fCyberwareTargetStatisticIntelligenceSum(cyberwareTarget) :
        cyberwareTarget === CyberwareTarget.StatisticReflexesSum ? fCyberwareTargetStatisticReflexesSum(cyberwareTarget) :
            cyberwareTarget === CyberwareTarget.StatisticDexteritySum ? fCyberwareTargetStatisticDexteritySum(cyberwareTarget) :
                cyberwareTarget === CyberwareTarget.StatisticTechniqueSum ? fCyberwareTargetStatisticTechniqueSum(cyberwareTarget) :
                    cyberwareTarget === CyberwareTarget.StatisticCoolSum ? fCyberwareTargetStatisticCoolSum(cyberwareTarget) :
                        cyberwareTarget === CyberwareTarget.StatisticWillSum ? fCyberwareTargetStatisticWillSum(cyberwareTarget) :
                            cyberwareTarget === CyberwareTarget.StatisticLuckSum ? fCyberwareTargetStatisticLuckSum(cyberwareTarget) :
                                cyberwareTarget === CyberwareTarget.StatisticMoveSum ? fCyberwareTargetStatisticMoveSum(cyberwareTarget) :
                                    cyberwareTarget === CyberwareTarget.StatisticBodySum ? fCyberwareTargetStatisticBodySum(cyberwareTarget) :
                                        cyberwareTarget === CyberwareTarget.StatisticEmpathySum ? fCyberwareTargetStatisticEmpathySum(cyberwareTarget) :
                                            cyberwareTarget === CyberwareTarget.SkillAthleticsSum ? fCyberwareTargetSkillAthleticsSum(cyberwareTarget) :
                                                cyberwareTarget === CyberwareTarget.SkillBasicTechSum ? fCyberwareTargetSkillBasicTechSum(cyberwareTarget) :
                                                    cyberwareTarget === CyberwareTarget.SkillBrawlingSum ? fCyberwareTargetSkillBrawlingSum(cyberwareTarget) :
                                                        cyberwareTarget === CyberwareTarget.SkillBriberySum ? fCyberwareTargetSkillBriberySum(cyberwareTarget) :
                                                            cyberwareTarget === CyberwareTarget.SkillConcentrationSum ? fCyberwareTargetSkillConcentrationSum(cyberwareTarget) :
                                                                cyberwareTarget === CyberwareTarget.SkillConversationSum ? fCyberwareTargetSkillConversationSum(cyberwareTarget) :
                                                                    cyberwareTarget === CyberwareTarget.SkillCyberTechSum ? fCyberwareTargetSkillCyberTechSum(cyberwareTarget) :
                                                                        cyberwareTarget === CyberwareTarget.SkillDrivingSum ? fCyberwareTargetSkillDrivingSum(cyberwareTarget) :
                                                                            cyberwareTarget === CyberwareTarget.SkillEducationSum ? fCyberwareTargetSkillEducationSum(cyberwareTarget) :
                                                                                cyberwareTarget === CyberwareTarget.SkillEvasionSum ? fCyberwareTargetSkillEvasionSum(cyberwareTarget) :
                                                                                    cyberwareTarget === CyberwareTarget.SkillFirstAidSum ? fCyberwareTargetSkillFirstAidSum(cyberwareTarget) :
                                                                                        cyberwareTarget === CyberwareTarget.SkillHumanPerceptionSum ? fCyberwareTargetSkillHumanPerceptionSum(cyberwareTarget) :
                                                                                            cyberwareTarget === CyberwareTarget.SkillInterrogationSum ? fCyberwareTargetSkillInterrogationSum(cyberwareTarget) :
                                                                                                cyberwareTarget === CyberwareTarget.SkillLocalExpertSum ? fCyberwareTargetSkillLocalExpertSum(cyberwareTarget) :
                                                                                                    cyberwareTarget === CyberwareTarget.SkillMarksmanshipSum ? fCyberwareTargetSkillMarksmanshipSum(cyberwareTarget) :
                                                                                                        cyberwareTarget === CyberwareTarget.SkillMeleeWeaponSum ? fCyberwareTargetSkillMeleeWeaponSum(cyberwareTarget) :
                                                                                                            cyberwareTarget === CyberwareTarget.SkillPerceptionSum ? fCyberwareTargetSkillPerceptionSum(cyberwareTarget) :
                                                                                                                cyberwareTarget === CyberwareTarget.SkillPersuasionSum ? fCyberwareTargetSkillPersuasionSum(cyberwareTarget) :
                                                                                                                    cyberwareTarget === CyberwareTarget.SkillPlayInstrumentSum ? fCyberwareTargetSkillPlayInstrumentSum(cyberwareTarget) :
                                                                                                                        cyberwareTarget === CyberwareTarget.SkillStealthSum ? fCyberwareTargetSkillStealthSum(cyberwareTarget) :
                                                                                                                            cyberwareTarget === CyberwareTarget.SkillTrackingSum ? fCyberwareTargetSkillTrackingSum(cyberwareTarget) :
                                                                                                                                cyberwareTarget === CyberwareTarget.AttackInitiativeSum ? fCyberwareTargetAttackInitiativeSum(cyberwareTarget) :
                                                                                                                                    fCyberwareTargetAttackReputationSum(cyberwareTarget);
}

var serializerDeserializerCyberwareTarget = serializerDeserializer(function (cyberwareTarget) {
    return just(cyberwareTarget.toString());
}, function (string) {
    return string === CyberwareTarget.StatisticIntelligenceSum ? just(CyberwareTarget.StatisticIntelligenceSum) :
        string === CyberwareTarget.StatisticReflexesSum ? just(CyberwareTarget.StatisticReflexesSum) :
            string === CyberwareTarget.StatisticDexteritySum ? just(CyberwareTarget.StatisticDexteritySum) :
                string === CyberwareTarget.StatisticTechniqueSum ? just(CyberwareTarget.StatisticTechniqueSum) :
                    string === CyberwareTarget.StatisticCoolSum ? just(CyberwareTarget.StatisticCoolSum) :
                        string === CyberwareTarget.StatisticWillSum ? just(CyberwareTarget.StatisticWillSum) :
                            string === CyberwareTarget.StatisticLuckSum ? just(CyberwareTarget.StatisticLuckSum) :
                                string === CyberwareTarget.StatisticMoveSum ? just(CyberwareTarget.StatisticMoveSum) :
                                    string === CyberwareTarget.StatisticBodySum ? just(CyberwareTarget.StatisticBodySum) :
                                        string === CyberwareTarget.StatisticEmpathySum ? just(CyberwareTarget.StatisticEmpathySum) :
                                            string === CyberwareTarget.SkillAthleticsSum ? just(CyberwareTarget.SkillAthleticsSum) :
                                                string === CyberwareTarget.SkillBasicTechSum ? just(CyberwareTarget.SkillBasicTechSum) :
                                                    string === CyberwareTarget.SkillBrawlingSum ? just(CyberwareTarget.SkillBrawlingSum) :
                                                        string === CyberwareTarget.SkillBriberySum ? just(CyberwareTarget.SkillBriberySum) :
                                                            string === CyberwareTarget.SkillConcentrationSum ? just(CyberwareTarget.SkillConcentrationSum) :
                                                                string === CyberwareTarget.SkillConversationSum ? just(CyberwareTarget.SkillConversationSum) :
                                                                    string === CyberwareTarget.SkillCyberTechSum ? just(CyberwareTarget.SkillCyberTechSum) :
                                                                        string === CyberwareTarget.SkillDrivingSum ? just(CyberwareTarget.SkillDrivingSum) :
                                                                            string === CyberwareTarget.SkillEducationSum ? just(CyberwareTarget.SkillEducationSum) :
                                                                                string === CyberwareTarget.SkillEvasionSum ? just(CyberwareTarget.SkillEvasionSum) :
                                                                                    string === CyberwareTarget.SkillFirstAidSum ? just(CyberwareTarget.SkillFirstAidSum) :
                                                                                        string === CyberwareTarget.SkillHumanPerceptionSum ? just(CyberwareTarget.SkillHumanPerceptionSum) :
                                                                                            string === CyberwareTarget.SkillInterrogationSum ? just(CyberwareTarget.SkillInterrogationSum) :
                                                                                                string === CyberwareTarget.SkillLocalExpertSum ? just(CyberwareTarget.SkillLocalExpertSum) :
                                                                                                    string === CyberwareTarget.SkillMarksmanshipSum ? just(CyberwareTarget.SkillMarksmanshipSum) :
                                                                                                        string === CyberwareTarget.SkillMeleeWeaponSum ? just(CyberwareTarget.SkillMeleeWeaponSum) :
                                                                                                            string === CyberwareTarget.SkillPerceptionSum ? just(CyberwareTarget.SkillPerceptionSum) :
                                                                                                                string === CyberwareTarget.SkillPersuasionSum ? just(CyberwareTarget.SkillPersuasionSum) :
                                                                                                                    string === CyberwareTarget.SkillPlayInstrumentSum ? just(CyberwareTarget.SkillPlayInstrumentSum) :
                                                                                                                        string === CyberwareTarget.SkillStealthSum ? just(CyberwareTarget.SkillStealthSum) :
                                                                                                                            string === CyberwareTarget.SkillTrackingSum ? just(CyberwareTarget.SkillTrackingSum) :
                                                                                                                                string === CyberwareTarget.AttackInitiativeSum ? just(CyberwareTarget.AttackInitiativeSum) :
                                                                                                                                    string === CyberwareTarget.AttackReputationSum ? just(CyberwareTarget.AttackReputationSum) :
                                                                                                                                        nothing();
});
var character_name = attributeString("character_name");
var statisticIntelligenceSum = attributeInteger("statisticIntelligenceSum");
var statisticIntelligence = attributeInteger("statisticIntelligence");
var statisticReflexesSum = attributeInteger("statisticReflexesSum");
var statisticReflexes = attributeInteger("statisticReflexes");
var statisticDexteritySum = attributeInteger("statisticDexteritySum");
var statisticDexterity = attributeInteger("statisticDexterity");
var statisticTechniqueSum = attributeInteger("statisticTechniqueSum");
var statisticTechnique = attributeInteger("statisticTechnique");
var statisticCoolSum = attributeInteger("statisticCoolSum");
var statisticCool = attributeInteger("statisticCool");
var statisticWillSum = attributeInteger("statisticWillSum");
var statisticWill = attributeInteger("statisticWill");
var statisticLuckSum = attributeInteger("statisticLuckSum");
var statisticLuck = attributeInteger("statisticLuck");
var statisticMoveSum = attributeInteger("statisticMoveSum");
var statisticMove = attributeInteger("statisticMove");
var statisticBodySum = attributeInteger("statisticBodySum");
var statisticBody = attributeInteger("statisticBody");
var statisticEmpathySum = attributeInteger("statisticEmpathySum");
var statisticEmpathy = attributeInteger("statisticEmpathy");
var skillAthleticsSum = attributeInteger("skillAthleticsSum");
var skillAthletics = attributeInteger("skillAthletics");
var skillBasicTechSum = attributeInteger("skillBasicTechSum");
var skillBasicTech = attributeInteger("skillBasicTech");
var skillBrawlingSum = attributeInteger("skillBrawlingSum");
var skillBrawling = attributeInteger("skillBrawling");
var skillBriberySum = attributeInteger("skillBriberySum");
var skillBribery = attributeInteger("skillBribery");
var skillConcentrationSum = attributeInteger("skillConcentrationSum");
var skillConcentration = attributeInteger("skillConcentration");
var skillConversationSum = attributeInteger("skillConversationSum");
var skillConversation = attributeInteger("skillConversation");
var skillCyberTechSum = attributeInteger("skillCyberTechSum");
var skillCyberTech = attributeInteger("skillCyberTech");
var skillDrivingSum = attributeInteger("skillDrivingSum");
var skillDriving = attributeInteger("skillDriving");
var skillEducationSum = attributeInteger("skillEducationSum");
var skillEducation = attributeInteger("skillEducation");
var skillEvasionSum = attributeInteger("skillEvasionSum");
var skillEvasion = attributeInteger("skillEvasion");
var skillFirstAidSum = attributeInteger("skillFirstAidSum");
var skillFirstAid = attributeInteger("skillFirstAid");
var skillHumanPerceptionSum = attributeInteger("skillHumanPerceptionSum");
var skillHumanPerception = attributeInteger("skillHumanPerception");
var skillInterrogationSum = attributeInteger("skillInterrogationSum");
var skillInterrogation = attributeInteger("skillInterrogation");
var skillLocalExpertSum = attributeInteger("skillLocalExpertSum");
var skillLocalExpert = attributeInteger("skillLocalExpert");
var skillMarksmanshipSum = attributeInteger("skillMarksmanshipSum");
var skillMarksmanship = attributeInteger("skillMarksmanship");
var skillMeleeWeaponSum = attributeInteger("skillMeleeWeaponSum");
var skillMeleeWeapon = attributeInteger("skillMeleeWeapon");
var skillPerceptionSum = attributeInteger("skillPerceptionSum");
var skillPerception = attributeInteger("skillPerception");
var skillPersuasionSum = attributeInteger("skillPersuasionSum");
var skillPersuasion = attributeInteger("skillPersuasion");
var skillPlayInstrumentSum = attributeInteger("skillPlayInstrumentSum");
var skillPlayInstrument = attributeInteger("skillPlayInstrument");
var skillStealthSum = attributeInteger("skillStealthSum");
var skillStealth = attributeInteger("skillStealth");
var skillTrackingSum = attributeInteger("skillTrackingSum");
var skillTracking = attributeInteger("skillTracking");
var attackInitiativeSum = attributeInteger("attackInitiativeSum");
var attackReputation = attributeInteger("attackReputation");
var attackReputationSum = attributeInteger("attackReputationSum");
var attackGrapplingSum = attributeInteger("attackGrapplingSum");
var attackChokingSum = attributeInteger("attackChokingSum");
var attackThrowingSum = attributeInteger("attackThrowingSum");
var luck = attributeInteger("luck");
var luck_max = attributeInteger("luck_max");
var luckDecrement = act("luckDecrement");
var luckReset = act("luckReset");
var attackBrawlingDamage = attributeInteger("attackBrawlingDamage");
var attackMeleeDamage = repeatingAttributeInteger("attackMelee", "attackMeleeDamage");
var attackMeleeName = repeatingAttributeString("attackMelee", "attackMeleeName");
var attackRanged1Damage = repeatingAttributeInteger("attackRanged1", "attackRangedDamage");
var attackRanged1Name = repeatingAttributeString("attackRanged1", "attackRangedName");
var attackRanged11Difficulty012 = repeatingAttributeInteger("attackRanged1", "attackRangedDifficulty012");
var attackRanged11Difficulty025 = repeatingAttributeInteger("attackRanged1", "attackRangedDifficulty025");
var attackRanged11Difficulty050 = repeatingAttributeInteger("attackRanged1", "attackRangedDifficulty050");
var attackRanged11Difficulty100 = repeatingAttributeInteger("attackRanged1", "attackRangedDifficulty100");
var attackRanged11Difficulty200 = repeatingAttributeInteger("attackRanged1", "attackRangedDifficulty200");
var attackRanged11Difficulty400 = repeatingAttributeInteger("attackRanged1", "attackRangedDifficulty400");
var attackRanged11Difficulty800 = repeatingAttributeInteger("attackRanged1", "attackRangedDifficulty800");
var attackRanged3Damage = repeatingAttributeInteger("attackRanged3", "attackRangedDamage");
var attackRanged3Name = repeatingAttributeString("attackRanged3", "attackRangedName");
var attackRanged31Difficulty012 = repeatingAttributeInteger("attackRanged3", "attackRanged1Difficulty012");
var attackRanged31Difficulty025 = repeatingAttributeInteger("attackRanged3", "attackRanged1Difficulty025");
var attackRanged31Difficulty050 = repeatingAttributeInteger("attackRanged3", "attackRanged1Difficulty050");
var attackRanged31Difficulty100 = repeatingAttributeInteger("attackRanged3", "attackRanged1Difficulty100");
var attackRanged31Difficulty200 = repeatingAttributeInteger("attackRanged3", "attackRanged1Difficulty200");
var attackRanged31Difficulty400 = repeatingAttributeInteger("attackRanged3", "attackRanged1Difficulty400");
var attackRanged31Difficulty800 = repeatingAttributeInteger("attackRanged3", "attackRanged1Difficulty800");
var attackRanged33Difficulty012 = repeatingAttributeInteger("attackRanged3", "attackRanged3Difficulty012");
var attackRanged33Difficulty025 = repeatingAttributeInteger("attackRanged3", "attackRanged3Difficulty025");
var attackRanged33Difficulty050 = repeatingAttributeInteger("attackRanged3", "attackRanged3Difficulty050");
var attackRanged33Difficulty100 = repeatingAttributeInteger("attackRanged3", "attackRanged3Difficulty100");
var hit = attributeInteger("hit");
var hit_max = attributeInteger("hit_max");
var hitDecrement = act("hitDecrement");
var hitReset = act("hitReset");
var armorHeadStoppingPower = attributeInteger("armorHeadStoppingPower");
var armorHeadStoppingPower_max = attributeInteger("armorHeadStoppingPower_max");
var armorHeadName = attributeString("armorHeadName");
var armorHeadStoppingPowerDecrement = act("armorHeadStoppingPowerDecrement");
var armorHeadStoppingPowerReset = act("armorHeadStoppingPowerReset");
var armorBodyStoppingPower = attributeInteger("armorBodyStoppingPower");
var armorBodyStoppingPower_max = attributeInteger("armorBodyStoppingPower_max");
var armorBodyName = attributeString("armorBodyName");
var armorBodyStoppingPowerDecrement = act("armorBodyStoppingPowerDecrement");
var armorBodyStoppingPowerReset = act("armorBodyStoppingPowerReset");
var conditionGrappled = attributeBoolean("conditionGrappled");
var conditionProne = attributeBoolean("conditionProne");
var deathSave = attributeInteger("deathSave");
var deathSaveIncrement = act("deathSaveIncrement");
var deathSaveReset = act("deathSaveReset");
var damageType = attribute("damageType", serializerDeserializerDamageType);
var damageLocation = attribute("damageLocation", serializerDeserializerDamageLocation);
var damage1 = attributeInteger("damage1");
var damage2 = attributeInteger("damage2");
var damage3 = attributeInteger("damage3");
var damage = act("damage");
var cyberwareAllRoll = repeatingAttributeString("cyberwareAll", "rollCyberware");
var cyberwareAllRollWithDifficulty = repeatingAttributeString("cyberwareAll", "rollCyberwareWithDifficulty");
var cyberwareAllRollWithDifficultyFirstAid = repeatingAttributeString("cyberwareAll", "rollCyberwareWithDifficultyFirstAid");
var cyberwareAllRollInitiative = repeatingAttributeString("cyberwareAll", "rollCyberwareInitiative");
var cyberwareAllRollReputation = repeatingAttributeString("cyberwareAll", "rollCyberwareReputation");
var cyberwareAllSum = repeatingAttributeInteger("cyberwareAll", "cyberwareSum");
var cyberwareAll = repeatingAttributeInteger("cyberwareAll", "cyberware");
var cyberwareAllTarget = repeatingAttribute("cyberwareAll", "cyberwareTarget", serializerDeserializerCyberwareTarget);
var cyberwareAllTargetName = repeatingAttributeString("cyberwareAll", "cyberwareTargetName");
var cyberwareAllName = repeatingAttributeInteger("cyberwareAll", "cyberwareName");
var cyberwareSomeRoll = repeatingAttributeString("cyberwareSome", "rollCyberware");
var cyberwareSomeRollWithDifficulty = repeatingAttributeString("cyberwareSome", "rollCyberwareWithDifficulty");
var cyberwareSomeRollWithDifficultyFirstAid = repeatingAttributeString("cyberwareSome", "rollCyberwareWithDifficultyFirstAid");
var cyberwareSomeRollInitiative = repeatingAttributeString("cyberwareSome", "rollCyberwareInitiative");
var cyberwareSomeRollReputation = repeatingAttributeString("cyberwareSome", "rollCyberwareReputation");
var cyberwareSomeSum = repeatingAttributeInteger("cyberwareSome", "cyberwareSum");
var cyberwareSome = repeatingAttributeInteger("cyberwareSome", "cyberware");
var cyberwareSomeTarget = repeatingAttribute("cyberwareSome", "cyberwareTarget", serializerDeserializerCyberwareTarget);
var cyberwareSomeName = repeatingAttributeInteger("cyberwareSome", "cyberwareName");
var sheetChangeInput = statisticBody
    .plus(statisticCool)
    .plus(statisticDexterity)
    .plus(statisticEmpathy)
    .plus(statisticIntelligence)
    .plus(statisticLuck)
    .plus(statisticMove)
    .plus(statisticReflexes)
    .plus(statisticTechnique)
    .plus(statisticWill)
    .plus(skillAthletics)
    .plus(skillBasicTech)
    .plus(skillBrawling)
    .plus(skillBribery)
    .plus(skillConcentration)
    .plus(skillConversation)
    .plus(skillCyberTech)
    .plus(skillDriving)
    .plus(skillEducation)
    .plus(skillEvasion)
    .plus(skillFirstAid)
    .plus(skillHumanPerception)
    .plus(skillInterrogation)
    .plus(skillLocalExpert)
    .plus(skillMarksmanship)
    .plus(skillMeleeWeapon)
    .plus(skillPerception)
    .plus(skillPersuasion)
    .plus(skillPlayInstrument)
    .plus(skillStealth)
    .plus(skillTracking)
    .plus(attackReputation)
    .plus(hit)
    .plus(conditionGrappled)
    .plus(cyberwareAllRollWithDifficulty)
    .plus(cyberwareAllRollWithDifficultyFirstAid)
    .plus(cyberwareAllRollInitiative)
    .plus(cyberwareAllRollReputation)
    .plus(cyberwareAll)
    .plus(cyberwareAllTarget)
    .plus(cyberwareSomeRollWithDifficulty)
    .plus(cyberwareSomeRollWithDifficultyFirstAid)
    .plus(cyberwareSomeRollInitiative)
    .plus(cyberwareSomeRollReputation)
    .plus(cyberwareSome)
    .plus(cyberwareSomeTarget);
var sheetReadInput = hit_max
    .plus(luck)
    .plus(luck_max);
var sheetDamage = damageLocation
    .plus(damageType)
    .plus(hit)
    .plus(armorBodyStoppingPower)
    .plus(armorHeadStoppingPower)
    .plus(damage1)
    .plus(damage2)
    .plus(damage3);
hitReset.onClick(function (event) {
    return hit_max.readMaybe(function (sourceValue, valueMaybe) {
        return valueMaybe.map(function (value) {
            return hit.write(value);
        });
    });
});
hitDecrement.onClick(function (event) {
    return hit.readMaybe(function (sourceValue, valueMaybe) {
        return valueMaybe.map(function (value) {
            return hit.write(value > 0 ? value - 1 : 0);
        });
    });
});
luckReset.onClick(function (event) {
    return luck_max.readMaybe(function (sourceValue, valueMaybe) {
        return valueMaybe.map(function (value) {
            return luck.write(value);
        });
    });
});
luckDecrement.onClick(function (event) {
    return luck.readMaybe(function (sourceValue, valueMaybe) {
        return valueMaybe.map(function (value) {
            return luck.write(value > 0 ? value - 1 : 0);
        });
    });
});
armorHeadStoppingPowerReset.onClick(function (event) {
    return armorHeadStoppingPower_max.readMaybe(function (sourceValue, valueMaybe) {
        return valueMaybe.map(function (value) {
            return armorHeadStoppingPower.write(value);
        });
    });
});
armorHeadStoppingPowerDecrement.onClick(function (event) {
    return armorHeadStoppingPower.readMaybe(function (sourceValue, valueMaybe) {
        return valueMaybe.map(function (value) {
            return armorHeadStoppingPower.write(value > 0 ? value - 1 : 0);
        });
    });
});
armorBodyStoppingPowerReset.onClick(function (event) {
    return armorBodyStoppingPower_max.readMaybe(function (sourceValue, valueMaybe) {
        return valueMaybe.map(function (value) {
            return armorBodyStoppingPower.write(value);
        });
    });
});
armorBodyStoppingPowerDecrement.onClick(function (event) {
    return armorBodyStoppingPower.readMaybe(function (sourceValue, valueMaybe) {
        return valueMaybe.map(function (value) {
            return armorBodyStoppingPower.write(value > 0 ? value - 1 : 0);
        });
    });
});
deathSaveIncrement.onClick(function (event) {
    return deathSave.readMaybe(function (sourceValue, valueMaybe) {
        return valueMaybe.map(function (value) {
            return deathSave.write(value + 1);
        });
    });
});
deathSaveReset.onClick(function (event) {
    return deathSave.write(0);
});
onOpen(function () {
    return sheetChangeInput.readMaybe(function (sourceValueReadonly, valueReadonly) {
        return sheetReadInput.readMaybe(function (sourceValue, value) {
            return onUpdate(new Sheet(just(sourceValueReadonly), valueReadonly, just(sourceValue), value));
        });
    });
});
sheetChangeInput.onChangeMaybe(function (event) {
    return sheetReadInput.readMaybe(function (sourceValue, value) {
        return onUpdate(new Sheet(just(event.source), event.valueNew, just(sourceValue), value));
    });
});
damage.onClick(function (event) {
    return sheetDamage.readMaybe(function (sourceValue, valueMaybe) {
        return onCalculate(sheet(sourceValue, valueMaybe));
    });
});

function onUpdate(sheet) {
    // seriously wounded, -3 to checks
    // mortally wounded, -5 to checks
    var modWounded = sheet.get(hit)
        .bind(function (hit) {
            return sheet.get(hit_max)
                .map(function (hitMax) {
                    return hit < Math.ceil(hitMax / 2) ?
                        hit === 0 ?
                            -5 :
                            -3 :
                        0;
                });
        })
        .orValue(0);
    // grappled, -3 to checks
    var modConditionGrab = sheet.get(conditionGrappled).map(function (conditionGrappled) {
        return conditionGrappled ? -3 : 0;
    }).orValue(0);

    function modCyberware(cyberwareTarget) {
        return sheet.get(cyberwareAllTarget).map(function (cyberwareAllTargetInner) {
            return Object.keys(cyberwareAllTargetInner)
                .filter(function (repeatingId) {
                    return cyberwareAllTargetInner[repeatingId] === cyberwareTarget;
                })
                .reduce(function (cyberwareSum, repeatingId) {
                    return cyberwareSum + sheet.get(cyberwareAll)
                        .map(function (cyberwareAllInner) {
                            return cyberwareAllInner[repeatingId];
                        })
                        .orValue(0);
                }, 0);
        })
            .orValue(0);
    }

    function cyberwareSumFor(sheet, cyberwareTarget) {
        return cyberwareTargetMatch(cyberwareTarget, function (ignore) {
            return sheet.get(statisticIntelligenceSum);
        }, function (ignore) {
            return sheet.get(statisticReflexesSum);
        }, function (ignore) {
            return sheet.get(statisticDexteritySum);
        }, function (ignore) {
            return sheet.get(statisticTechniqueSum);
        }, function (ignore) {
            return sheet.get(statisticCoolSum);
        }, function (ignore) {
            return sheet.get(statisticWillSum);
        }, function (ignore) {
            return sheet.get(statisticLuckSum);
        }, function (ignore) {
            return sheet.get(statisticMoveSum);
        }, function (ignore) {
            return sheet.get(statisticBodySum);
        }, function (ignore) {
            return sheet.get(statisticEmpathySum);
        }, function (ignore) {
            return sheet.get(skillAthleticsSum);
        }, function (ignore) {
            return sheet.get(skillBasicTechSum);
        }, function (ignore) {
            return sheet.get(skillBrawlingSum);
        }, function (ignore) {
            return sheet.get(skillBriberySum);
        }, function (ignore) {
            return sheet.get(skillConcentrationSum);
        }, function (ignore) {
            return sheet.get(skillConversationSum);
        }, function (ignore) {
            return sheet.get(skillCyberTechSum);
        }, function (ignore) {
            return sheet.get(skillDrivingSum);
        }, function (ignore) {
            return sheet.get(skillEducationSum);
        }, function (ignore) {
            return sheet.get(skillEvasionSum);
        }, function (ignore) {
            return sheet.get(skillFirstAidSum);
        }, function (ignore) {
            return sheet.get(skillHumanPerceptionSum);
        }, function (ignore) {
            return sheet.get(skillInterrogationSum);
        }, function (ignore) {
            return sheet.get(skillLocalExpertSum);
        }, function (ignore) {
            return sheet.get(skillMarksmanshipSum);
        }, function (ignore) {
            return sheet.get(skillMeleeWeaponSum);
        }, function (ignore) {
            return sheet.get(skillPerceptionSum);
        }, function (ignore) {
            return sheet.get(skillPersuasionSum);
        }, function (ignore) {
            return sheet.get(skillPlayInstrumentSum);
        }, function (ignore) {
            return sheet.get(skillStealthSum);
        }, function (ignore) {
            return sheet.get(skillTrackingSum);
        }, function (ignore) {
            return sheet.get(attackInitiativeSum);
        }, function (ignore) {
            return sheet.get(attackReputationSum);
        });
    }

    function cyberwareAllTargetNameFor(cyberwareTarget) {
        return cyberwareTargetMatch(cyberwareTarget, function (ignore) {
            return just("Intelligence");
        }, function (ignore) {
            return just("Reflexes");
        }, function (ignore) {
            return just("Dexterity");
        }, function (ignore) {
            return just("Technique");
        }, function (ignore) {
            return just("Cool");
        }, function (ignore) {
            return just("Will");
        }, function (ignore) {
            return just("Luck");
        }, function (ignore) {
            return just("Move");
        }, function (ignore) {
            return just("Body");
        }, function (ignore) {
            return just("Empathy");
        }, function (ignore) {
            return just("Athletics");
        }, function (ignore) {
            return just("Basic Tech");
        }, function (ignore) {
            return just("Brawling");
        }, function (ignore) {
            return just("Bribery");
        }, function (ignore) {
            return just("Concentration");
        }, function (ignore) {
            return just("Conversation");
        }, function (ignore) {
            return just("Cyber Tech");
        }, function (ignore) {
            return just("Driving");
        }, function (ignore) {
            return just("Education");
        }, function (ignore) {
            return just("Evasion");
        }, function (ignore) {
            return just("First Aid");
        }, function (ignore) {
            return just("Human Perception");
        }, function (ignore) {
            return just("Interrogation");
        }, function (ignore) {
            return just("Local Expert");
        }, function (ignore) {
            return just("Marksmanship");
        }, function (ignore) {
            return just("Melee Weapon");
        }, function (ignore) {
            return just("Perception");
        }, function (ignore) {
            return just("Persuasion");
        }, function (ignore) {
            return just("Play Instrument");
        }, function (ignore) {
            return just("Stealth");
        }, function (ignore) {
            return just("Tracking");
        }, function (ignore) {
            return just("Initiative");
        }, function (ignore) {
            return just("Reputation");
        });
    }

    function cyberwareRollFor(cyberwareTarget, cyberwareRollWithDifficulty, cyberwareRollWithDifficultyFirstAid, cyberwareRollInitiative, cyberwareRollReputation) {
        return cyberwareTargetMatch(cyberwareTarget, function (ignore) {
            return cyberwareRollWithDifficulty;
        }, function (ignore) {
            return cyberwareRollWithDifficulty;
        }, function (ignore) {
            return cyberwareRollWithDifficulty;
        }, function (ignore) {
            return cyberwareRollWithDifficulty;
        }, function (ignore) {
            return cyberwareRollWithDifficulty;
        }, function (ignore) {
            return cyberwareRollWithDifficulty;
        }, function (ignore) {
            return cyberwareRollWithDifficulty;
        }, function (ignore) {
            return cyberwareRollWithDifficulty;
        }, function (ignore) {
            return cyberwareRollWithDifficulty;
        }, function (ignore) {
            return cyberwareRollWithDifficulty;
        }, function (ignore) {
            return cyberwareRollWithDifficulty;
        }, function (ignore) {
            return cyberwareRollWithDifficulty;
        }, function (ignore) {
            return cyberwareRollWithDifficulty;
        }, function (ignore) {
            return cyberwareRollWithDifficulty;
        }, function (ignore) {
            return cyberwareRollWithDifficulty;
        }, function (ignore) {
            return cyberwareRollWithDifficulty;
        }, function (ignore) {
            return cyberwareRollWithDifficulty;
        }, function (ignore) {
            return cyberwareRollWithDifficulty;
        }, function (ignore) {
            return cyberwareRollWithDifficulty;
        }, function (ignore) {
            return cyberwareRollWithDifficulty;
        }, function (ignore) {
            return cyberwareRollWithDifficultyFirstAid;
        }, function (ignore) {
            return cyberwareRollWithDifficulty;
        }, function (ignore) {
            return cyberwareRollWithDifficulty;
        }, function (ignore) {
            return cyberwareRollWithDifficulty;
        }, function (ignore) {
            return cyberwareRollWithDifficulty;
        }, function (ignore) {
            return cyberwareRollWithDifficulty;
        }, function (ignore) {
            return cyberwareRollWithDifficulty;
        }, function (ignore) {
            return cyberwareRollWithDifficulty;
        }, function (ignore) {
            return cyberwareRollWithDifficulty;
        }, function (ignore) {
            return cyberwareRollWithDifficulty;
        }, function (ignore) {
            return cyberwareRollWithDifficulty;
        }, function (ignore) {
            return cyberwareRollInitiative;
        }, function (ignore) {
            return cyberwareRollReputation;
        });
    }

    sheet.set(statisticIntelligenceSum, sheet.get(statisticIntelligence).map(function (value) {
        return value + modWounded + modConditionGrab + modCyberware(CyberwareTarget.StatisticIntelligenceSum);
    }))
        // @formatter:off
        .bind(function (sheet) { return sheet.set(statisticReflexesSum, sheet.get(statisticReflexes).map(function (value) { return value + modWounded + modConditionGrab + modCyberware(CyberwareTarget.StatisticReflexesSum); })); })
        .bind(function (sheet) { return sheet.set(statisticDexteritySum, sheet.get(statisticDexterity).map(function (value) { return value + modWounded + modConditionGrab + modCyberware(CyberwareTarget.StatisticDexteritySum); })); })
        .bind(function (sheet) { return sheet.set(statisticTechniqueSum, sheet.get(statisticTechnique).map(function (value) { return value + modWounded + modConditionGrab + modCyberware(CyberwareTarget.StatisticTechniqueSum); })); })
        .bind(function (sheet) { return sheet.set(statisticCoolSum, sheet.get(statisticCool).map(function (value) { return value + modWounded + modConditionGrab + modCyberware(CyberwareTarget.StatisticCoolSum); })); })
        .bind(function (sheet) { return sheet.set(statisticWillSum, sheet.get(statisticWill).map(function (value) { return value + modWounded + modConditionGrab + modCyberware(CyberwareTarget.StatisticWillSum); })); })
        .bind(function (sheet) { return sheet.set(statisticLuckSum, sheet.get(statisticLuck).map(function (value) { return value + modWounded + modConditionGrab + modCyberware(CyberwareTarget.StatisticLuckSum); })); })
        .bind(function (sheet) { return sheet.set(statisticMoveSum, sheet.get(statisticMove).map(function (value) { return value + modWounded + modConditionGrab + modCyberware(CyberwareTarget.StatisticMoveSum); })); })
        .bind(function (sheet) { return sheet.set(statisticBodySum, sheet.get(statisticBody).map(function (value) { return value + modWounded + modConditionGrab + modCyberware(CyberwareTarget.StatisticBodySum); })); })
        .bind(function (sheet) { return sheet.set(statisticEmpathySum, sheet.get(statisticEmpathy).map(function (value) { return value + modWounded + modConditionGrab + modCyberware(CyberwareTarget.StatisticEmpathySum); })); })
        .bind(function (sheet) { return sheet.set(skillAthleticsSum, sheet.get(statisticDexterity).map(function (statistic) { return statistic + sheet.get(skillAthletics).orValue(0) + modWounded + modConditionGrab + modCyberware(CyberwareTarget.SkillAthleticsSum); })); })
        .bind(function (sheet) { return sheet.set(skillBasicTechSum, sheet.get(statisticTechnique).map(function (statistic) { return statistic + sheet.get(skillBasicTech).orValue(0) + modWounded + modConditionGrab + modCyberware(CyberwareTarget.SkillBasicTechSum); })); })
        .bind(function (sheet) { return sheet.set(skillBrawlingSum, sheet.get(statisticDexterity).map(function (statistic) { return statistic + sheet.get(skillBrawling).orValue(0) + modWounded + modConditionGrab + modCyberware(CyberwareTarget.SkillBrawlingSum); })); })
        .bind(function (sheet) { return sheet.set(skillBriberySum, sheet.get(statisticCool).map(function (statistic) { return statistic + sheet.get(skillBribery).orValue(0) + modWounded + modConditionGrab + modCyberware(CyberwareTarget.SkillBriberySum); })); })
        .bind(function (sheet) { return sheet.set(skillConcentrationSum, sheet.get(statisticWill).map(function (statistic) { return statistic + sheet.get(skillConcentration).orValue(0) + modWounded + modConditionGrab + modCyberware(CyberwareTarget.SkillConcentrationSum); })); })
        .bind(function (sheet) { return sheet.set(skillConversationSum, sheet.get(statisticCool).map(function (statistic) { return statistic + sheet.get(skillConversation).orValue(0) + modWounded + modConditionGrab + modCyberware(CyberwareTarget.SkillConversationSum); })); })
        .bind(function (sheet) { return sheet.set(skillCyberTechSum, sheet.get(statisticTechnique).map(function (statistic) { return statistic + sheet.get(skillCyberTech).orValue(0) + modWounded + modConditionGrab + modCyberware(CyberwareTarget.SkillCyberTechSum); })); })
        .bind(function (sheet) { return sheet.set(skillDrivingSum, sheet.get(statisticReflexes).map(function (statistic) { return statistic + sheet.get(skillDriving).orValue(0) + modWounded + modConditionGrab + modCyberware(CyberwareTarget.SkillDrivingSum); })); })
        .bind(function (sheet) { return sheet.set(skillEducationSum, sheet.get(statisticIntelligence).map(function (statistic) { return statistic + sheet.get(skillEducation).orValue(0) + modWounded + modConditionGrab + modCyberware(CyberwareTarget.SkillEducationSum); })); })
        .bind(function (sheet) { return sheet.set(skillEvasionSum, sheet.get(statisticReflexes).map(function (statistic) { return statistic + sheet.get(skillEvasion).orValue(0) + modWounded + modConditionGrab + modCyberware(CyberwareTarget.SkillEvasionSum); })); })
        .bind(function (sheet) { return sheet.set(skillFirstAidSum, sheet.get(statisticTechnique).map(function (statistic) { return statistic + sheet.get(skillFirstAid).orValue(0) + modWounded + modConditionGrab + modCyberware(CyberwareTarget.SkillFirstAidSum); })); })
        .bind(function (sheet) { return sheet.set(skillHumanPerceptionSum, sheet.get(statisticEmpathy).map(function (statistic) { return statistic + sheet.get(skillHumanPerception).orValue(0) + modWounded + modConditionGrab + modCyberware(CyberwareTarget.SkillHumanPerceptionSum); })); })
        .bind(function (sheet) { return sheet.set(skillInterrogationSum, sheet.get(statisticCool).map(function (statistic) { return statistic + sheet.get(skillInterrogation).orValue(0) + modWounded + modConditionGrab + modCyberware(CyberwareTarget.SkillInterrogationSum); })); })
        .bind(function (sheet) { return sheet.set(skillLocalExpertSum, sheet.get(statisticIntelligence).map(function (statistic) { return statistic + sheet.get(skillLocalExpert).orValue(0) + modWounded + modConditionGrab + modCyberware(CyberwareTarget.SkillLocalExpertSum); })); })
        .bind(function (sheet) { return sheet.set(skillMarksmanshipSum, sheet.get(statisticReflexes).map(function (statistic) { return statistic + sheet.get(skillMarksmanship).orValue(0) + modWounded + modConditionGrab + modCyberware(CyberwareTarget.SkillMarksmanshipSum); })); })
        .bind(function (sheet) { return sheet.set(skillMeleeWeaponSum, sheet.get(statisticDexterity).map(function (statistic) { return statistic + sheet.get(skillMeleeWeapon).orValue(0) + modWounded + modConditionGrab + modCyberware(CyberwareTarget.SkillMeleeWeaponSum); })); })
        .bind(function (sheet) { return sheet.set(skillPerceptionSum, sheet.get(statisticIntelligence).map(function (statistic) { return statistic + sheet.get(skillPerception).orValue(0) + modWounded + modConditionGrab + modCyberware(CyberwareTarget.SkillPerceptionSum); })); })
        .bind(function (sheet) { return sheet.set(skillPersuasionSum, sheet.get(statisticCool).map(function (statistic) { return statistic + sheet.get(skillPersuasion).orValue(0) + modWounded + modConditionGrab + modCyberware(CyberwareTarget.SkillPersuasionSum); })); })
        .bind(function (sheet) { return sheet.set(skillPlayInstrumentSum, sheet.get(statisticEmpathy).map(function (statistic) { return statistic + sheet.get(skillPlayInstrument).orValue(0) + modWounded + modConditionGrab + modCyberware(CyberwareTarget.SkillPlayInstrumentSum); })); })
        .bind(function (sheet) { return sheet.set(skillStealthSum, sheet.get(statisticDexterity).map(function (statistic) { return statistic + sheet.get(skillStealth).orValue(0) + modWounded + modConditionGrab + modCyberware(CyberwareTarget.SkillStealthSum); })); })
        .bind(function (sheet) { return sheet.set(skillTrackingSum, sheet.get(statisticIntelligence).map(function (statistic) { return statistic + sheet.get(skillTracking).orValue(0) + modWounded + modConditionGrab + modCyberware(CyberwareTarget.SkillTrackingSum); })); })
        .bind(function (sheet) { return sheet.set(attackReputationSum, sheet.get(statisticCool).map(function (statistic) { return statistic + sheet.get(attackReputation).orValue(0) + modWounded + modConditionGrab + modCyberware(CyberwareTarget.AttackReputationSum); })); })
        .bind(function (sheet) { return sheet.set(attackInitiativeSum, sheet.get(statisticReflexes).map(function (statistic) { return statistic + modCyberware(CyberwareTarget.AttackInitiativeSum); })); })
        .bind(function (sheet) { return sheet.set(attackChokingSum, sheet.get(statisticBody)); })
        .bind(function (sheet) { return sheet.set(attackThrowingSum, sheet.get(statisticBody)); })
        .bind(function (sheet) { return sheet.set(attackBrawlingDamage, sheet.get(statisticBody).map(function (statistic) { return statistic > 2 ? Math.floor((statistic - 1) / 2) : 0; })); })
        .bind(function (sheet) { return sheet.set(attackGrapplingSum, sheet.get(skillAthleticsSum)
        .map(function (skillAthleticsSum) {
        return sheet.get(skillBrawlingSum)
            .map(function (skillBrawlingSum) { return Math.max(skillAthleticsSum, skillBrawlingSum) + modWounded + modConditionGrab; })
            .orValue(skillAthleticsSum + modWounded + modConditionGrab);
    })
        .orMaybe(sheet.get(skillBrawlingSum)
        .map(function (skillBrawlingSum) { return skillBrawlingSum + modWounded + modConditionGrab; }))); })
        .bind(function (sheet) { return sheet.set(hit_max, sheet.get(statisticBody).map(function (statistic) { return (statistic + modCyberware(CyberwareTarget.StatisticBodySum)) * 5; })); })
        .bind(function (sheet) { return sheet.set(luck_max, sheet.get(statisticLuck).map(function (statistic) { return (statistic + modCyberware(CyberwareTarget.StatisticLuckSum)); })); })
        // @formatter:on
        .bind(function (sheet) {
            return sheet.set(cyberwareAllSum, sheet.get(cyberwareAllTarget)
                .map(function (cyberwareAllTargetInner) {
                    return Object.keys(cyberwareAllTargetInner)
                        .reduce(function (record, repeatingId) {
                            return cyberwareSumFor(sheet, cyberwareAllTargetInner[repeatingId])
                                .map(function (value) {
                                    return assign(record, repeatingId, value);
                                })
                                .orValue(record);
                        }, {});
                }));
        })
        .bind(function (sheet) {
            return sheet.set(cyberwareAllTargetName, sheet.get(cyberwareAllTarget)
                .map(function (cyberwareAllTargetInner) {
                    return Object.keys(cyberwareAllTargetInner)
                        .reduce(function (record, repeatingId) {
                            return cyberwareAllTargetNameFor(cyberwareAllTargetInner[repeatingId])
                                .map(function (value) {
                                    return assign(record, repeatingId, value);
                                })
                                .orValue(record);
                        }, {});
                }));
        })
        .bind(function (sheet) {
            return sheet.set(cyberwareAllRoll, sheet.get(cyberwareAllTarget)
                .map(function (cyberwareAllTargetInner) {
                    return Object.keys(cyberwareAllTargetInner)
                        .reduce(function (record, repeatingId) {
                            return cyberwareRollFor(cyberwareAllTargetInner[repeatingId], sheet.get(cyberwareAllRollWithDifficulty).map(function (value) {
                                return value[repeatingId];
                            }), sheet.get(cyberwareAllRollWithDifficultyFirstAid).map(function (value) {
                                return value[repeatingId];
                            }), sheet.get(cyberwareAllRollInitiative).map(function (value) {
                                return value[repeatingId];
                            }), sheet.get(cyberwareAllRollReputation).map(function (value) {
                                return value[repeatingId];
                            }))
                                .map(function (value) {
                                    return assign(record, repeatingId, value);
                                })
                                .orValue(record);
                        }, {});
                }));
        })
        .bind(function (sheet) {
            return sheet.set(cyberwareSomeSum, sheet.get(cyberwareSomeTarget)
                .bind(function (cyberwareSomeTargetInner) {
                    return sheet.get(cyberwareSome)
                        .map(function (cyberwareSomeInner) {
                            return Object.keys(cyberwareSomeTargetInner).filter(function (repeatingId) {
                                return Object.keys(cyberwareSomeInner).includes(repeatingId);
                            })
                                .reduce(function (record, repeatingId) {
                                    return cyberwareSumFor(sheet, cyberwareSomeTargetInner[repeatingId])
                                        .map(function (value) {
                                            return assign(record, repeatingId, cyberwareSomeInner[repeatingId] + value);
                                        })
                                        .orValue(record);
                                }, {});
                        });
                }));
        })
        .bind(function (sheet) {
            return sheet.set(cyberwareSomeRoll, sheet.get(cyberwareSomeTarget)
                .map(function (cyberwareSomeTarget) {
                    return Object.keys(cyberwareSomeTarget)
                        .reduce(function (record, repeatingId) {
                            return cyberwareRollFor(cyberwareSomeTarget[repeatingId], sheet.get(cyberwareSomeRollWithDifficulty).map(function (value) {
                                return value[repeatingId];
                            }), sheet.get(cyberwareSomeRollWithDifficultyFirstAid).map(function (value) {
                                return value[repeatingId];
                            }), sheet.get(cyberwareSomeRollInitiative).map(function (value) {
                                return value[repeatingId];
                            }), sheet.get(cyberwareSomeRollReputation).map(function (value) {
                                return value[repeatingId];
                            }))
                                .map(function (value) {
                                    return assign(record, repeatingId, value);
                                })
                                .orValue(record);
                        }, {});
                }));
        })
        .sequenceLeft(function (sheetMaybe) {
            return just(sheetMaybe.match(function () {
                throw new Error("The system cannot write to a readonly source.");
            }, function (sheet) {
                return sheet.write();
            }));
        });
}

function onCalculate(sheet) {
    sheet.get(damageLocation).bind(function (damageLocation) {
        return sheet.get(damageType).bind(function (damageType) {
            return sheet.get(hit).bind(function (hitValue) {
                return damageLocationMatch(damageLocation, function (damageLocation) {
                    return sheet.get(armorHeadStoppingPower).bind(function (armorHeadStoppingPowerValue) {
                        return damageTypeMatch(damageType,
                            // up to two attacks
                            // if head armor stopping power is zero
                            // hit is 2 * damage
                            function (damageType) {
                                return sheet.set(hit, just(Math.max(hitValue -
                                    (armorHeadStoppingPowerValue === 0 ?
                                        2 * (sheet.get(damage1).orValue(0) + sheet.get(damage2).orValue(0)) :
                                        0), 0)));
                            },
                            // up to two attacks, each ablates armor
                            // hit is 2 * damage less head armor stopping power / 2
                            function (damageType) {
                                return sheet.set(hit, just(Math.max(hitValue -
                                    (2 * sheet.get(damage1).map(function (damage) {
                                            return Math.max(damage - Math.ceil(armorHeadStoppingPowerValue / 2), 0);
                                        }).orValue(0) +
                                        2 * sheet.get(damage2).map(function (damage) {
                                            return Math.max(damage - Math.ceil(armorHeadStoppingPowerValue / 2), 0);
                                        }).orValue(0)), 0)))
                                    .bind(function (sheet) {
                                        return sheet.set(armorHeadStoppingPower, just(Math.max(armorHeadStoppingPowerValue -
                                            (sheet.get(damage1).map(function (damage) {
                                                    return damage === 0 ? 0 : 1;
                                                }).orValue(0) +
                                                sheet.get(damage2).map(function (damage) {
                                                    return damage === 0 ? 0 : 1;
                                                }).orValue(0)), 0)));
                                    });
                            },
                            // up to three attacks, one ablates armor
                            // hit is 2 * damage less head armor stopping power
                            function (damageType) {
                                return sheet.set(hit, just(Math.max(hitValue -
                                    (2 * sheet.get(damage1).map(function (damage) {
                                            return Math.max(damage - Math.ceil(armorHeadStoppingPowerValue), 0);
                                        }).orValue(0) +
                                        2 * sheet.get(damage2).map(function (damage) {
                                            return Math.max(damage - Math.ceil(armorHeadStoppingPowerValue), 0);
                                        }).orValue(0) +
                                        2 * sheet.get(damage3).map(function (damage) {
                                            return Math.max(damage - Math.ceil(armorHeadStoppingPowerValue), 0);
                                        }).orValue(0)), 0)))
                                    .bind(function (sheet) {
                                        return sheet.set(armorHeadStoppingPower, just(Math.max(armorHeadStoppingPowerValue -
                                            (sheet.get(damage1).bind(function (damage1) {
                                                return sheet.get(damage2).bind(function (damage2) {
                                                    return sheet.get(damage3).map(function (damage3) {
                                                        return damage1 === 0 && damage2 === 0 && damage3 === 0 ?
                                                            0 :
                                                            1;
                                                    });
                                                });
                                            })
                                                .orValue(0)), 0)));
                                    });
                            });
                    });
                }, function (damageLocation) {
                    return sheet.get(armorBodyStoppingPower).bind(function (armorBodyStoppingPowerValue) {
                        return damageTypeMatch(damageType,
                            // up to two attacks
                            // if body armor stopping power is zero
                            // hit is damage
                            function (damageType) {
                                return sheet.set(hit, just(Math.max(hitValue -
                                    (armorBodyStoppingPowerValue === 0 ?
                                        sheet.get(damage1).orValue(0) + sheet.get(damage2).orValue(0) :
                                        0), 0)));
                            },
                            // up to two attacks, each ablates armor
                            // hit is damage less body armor stopping power / 2
                            function (damageType) {
                                return sheet.set(hit, just(Math.max(hitValue -
                                    (sheet.get(damage1).map(function (damage) {
                                            return Math.max(damage - Math.ceil(armorBodyStoppingPowerValue / 2), 0);
                                        }).orValue(0) +
                                        sheet.get(damage2).map(function (damage) {
                                            return Math.max(damage - Math.ceil(armorBodyStoppingPowerValue / 2), 0);
                                        }).orValue(0)), 0)))
                                    .bind(function (sheet) {
                                        return sheet.set(armorBodyStoppingPower, just(Math.max(armorBodyStoppingPowerValue -
                                            (sheet.get(damage1).map(function (damage) {
                                                    return damage === 0 ? 0 : 1;
                                                }).orValue(0) +
                                                sheet.get(damage2).map(function (damage) {
                                                    return damage === 0 ? 0 : 1;
                                                }).orValue(0)), 0)));
                                    });
                            },
                            // up to three attacks, one ablates armor
                            // hit is damage less body armor stopping power
                            function (damageType) {
                                return sheet.set(hit, just(Math.max(hitValue -
                                    (sheet.get(damage1).map(function (damage) {
                                            return Math.max(damage - Math.ceil(armorBodyStoppingPowerValue), 0);
                                        }).orValue(0) +
                                        sheet.get(damage2).map(function (damage) {
                                            return Math.max(damage - Math.ceil(armorBodyStoppingPowerValue), 0);
                                        }).orValue(0) +
                                        sheet.get(damage3).map(function (damage) {
                                            return Math.max(damage - Math.ceil(armorBodyStoppingPowerValue), 0);
                                        }).orValue(0)), 0)))
                                    .bind(function (sheet) {
                                        return sheet.set(armorBodyStoppingPower, just(Math.max(armorBodyStoppingPowerValue -
                                            (sheet.get(damage1).bind(function (damage1) {
                                                return sheet.get(damage2).bind(function (damage2) {
                                                    return sheet.get(damage3).map(function (damage3) {
                                                        return damage1 === 0 && damage2 === 0 && damage3 === 0 ?
                                                            0 :
                                                            1;
                                                    });
                                                });
                                            })
                                                .orValue(0)), 0)));
                                    });
                            });
                    });
                });
            });
        });
    })
        .bind(function (sheet) {
            return sheet.set(damage1, just(0));
        })
        .bind(function (sheet) {
            return sheet.set(damage2, just(0));
        })
        .bind(function (sheet) {
            return sheet.set(damage3, just(0));
        })
        .map(function (sheet) {
            return sheet.write();
        });
}

</script>
