<div class="fadingsuns">
    
    <input class="fs-showarrow fs-h2arrow" type="checkbox" name="attr_background_show" value="1" checked />
    <h2 class="fs-clickheader fs-showsect"><label data-i18n="background">Background</label></h2>
    <div class="fs-h2-section fs-nontable fs-core-details fs-wide-readonly">
        <div class="fs-space-evenly">
            <label class="fs-small-label2 fs-autoexpand"><input title="@{character_name}" type="text" name="attr_character_name" /><span data-i18n="name">Name</span><span name="attr_character_name" class="fs-autoexpand"></span></label>
            <label class="fs-small-label2 fs-autoexpand"><input title="@{alliance}" type="text" name="attr_alliance"/><span data-i18n="alliance">Alliance</span><span name="attr_alliance" class="fs-autoexpand"></span></label>
            <label class="fs-small-label2 fs-autoexpand"><input title="@{title}" type="text" name="attr_title"/><span data-i18n="title">Title</span><span name="attr_title" class="fs-autoexpand"></span></label>
            <label class="fs-small-label2 fs-autoexpand"><input title="@{genre}" type="text" name="attr_genre"/><span data-i18n="genre">Genre</span><span name="attr_genre" class="fs-autoexpand"></span></label>
            <label class="fs-small-label2 fs-autoexpand"><input title="@{race}" type="text" name="attr_race"/><span data-i18n="race">Race</span><span name="attr_race" class="fs-autoexpand"></span></label>
            <label class="fs-small-label2 fs-autoexpand"><input title="@{homeworld}" type="text" name="attr_homeworld"/><span data-i18n="homeworld">Homeworld</span><span name="attr_homeworld" class="fs-autoexpand"></span></label>
            <label class="fs-small-label2 fs-autoexpand"><input title="@{age}" type="text" name="attr_age"/><span data-i18n="age">Age</span><span name="attr_age" class="fs-autoexpand"></span></label>
            <label class="fs-small-label2 fs-autoexpand"><input title="@{height}" type="text" name="attr_height"/><span data-i18n="char_height">Height</span><span name="attr_height" class="fs-autoexpand"></span></label>
            <label class="fs-small-label2 fs-autoexpand"><input title="@{weight}" type="text" name="attr_weight"/><span data-i18n="char_weight">Weight</span><span name="attr_weight" class="fs-autoexpand"></span></label>
            <label class="fs-small-label2 fs-autoexpand"><input title="@{hair}" type="text" name="attr_hair"/><span data-i18n="hair">Hair</span><span name="attr_hair" class="fs-autoexpand"></span></label>
            <label class="fs-small-label2 fs-autoexpand"><input title="@{eyes}" type="text" name="attr_eyes"/><span data-i18n="eyes">Eyes</span><span name="attr_eyes" class="fs-autoexpand"></span></label>
            <label class="fs-small-label2 fs-autoexpand"><input title="@{skintone}" type="text" name="attr_skin"/><span data-i18n="skin">Skin</span><span name="attr_skin" class="fs-autoexpand"></span></label>
        </div>
        <div class="fs-grid-1x2-equal fs-w100">
            <label class="fs-small-label2 fs-wide-textareaparent fs-description"><textarea class="fs-inline-textarea fs-tall-textarea fs-w100" title="@{description}" type="text" name="attr_description" spellcheck="false"></textarea><span data-i18n="description">Description</span></label>
             <div class="fs-col fs-beneficesafflictions fs-h100">
                <div class="fs-row fs-w100">
                    <span class="fs-secondary-table-name" data-i18n="benefices_and_afflictions">Benefices &amp; Afflictions</span>
                </div>
                <div class="fs-col fs-w100">
                    <fieldset class="repeating_beneficesandafflications">
                        <div>
                            <input class="fs-beneficeaffliction" name="attr_benefice_or_affliction" type="text" />
                        </div>
                    </fieldset>
                </div>
            </div>
        </div>
    </div>
    
    <input class="fs-showarrow fs-h2arrow" type="checkbox" name="attr_characteristics_show" value="1" checked />
    <h2 class="fs-clickheader fs-showsect">
        <label data-i18n="characteristics">Characteristics</label>
    </h2>
    <button type="roll" name="roll_characteristic" value="&{template:fs-GoalRoll} {{characteristicName=@{selected_characteristic}}} {{characteristicName-i18n=@{selected_characteristic_i18n}}} {{bonus_malus=[[?{Bonus/Malus|0}]]}} {{goal=[[@{selected_characteristic_value}+?{Bonus/Malus|0}]]}} {{roll=[[1d20cs[[@{selected_characteristic_value}}+?{Bonus/Malus|0},19}kl1]]cf20]]}}"></button>
    <div class="fs-h2-section fs-nontable fs-core-details">
        <div class="fs-grid-characteristics">
            <div class="fs-col fs-grid-characteristics-body">
                <div class="fs-row">
                    <span class="fs-secondary-table-name" data-i18n="body">Body</span>
                </div>
                <div class="fs-characteristic">
                    <button type="roll" name="roll_strength" value="&{template:fs-GoalRoll} {{characteristicName=strength}} {{characteristicName-i18n=^{strength}}} {{bonus_malus=[[?{Bonus/Malus|0}]]}} {{goal=[[@{strength}+?{Bonus/Malus|0}]]}} {{roll=[[1d20cs[[{@{strength}+?{Bonus/Malus|0},19}kl1]]cf20]]}}"></button>
                    <label class="fs-characteristic-label"><input type='radio' name='attr_selected_characteristic' value='strength' /><span data-i18n="strength">Strength</span></label>
                    <input name="attr_strength" type="number" min=0 value=3 />
                </div>
                <div class="fs-characteristic">
                    <button type="roll" name="roll_dexterity" value="!fs_roll,@{character_name},?{Bonus/Malus|0},dexterity,null"></button>
                    <label class="fs-characteristic-label"><input type='radio' name='attr_selected_characteristic' value='dexterity' /><span data-i18n="dexterity">Dexterity</span></label>
                    <input name="attr_dexterity" type="number" min=0 value=3 />
                </div>
                <div class="fs-characteristic">
                    <button type="roll" name="roll_endurance" value="!fs_roll,@{character_name},?{Bonus/Malus|0},endurance,null"></button>
                    <label class="fs-characteristic-label"><input type='radio' name='attr_selected_characteristic' value='endurance' /><span data-i18n="endurance">Endurance</span></label>
                    <input name="attr_endurance" type="number" min=0 value=3 />
                </div>
            </div>
            <div class="fs-col fs-grid-characteristics-mind">
                <div class="fs-row">
                    <span class="fs-secondary-table-name" data-i18n="mind">Mind</span>
                </div>
                <div class="fs-characteristic">
                    <button type="roll" name="roll_wits" value="!fs_roll,@{character_name},?{Bonus/Malus|0},wits,null"></button>
                    <label class="fs-characteristic-label"><input type='radio' name='attr_selected_characteristic' value='wits' /><span data-i18n="wits">Wits</span></label>
                    <input name="attr_wits" type="number" min=0 value=3 />
                </div>
                <div class="fs-characteristic">
                    <button type="roll" name="roll_perception" value="!fs_roll,@{character_name},?{Bonus/Malus|0},perception,null"></button>
                    <label class="fs-characteristic-label"><input type='radio' name='attr_selected_characteristic' value='perception' /><span data-i18n="perception">Perception</span></label>
                    <input name="attr_perception" type="number" min=0 value=3 />
                </div>
                <div class="fs-characteristic">
                    <button type="roll" name="roll_tech" value="!fs_roll,@{character_name},?{Bonus/Malus|0},tech,null"></button>
                    <label class="fs-characteristic-label"><input type='radio' name='attr_selected_characteristic' value='tech' /><span data-i18n="tech">Tech</span></label>
                    <input name="attr_tech" type="number" min=0 value=3 />
                </div>
            </div>
            <div class="fs-col fs-grid-characteristics-spirit">
                <div class="fs-row">
                    <span class="fs-secondary-table-name" data-i18n="spirit">Spirit</span>
                </div>
                <div class="fs-characteristic">
                    <button type="roll" name="roll_presence" value="!fs_roll,@{character_name},?{Bonus/Malus|0},presence,null"></button>
                    <label class="fs-characteristic-label"><input type='radio' name='attr_selected_characteristic' value='presence' /><span data-i18n="presence">Presence</span></label>
                    <input name="attr_presence" type="number" min=0 value=3 />
                </div>
                <div class="fs-characteristic">
                    <button type="roll" name="roll_will" value="!fs_roll,@{character_name},?{Bonus/Malus|0},will,null"></button>
                    <label class="fs-characteristic-label"><input type='radio' name='attr_selected_characteristic' value='will' /><span data-i18n="will">Will</span></label>
                    <input name="attr_will" type="number" min=0 value=3 />
                </div>
                <div class="fs-characteristic">
                    <button type="roll" name="roll_faith" value="!fs_roll,@{character_name},?{Bonus/Malus|0},faith,null"></button>
                    <label class="fs-characteristic-label"><input type='radio' name='attr_selected_characteristic' value='faith' /><span data-i18n="faith">Faith</span></label>
                    <input name="attr_faith" type="number" min=0 value=3 />
                </div>
            </div>
            <div class="fs-grid-characteristics-wyrdvita fs-grid-3x4">
                <label data-i18n="wyrd">Wyrd</label>
                <input type="number" name="attr_wyrd_max" min=0 value=3 />
                <div class="fs-rating">
                    <input name="attr_wyrd" type="radio" value="20" /><span>&#9633;</span><input name="attr_wyrd" type="radio" value="19" /><span>&#9633;</span><input name="attr_wyrd" type="radio" value="18" /><span>&#9633;</span><input name="attr_wyrd" type="radio" value="17" /><span>&#9633;</span><input name="attr_wyrd" type="radio" value="16" /><span>&#9633;</span><input name="attr_wyrd" type="radio" value="15" class="fs-rating-widebox" /><span>&#9633;</span><input name="attr_wyrd" type="radio" value="14" /><span>&#9633;</span><input name="attr_wyrd" type="radio" value="13" /><span>&#9633;</span><input name="attr_wyrd" type="radio" value="12" /><span>&#9633;</span><input name="attr_wyrd" type="radio" value="11" /><span>&#9633;</span><input name="attr_wyrd" type="radio" value="10" class="fs-rating-widebox" /><span>&#9633;</span><input name="attr_wyrd" type="radio" value="9" /><span>&#9633;</span><input name="attr_wyrd" type="radio" value="8" /><span>&#9633;</span><input name="attr_wyrd" type="radio" value="7" /><span>&#9633;</span><input name="attr_wyrd" type="radio" value="6" /><span>&#9633;</span><input name="attr_wyrd" type="radio" value="5" class="fs-rating-widebox" /><span>&#9633;</span><input name="attr_wyrd" type="radio" value="4" /><span>&#9633;</span><input name="attr_wyrd" type="radio" value="3" checked/><span>&#9633;</span><input name="attr_wyrd" type="radio" value="2" /><span>&#9633;</span><input name="attr_wyrd" type="radio" value="1" /><span>&#9633;</span><input name="attr_wyrd" type="radio" value="0" /><span class="fs-rating-null">&#9633;</span>
                </div>
                <span class="fs-after-wyrd-vita"></span>
                
                <label data-i18n="vitality">Vitality</label>
                <input type="number" name="attr_vitality_max" min=0 value=8 />
                <div class="fs-rating">
                    <input name="attr_vitality" type="radio" value="20" /><span>&#9633;</span><input name="attr_vitality" type="radio" value="19" /><span>&#9633;</span><input name="attr_vitality" type="radio" value="18" /><span>&#9633;</span><input name="attr_vitality" type="radio" value="17" /><span>&#9633;</span><input name="attr_vitality" type="radio" value="16" /><span>&#9633;</span><input name="attr_vitality" type="radio" value="15" class="fs-rating-widebox" /><span>&#9633;</span><input name="attr_vitality" type="radio" value="14" /><span>&#9633;</span><input name="attr_vitality" type="radio" value="13" /><span>&#9633;</span><input name="attr_vitality" type="radio" value="12" /><span>&#9633;</span><input name="attr_vitality" type="radio" value="11" /><span>&#9633;</span><input name="attr_vitality" type="radio" value="10" class="fs-rating-widebox" /><span>&#9633;</span><input name="attr_vitality" type="radio" value="9" /><span>&#9633;</span><input name="attr_vitality" type="radio" value="8" checked /><span>&#9633;</span><input name="attr_vitality" type="radio" value="7" /><span>&#9633;</span><input name="attr_vitality" type="radio" value="6" /><span>&#9633;</span><input name="attr_vitality" type="radio" value="5" class="fs-rating-widebox" /><span>&#9633;</span><input name="attr_vitality" type="radio" value="4" /><span>&#9633;</span><input name="attr_vitality" type="radio" value="3" /><span>&#9633;</span><input name="attr_vitality" type="radio" value="2" /><span>&#9633;</span><input name="attr_vitality" type="radio" value="1" /><span>&#9633;</span><input name="attr_vitality" type="radio" value="0" /><span class="fs-rating-null">&#9633;</span>
                </div>
                <span class="fs-after-wyrd-vita"></span>
                
                <div>
                </div>
                <div>
                </div>
                <div class="fs-vitality-malus">
                    <span>&nbsp;</span>
                    <span>-10</span>
                    <span>-8</span>
                    <span>-6</span>
                    <span>-4</span>
                    <span>-2</span>
                </div>
            </div>
            <div class="fs-characteristic fs-grid-characteristics-init">
                <button type="roll" name="initiative" value="&{template:fs-InitRoll} {{stance=?{Posture|Neutre|Attaque : +4 toucher ; -2 Déf|Attaque : +2d dégâs; -2 Déf|Défense : -4 à toute action ; +2 Déf|Défense totale : pas d'action ; +4 Déf}}} {{style=[[?{Style de combat|Non,0|Oui,1}]]}} {{roll=[[@{initiative}+1d6 &{tracker}]]}}"></button>
                <label class="fs-characteristic-label" data-i18n="initiative">Initiative</label>
                <input type="number" name="attr_initiative" min=0 value="6" />
            </div>
            <div class="fs-col fs-grid-characteristics-blessingscurses">
                <div class="fs-row fs-w100">
                    <span class="fs-secondary-table-name" data-i18n="blessings_and_curses">Blessings & Curses</span>
                </div>
                <div class="fs-col fs-w100">
                    <fieldset class="repeating_blessingandcurses">
                        <div>
                            <input class="fs-blessingcurse" name="attr_blessing_or_curse" type="text" />
                        </div>
                    </fieldset>
                </div>
            </div>
        </div>
    </div>

    <input class="fs-showarrow fs-h2arrow" type="checkbox" name="attr_skills_show" value="1" checked />
    <h2 class="fs-clickheader fs-showsect"><label data-i18n="skills">Skills</label></h2>
    <button type="roll" name="roll_skill" value="&{template:fs-GoalRoll} {{characteristicName=@{selected_characteristic}}} {{characteristicName-i18n=@{selected_characteristic_i18n}}} {{skillName=@{selected_skill}}} {{skillName-i18n=@{selected_skill_i18n}}} {{bonus_malus=[[?{Bonus/Malus|0}]]}} {{goal=[[@{selected_characteristic_value}+@{selected_skill_value}+?{Bonus/Malus|0}]]}} {{roll=[[1d20cs[[@{selected_characteristic_value}}+@{selected_skill_value}+?{Bonus/Malus|0},19}kl1]]cf20]]}}"></button>
    <div class="fs-h2-section fs-nontable fs-core-details">
        <div class="fs-grid-skills">
            
            <div class="fs-skill-col">
                
                <div class="fs-row fs-skill-family">
                    <span class="fs-secondary-table-name" data-i18n="analytical">Analytical</span>
                </div>
                <div class="fs-skill">
                    <button type="roll" value="!fs_roll,@{character_name},?{Bonus/Malus|0},@{selected_characteristic},bureaucracy"></button>
                    <label class="fs-skill-label"><input type='radio' name='attr_selected_skill' value='bureaucracy' /><span data-i18n="bureaucracy">Bureaucracy</span></label>
                    <input type="number" name="attr_bureaucracy" min=0 value=0 />
                </div>
                <div class="fs-skill">
                    <button type="roll" value="!fs_roll,@{character_name},?{Bonus/Malus|0},@{selected_characteristic},investigation"></button>
                    <label class="fs-skill-label"><input type='radio' name='attr_selected_skill' value='investigation' /><span data-i18n="investigation">Investigation</span></label>
                    <input type="number" name="attr_investigation" min=0 value=0 />
                </div>
                <div class="fs-skill">
                    <button type="roll" value="!fs_roll,@{character_name},?{Bonus/Malus|0},@{selected_characteristic},observe"></button>
                    <label class="fs-skill-label" data-i18n="observe">Observe</label>
                    <input type="number" name="attr_observe" min=0 value=3 />
                </div>
                <div class="fs-skill">
                    <button type="roll" value="!fs_roll,@{character_name},?{Bonus/Malus|0},@{selected_characteristic},physick"></button>
                    <label class="fs-skill-label" data-i18n="physick">Physick</label>
                    <input type="number" name="attr_physick" min=0 value=0 />
                </div>
                <div class="fs-skill">
                    <button type="roll" value="!fs_roll,@{character_name},?{Bonus/Malus|0},@{selected_characteristic},warfare"></button>
                    <label class="fs-skill-label" data-i18n="warfare">Warfare</label>
                    <input type="number" name="attr_warfare" min=0 value=0 />
                </div>
                
                <div class="fs-row fs-skill-family">
                    <span class="fs-secondary-table-name" data-i18n="combat">Combat</span>
                </div>
                <div class="fs-skill">
                    <button type="roll" value="!fs_roll,@{character_name},?{Bonus/Malus|0},@{selected_characteristic},artifact_melee"></button>
                    <label class="fs-skill-label" data-i18n="artifact_melee">Artifact Melee</label>
                    <input type="number" name="attr_artifact_melee" min=0 value=0 />
                </div>
                <div class="fs-skill">
                    <button type="roll" value="!fs_roll,@{character_name},?{Bonus/Malus|0},@{selected_characteristic},archery"></button>
                    <label class="fs-skill-label" data-i18n="archery">Archery</label>
                    <input type="number" name="attr_archery" min=0 value=0 />
                </div>
                <div class="fs-skill">
                    <button type="roll" value="!fs_roll,@{character_name},?{Bonus/Malus|0},@{selected_characteristic},throwing"></button>
                    <label class="fs-skill-label" data-i18n="throwing">Throwing</label>
                    <input type="number" name="attr_throwing" min=0 value=3 />
                </div>
                <div class="fs-skill">
                    <button type="roll" value="!fs_roll,@{character_name},?{Bonus/Malus|0},@{selected_characteristic},energy_guns"></button>
                    <label class="fs-skill-label" data-i18n="energy_guns">Energy Guns</label>
                    <input type="number" name="attr_energy_guns" min=0 value=0 />
                </div>
                <div class="fs-skill">
                    <button type="roll" value="!fs_roll,@{character_name},?{Bonus/Malus|0},@{selected_characteristic},gunnery"></button>
                    <label class="fs-skill-label" data-i18n="gunnery">Gunnery</label>
                    <input type="number" name="attr_gunnery" min=0 value=0 />
                </div>
                <div class="fs-skill">
                    <button type="roll" value="!fs_roll,@{character_name},?{Bonus/Malus|0},@{selected_characteristic},artillery"></button>
                    <label class="fs-skill-label" data-i18n="artillery">Artillery</label>
                    <input type="number" name="attr_artillery" min=0 value=0 />
                </div>
                <div class="fs-skill">
                    <button type="roll" value="!fs_roll,@{character_name},?{Bonus/Malus|0},@{selected_characteristic},fight"></button>
                    <label class="fs-skill-label" data-i18n="fight">Fight</label>
                    <input type="number" name="attr_fight" min=0 value=3 />
                </div>
                <div class="fs-skill">
                    <button type="roll" value="!fs_roll,@{character_name},?{Bonus/Malus|0},@{selected_characteristic},demolitions"></button>
                    <label class="fs-skill-label" data-i18n="demolitions">Demolitions</label>
                    <input type="number" name="attr_demolitions" min=0 value=0 />
                </div>
                <div class="fs-skill">
                    <button type="roll" value="!fs_roll,@{character_name},?{Bonus/Malus|0},@{selected_characteristic},melee"></button>
                    <label class="fs-skill-label" data-i18n="melee">Melee</label>
                    <input type="number" name="attr_melee" min=0 value=0 />
                </div>
                <div class="fs-skill">
                    <button type="roll" value="!fs_roll,@{character_name},?{Bonus/Malus|0},@{selected_characteristic},slug_guns"></button>
                    <label class="fs-skill-label" data-i18n="slug_guns">Slug Guns</label>
                    <input type="number" name="attr_slug_guns" min=0 value=0 />
                </div>
                
            </div>
            <div class="fs-skill-col">
                
                <div class="fs-row fs-skill-family">
                    <span class="fs-secondary-table-name" data-i18n="control">Control</span>
                </div>
                <div class="fs-skill">
                    <button type="roll" value="!fs_roll,@{character_name},?{Bonus/Malus|0},@{selected_characteristic},aircraft"></button>
                    <label class="fs-skill-label" data-i18n="aircraft">Aircraft</label>
                    <input type="number" name="attr_aircraft" value=0 />
                </div>
                <div class="fs-skill">
                    <button type="roll" value="!fs_roll,@{character_name},?{Bonus/Malus|0},@{selected_characteristic},beastcraft"></button>
                    <label class="fs-skill-label" data-i18n="beastcraft">Beastcraft</label>
                    <input type="number" name="attr_beastcraft" value=0 />
                </div>
                <div class="fs-skill">
                    <button type="roll" value="!fs_roll,@{character_name},?{Bonus/Malus|0},@{selected_characteristic},landcraft"></button>
                    <label class="fs-skill-label" data-i18n="landcraft">Landcraft</label>
                    <input type="number" name="attr_landcraft" value=0 />
                </div>
                <div class="fs-skill">
                    <button type="roll" value="!fs_roll,@{character_name},?{Bonus/Malus|0},@{selected_characteristic},spacecraft"></button>
                    <label class="fs-skill-label" data-i18n="spacecraft">Spacecraft</label>
                    <input type="number" name="attr_spacecraft" value=0 />
                </div>
                <div class="fs-skill">
                    <button type="roll" value="!fs_roll,@{character_name},?{Bonus/Malus|0},@{selected_characteristic},watercraft"></button>
                    <label class="fs-skill-label" data-i18n="watercraft">Watercraft</label>
                    <input type="number" name="attr_watercraft" value=0 />
                </div>
                <div class="fs-skill">
                    <button type="roll" value="!fs_roll,@{character_name},?{Bonus/Malus|0},@{selected_characteristic},ride"></button>
                    <label class="fs-skill-label" data-i18n="ride">Ride</label>
                    <input type="number" name="attr_ride" value=0 />
                </div>

                <div class="fs-row fs-skill-family">
                    <span class="fs-secondary-table-name" data-i18n="creative">Creative</span>
                </div>
                <div class="fs-skill">
                    <button type="roll" value="!fs_roll,@{character_name},?{Bonus/Malus|0},@{selected_characteristic},disguise"></button>
                    <label class="fs-skill-label" data-i18n="disguise">Disguise</label>
                    <input name="attr_disguise" type="number" min=0 value=0 />
                </div>
                <div class="fs-skill">
                    <button type="roll" name="roll_gaming" value="!fs_roll,@{character_name},?{Bonus/Malus|0},@{selected_characteristic},gaming"></button>
                    <label class="fs-skill-label" data-i18n="gaming">Gaming</label>
                    <input name="attr_gaming" type="number" min=0 value=0 />
                </div>
                <div class="fs-col">
                    <fieldset class="repeating_creativeskills">
                        <div class="fs-skill">
                            <button type="action" name="act_creativeskill-selectskill"></button>
                            <input class="fs-skill-label" name="attr_creativeskill_name" type="text" />
                            <input name="attr_creativeskill_value" type="number" min=0 value=0 />
                        </div>
                    </fieldset>
                </div>

                <div class="fs-row fs-skill-family">
                    <span class="fs-secondary-table-name" data-i18n="lore">Lore</span>
                </div>
                <div class="fs-skill">
                    <button type="roll" value="!fs_roll,@{character_name},?{Bonus/Malus|0},@{selected_characteristic},beast_lore"></button>
                    <label class="fs-skill-label" data-i18n="beast_lore">Beast Lore</span></label>
                    <input name="attr_beast_lore" type="number" min=0 value=0 />
                </div>
                <div class="fs-skill">
                    <button type="roll" value="!fs_roll,@{character_name},?{Bonus/Malus|0},@{selected_characteristic},faction_lore_phoenix_empire"></button>
                    <label class="fs-skill-label"><span data-i18n="faction_lore">Faction Lore</span> (<span data-i18n="phoenix_empire">Phoenix Empire</span>)</label>
                    <input name="attr_faction_lore_phoenix_empire" type="number" min=0 value=3 />
                </div>
                <div class="fs-skill">
                    <button type="roll" value="!fs_roll,@{character_name},?{Bonus/Malus|0},@{selected_characteristic},faction_lore_ownalliance"></button>
                    <label class="fs-skill-label"><span data-i18n="faction_lore">Faction Lore</span> (<span name='attr_alliance'></span>)</label>
                    <input name="attr_faction_lore_ownalliance" type="number" min=0 value=3 />
                </div>
                <div class="fs-skill">
                    <button type="roll" value="!fs_roll,@{character_name},?{Bonus/Malus|0},@{selected_characteristic},jumpweb_lore"></button>
                    <label class="fs-skill-label" data-i18n="jumpweb_lore">Jumpweb Lore</label>
                    <input name="attr_jumpweb_lore" type="number" min=0 value=0 />
                </div>
                <div class="fs-skill">
                    <button type="roll" value="!fs_roll,@{character_name},?{Bonus/Malus|0},@{selected_characteristic},planetary_lore_homeworld"></button>
                    <label class="fs-skill-label"><span data-i18n="planetary_lore">Planetary Lore</span> (<span name='attr_homeworld'></span>)</label>
                    <input name="attr_planetary_lore_homeworld" type="number" min=0 value=3 />
                </div>
                <div class="fs-col">
                    <fieldset class="repeating_loreskills">
                        <div class="fs-skill">
                            <button type="roll" value="!fs_roll,@{character_name},?{Bonus/Malus|0},@{selected_characteristic},repeating_loreskills#@{loreskill_name}"></button>
                            <input class="fs-skill-label" name="attr_loreskill_name" type="text" />
                            <input name="attr_loreskill_value" type="number" min=0 value=0 />
                        </div>
                    </fieldset>
                </div>
                
            </div>
            <div class="fs-skill-col">
                
                <div class="fs-row fs-skill-family">
                    <span class="fs-secondary-table-name" data-i18n="malefaction">Malefaction</span>
                </div>
                <div class="fs-skill">
                    <button type="roll" value="!fs_roll,@{character_name},?{Bonus/Malus|0},@{selected_characteristic},lockpicking"></button>
                    <label class="fs-skill-label" data-i18n="lockpicking">Lockpicking</label>
                    <input type="number" name="attr_lockpicking" min=0 value=0 />
                </div>
                <div class="fs-skill">
                    <button type="roll" value="!fs_roll,@{character_name},?{Bonus/Malus|0},@{selected_characteristic},sleight_of_hand"></button>
                    <label class="fs-skill-label" data-i18n="sleight_of_hand">Sleight of hand</label>
                    <input type="number" name="attr_sleight_of_hand" min=0 value=0 />
                </div>
                <div class="fs-skill">
                    <button type="roll" value="!fs_roll,@{character_name},?{Bonus/Malus|0},@{selected_characteristic},sneak"></button>
                    <label class="fs-skill-label" data-i18n="sneak">Sneak</label>
                    <input type="number" name="attr_sneak" min=0 value=3 />
                </div>
                <div class="fs-skill">
                    <button type="roll" value="!fs_roll,@{character_name},?{Bonus/Malus|0},@{selected_characteristic},streetwise"></button>
                    <label class="fs-skill-label" data-i18n="streetwise">Streetwise</label>
                    <input type="number" name="attr_streetwise" min=0 value=0 />
                </div>
                <div class="fs-skill">
                    <button type="roll" value="!fs_roll,@{character_name},?{Bonus/Malus|0},@{selected_characteristic},torture"></button>
                    <label class="fs-skill-label" data-i18n="torture">Torture</label>
                    <input type="number" name="attr_torture" min=0 value=0 />
                </div>

                <div class="fs-row fs-skill-family">
                    <span class="fs-secondary-table-name" data-i18n="physical">Physical</span>
                </div>
                <div class="fs-skill">
                    <button type="roll" value="!fs_roll,@{character_name},?{Bonus/Malus|0},@{selected_characteristic},athletics"></button>
                    <label class="fs-skill-label" data-i18n="athletics">Athletics</label>
                    <input type="number" name="attr_athletics" min=0 value=0 />
                </div>
                <div class="fs-skill">
                    <button type="roll" value="!fs_roll,@{character_name},?{Bonus/Malus|0},@{selected_characteristic},self_control"></button>
                    <label class="fs-skill-label" data-i18n="self_control">Self Control</label>
                    <input type="number" name="attr_self_control" min=0 value=0 />
                </div>
                <div class="fs-skill">
                    <button type="roll" value="!fs_roll,@{character_name},?{Bonus/Malus|0},@{selected_characteristic},survival"></button>
                    <label class="fs-skill-label" data-i18n="survival">Survival</label>
                    <input type="number" name="attr_survival" min=0 value=0 />
                </div>
                <div class="fs-skill">
                    <button type="roll" value="!fs_roll,@{character_name},?{Bonus/Malus|0},@{selected_characteristic},vigor"></button>
                    <label class="fs-skill-label" data-i18n="vigor">Vigor</label>
                    <input type="number" name="attr_vigor" min=0 value=3 />
                </div>

                <div class="fs-row fs-skill-family">
                    <span class="fs-secondary-table-name" data-i18n="sciences">Sciences</span>
                </div>
                <div class="fs-skill">
                    <button type="roll" value="!fs_roll,@{character_name},?{Bonus/Malus|0},@{selected_characteristic},applied_science"></button>
                    <label class="fs-skill-label" data-i18n="applied_science">Applied Science</label>
                    <input type="number" name="attr_applied_science" min=0 value=0 />
                </div>
                <div class="fs-skill">
                    <button type="roll" value="!fs_roll,@{character_name},?{Bonus/Malus|0},@{selected_characteristic},life_science"></button>
                    <label class="fs-skill-label" data-i18n="life_science">Life Science</label>
                    <input type="number" name="attr_life_science" min=0 value=0 />
                </div>
                <div class="fs-skill">
                    <button type="roll" value="!fs_roll,@{character_name},?{Bonus/Malus|0},@{selected_characteristic},social_science"></button>
                    <label class="fs-skill-label" data-i18n="social_science">Social Science</label>
                    <input type="number" name="attr_social_science" min=0 value=0 />
                </div>
                <div class="fs-skill">
                    <button type="roll" value="!fs_roll,@{character_name},?{Bonus/Malus|0},@{selected_characteristic},physical_science"></button>
                    <label class="fs-skill-label" data-i18n="physical_science">Physical Science</label>
                    <input type="number" name="attr_physical_science" min=0 value=0 />
                </div>
                <div class="fs-skill">
                    <button type="roll" value="!fs_roll,@{character_name},?{Bonus/Malus|0},@{selected_characteristic},terraforming"></button>
                    <label class="fs-skill-label" data-i18n="terraforming">Terraforming</label>
                    <input type="number" name="attr_terraforming" min=0 value=0 />
                </div>
            </div>
            <div class="fs-skill-col">
                <div class="fs-row fs-skill-family">
                    <span class="fs-secondary-table-name" data-i18n="social">Social</span>
                </div>
                <div class="fs-skill">
                    <button type="roll" value="!fs_roll,@{character_name},?{Bonus/Malus|0},@{selected_characteristic},empathy"></button>
                    <label class="fs-skill-label" data-i18n="empathy">Empathy</label>
                    <input type="number" name="attr_empathy" min=0 value=0 />
                </div>
                <div class="fs-skill">
                    <button type="roll" value="!fs_roll,@{character_name},?{Bonus/Malus|0},@{selected_characteristic},etiquette"></button>
                    <label class="fs-skill-label" data-i18n="etiquette">Etiquette</label>
                    <input type="number" name="attr_etiquette" min=0 value=0 />
                </div>
                <div class="fs-skill">
                    <button type="roll" value="!fs_roll,@{character_name},?{Bonus/Malus|0},@{selected_characteristic},influence"></button>
                    <label class="fs-skill-label" data-i18n="influence">Influence</label>
                    <input type="number" name="attr_influence" min=0 value=3 />
                </div>
                <div class="fs-skill">
                    <button type="roll" value="!fs_roll,@{character_name},?{Bonus/Malus|0},@{selected_characteristic},knavery"></button>
                    <label class="fs-skill-label" data-i18n="knavery">Knavery</label>
                    <input type="number" name="attr_knavery" min=0 value=0 />
                </div>
                <div class="fs-skill">
                    <button type="roll" value="!fs_roll,@{character_name},?{Bonus/Malus|0},@{selected_characteristic},leadership"></button>
                    <label class="fs-skill-label" data-i18n="leadership">Leadership</label>
                    <input type="number" name="attr_leadership" min=0 value=0 />
                </div>
                
                <div class="fs-row fs-skill-family">
                    <span class="fs-secondary-table-name" data-i18n="technical">Technical</span>
                </div>
                <div class="fs-skill">
                    <button type="roll" value="!fs_roll,@{character_name},?{Bonus/Malus|0},@{selected_characteristic},spacecraft_operations"></button>
                    <label class="fs-skill-label" data-i18n="spacecraft_operations">Spacecraft Operations</label>
                    <input type="number" name="attr_spacecraft_operations" min=0 value=0 />
                </div>
                <div class="fs-skill">
                    <button type="roll" value="!fs_roll,@{character_name},?{Bonus/Malus|0},@{selected_characteristic},tech_redemption"></button>
                    <label class="fs-skill-label" data-i18n="tech_redemption">Tech Redemption</label>
                    <input type="number" name="attr_tech_redemption" min=0 value=0 />
                </div>
                <div class="fs-skill">
                    <button type="roll" value="!fs_roll,@{character_name},?{Bonus/Malus|0},@{selected_characteristic},think_machine"></button>
                    <label class="fs-skill-label" data-i18n="think_machine">Think Machine</label>
                    <input type="number" name="attr_think_machine" min=0 value=0 />
                </div>
            </div>
        </div>
    </div>

    <input class="fs-showarrow fs-h2arrow" type="checkbox" name="attr_weapons_armor_and_shield_show" value="1" checked />
    <h2 class="fs-clickheader fs-showsect"><label data-i18n="weapons_armor_and_shield">Weapons, Armor &amp; Shield</label></h2>
    <div class="fs-h2-section fs-nontable fs-core-details fs-wide-readonly">
        
        <div class="fs-weapons">
            <div class="fs-table">
                <span class="fs-table-head" data-i18n="weapon_name">Weapon</span>
                <span class="fs-table-head" data-i18n="tech_level">TL</span>
                <span class="fs-table-head" data-i18n="goal_bonus_malus">Goal</span>
                <span class="fs-table-head" data-i18n="damage">Damage</span>
                <span class="fs-table-head" data-i18n="strength_required">Min Str.</span>
                <span class="fs-table-head" data-i18n="weapon_range">Range</span>
                <span class="fs-table-head" data-i18n="weapon_shots">Shots</span>
                <span class="fs-table-head" data-i18n="weapon_rate">Rate</span>
                <span class="fs-table-head" data-i18n="weapon_size">Size</span>
            </div>
            <fieldset class="repeating_weapons">
                <div class="fs-table">
                    <input class="fs-table-cell" type="text" name="attr_weapon_name" />
                    <input class="fs-table-cell" type="number" name="attr_weapon_tech_level" min="0" />
                    <input class="fs-table-cell" type="text" name="attr_weapon_goal_bonus_malus" />
                    <button type="roll" value="&{template:fs-d6Roll} {{name-i18n=@{weapon_name}}} {{roll=[[@{weapon_damage}d6cs<4cf>5<4]]}} {{what-i18n=^{attack_damage}}}"></button>
                    <input class="fs-table-cell" type="text" name="attr_weapon_damage" />
                    <input class="fs-table-cell" type="text" name="attr_weapon_strength_required" />
                    <input class="fs-table-cell" type="text" name="attr_weapon_range" />
                    <input class="fs-table-cell" type="text" name="attr_weapon_shots" />
                    <input class="fs-table-cell" type="text" name="attr_weapon_rate" />
                    <input class="fs-table-cell" type="text" name="attr_weapon_size" />
                    <textarea class="fs-notes" name="attr_weapon_notes" data-i18n-placeholder="notes" placeholder="Notes" spellcheck="false"></textarea>
                </div>
            </fieldset>
        </div>

        <div class="fs-armors">
            <div class="fs-table">
                <span class="fs-table-head" data-i18n="armor">Armor</span>
                <span class="fs-table-head" data-i18n="tech_level">TL</span>
                <span class="fs-table-head" data-i18n="armor_prot_s">Prot.</span>
                <span class="fs-table-head" data-i18n="armor_str_malus_s">Str.</span>
                <span class="fs-table-head" data-i18n="armor_dex_malus_s">Dex.</span>
                <span class="fs-table-head" data-i18n="armor_end_malus_s">End.</span>
                <span class="fs-table-head" data-i18n="armor_init_malus_s">Init.</span>
            </div>
            <fieldset class="repeating_armors">
                <div class="fs-table">
                    <input class="fs-table-cell" type="text" name="attr_armor_name" />
                    <input class="fs-table-cell" type="number" name="attr_armor_tech_level" min="0" />
                    <button type="roll" value="&{template:fs-d6Roll} {{name-i18n=@{armor_name}}} {{roll=[[@{armor_prot}d6cs<4cf>5<4]]}} {{what-i18n=^{mitigated_damage}}}"></button>
                    <input class="fs-table-cell" type="text" name="attr_armor_prot" />
                    <input class="fs-table-cell" type="text" name="attr_armor_str_malus" />
                    <input class="fs-table-cell" type="text" name="attr_armor_dex_malus" />
                    <input class="fs-table-cell" type="text" name="attr_armor_end_malus" />
                    <input class="fs-table-cell" type="text" name="attr_armor_init_malus" />
                    <textarea class="fs-notes" name="attr_armor_notes" data-i18n-placeholder="notes" placeholder="Notes" spellcheck="false"></textarea>
                </div>
            </fieldset>
        </div>

        <div class="fs-shield-props fs-grid-1x6">
            <label class="fs-small-label2 fs-autoexpand"><input title="@{energy_shield_name}" type="text" name="attr_energy_shield_name"/><span data-i18n="energy_shield_name">Energy shield</span><span name="attr_energy_shield_name" class="fs-autoexpand"></span></label>
            <label class="fs-small-label2 fs-autoexpand fs-shield-impact"><input title="@{energy_shield_impact}" type="text" name="attr_energy_shield_impact"/><span data-i18n="energy_shield_impact">Impact</span><span name="attr_energy_shield_impact" class="fs-autoexpand"></span></label>
            /
            <label class="fs-small-label2 fs-autoexpand fs-shield-force"><input title="@{energy_shield_force}" type="text" name="attr_energy_shield_force"/><span data-i18n="energy_shield_force">Force</span><span name="attr_energy_shield_force" class="fs-autoexpand"></span></label>
            <label class="fs-small-label2 fs-autoexpand fs-energy-shield-charges"><input title="@{energy_shield|max}" type="number" name="attr_energy_shield_max" min="0" /><span data-i18n="energy_shield_charges">Charges</span><span name="attr_energy_shield_max" class="fs-autoexpand"></span></label>
            <div class="fs-rating">
                <input name="attr_energy_shield" type="radio" value="20" /><span>&#9633;</span><input name="attr_energy_shield" type="radio" value="19" /><span>&#9633;</span><input name="attr_energy_shield" type="radio" value="18" /><span>&#9633;</span><input name="attr_energy_shield" type="radio" value="17" /><span>&#9633;</span><input name="attr_energy_shield" type="radio" value="16" /><span>&#9633;</span><input name="attr_energy_shield" type="radio" value="15" class="fs-rating-widebox" /><span>&#9633;</span><input name="attr_energy_shield" type="radio" value="14" /><span>&#9633;</span><input name="attr_energy_shield" type="radio" value="13" /><span>&#9633;</span><input name="attr_energy_shield" type="radio" value="12" /><span>&#9633;</span><input name="attr_energy_shield" type="radio" value="11" /><span>&#9633;</span><input name="attr_energy_shield" type="radio" value="10" class="fs-rating-widebox" /><span>&#9633;</span><input name="attr_energy_shield" type="radio" value="9" /><span>&#9633;</span><input name="attr_energy_shield" type="radio" value="8" /><span>&#9633;</span><input name="attr_energy_shield" type="radio" value="7" /><span>&#9633;</span><input name="attr_energy_shield" type="radio" value="6" /><span>&#9633;</span><input name="attr_energy_shield" type="radio" value="5" class="fs-rating-widebox" /><span>&#9633;</span><input name="attr_energy_shield" type="radio" value="4" /><span>&#9633;</span><input name="attr_energy_shield" type="radio" value="3" /><span>&#9633;</span><input name="attr_energy_shield" type="radio" value="2" /><span>&#9633;</span><input name="attr_energy_shield" type="radio" value="1" /><span>&#9633;</span><input name="attr_energy_shield" type="radio" value="0" /><span class="fs-rating-null">&#9633;</span>
            </div>
        </div>

    </div>
    
    <input class="fs-showarrow fs-h2arrow" type="checkbox" name="attr_combat_actions_show" value="1" checked />
    <h2 class="fs-clickheader fs-showsect"><label data-i18n="combat_actions">Combat actions</label></h2>
    <div class="fs-h2-section fs-nontable fs-core-details fs-wide-readonly">
        
        <div class="fs-combatactions">
            <div class="fs-table">
                <span class="fs-table-head" data-i18n="fighting_style">Style</span>
                <span class="fs-table-head" data-i18n="combat_action_name">Action</span>
                <span class="fs-table-head" data-i18n="notes">Notes</span>
            </div>
            <fieldset class="repeating_combatactions">
                <div class="fs-table">
                    <input class="fs-table-cell" type="text" name="attr_combat_action_style" />
                    <input class="fs-table-cell" type="text" name="attr_combat_action_name" />
                    <input class="fs-table-cell" type="text" name="attr_combat_action_notes" />
                </div>
            </fieldset>
        </div>
    </div>

    <input class="fs-showarrow fs-h2arrow" type="checkbox" name="attr_psi_show" value="1" checked />
    <h2 class="fs-clickheader fs-showsect"><label data-i18n="psi">Psi</label></h2>
    <div class="fs-h2-section fs-nontable fs-core-details fs-wide-readonly">
        <div class="fs-space-evenly">
            <label class="fs-small-label2 fs-autoexpand"><input title="@{psi}" type="number" name="attr_psi" value="0" min="0" /><span data-i18n="psi">Psi</span><span name="attr_psi" class="fs-autoexpand"></span></label>
            <label class="fs-small-label2 fs-autoexpand"><input title="@{psi_stigmata}" type="text" name="attr_psi_stigmata" /><span data-i18n="stigmata">Stigmata</span><span name="attr_psi_stigmata" class="fs-autoexpand"></span></label>
            <label class="fs-small-label2 fs-autoexpand"><input title="@{urge}" type="number" name="attr_urge" value="0" min="0" /><span data-i18n="urge">Urge</span><span name="attr_urge" class="fs-autoexpand"></span></label>
        </div>
        
        <div class="fs-psipowers">
            <div class="fs-table">
                <span class="fs-table-head fs-table-text" data-i18n="psi_path">Path</span>
                <span class="fs-table-head" data-i18n="level_s">Lvl</span>
                <span class="fs-table-head" data-i18n="power_name">Power</span>
                <span class="fs-table-head" data-i18n="characteristic_s">Charac.</span>
                <span class="fs-table-head" data-i18n="skill_s">Skill</span>
                <span class="fs-table-head" data-i18n="power_range">Range</span>
                <span class="fs-table-head" data-i18n="power_duration">Duration</span>
                <span class="fs-table-head" data-i18n="wyrd">Wyrd</span>
            </div>
            <fieldset class="repeating_psipowers">
                <div class="fs-table">
                    <input class="fs-table-cell" type="text" name="attr_power_path" />
                    <input class="fs-table-cell" type="number" name="attr_power_level" min="0" />
                    <input class="fs-table-cell" type="text" name="attr_power_name" />
                    <input class="fs-table-cell" type="text" name="attr_power_roll_characteristic" />
                    <input class="fs-table-cell" type="text" name="attr_power_roll_skill" />
                    <input class="fs-table-cell" type="text" name="attr_power_range" />
                    <input class="fs-table-cell" type="text" name="attr_power_duration" />
                    <input class="fs-table-cell" type="text" name="attr_power_wyrdcost" />
                    <textarea class="fs-notes" name="attr_power_notes" data-i18n-placeholder="notes" placeholder="Notes" spellcheck="false"></textarea>
                </div>
            </fieldset>
        </div>
    </div>
    
    <input class="fs-showarrow fs-h2arrow" type="checkbox" name="attr_theurgy_show" value="1" checked />
    <h2 class="fs-clickheader fs-showsect"><label data-i18n="theurgy">Theurgy</label></h2>
    <div class="fs-h2-section fs-nontable fs-core-details fs-wide-readonly">

        <div class="fs-space-evenly">
            <label class="fs-small-label2 fs-autoexpand"><input title="@{theurgy}" type="number" name="attr_theurgy" value="0" min="0" /><span data-i18n="theurgy">Theurgy</span><span name="attr_theurgy" class="fs-autoexpand"></span></label>
            <label class="fs-small-label2 fs-autoexpand"><input title="@{theurgy_stigmata}" type="text" name="attr_theurgy_stigmata"/><span data-i18n="stigmata">Stigmata</span><span name="attr_theurgy_stigmata" class="fs-autoexpand"></span></label>
            <label class="fs-small-label2 fs-autoexpand"><input title="@{hubris}" type="number" name="attr_hubris" value="0" min="0" /><span data-i18n="hubris">Hubris</span><span name="attr_hubris" class="fs-autoexpand"></span></label>
        </div>
        
        <div class="fs-theurgyrituals">
            <div class="fs-table">
                <span class="fs-table-head" data-i18n="church_sect">Sect</span>
                <span class="fs-table-head" data-i18n="level_s">Lvl</span>
                <span class="fs-table-head" data-i18n="ritual_name">Ritual</span>
                <span class="fs-table-head" data-i18n="characteristic_s">Charact.</span>
                <span class="fs-table-head" data-i18n="skill_s">Skill</span>
                <span class="fs-table-head" data-i18n="ritual_components_s">Compo.</span>
                <span class="fs-table-head" data-i18n="ritual_range">Range</span>
                <span class="fs-table-head" data-i18n="ritual_duration">Duration</span>
                <span class="fs-table-head" data-i18n="wyrd">Wyrd</span>
            </div>
            <fieldset class="repeating_theurgyrites">
                <div class="fs-table">
                    <input class="fs-table-cell" type="text" name="attr_ritual_path" />
                    <input class="fs-table-cell" type="number" name="attr_ritual_level" min="0" />
                    <input class="fs-table-cell" type="text" name="attr_ritual_name" />
                    <input class="fs-table-cell" type="text" name="attr_ritual_roll_characteristic" />
                    <input class="fs-table-cell" type="text" name="attr_ritual_roll_skill" />
                    <input class="fs-table-cell" type="text" name="attr_ritual_components" />
                    <input class="fs-table-cell" type="text" name="attr_ritual_range" />
                    <input class="fs-table-cell" type="text" name="attr_ritual_duration" />
                    <input class="fs-table-cell" type="text" name="attr_ritual_wyrdcost" />
                    <textarea class="fs-notes" name="attr_ritual_notes" data-i18n-placeholder="notes" placeholder="Notes" spellcheck="false"></textarea>
                </div>
            </fieldset>
        </div>
    </div>
    
    <input class="fs-showarrow fs-h2arrow" type="checkbox" name="attr_possessions_show" value="1" checked />
    <h2 class="fs-clickheader fs-showsect"><label data-i18n="possessions">Possessions</label></h2>
    <div class="fs-h2-section fs-nontable fs-core-details fs-wide-readonly">

        <div class="fs-grid-1x2-equal">
            <div class="fs-carried">
                <div class="fs-table">
                    <span class="fs-table-head" data-i18n="carried">Carried</span>
                    <input class="fs-table-cell" title="@{cash}" type="text" name="attr_cash" placeholder="Cash" data-i18n-placeholder="cash" />
                </div>
                <fieldset class="repeating_carried">
                    <div class="fs-table">
                        <input class="fs-table-cell" type="text" name="attr_carried" />
                    </div>
                </fieldset>
            </div>
            
            <div class="fs-owned">
                <div class="fs-table">
                    <span class="fs-table-head" data-i18n="owned">Owned</span>
                    <span class="fs-table-head" data-i18n="location">Location</span>
                </div>
                <fieldset class="repeating_owned">
                    <div class="fs-table">
                        <input class="fs-table-cell" type="text" name="attr_owned_what" />
                        <input class="fs-table-cell" type="text" name="attr_owned_where" />
                    </div>
                </fieldset>
            </div>
        </div>
    </div>
    
    <input class="fs-showarrow fs-h2arrow" type="checkbox" name="attr_experience_show" value="1" checked />
    <h2 class="fs-clickheader fs-showsect"><label data-i18n="experience">Experience</label></h2>
    <div class="fs-h2-section fs-nontable fs-core-details fs-wide-readonly">

        <div class="fs-space-evenly">
            <label class="fs-small-label2 fs-autoexpand"><input title="@{total_xp}" type="number" name="attr_total_xp"/><span data-i18n="total_xp">Total</span><span name="attr_total_xp" class="fs-autoexpand"></span></label>
            <label class="fs-small-label2 fs-autoexpand"><input title="@{unspent_xp}" type="number" name="attr_unspent_xp" readonly /><span data-i18n="unspent_xp">Unspent</span><span name="attr_unspent_xp" class="fs-autoexpand"></span></label>
        </div>
        
        <div class="fs-spentxp">
            <div class="fs-table">
                <span class="fs-table-head" data-i18n="trait">Trait</span>
                <span class="fs-table-head" data-i18n="rank_from">From</span>
                <span class="fs-table-head" data-i18n="rank_to">To</span>
                <span class="fs-table-head" data-i18n="xp_cost">Cost</span>
                <span class="fs-table-head" data-i18n="notes">Notes</span>
            </div>
            <fieldset class="repeating_spentxp">
                <div class="fs-table">
                    <input class="fs-table-cell" type="text" name="attr_spentxp_trait" />
                    <input class="fs-table-cell" type="number" name="attr_spentxp_rank_from" min="0" />
                    <input class="fs-table-cell" type="number" name="attr_spentxp_rank_to" min="0" />
                    <input class="fs-table-cell" type="text" name="attr_spentxp_cost" />
                    <input class="fs-table-cell" type="text" name="attr_spentxp_notes" />
                </div>
            </fieldset>
        </div>
    </div>
    
    <input class="fs-showarrow fs-h2arrow" type="checkbox" name="attr_notes_show" value="1" checked />
    <h2 class="fs-clickheader fs-showsect"><label data-i18n="notes">Notes</label></h2>
    <div class="fs-h2-section fs-nontable fs-core-details fs-wide-readonly">
        <textarea class="fs-inline-textarea fs-supertall-textarea fs-w100" title="@{notes}" type="text" name="attr_notes" spellcheck="false"></textarea>
    </div>

</div>
<!-- CHARACTER SHEET LAYOUT IS OVER  -->

<!-- NOW, ROLL TEMPLATES -->
<div style="display:none">
    <rolltemplate class="sheet-rolltemplate-fs-ApiError">
        <div class="fs-container">
            <div class="fs-header"><h1>API error</h1></div>
            <div>{{error}}</div>
        </div>
    </rolltemplate>
    
    <rolltemplate class="sheet-rolltemplate-fs-InitRoll">
        <div class="fs-container">
            <div class="fs-header"><h1>Initiative</h1></div>
            <div class="fs-arrow-container"><div class="fs-arrow-right"></div></div>
            <div>{{roll}} - {{stance}}</div>
            {{#^rollTotal() style 0}}
            <div>
                <span data-i18n="fighting_style">Fighting style</span>: {{style}}
            </div>
            {{/^rollTotal() style 0}}
        </div>
    </rolltemplate>
    
    <rolltemplate class="sheet-rolltemplate-fs-d6Roll">
        <div class="fs-container">
            <div class="fs-header"><h1>{{name-i18n}}</h1></div>
            <div class="fs-arrow-container"><div class="fs-arrow-right"></div></div>
            <div>{{roll}} {{what-i18n}}</div>
        </div>
    </rolltemplate>
    
    <rolltemplate class="sheet-rolltemplate-fs-GoalRoll">
        <div class="fs-container">
            {{#skillName}}
                <div class="fs-header"><h1>{{characteristicName-i18n}} + {{skillName-i18n}} {{#rollGreater() bonus_malus -1}}+{{/rollGreater() bonus_malus -1}}{{bonus_malus}}</h1></div>
            {{/skillName}}
            {{^skillName}}
                <div class="fs-header"><h1>{{characteristicName-i18n}} {{#rollGreater() bonus_malus -1}}+{{/rollGreater() bonus_malus -1}}{{bonus_malus}}</h1></div>
            {{/skillName}}
            <div class="fs-arrow-container"><div class="fs-arrow-right"></div></div>

            {{#^rollGreater() roll goal}}
                {{#^rollGreater() roll 19}} <!-- rolled [1, min(19, goal)] -->
                    {{#critFailureConfirm}}
                        <span class="fs-success fs-actualroll">{{roll}}</span><span> | {{goal}}. </span><span class="fs-success" data-i18n="noncritical_failure">Non-critical failure.</span>
                    {{/critFailureConfirm}}
                    {{^critFailureConfirm}}
                        {{#rollWasCrit() roll}}  <!-- crit -->
                            <span class="fs-critsuccess fs-actualroll">{{roll}}</span><span> | {{goal}}. </span><span class="fs-critsuccess" data-i18n="critical_success">Critical success!</span>
                        {{/rollWasCrit() roll}}
                        {{#^rollWasCrit() roll}} <!-- not a crit -->
                            <span class="fs-success fs-actualroll">{{roll}}</span><span> | {{goal}}. </span><span class="fs-success" data-i18n="success">Success!</span>
                        {{/^rollWasCrit() roll}}
                        {{#rollTotal() roll 1}}
                            <span class="fs-success">0</span>
                        {{/rollTotal() roll 1}}
                        {{#rollBetween() roll 2 3}}
                            <span class="fs-success">1</span>
                        {{/rollBetween() roll 2 3}}
                        {{#rollBetween() roll 4 5}}
                            <span class="fs-success">2</span>
                        {{/rollBetween() roll 4 5}}
                        {{#rollBetween() roll 6 7}}
                            <span class="fs-success">3</span>
                        {{/rollBetween() roll 6 7}}
                        {{#rollBetween() roll 8 9}}
                            <span class="fs-success">4</span>
                        {{/rollBetween() roll 8 9}}
                        {{#rollBetween() roll 10 11}}
                            <span class="fs-success">5</span>
                        {{/rollBetween() roll 10 11}}
                        {{#rollBetween() roll 12 13}}
                            <span class="fs-success">6</span>
                        {{/rollBetween() roll 12 13}}
                        {{#rollBetween() roll 14 15}}
                            <span class="fs-success">7</span>
                        {{/rollBetween() roll 14 15}}
                        {{#rollBetween() roll 16 17}}
                            <span class="fs-success">8</span>
                        {{/rollBetween() roll 16 17}}
                        {{#rollBetween() roll 18 19}}
                            <span class="fs-success">9</span>
                        {{/rollBetween() roll 18 19}}
                        {{#rollBetween() goal 21 22}}
                        <span class="fs-success"> + 1</span>
                        {{/rollBetween() goal 21 22}}
                        {{#rollBetween() goal 23 24}}
                        <span class="fs-success"> + 2</span>
                        {{/rollBetween() goal 23 24}}
                        {{#rollBetween() goal 25 26}}
                        <span class="fs-success"> + 3</span>
                        {{/rollBetween() goal 25 26}}
                        {{#rollBetween() goal 27 28}}
                        <span class="fs-success"> + 4</span>
                        {{/rollBetween() goal 27 28}}
                        {{#rollBetween() goal 29 30}}
                        <span class="fs-success"> + 5</span>
                        {{/rollBetween() goal 29 30}}
                        {{#rollBetween() goal 31 32}}
                        <span class="fs-success"> + 6</span>
                        {{/rollBetween() goal 31 32}}
                        {{#rollBetween() goal 33 34}}
                        <span class="fs-success"> + 7</span>
                        {{/rollBetween() goal 33 34}}
                        {{#rollBetween() goal 35 36}}
                        <span class="fs-success"> + 8</span>
                        {{/rollBetween() goal 35 36}}
                        {{#rollBetween() goal 37 38}}
                        <span class="fs-success"> + 9</span>
                        {{/rollBetween() goal 37 38}}
                        {{#rollBetween() goal 39 40}}
                        <span class="fs-success"> + 10</span>
                        {{/rollBetween() goal 39 40}}
                        {{#rollGreater() goal 40}}
                        <span class="fs-success"> + (a ton of bonus)</span>
                        {{/rollGreater() goal 40}}
                        <span class="fs-success"> <span data-i18n="victory_points">VP</span></span>
                        {{#rollWasCrit() roll}}
                            {{#skillName}}
                                <div class="rolltemplate-fs-button">[<span data-i18n="roll_again">Roll again</span>](~@{character_name}|characteristic)</div>
                            {{/skillName}}
                            {{^skillName}}
                                <div class="rolltemplate-fs-button">[<span data-i18n="roll_again">Roll again</span>](~@{character_name}|skill)</div>
                            {{/skillName}}
                        {{/rollWasCrit() roll}}
                    {{/critFailureConfirm}}
                {{/^rollGreater() roll 19}}
            {{/^rollGreater() roll goal}}

            {{#rollGreater() roll goal}}
                {{#^rollGreater() roll 19}} <!-- rolled ]goal, 19] -->
                    {{#critFailureConfirm}}
                        <span class="fs-critfailure fs-actualroll">{{roll}}</span><span> | {{goal}}. </span><span class="fs-critfailure" data-i18n="critical_failure">Critical failure.</span>
                    {{/critFailureConfirm}}
                    {{^critFailureConfirm}}
                    <span class="failure fs-actualroll">{{roll}}</span><span> | {{goal}}. </span><span class="fs-failure" data-i18n="failure">Failure!</span>
                    {{/critFailureConfirm}}
                {{/^rollGreater() roll 19}}
            {{/rollGreater() roll goal}}

            {{#rollTotal() roll 20}} <!-- rolled a 20 -->
                {{#critFailureConfirm}}
                    <span class="fs-critfailure fs-actualroll">{{roll}}</span><span> | {{goal}}. </span><span class="fs-critfailure" data-i18n="critical_failure">Critical failure.</span>
                {{/critFailureConfirm}}
                {{^critFailureConfirm}}
                    <span class="fs-critfailure fs-actualroll">{{roll}}</span><span> | {{goal}}. </span><span class="fs-critfailure" data-i18n="critical_failure_q">Critical failure?</span>
                    {{#skillName}}
                        <div class="rolltemplate-fs-button">[<span data-i18n="confirm">Confirm</span>](!fs_critFailureConfirm,@{character_name},{{bonus_malus}},{{characteristicName}},{{skillName}})</div>
                    {{/skillName}}
                    {{^skillName}}
                        <div class="rolltemplate-fs-button">[<span data-i18n="confirm">Confirm</span>](!fs_critFailureConfirm,@{character_name},{{bonus_malus}},{{characteristicName}},null)</div>
                    {{/skillName}}
                {{/critFailureConfirm}}
            {{/rollTotal() roll 20}}
        </div>
    </rolltemplate>
</div>
<!-- ROLL TEMPLATES DEFINED -->

<!-- NOW, SHEET WORKERS -->
<script type="text/worker">

    const repeatingSum = (destination, section, fields, multiplier = 1, add = 0) => {
        if (!Array.isArray(fields)) fields = [fields];
        getSectionIDs(`repeating_${section}`, idArray => {
            const attrArray = idArray.reduce( (m,id) => [...m, ...(fields.map(field => `repeating_${section}_${id}_${field}`))],[]);
            getAttrs(attrArray, v => {
                // getValue: if not a number, returns 1 if it is 'on' (checkbox), otherwise returns 0..
                const getValue = (section, id,field) => parseFloat(v[`repeating_${section}_${id}_${field}`], 10) || (v[`repeating_${section}_${id}_${field}`] === 'on' ? 1 : 0); 
                const sumTotal = idArray.reduce((total, id) => total + fields.reduce((subtotal,field) => subtotal * getValue(section, id,field),1),0);
                setAttrs({[destination]: sumTotal * multiplier + add});    
            });
        });
    };
    
    on("change:total_xp change:repeating_spentxp:spentxp_cost", function() {
        console.log("change:total_xp")
        getAttrs([ "total_xp" ], function(values) {
            let total_xp = Number(values.total_xp);
            repeatingSum("unspent_xp", "spentxp", "spentxp_cost", -1, total_xp);
       });
    });

    on("change:selected_characteristic", function(eventInfo) {
        getAttrs([ "selected_characteristic", "strength", "dexterity", "endurance", "wits", "perception", "tech", "presence", "will", "faith" ], function(values) {
            let charac_val;
            switch (values.selected_characteristic) {
                case "strength":
                    charac_val = values.strength;
                    break;
                case "dexterity":
                    charac_val = values.dexterity;
                    break;
                case "endurance":
                    charac_val = values.endurance;
                    break;
                case "wits":
                    charac_val = values.wits;
                    break;
                case "perception":
                    charac_val = values.perception;
                    break;
                case "tech":
                    charac_val = values.tech;
                    break;
                case "presence":
                    charac_val = values.presence;
                    break;
                case "will":
                    charac_val = values.will;
                    break;
                case "faith":
                    charac_val = values.faith;
                    break;
            }
            setAttrs({
                selected_characteristic_i18n: getTranslationByKey(values.selected_characteristic),
                selected_characteristic_value: charac_val
            });
        });
    });

    on("change:selected_skill", function (eventInfo) {
        log("change:selected_skill")
        log(eventInfo);
        if(eventInfo.sourceType ==='sheetworker') {
			return; //prevents cascades from the equivalent sheet worker which manages repeating sections
		}
        getAttrs([ "selected_skill" ], function (values) {
            log("change:selected_skill getAttrs")
            log(values)
            if (values.selected_skill) {
                log("values.selected_skill != null")
                getAttrs([ values.selected_skill ], function (values3) {
                    log(values3)
                    log(Object.values(values3)[0]);
                    setAttrs({
                        selected_skill_i18n: getTranslationByKey(values.selected_skill),
                        selected_skill_repeatroot: "",
                        selected_skill_value: Object.values(values3)[0]
                    });
                });
            }
        });
    });

    on("clicked:repeating_creativeskills:creativeskill-selectskill", function (eventInfo) {
        log("clicked:repeating_...-selectskill")
        log(eventInfo)
        if (eventInfo.sourceAttribute.endsWith("-selectskill")) {
            log("endsWith -selectskill")
            // roll20 communicates a sourceAttribute with caps in it, but will store it in lowercase after this callback....
            let itemRoot = eventInfo.sourceAttribute.replace("-selectskill","").toLowerCase();
            log(itemRoot)
            getAttrs([ itemRoot + "_name", itemRoot + "_value" ], function (values) {
                log(values)
                log(Object.values(values)[0])
                log(Object.values(values)[1])
                setAttrs({
                    selected_skill: Object.values(values)[0],
                    selected_skill_i18n: Object.values(values)[0],
                    selected_skill_repeatroot: itemRoot,
                    selected_skill_value: Object.values(values)[1]
                });
            });
        }
    });

    on("change:repeating_creativeskills", function (eventInfo) {
        log("change:repeating_...")
        log(eventInfo)
        getAttrs([ "selected_skill_repeatroot" ], function (values) {
            if (eventInfo.sourceAttribute.endsWith("_name")) {
                if (eventInfo.sourceAttribute === values.selected_skill_repeatroot + "_name") {
                    getAttrs([ eventInfo.sourceAttribute ], function (values2) {
                        setAttrs({
                            selected_skill: Object.values(values2)[0],
                            selected_skill_i18n: Object.values(values2)[0]
                        });
                    });
                }
            } else if (eventInfo.sourceAttribute.endsWith("_value")) {
                if (eventInfo.sourceAttribute === values.selected_skill_repeatroot + "_value") {
                    getAttrs([ eventInfo.sourceAttribute ], function (values2) {
                        setAttrs({
                            selected_skill_value: Object.values(values2)[0]
                        });
                    });
                }
            }
        });
    });

</script>
<!-- SHEET WORKERS DEFINED -->

<!-- FIN -->
