<div class="sheet-container">
    <input class="sheet-phase0-flag sheet-hidden" type="checkbox" name="attr_show_phase0_flag" checked="checked" value="1" />
    <input class="sheet-notesTab-flag sheet-hidden" type="checkbox" name="attr_show_notesTab_flag" value="1" />
    <input type="radio" name="attr_tab" class="sheet-tab sheet-tab1" value="1" />
    <span title="Phase 0"></span>
    <input type="radio" name="attr_tab" class="sheet-tab sheet-tab2" value="2" checked="checked" />
    <span title="Core"></span>
    <input type="radio" name="attr_tab" class="sheet-tab sheet-tab3" value="3" />
    <span title="Notes"></span>
    <input type="radio" name="attr_tab" class="sheet-tab sheet-tab4" value="4" />
    <span title="Settings"></span>

    <div class="sheet-tab-content sheet-tab1">
        <div class="sheet-section">
            <h1 class="sheet-h1-logo">
                <img class="sheet-logo" src="./images/Powered-by-Fate.png" alt="Fate Core" />
                <span>Charaktererschaffung</span>
            </h1>
        </div>
        <div class="sheet-break"></div>

        <div class="sheet-section-idea sheet-section">
            <div class="sheet-header">
                <span>CHARAKTER IDEE</span>
            </div>
            <div class="sheet-repitem">
                <input type="text" name="attr_HighConcept" placeholder="Konzept Aspekt" />
            </div>
            <div class="sheet-repitem">
                <input type="text" name="attr_Trouble" placeholder="Dilemma Aspekt" />
            </div>
            <div class="sheet-repitem">
                <input type="text" name="attr_character_name" placeholder="Name" />
            </div>
        </div>
        <div class="sheet-break"></div>

        <div class="sheet-section-phase-trio sheet-section">
            <div class="sheet-header">
                <span>PHASEN TRIO</span>
            </div>
            <div class="sheet-repitem">
                <textarea name="attr_aspect_one_story" placeholder="Phase Eins: Dein Abenteuer"></textarea>
                <input type="text" name="attr_aspect_one" placeholder="Phase Eins Aspekt" />
            </div>
            <div class="sheet-repitem">
                <textarea name="attr_aspect_two_story" placeholder="Phase Zwei: Erste Begegnung"></textarea>
                <input type="text" name="attr_aspect_two" placeholder="Phase Zwei Aspekt" />
            </div>
            <div class="sheet-repitem">
                <textarea name="attr_aspect_three_story" placeholder="Phase Drei: Weitere Begegnungen"></textarea>
                <input type="text" name="attr_aspect_three" placeholder="Phase Drei Aspekt" />
            </div>
        </div>
    </div>
    <div class="sheet-tab-content sheet-tab2">
        <input class="sheet-hints-flag sheet-hidden" type="checkbox" name="attr_show_hints_flag" checked="checked" />
        <div class="sheet-section sheet-hint">
            <div class="sheet-hint-options">
                <input class="sheet-hint-options-flag" type="checkbox" name="attr_show_hints_flag" checked="checked" />
                <span>*</span>
            </div>
            <div class="sheet-hint-icon">
                <span>!</span>
            </div>
            <div class="sheet-hint-content">
                <span>This Fate Core character sheet has been designed to be user friendly, keeping unnecessary changes to a minimum. Use the pencil icons to switch between editing mode and play mode, where you are able to then use Aspects, Skills and Stunts.</span>
            </div>
        </div>
        <div class="sheet-break"></div>
        <div class="sheet-section-id-logo sheet-section">
            <img class="sheet-logo" src="./images/Powered-by-Fate.png" alt="Fate Core" />
        </div>

        <div class="sheet-section-id sheet-section">
            <div class="sheet-header">
                <span>ID</span>
            </div>
            <input class="sheet-fatepoints-flag sheet-hidden" type="checkbox" name="attr_show_fatepoints_flag" value="1" checked />
            <div class="sheet-section sheet-section-id-info">
                <div class="sheet-repitem">
                    <input type="text" name="attr_character_name" placeholder="Name" />
                </div>
                <div class="sheet-repitem">
                    <textarea name="attr_character_description" placeholder="Beschreibung"></textarea>
                </div>
            </div>
            <div class="sheet-section sheet-section-id-fatepoints">
                <div class="sheet-repitem">
                    <button type="roll" class="sheet-small-button" name="roll_fatePointsRefreshRoll" value="&{template:refresh} @{rollTemplate_showCharName} {{refresh=@{fatePoints_refresh}}} {{fatePoints=@{fatepoints}}} {{pointsNeeded=[[@{fatePoints_refresh}-@{fatepoints}]]}} @{rollTemplate_showInfo}">Refresh</button>
                    <input type="number" name="attr_fatePoints_refresh" placeholder="0" />
                </div>
                <div class="sheet-repitem">
                    <button type="roll" class="sheet-small-button" name="roll_fatePointsRoll" value="&{template:fatepoints} @{rollTemplate_showCharName} {{fatePoints=@{fatepoints}}} @{rollTemplate_showInfo}">Fate Points</button>
                    <input type="number" name="attr_fatepoints" placeholder="0" class="sheet-large-number" />
                </div>
            </div>
        </div>
        <div class="sheet-break"></div>

        <div class="sheet-section-aspects sheet-section sheet-half">
            <div class="sheet-header">
                <span>ASPEKTE</span>
                <div class="sheet-section-options">
                    <input class="sheet-section-options-flag" type="checkbox" name="attr_aspects_options_flag" />
                    <span>p</span>
                </div>
            </div>
            <input class="sheet-options-flag sheet-hidden" type="checkbox" name="attr_aspects_options_flag" />
            <div class="sheet-options">
                <div class="sheet-repitem">
                    <input type="text" name="attr_HighConcept" placeholder="Konzept Aspekt" />
                </div>
                <div class="sheet-repitem">
                    <input type="text" name="attr_Trouble" placeholder="Dilemma Aspect" />
                </div>
                <div class="sheet-repitem">
                    <input type="text" name="attr_aspect_one" />
                </div>
                <div class="sheet-repitem">
                    <input type="text" name="attr_aspect_two" />
                </div>
                <div class="sheet-repitem">
                    <input type="text" name="attr_aspect_three" />
                </div>
            </div>
            <div class="sheet-display">
                <div class="sheet-repitem">
                    <button type="roll" class="sheet-action-button" name="roll_highConceptRoll" value="&{template:aspect} @{rollTemplate_showCharName} {{fatePoints=@{fatepoints}}} @{rollTemplate_showInfo} {{aspect=@{HighConcept}}}">
                        <span name="attr_HighConcept"></span>
                    </button>
                </div>
                <div class="sheet-repitem">
                    <button type="roll" class="sheet-action-button" name="roll_troubleAspectRoll" value="&{template:aspect} @{rollTemplate_showCharName} {{fatePoints=@{fatepoints}}} @{rollTemplate_showInfo} {{aspect=@{Trouble}}}">
                        <span name="attr_Trouble"></span>
                    </button>
                </div>
                <div class="sheet-repitem">
                    <button type="roll" class="sheet-action-button" name="roll_aspectOneRoll" value="&{template:aspect} @{rollTemplate_showCharName} {{fatePoints=@{fatepoints}}} @{rollTemplate_showInfo} {{aspect=@{aspect_one}}}">
                        <span name="attr_aspect_one"></span>
                    </button>
                </div>
                <div class="sheet-repitem">
                    <button type="roll" class="sheet-action-button" name="roll_aspectTwoRoll" value="&{template:aspect} @{rollTemplate_showCharName} {{fatePoints=@{fatepoints}}} @{rollTemplate_showInfo} {{aspect=@{aspect_two}}}">
                        <span name="attr_aspect_two"></span>
                    </button>
                </div>
                <div class="sheet-repitem">
                    <button type="roll" class="sheet-action-button" name="roll_aspectThreeRoll" value="&{template:aspect} @{rollTemplate_showCharName} {{fatePoints=@{fatepoints}}} @{rollTemplate_showInfo} {{aspect=@{aspect_three}}}">
                        <span name="attr_aspect_three"></span>
                    </button>
                </div>
            </div>
        </div>

        <div class="sheet-section-bonus sheet-section sheet-half">
            <div class="sheet-header">
                <span>SCHUB & SITUATIONS ASPEKTE</span>
            </div>
            <div>
                <div class="sheet-repitem sheet-sa-row">
                    <span class="sheet-sa-free-invoke">Frei</span>
                    <span class="sheet-sa-name">Aspekt</span>
                    <span class="sheet-sa-edit"></span>
                </div>
                <fieldset class="repeating_situationaspect">
                    <input class="sheet-options-flag sheet-hidden" type="checkbox" name="attr_options_flag" checked="checked" />
                    <div class="sheet-options sheet-sa-row">
                        <input type="number" name="attr_aspect_free_invokes" class="sheet-sa-free-invoke" />
                        <input type="text" name="attr_aspect_name" class="sheet-sa-name" />
                    </div>
                    <div class="sheet-display sheet-sa-row">
                        <button type="roll" class="sheet-action-button" name="roll_situationAspectRoll" value="&{template:aspect} @{rollTemplate_showCharName} {{fatePoints=@{fatepoints}}} @{rollTemplate_showInfo} {{aspect=@{aspect_name}}} {{bonus=@{aspect_free_invokes}}}">
                            <span class="sheet-sa-free-invoke" name="attr_aspect_free_invokes"></span>
                            <span class="sheet-sa-name" name="attr_aspect_name"></span>
                        </button>
                    </div>
                    <div class="sheet-item-options sheet-sa-edit">
                        <input class="sheet-item-options-flag" type="checkbox" name="attr_options_flag" checked="checked" />
                        <span>p</span>
                    </div>
                </fieldset>
            </div>
        </div>

        <div class="sheet-break"></div>

        <div class="sheet-section-skills sheet-section">
            <div class="sheet-header">
                <span>FERTIGKEITEN</span>
                <div class="sheet-section-options">
                    <input class="sheet-section-options-flag" type="checkbox" name="attr_skills_options_flag" checked="checked" />
                    <span>p</span>
                </div>
            </div>
            <div>
                <input class="sheet-rollable-flag sheet-hidden" type="checkbox" name="attr_ladder_rollable_flag" value="1" checked="checked" />
                <input class="sheet-options-flag sheet-hidden" type="checkbox" name="attr_skills_options_flag" checked="checked" />
                <div class="sheet-skills-pyramid">
                    <div class="sheet-skills-pyramid-row sheet-skills-pyramid-row-8">
                        <div class="sheet-skills-pyramid-shiftLevel">
                            <div class="sheet-rollable-flag-true">
                                <button type="roll" class="sheet-action-button" name="roll_ladder" value="&{template:skill} @{rollTemplate_showCharName} {{fatePoints=@{fatepoints}}} @{rollTemplate_showInfo} {{shiftLevel=8}} {{shiftLevelText=Legendary}} {{skill=@{ladderRollLabel}}} {{skillRoll=[[4df + 8]]}}">
                                    <span>Legendär</span> (+8)
                                </button>
                            </div>
                            <div class="sheet-rollable-flag-false">
                                <span>Legendär</span> (+8)
                            </div>
                        </div>
                        <fieldset class="repeating_skills">
                            <input type="hidden" name="attr_shiftLevel" class="sheet-skills-filter" />
                            <input type="hidden" name="attr_shiftLevelText" />
                            <div class="sheet-skills-pyramid-skill">
                                <div class="sheet-options">
                                    <input type="text" name="attr_skill" />
                                </div>
                                <div class="sheet-display">
                                    <button type="roll" class="sheet-action-button" name="roll_skillRoll" value="&{template:skill} @{rollTemplate_showCharName} {{fatePoints=@{fatepoints}}} @{rollTemplate_showInfo} {{shiftLevel=@{shiftLevel}}} {{shiftLevelText=@{shiftLevelText}}} {{skill=@{skill}}} {{skillRoll=[[4df + @{shiftLevel}]]}}">
                                        <span name="attr_skill"></span>
                                    </button>
                                </div>
                            </div>
                        </fieldset>
                        <div class="sheet-inline-options">
                            <button type="action" name="act_removeSkill8">
                                <span>-</span>
                            </button>
                            <button type="action" name="act_addSkill8">
                                <span>+</span>
                            </button>
                        </div>
                    </div>
                    <div class="sheet-skills-pyramid-row sheet-skills-pyramid-row-7">
                        <div class="sheet-skills-pyramid-shiftLevel">
                            <div class="sheet-rollable-flag-true">
                                <button type="roll" class="sheet-action-button" name="roll_ladder" value="&{template:skill} @{rollTemplate_showCharName} {{fatePoints=@{fatepoints}}} @{rollTemplate_showInfo} {{shiftLevel=7}} {{shiftLevelText=Epic}} {{skill=@{ladderRollLabel}}} {{skillRoll=[[4df + 7]]}}">
                                    <span>Episch</span> (+7)
                                </button>
                            </div>
                            <div class="sheet-rollable-flag-false">
                                <span>Episch</span> (+7)
                            </div>
                        </div>
                        <fieldset class="repeating_skills">
                            <input type="hidden" name="attr_shiftLevel" class="sheet-skills-filter" />
                            <input type="hidden" name="attr_shiftLevelText" />
                            <div class="sheet-skills-pyramid-skill">
                                <div class="sheet-options">
                                    <input type="text" name="attr_skill" />
                                </div>
                                <div class="sheet-display">
                                    <button type="roll" class="sheet-action-button" name="roll_skillRoll" value="&{template:skill} @{rollTemplate_showCharName} {{fatePoints=@{fatepoints}}} @{rollTemplate_showInfo} {{shiftLevel=@{shiftLevel}}} {{shiftLevelText=@{shiftLevelText}}} {{skill=@{skill}}} {{skillRoll=[[4df + @{shiftLevel}]]}}">
                                        <span name="attr_skill"></span>
                                    </button>
                                </div>
                            </div>
                        </fieldset>
                        <div class="sheet-inline-options">
                            <button type="action" name="act_removeSkill7">
                                <span>-</span>
                            </button>
                            <button type="action" name="act_addSkill7">
                                <span>+</span>
                            </button>
                        </div>
                    </div>
                    <div class="sheet-skills-pyramid-row sheet-skills-pyramid-row-6">
                        <div class="sheet-skills-pyramid-shiftLevel">
                            <div class="sheet-rollable-flag-true">
                                <button type="roll" class="sheet-action-button" name="roll_ladder" value="&{template:skill} @{rollTemplate_showCharName} {{fatePoints=@{fatepoints}}} @{rollTemplate_showInfo} {{shiftLevel=6}} {{shiftLevelText=Fantastic}} {{skill=@{ladderRollLabel}}} {{skillRoll=[[4df + 6]]}}">
                                    <span>Fantastisch</span> (+6)
                                </button>
                            </div>
                            <div class="sheet-rollable-flag-false">
                                <span>Fantastisch</span> (+6)
                            </div>
                        </div>
                        <fieldset class="repeating_skills">
                            <input type="hidden" name="attr_shiftLevel" class="sheet-skills-filter" />
                            <input type="hidden" name="attr_shiftLevelText" />
                            <div class="sheet-skills-pyramid-skill">
                                <div class="sheet-options">
                                    <input type="text" name="attr_skill" />
                                </div>
                                <div class="sheet-display">
                                    <button type="roll" class="sheet-action-button" name="roll_skillRoll" value="&{template:skill} @{rollTemplate_showCharName} {{fatePoints=@{fatepoints}}} @{rollTemplate_showInfo} {{shiftLevel=@{shiftLevel}}} {{shiftLevelText=@{shiftLevelText}}} {{skill=@{skill}}} {{skillRoll=[[4df + @{shiftLevel}]]}}">
                                        <span name="attr_skill"></span>
                                    </button>
                                </div>
                            </div>
                        </fieldset>
                        <div class="sheet-inline-options">
                            <button type="action" name="act_removeSkill6">
                                <span>-</span>
                            </button>
                            <button type="action" name="act_addSkill6">
                                <span>+</span>
                            </button>
                        </div>
                    </div>
                    <div class="sheet-skills-pyramid-row sheet-skills-pyramid-row-5">
                        <div class="sheet-skills-pyramid-shiftLevel">
                            <div class="sheet-rollable-flag-true">
                                <button type="roll" class="sheet-action-button" name="roll_ladder" value="&{template:skill} @{rollTemplate_showCharName} {{fatePoints=@{fatepoints}}} @{rollTemplate_showInfo} {{shiftLevel=5}} {{shiftLevelText=Superb}} {{skill=@{ladderRollLabel}}} {{skillRoll=[[4df + 5]]}}">
                                    <span>Hervorragend</span> (+5)
                                </button>
                            </div>
                            <div class="sheet-rollable-flag-false">
                                <span>Hervorragend</span> (+5)
                            </div>
                        </div>
                        <fieldset class="repeating_skills">
                            <input type="hidden" name="attr_shiftLevel" class="sheet-skills-filter" />
                            <input type="hidden" name="attr_shiftLevelText" />
                            <div class="sheet-skills-pyramid-skill">
                                <div class="sheet-options">
                                    <input type="text" name="attr_skill" />
                                </div>
                                <div class="sheet-display">
                                    <button type="roll" class="sheet-action-button" name="roll_skillRoll" value="&{template:skill} @{rollTemplate_showCharName} {{fatePoints=@{fatepoints}}} @{rollTemplate_showInfo} {{shiftLevel=@{shiftLevel}}} {{shiftLevelText=@{shiftLevelText}}} {{skill=@{skill}}} {{skillRoll=[[4df + @{shiftLevel}]]}}">
                                        <span name="attr_skill"></span>
                                    </button>
                                </div>
                            </div>
                        </fieldset>
                        <div class="sheet-inline-options">
                            <button type="action" name="act_removeSkill5">
                                <span>-</span>
                            </button>
                            <button type="action" name="act_addSkill5">
                                <span>+</span>
                            </button>
                        </div>
                    </div>
                    <div class="sheet-skills-pyramid-row sheet-skills-pyramid-row-4">
                        <div class="sheet-skills-pyramid-shiftLevel">
                            <div class="sheet-rollable-flag-true">
                                <button type="roll" class="sheet-action-button" name="roll_ladder" value="&{template:skill} @{rollTemplate_showCharName} {{fatePoints=@{fatepoints}}} @{rollTemplate_showInfo} {{shiftLevel=4}} {{shiftLevelText=Great}} {{skill=@{ladderRollLabel}}} {{skillRoll=[[4df + 4]]}}">
                                    <span>Grossartig</span> (+4)
                                </button>
                            </div>
                            <div class="sheet-rollable-flag-false">
                                <span>Grossartig</span> (+4)
                            </div>
                        </div>
                        <fieldset class="repeating_skills">
                            <input type="hidden" name="attr_shiftLevel" class="sheet-skills-filter" />
                            <input type="hidden" name="attr_shiftLevelText" />
                            <div class="sheet-skills-pyramid-skill">
                                <div class="sheet-options">
                                    <input type="text" name="attr_skill" />
                                </div>
                                <div class="sheet-display">
                                    <button type="roll" class="sheet-action-button" name="roll_skillRoll" value="&{template:skill} @{rollTemplate_showCharName} {{fatePoints=@{fatepoints}}} @{rollTemplate_showInfo} {{shiftLevel=@{shiftLevel}}} {{shiftLevelText=@{shiftLevelText}}} {{skill=@{skill}}} {{skillRoll=[[4df + @{shiftLevel}]]}}">
                                        <span name="attr_skill"></span>
                                    </button>
                                </div>
                            </div>
                        </fieldset>
                        <div class="sheet-inline-options">
                            <button type="action" name="act_removeSkill4">
                                <span>-</span>
                            </button>
                            <button type="action" name="act_addSkill4">
                                <span>+</span>
                            </button>
                        </div>
                    </div>
                    <div class="sheet-skills-pyramid-row sheet-skills-pyramid-row-3">
                        <div class="sheet-skills-pyramid-shiftLevel">
                            <div class="sheet-rollable-flag-true">
                                <button type="roll" class="sheet-action-button" name="roll_ladder" value="&{template:skill} @{rollTemplate_showCharName} {{fatePoints=@{fatepoints}}} @{rollTemplate_showInfo} {{shiftLevel=3}} {{shiftLevelText=Good}} {{skill=@{ladderRollLabel}}} {{skillRoll=[[4df + 3]]}}">
                                    <span>Gut</span> (+3)
                                </button>
                            </div>
                            <div class="sheet-rollable-flag-false">
                                <span>Gut</span> (+3)
                            </div>
                        </div>
                        <fieldset class="repeating_skills">
                            <input type="hidden" name="attr_shiftLevel" class="sheet-skills-filter" />
                            <input type="hidden" name="attr_shiftLevelText" />
                            <div class="sheet-skills-pyramid-skill">
                                <div class="sheet-options">
                                    <input type="text" name="attr_skill" />
                                </div>
                                <div class="sheet-display">
                                    <button type="roll" class="sheet-action-button" name="roll_skillRoll" value="&{template:skill} @{rollTemplate_showCharName} {{fatePoints=@{fatepoints}}} @{rollTemplate_showInfo} {{shiftLevel=@{shiftLevel}}} {{shiftLevelText=@{shiftLevelText}}} {{skill=@{skill}}} {{skillRoll=[[4df + @{shiftLevel}]]}}">
                                        <span name="attr_skill"></span>
                                    </button>
                                </div>
                            </div>
                        </fieldset>
                        <div class="sheet-inline-options">
                            <button type="action" name="act_removeSkill3">
                                <span>-</span>
                            </button>
                            <button type="action" name="act_addSkill3">
                                <span>+</span>
                            </button>
                        </div>
                    </div>
                    <div class="sheet-skills-pyramid-row sheet-skills-pyramid-row-2">
                        <div class="sheet-skills-pyramid-shiftLevel">
                            <div class="sheet-rollable-flag-true">
                                <button type="roll" class="sheet-action-button" name="roll_ladder" value="&{template:skill} @{rollTemplate_showCharName} {{fatePoints=@{fatepoints}}} @{rollTemplate_showInfo} {{shiftLevel=2}} {{shiftLevelText=Fair}} {{skill=@{ladderRollLabel}}} {{skillRoll=[[4df + 2]]}}">
                                    <span>Ordentlich</span> (+2)
                                </button>
                            </div>
                            <div class="sheet-rollable-flag-false">
                                <span>Ordentlich</span> (+2)
                            </div>
                        </div>
                        <fieldset class="repeating_skills">
                            <input type="hidden" name="attr_shiftLevel" class="sheet-skills-filter" />
                            <input type="hidden" name="attr_shiftLevelText" />
                            <div class="sheet-skills-pyramid-skill">
                                <div class="sheet-options">
                                    <input type="text" name="attr_skill" />
                                </div>
                                <div class="sheet-display">
                                    <button type="roll" class="sheet-action-button" name="roll_skillRoll" value="&{template:skill} @{rollTemplate_showCharName} {{fatePoints=@{fatepoints}}} @{rollTemplate_showInfo} {{shiftLevel=@{shiftLevel}}} {{shiftLevelText=@{shiftLevelText}}} {{skill=@{skill}}} {{skillRoll=[[4df + @{shiftLevel}]]}}">
                                        <span name="attr_skill"></span>
                                    </button>
                                </div>
                            </div>
                        </fieldset>
                        <div class="sheet-inline-options">
                            <button type="action" name="act_removeSkill2">
                                <span>-</span>
                            </button>
                            <button type="action" name="act_addSkill2">
                                <span>+</span>
                            </button>
                        </div>
                    </div>
                    <div class="sheet-skills-pyramid-row sheet-skills-pyramid-row-1">
                        <div class="sheet-skills-pyramid-shiftLevel">
                            <div class="sheet-rollable-flag-true">
                                <button type="roll" class="sheet-action-button" name="roll_ladder" value="&{template:skill} @{rollTemplate_showCharName} {{fatePoints=@{fatepoints}}} @{rollTemplate_showInfo} {{shiftLevel=1}} {{shiftLevelText=Average}} {{skill=@{ladderRollLabel}}} {{skillRoll=[[4df + 1]]}}">
                                    <span>Durchschnittlich</span> (+1)
                                </button>
                            </div>
                            <div class="sheet-rollable-flag-false">
                                <span>Durchschnittlich</span> (+1)
                            </div>
                        </div>
                        <fieldset class="repeating_skills">
                            <input type="hidden" name="attr_shiftLevel" class="sheet-skills-filter" />
                            <input type="hidden" name="attr_shiftLevelText" />
                            <div class="sheet-skills-pyramid-skill">
                                <div class="sheet-options">
                                    <input type="text" name="attr_skill" />
                                </div>
                                <div class="sheet-display">
                                    <button type="roll" class="sheet-action-button" name="roll_skillRoll" value="&{template:skill} @{rollTemplate_showCharName} {{fatePoints=@{fatepoints}}} @{rollTemplate_showInfo} {{shiftLevel=@{shiftLevel}}} {{shiftLevelText=@{shiftLevelText}}} {{skill=@{skill}}} {{skillRoll=[[4df + @{shiftLevel}]]}}">
                                        <span name="attr_skill"></span>
                                    </button>
                                </div>
                            </div>
                        </fieldset>
                        <div class="sheet-inline-options">
                            <button type="action" name="act_removeSkill1">
                                <span>-</span>
                            </button>
                            <button type="action" name="act_addSkill1">
                                <span>+</span>
                            </button>
                        </div>
                    </div>
                    <div class="sheet-skills-pyramid-row sheet-skills-pyramid-row-0">
                        <div class="sheet-skills-pyramid-shiftLevel">
                            <div class="sheet-rollable-flag-true">
                                <button type="roll" class="sheet-action-button" name="roll_ladder" value="&{template:skill} @{rollTemplate_showCharName} {{fatePoints=@{fatepoints}}} @{rollTemplate_showInfo} {{shiftLevel=0}} {{shiftLevelText=Mediocre}} {{skill=@{ladderRollLabel}}} {{skillRoll=[[4df + 0]]}}">
                                    <span>Mässig</span> (+0)
                                </button>
                            </div>
                            <div class="sheet-rollable-flag-false">
                                <span>Mässig</span> (+0)
                            </div>
                        </div>
                        <fieldset class="repeating_skills">
                            <input type="hidden" name="attr_shiftLevel" class="sheet-skills-filter" />
                            <input type="hidden" name="attr_shiftLevelText" />
                            <div class="sheet-skills-pyramid-skill">
                                <div class="sheet-options">
                                    <input type="text" name="attr_skill" />
                                </div>
                                <div class="sheet-display">
                                    <button type="roll" class="sheet-action-button" name="roll_skillRoll" value="&{template:skill} @{rollTemplate_showCharName} {{fatePoints=@{fatepoints}}} @{rollTemplate_showInfo} {{shiftLevel=@{shiftLevel}}} {{shiftLevelText=@{shiftLevelText}}} {{skill=@{skill}}} {{skillRoll=[[4df + @{shiftLevel}]]}}">
                                        <span name="attr_skill"></span>
                                    </button>
                                </div>
                            </div>
                        </fieldset>
                        <div class="sheet-inline-options">
                            <button type="action" name="act_removeSkill0">
                                <span>-</span>
                            </button>
                            <button type="action" name="act_addSkill0">
                                <span>+</span>
                            </button>
                        </div>
                    </div>
                    <div class="sheet-skills-pyramid-row sheet-skills-pyramid-row-n1">
                        <div class="sheet-skills-pyramid-shiftLevel">
                            <div class="sheet-rollable-flag-true">
                                <button type="roll" class="sheet-action-button" name="roll_ladder" value="&{template:skill} @{rollTemplate_showCharName} {{fatePoints=@{fatepoints}}} @{rollTemplate_showInfo} {{shiftLevel=-1}} {{shiftLevelText=Poor}} {{skill=@{ladderRollLabel}}} {{skillRoll=[[4df - 1]]}}">
                                    <span>Schwach</span> (-1)
                                </button>
                            </div>
                            <div class="sheet-rollable-flag-false">
                                <span>Schwach</span> (-1)
                            </div>
                        </div>
                        <fieldset class="repeating_skills">
                            <input type="hidden" name="attr_shiftLevel" class="sheet-skills-filter" />
                            <input type="hidden" name="attr_shiftLevelText" />
                            <div class="sheet-skills-pyramid-skill">
                                <div class="sheet-options">
                                    <input type="text" name="attr_skill" />
                                </div>
                                <div class="sheet-display">
                                    <button type="roll" class="sheet-action-button" name="roll_skillRoll" value="&{template:skill} @{rollTemplate_showCharName} {{fatePoints=@{fatepoints}}} @{rollTemplate_showInfo} {{shiftLevel=@{shiftLevel}}} {{shiftLevelText=@{shiftLevelText}}} {{skill=@{skill}}} {{skillRoll=[[4df + @{shiftLevel}]]}}">
                                        <span name="attr_skill"></span>
                                    </button>
                                </div>
                            </div>
                        </fieldset>
                        <div class="sheet-inline-options">
                            <button type="action" name="act_removeSkillN1">
                                <span>-</span>
                            </button>
                            <button type="action" name="act_addSkillN1">
                                <span>+</span>
                            </button>
                        </div>
                    </div>
                    <div class="sheet-skills-pyramid-row sheet-skills-pyramid-row-n2">
                        <div class="sheet-skills-pyramid-shiftLevel">
                            <div class="sheet-rollable-flag-true">
                                <button type="roll" class="sheet-action-button" name="roll_ladder" value="&{template:skill} @{rollTemplate_showCharName} {{fatePoints=@{fatepoints}}} @{rollTemplate_showInfo} {{shiftLevel=-2}} {{shiftLevelText=Terrible}} {{skill=@{ladderRollLabel}}} {{skillRoll=[[4df - 2]]}}">
                                    <span>Fürchterlich</span> (-2)
                                </button>
                            </div>
                            <div class="sheet-rollable-flag-false">
                                <span>Fürchterlich</span> (-2)
                            </div>
                        </div>
                        <fieldset class="repeating_skills">
                            <input type="hidden" name="attr_shiftLevel" class="sheet-skills-filter" />
                            <input type="hidden" name="attr_shiftLevelText" />
                            <div class="sheet-skills-pyramid-skill">
                                <div class="sheet-options">
                                    <input type="text" name="attr_skill" />
                                </div>
                                <div class="sheet-display">
                                    <button type="roll" class="sheet-action-button" name="roll_skillRoll" value="&{template:skill} @{rollTemplate_showCharName} {{fatePoints=@{fatepoints}}} @{rollTemplate_showInfo} {{shiftLevel=@{shiftLevel}}} {{shiftLevelText=@{shiftLevelText}}} {{skill=@{skill}}} {{skillRoll=[[4df + @{shiftLevel}]]}}">
                                        <span name="attr_skill"></span>
                                    </button>
                                </div>
                            </div>
                        </fieldset>
                        <div class="sheet-inline-options">
                            <button type="action" name="act_removeSkillN2">
                                <span>-</span>
                            </button>
                            <button type="action" name="act_addSkillN2">
                                <span>+</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="sheet-break"></div>

        <div class="sheet-section-stunts sheet-section sheet-half">
            <div class="sheet-header">
                <span>STUNTS</span>
            </div>
            <fieldset class="repeating_stunts">
                <div class="sheet-item-options">
                    <input class="sheet-options-flag sheet-hidden" type="checkbox" name="attr_options_flag" checked="checked" />
                    <div class="sheet-display">
                        <input class="sheet-item-options-flag2" type="checkbox" name="attr_more_flag" checked="checked" />
                        <span>E</span>
                    </div>
                    <input class="sheet-item-options-flag" type="checkbox" name="attr_options_flag" checked="checked" />
                    <span>p</span>
                </div>
                <input class="sheet-options-flag sheet-hidden" type="checkbox" name="attr_options_flag" checked="checked" />
                <div class="sheet-options">
                    <input type="text" name="attr_aspect_name" placeholder="Aspekt" />
                    <input type="text" name="attr_skill" placeholder="Fertigkeit" />
                    <input type="hidden" name="attr_skillShiftLevel" />
                    <input type="hidden" name="attr_skillShiftLevelText" />
                    <div>
                        <span class="sheet-check-label">Kostet Fate Punkte?</span>
                        <input type="checkbox" name="attr_requiresFatePoint" value="{{requiresFatePoint=1}}" />
                    </div>
                    <select name="attr_type">
                        <option value="" disabled selected hidden>Stunt Typ...</option>
                        <option value="1"><span>Fertigkeit neue Aktion zuordnen</span></option>
                        <option value="2"><span>Aktion einen Bonus zuordnen</span></option>
                        <option value="3"><span>Ausnahme von der Regel erlauben</span></option>
                    </select>
                    <input type="hidden" name="attr_typeText" />
                    <input type="hidden" name="attr_type" class="sheet-stunt-type" />
                    <div class="sheet-stunt-action">
                        <div>
                            <input type="checkbox" name="attr_isOvercome" value="{{isOvercome=1}}" />
                            <span class="sheet-check-label">Überwinden</span>
                        </div>
                        <div>
                            <input type="checkbox" name="attr_isAdvantage" value="{{isAdvantage=1}}" />
                            <span class="sheet-check-label">Einen Vorteil erschaffen</span>
                        </div>
                        <div>
                            <input type="checkbox" name="attr_isAttack" value="{{isAttack=1}}" />
                            <span class="sheet-check-label">Angreifen</span>
                        </div>
                        <div>
                            <input type="checkbox" name="attr_isDefend" value="{{isDefend=1}}" />
                            <span class="sheet-check-label">Verteidigen</span>
                        </div>
                    </div>
                    <div class="sheet-stunt-bonus">
                        <span>Bonus : </span>
                        <select name="attr_bonusShifts">
                            <option value="8"><span>Legendär</span> (+8)</option>
                            <option value="7"><span>Episch</span> (+7)</option>
                            <option value="6"><span>Fantastisch</span> (+6)</option>
                            <option value="5"><span>Hervorragend</span> (+5)</option>
                            <option value="4"><span>Grossartig</span> (+4)</option>
                            <option value="3"><span>Gut</span> (+3)</option>
                            <option value="2" selected><span>Ordentlich</span> (+2)</option>
                            <option value="1"><span>Durchschnittlich</span> (+1)</option>
                        </select>
                        <input type="hidden" name="attr_bonusShiftsText" />
                        <div>
                            <span class="sheet-check-label">Roll Fertigkeit?</span>
                            <input type="checkbox" name="attr_rollSkill" value="{{isSkillRoll=1}}" />
                        </div>
                    </div>
                    <textarea name="attr_description" placeholder="Beschreibung"></textarea>
                </div>
                <div class="sheet-display">
                    <input class="sheet-options-flag sheet-hidden" type="checkbox" name="attr_more_flag" checked="checked" />
                    <div class="sheet-display">
                        <h3 class="sheet-right-buttons">
                            <button type="roll" class="sheet-action-button" name="roll_stunt" value="&{template:stunt} @{rollTemplate_showCharName} {{fatePoints=@{fatepoints}}} @{rollTemplate_showInfo} {{stunt=@{aspect_name}}} @{requiresFatePoint} {{skill=@{skill}}} {{skillShiftLevelText=@{skillShiftLevelText}}} {{skillShiftLevel=[[@{skillShiftLevel}]]}} {{typeText=@{typeText}}} {{type=[[@{type}]]}} @{isOvercome} @{isAdvantage} @{isAttack} @{isDefend} {{bonusShiftsText=@{bonusShiftsText}}} {{bonusShifts=@{bonusShifts}}} @{rollSkill} {{skillRoll=[[4df + @{skillShiftLevel} + @{bonusShifts}]]}} {{description=@{description}}}">
                                <span name="attr_aspect_name"></span>
                            </button>
                        </h3>
                        <span name="attr_description" class="sheet-keep-whitespace"></span>
                    </div>
                    <div class="sheet-options">
                        <h3 class="sheet-right-buttons">
                            <button type="roll" class="sheet-action-button sheet-tooltip" name="roll_stunt" value="&{template:stunt} @{rollTemplate_showCharName} {{fatePoints=@{fatepoints}}} @{rollTemplate_showInfo} {{stunt=@{aspect_name}}} @{requiresFatePoint} {{skill=@{skill}}} {{skillShiftLevelText=@{skillShiftLevelText}}} {{skillShiftLevel=[[@{skillShiftLevel}]]}} {{typeText=@{typeText}}} {{type=[[@{type}]]}} @{isOvercome} @{isAdvantage} @{isAttack} @{isDefend} {{bonusShiftsText=@{bonusShiftsText}}} {{bonusShifts=@{bonusShifts}}} @{rollSkill} {{skillRoll=[[4df + @{skillShiftLevel} + @{bonusShifts}]]}} {{description=@{description}}}">
                                <span name="attr_aspect_name"></span>
                                <span name="attr_description" class="sheet-tooltipText sheet-keep-whitespace"></span>
                            </button>
                        </h3>
                    </div>
                </div>
            </fieldset>
        </div>

        <div class="sheet-section-extras sheet-section sheet-half">
            <div class="sheet-header">
                <span>EXTRAS & BELOHNUNG</span>
            </div>
            <fieldset class="repeating_extras">
                <input class="sheet-options-flag sheet-hidden" type="checkbox" name="attr_options_flag" checked="checked" />
                <div class="sheet-item-options sheet-extras-edit">
                    <input class="sheet-options-flag sheet-hidden" type="checkbox" name="attr_options_flag" checked="checked" />
                    <div class="sheet-display">
                        <input class="sheet-item-options-flag2" type="checkbox" name="attr_more_flag" checked="checked" />
                        <span>E</span>
                    </div>
                    <input class="sheet-item-options-flag" type="checkbox" name="attr_options_flag" checked="checked" />
                    <span>p</span>
                </div>
                <div class="sheet-options sheet-extras-row">
                    <input type="text" name="attr_title" placeholder="Titel" />
                    <input type="text" name="attr_permissions" placeholder="Zulassung" />
                    <input type="text" name="attr_costs" placeholder="Kosten" />
                    <textarea name="attr_description" placeholder="Beschreibung"></textarea>
                </div>
                <div class="sheet-display sheet-extras-row">
                    <input class="sheet-options-flag sheet-hidden" type="checkbox" name="attr_more_flag" checked="checked" />
                    <div class="sheet-display">
                        <h3 class="sheet-right-buttons">
                            <button type="roll" class="sheet-action-button" name="roll_extra" value="&{template:extra} @{rollTemplate_showCharName} {{fatePoints=@{fatepoints}}} @{rollTemplate_showInfo} {{extra=@{title}}} {{permissions=@{permissions}}} {{costs=@{costs}}} {{description=@{description}}}">
                                <span name="attr_title"></span>
                            </button>    
                        </h3>
                        <div class="row">
                            <span class="sheet-inlineLabel">Zulassung</span>
                            <span class="sheet-inlineLabel">: </span>
                            <span name="attr_permissions"></span>
                        </div>
                        <div class="row">
                            <span class="sheet-inlineLabel">Costs</span>
                            <span class="sheet-inlineLabel">: </span>
                            <span name="attr_costs"></span>
                        </div>                        
                        <span name="attr_description" class="sheet-keep-whitespace"></span>
                    </div>
                    <div class="sheet-options">
                        <h3 class="sheet-right-buttons">
                            <button type="roll" class="sheet-action-button sheet-tooltip" name="roll_extra" value="&{template:extra} @{rollTemplate_showCharName} {{fatePoints=@{fatepoints}}} @{rollTemplate_showInfo} {{extra=@{title}}} {{permissions=@{permissions}}} {{costs=@{costs}}} {{description=@{description}}}">
                                <span name="attr_title"></span>
                                <span name="attr_description" class="sheet-tooltipText sheet-keep-whitespace"></span>
                            </button>    
                        </h3>
                    </div>
                </div>
            </fieldset>
        </div>

        <div class="sheet-break"></div>

        <div class="sheet-section-stress sheet-section sheet-half">
            <div class="sheet-header">
                <span>STRESS</span>
                <div class="sheet-section-options">
                    <button type="action" name="act_clearStress" >
                        <span>#</span>
                    </button>
                </div>
            </div>
            <fieldset class="repeating_stress">
                <input class="sheet-options-flag sheet-hidden" type="checkbox" name="attr_options_flag" checked="checked" />
                <div class="sheet-options">
                    <input type="text" name="attr_name" placeholder="Name" />
                    <input type="text" name="attr_skill" placeholder="Fertigkeit" />
                    <select name="attr_usable">
                        <option value=1>1</option>
                        <option value=2 selected>2</option>
                        <option value=3>3</option>
                        <option value=4>4</option>
                        <option value=5>5</option>
                        <option value=6>6</option>
                        <option value=7>7</option>
                        <option value=8>8</option>
                    </select>
                    <input type="hidden" name="attr_bound" />
                    <div class="sheet-item-options sheet-stress-edit">
                        <input class="sheet-item-options-flag" type="checkbox" name="attr_options_flag" checked="checked" />
                        <span>3</span>
                    </div>
                </div>
                <div class="sheet-display">
                    <div class="sheet-stress-header">
                        <span class="sheet-stress-header-name" name="attr_name"></span>
                        <span class="sheet-stress-header-skill" name="attr_skill"></span>
                    </div>
                    <div class="sheet-stress-row">
                        <input type="hidden" name="attr_usable" />
                        <input type="checkbox" name="attr_isUsed1" title="1" value=1 />
                        <input type="checkbox" name="attr_isUsed2" title="2" value=2 />
                        <input type="checkbox" name="attr_isUsed3" title="3" value=3 />
                        <input type="checkbox" name="attr_isUsed4" title="4" value=4 />
                        <input type="checkbox" name="attr_isUsed5" title="5" value=5 />
                        <input type="checkbox" name="attr_isUsed6" title="6" value=6 />
                        <input type="checkbox" name="attr_isUsed7" title="7" value=7 />
                        <input type="checkbox" name="attr_isUsed8" title="8" value=8 />
                    </div>
                </div>
            </fieldset>
        </div>

        <input class="sheet-conditions-flag sheet-hidden" type="checkbox" name="attr_show_conditions_flag" value="1" />
        <div class="sheet-section-consequences sheet-section sheet-half">
            <div class="sheet-header">
                <span>KONSEQUENZEN</span>
            </div>
            <div class="sheet-repitem sheet-consequence-row">
                <span class="sheet-consequence-worth"></span>
                <span class="sheet-consequence-aspect">Aspekt</span>
                <span class="sheet-consequence-healing">k</span>
            </div>
            <fieldset class="repeating_consequences">
                <input class="sheet-options-flag sheet-hidden" type="checkbox" name="attr_options_flag" checked="checked" />
                <div class="sheet-options">
                    <select name="attr_worth">
                        <option value=2 selected><span>Leicht</span> (2)</option>
                        <option value=4><span>Mittel</span> (4)</option>
                        <option value=6><span>Schwer</span> (6)</option>
                        <option value=8><span>Extrem</span> (8)</option>
                    </select>
                    <input type="hidden" name="attr_worth_text" value="Mild"/>
                    <input type="checkbox" name="attr_isUsed" class="sheet-hidden" value="1" />
                    <div class="sheet-item-options sheet-consequence-edit">
                        <input class="sheet-item-options-flag" type="checkbox" name="attr_options_flag" checked="checked" />
                        <span>3</span>
                    </div>
                </div>
                <div class="sheet-display sheet-consequence-row">
                    <div class="sheet-consequence-worth">
                        <button type="roll" class="sheet-action-button" name="roll_consequenceRoll" value="&{template:consequence} @{rollTemplate_showCharName} {{fatePoints=@{fatepoints}}} @{rollTemplate_showInfo} {{worth=@{worth}}} {{worthText=@{worth_text}}} {{aspect=@{aspect}}} {{isHealing=[[@{isHealing}]]}}">
                            <span class="sheet-worth-value" name="attr_worth"></span>
                            <span class="sheet-worth-text" name="attr_worth_text"></span>
                        </button>
                    </div>
                    <input type="text" name="attr_aspect" placeholder="Ungenutzt" class="sheet-consequence-aspect" />
                    <input type="checkbox" name="attr_isHealing" class="sheet-consequence-healing" value="1" />
                </div>
            </fieldset>
        </div>
        <div class="sheet-section-conditions sheet-section sheet-half">
            <div class="sheet-header">
                <span>ZUSTÄNDE</span>
                <div class="sheet-section-options">
                    <input class="sheet-section-options-flag" type="checkbox" name="attr_consequences_options_flag" checked="checked" />
                    <span>p</span>
                </div>
            </div>
            <div class="sheet-repitem sheet-conditions-row">
                <span class="sheet-consequence-worth"></span>
                <span class="sheet-consequence-healing">k</span>
                <span class="sheet-consequence-aspect">Aspekt</span>
            </div>
            <input class="sheet-options-flag sheet-hidden" type="checkbox" name="attr_consequences_options_flag" checked="checked" />
            <div class="sheet-options">
                <fieldset class="repeating_consequences">
                    <div class="sheet-conditions-row">
                        <select name="attr_worth">
                            <option value=1 selected><span>Vergänglich</span> (1)</option>
                            <option value=2><span>Angehängt</span> (2)</option>
                            <option value=4><span>Dauerhaft</span> (4)</option>
                        </select>
                        <input type="hidden" name="attr_worth_text" value="Fleeting"/>
                        <input type="text" name="attr_aspect" placeholder="Aspekt" />
                        <input type="checkbox" name="attr_isUsed" class="sheet-hidden" value="1" />
                        <input type="checkbox" name="attr_isHealing" class="sheet-hidden" value="1" />
                    </div>
                </fieldset>
            </div>
            <div class="sheet-display">
                <div class="sheet-conditions-group1">
                    <h3><span>Vergänglich</span></h3>
                    <fieldset class="repeating_consequences">
                        <input type="hidden" name="attr_worth" class="sheet-conditions-filter" />
                        <input type="hidden" name="attr_worth_text" />
                        <div class="sheet-conditions-row">
                            <div class="sheet-consequence-worth">
                                <span class="sheet-worth-value" name="attr_worth"></span>
                                <input type="checkbox" name="attr_isUsed" value="1" />
                            </div>
                            <div class="sheet-consequence-healing">
                                <input type="checkbox" name="attr_isHealing" value="1" class="sheet-hidden" />
                            </div>
                            <div class="sheet-consequence-aspect">
                                <button type="roll" class="sheet-action-button" name="roll_consequenceRoll" value="&{template:consequence} @{rollTemplate_showCharName} {{fatePoints=@{fatepoints}}} @{rollTemplate_showInfo} {{worth=@{worth}}} {{worthText=@{worth_text}}} {{aspect=@{aspect}}} {{isHealing=[[@{isHealing}]]}}">
                                    <span name="attr_aspect"></span>
                                </button>
                            </div>
                        </div>
                    </fieldset>
                </div>
                <div class="sheet-conditions-group2">
                    <h3><span>Angehängt</span></h3>
                    <fieldset class="repeating_consequences">
                        <input type="hidden" name="attr_worth" class="sheet-conditions-filter" />
                        <input type="hidden" name="attr_worth_text" />
                        <div class="sheet-conditions-row">
                            <div class="sheet-consequence-worth">
                                <span class="sheet-worth-value" name="attr_worth"></span>
                                <input type="checkbox" name="attr_isUsed" value="1" />
                            </div>
                            <div class="sheet-consequence-healing">
                                <input type="checkbox" name="attr_isHealing" value="1" class="sheet-hidden" />
                            </div>
                            <div class="sheet-consequence-aspect">
                                <button type="roll" class="sheet-action-button" name="roll_consequenceRoll" value="&{template:consequence} @{rollTemplate_showCharName} {{fatePoints=@{fatepoints}}} @{rollTemplate_showInfo} {{worth=@{worth}}} {{worthText=@{worth_text}}} {{aspect=@{aspect}}} {{isHealing=[[@{isHealing}]]}}">
                                    <span name="attr_aspect"></span>
                                </button>
                            </div>
                        </div>
                    </fieldset>
                </div>
                <div class="sheet-conditions-group4">
                    <h3><span>Dauerhaft</span></h3>
                    <fieldset class="repeating_consequences">
                        <input type="hidden" name="attr_worth" class="sheet-conditions-filter" />
                        <input type="hidden" name="attr_worth_text" />
                        <div class="sheet-conditions-row">
                            <div class="sheet-consequence-worth">
                                <span class="sheet-worth-value" name="attr_worth"></span>
                                <input type="checkbox" name="attr_isUsed" value="1" />
                            </div>
                            <div class="sheet-consequence-healing">
                                <input type="checkbox" name="attr_isHealing" value="1" />
                            </div>
                            <div class="sheet-consequence-aspect">
                                <button type="roll" class="sheet-action-button" name="roll_consequenceRoll" value="&{template:consequence} @{rollTemplate_showCharName} {{fatePoints=@{fatepoints}}} @{rollTemplate_showInfo} {{worth=@{worth}}} {{worthText=@{worth_text}}} {{aspect=@{aspect}}} {{isHealing=[[@{isHealing}]]}}">
                                    <span name="attr_aspect"></span>
                                </button>
                            </div>
                        </div>
                    </fieldset>
                </div>
            </div>
        </div>

        <div class="sheet-break"></div>

        <input class="sheet-notesTab-flag sheet-hidden" type="checkbox" name="attr_show_notesTab_flag" value="1" />

        <div class="sheet-section-notes sheet-section">
            <div class="sheet-header">
                <span>NOTIZEN</span>
            </div>
            <fieldset class="repeating_notes">
                <input class="sheet-options-flag sheet-hidden" type="checkbox" name="attr_options_flag" checked="checked" />
                <div class="sheet-item-options sheet-notes-edit">
                    <input class="sheet-item-options-flag" type="checkbox" name="attr_options_flag" checked="checked" />
                    <span>p</span>
                </div>
                <div class="sheet-options sheet-notes-row">
                    <input type="text" name="attr_title" placeholder="Notizen Title" />
                    <textarea name="attr_body" placeholder="Notizen"></textarea>
                </div>
                <div class="sheet-display sheet-notes-row">
                    <h3><span name="attr_title"></span></h3>
                    <span name="attr_body" class="sheet-keep-whitespace"></span>
                </div>
            </fieldset>
        </div>
    </div>
    
    <div class="sheet-tab-content sheet-tab3">
        <h1>Notizen</h1>
        <fieldset class="repeating_notes">
            <div class="sheet-header">
                <span name="attr_title"></span>
                <div class="sheet-section-options">
                    <input class="sheet-section-options-flag" type="checkbox" name="attr_options_flag" checked="checked" />
                    <span>p</span>
                </div>
            </div>
            <input class="sheet-options-flag sheet-hidden" type="checkbox" name="attr_options_flag" checked="checked" />
            <div class="sheet-options">
                <input type="text" name="attr_title" placeholder="Notizen Title" />
                <textarea name="attr_body" placeholder="Notizen"></textarea>
            </div>
            <div class="sheet-display">
                <span name="attr_body" class="sheet-keep-whitespace"></span>
            </div>
        </fieldset>
    </div>
    
    <div class="sheet-tab-content sheet-tab4">
        <h1>Einstellungen</h1>
        <div class="sheet-section">
            <div class="sheet-header">
                <span>Darstellungs Optionen</span>
            </div>
            <div class="sheet-settings">
                <div class="sheet-setting">
                    <div class="sheet-header">
                        <span>Show First Time Hints</span>
                    </div>
                    <div>
                        <input type="checkbox" value="1" name="attr_show_hints_flag" checked="checked" />
                        <p><span>Show hints that might be useful for first time players or those upgrading from the previous sheet design.</span></p>
                    </div>
                </div>
                <div class="sheet-setting">
                    <div class="sheet-header">
                        <span>Show Phase 0 Tab</span>
                    </div>
                    <div>
                        <input type="checkbox" value="1" name="attr_show_phase0_flag" checked="checked" />
                        <p><span>If you are starting with a Phase 0, then you can use this tab to build up your ideas.</span></p>
                    </div>
                </div>
                <div class="sheet-setting">
                    <div class="sheet-header">
                        <span>Show Notes Tab</span>
                    </div>
                    <div>
                        <input type="checkbox" value="1" name="attr_show_notesTab_flag" />
                        <p><span>Set this if you would prefer the notes to show on a Tab of their own.</span></p>
                    </div>
                </div>
                <div class="sheet-setting">
                    <div class="sheet-header">
                        <span>Rollable Ladder</span>
                    </div>
                    <div>
                        <input type="checkbox" class="sheet-ladder-rollable" value="1" name="attr_ladder_rollable_flag" checked="checked" />
                        <p><span>Make the values on the Ladder rollable.</span></p>
                        <div class="sheet-ladder-rollable-true">
                            <select name="attr_ladderRollLabel">
                                <option value="&nbsp;" selected>Blank</option>
                                <option value="?{Skill?}">Ask on roll</option>
                            </select>
                            <p><span>When rolling from the ladder, what header should be used?</span></p>
                        </div>
                    </div>
                </div>
                <div class="sheet-setting">
                    <div class="sheet-header">
                        <span>Show Fate Points</span>
                    </div>
                    <div>
                        <input type="checkbox" value="1" name="attr_show_fatepoints_flag" checked="checked" />
                        <p><span>NPCs and Extras don't usually have their own Fate Points so uncheck this to hide the Fate Points and Refresh boxes</span></p>
                    </div>
                </div>
                <div class="sheet-setting">
                    <div class="sheet-header">
                        <span>Use Conditions instead of Consequences</span>
                    </div>
                    <div>
                        <input type="checkbox" value="1" name="attr_show_conditions_flag">
                        <p><span>Use the Conditions from the Fate Toolkit to replace Consequences</span></p>
                    </div>
                </div>
            </div>
        </div>
        <div class="sheet-section">
            <div class="sheet-header">
                <span>Roll Options</span>
            </div>
            <div class="sheet-settings">
                <div class="sheet-setting">
                    <div class="sheet-header">
                        <span>Show Help Info on Rolls</span>
                    </div>
                    <div>
                        <input type="checkbox" value="{{showInfo=1}}" name="attr_rollTemplate_showInfo" checked="checked" />
                        <p><span>Show hints that might be useful for first time players on rolls.</span></p>
                    </div>
                </div>
                <div class="sheet-setting">
                    <div class="sheet-header">
                        <span>Show Character Name on Rolls</span>
                    </div>
                    <div>
                        <input type="checkbox" value="{{charname=@{character_name}}}" name="attr_rollTemplate_showCharName" checked="checked" />
                        <p><span>Show the Character's name on the Roll output. This is useful when rolling other character's Aspects.</span></p>
                    </div>
                </div>
            </div>
        </div>
        <div class="sheet-section">
            <div class="sheet-header">
                <span>Game Defaults</span>
            </div>
            <div class="sheet-settings">
                <div class="sheet-setting">
                    <div class="sheet-header">
                        <span>Run First Time Setup</span>
                    </div>
                    <div>
                        <input type="checkbox" value="1" name="attr_run_firstTime_setup" checked="checked" />
                        <p><span>Run scripts to setup the sheet for a default character.</span></p>
                    </div>
                </div>
                <div class="sheet-setting">
                    <div class="sheet-header">
                        <span>Default Stresses and Skills</span>
                    </div>
                    <div>
                        <input type="text" value="Physical:Physique,Mental:Will" name="attr_default_stressSkills" />
                        <p><span>When setting up a default sheet, what stress tracks and their guiding skill should be set up? e.g. "Mental:Will,Extra:3"</span></p>
                    </div>
                </div>
                <div class="sheet-setting">
                    <div class="sheet-header">
                        <span>Default Consequences</span>
                    </div>
                    <div>
                        <input type="text" value="2,4,6" name="attr_default_consequences" />
                        <p><span>When setting up a default sheet, what consequences are the default consequences? e.g. "2,4,6"</span></p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="sheet-hidden">
        <input type="hidden" name="attr_importedOldData_flag" />
    </div>
</div>

<rolltemplate class="sheet-rolltemplate-refresh">
    <div class="sheet-rollTemplate">
        <div class="sheet-fate-point-circle">
            <span>{{fatePoints}}</span>
        </div>
        <div class="row sheet-header">
            <span>Erholungsrate</span>
        </div>
        <div class="row">
            <span>{{#charname}}{{charname}}'s {{/charname}}Refresh is {{refresh}}. {{#rollLess() pointsNeeded 1}}No{{/rollLess() pointsNeeded 1}}{{#^rollLess() pointsNeeded 1}}{{pointsNeeded}}{{/^rollLess() pointsNeeded 1}} Fate Point{{#^rollTotal() pointsNeeded 1}}s{{/^rollTotal() pointsNeeded 1}} needed to reach the Refresh.</span>
        </div>
        {{#showInfo}}
        <div class="row sheet-header">
            <span>Info</span>
        </div>
        <div class="row">
            <span class="sheet-info">Beim Start einer neuen Session, bitte die Fate Punkte der Erholungsraten entsprechend anpassen.</span>
        </div>
        {{/showInfo}}
    </div>
</rolltemplate>

<rolltemplate class="sheet-rolltemplate-fatepoints">
    <div class="sheet-rollTemplate">
        <div class="sheet-fate-point-circle">
            <span>{{fatePoints}}</span>
        </div>
        {{^showInfo}}
        <div class="row sheet-header">
            <span>Fate Punkte</span>
        </div>
        {{/showInfo}}
        {{#showInfo}}
        <div class="row sheet-header">
            <span>Info</span>
        </div>
        <div class="row">
            <p class="sheet-info">Du gibst Fate aus um deinen Charakter Grossartig zu machen. Du kannst damit Story Details einfügen oder Aspekte erschaffen. Manche Stunts benötigen Fate Punkte zur Aktivierung. Keine Fate Punkte mehr? Dann reize deine Aspekte.</p>
            <ul class="sheet-info">
                <li>Ein Story Detail sollte etwas sein, was Dir in der Szene etwas bringt. Bespreche das Detail it der SL. Bei Einigung kostet es dich einen Fate Punkt und das Detail wird zu einem Aspekt.</li>
                <li>Einen Aspekt verwenden, gibt dir einen Bonus auf einen Fertigkeits-Wurf. Der Aspekt sollte mit der benutzten Fertigkeit etwas gemein haben. Du kannst dich entweder entscheiden neu zu würfeln, oder erhälst auf deinen Wurf einen Bonus von (+2). Sollte es Sinn ergeben, kannst du mehrere Aspekte gleichzeitig verwenden.</li>
                <li>Hast du keine Fate Punkte mehr? Versuche einen deiner Aspekte zu reizen. Scheitern ist cool!, das gibt Fate-Punkte. Auch die SL kann Spieler Aspekte reizen..</li>
            </ul>
        </div>
        {{/showInfo}}
    </div>
</rolltemplate>

<rolltemplate class="sheet-rolltemplate-aspect">
    <div class="sheet-rollTemplate">
        <div class="sheet-fate-point-circle">
            <span>{{fatePoints}}</span>
        </div>
        {{#bonus}}
        <div class="sheet-bonus-circle">
            <span>{{bonus}}</span>
        </div>
        {{/bonus}}
        <div class="row sheet-header">
            <span>{{#isCompel}}Compel{{/isCompel}}{{^isCompel}}Überwinde{{/isCompel}} Aspect</span>
        </div>
        <div class="row">
            <span>{{#isCompel}}Compelling{{/isCompel}}{{^isCompel}}Überwinde{{/isCompel}} {{#charname}}{{charname}}'s {{/charname}}Aspect "{{aspect}}".</span>
        </div>
        {{#showInfo}}
        <div class="row sheet-header">
            <span>Info</span>
        </div>
        <div class="row">
            {{#isCompel}}
            <span class="sheet-info">Wird ein Aspekt gegen dich gereizt? Dann bezahle der Person einen Fate Punkt um das Reizen zu verhindern, oder erlaube das Reizen und erhalte dafür einen Fate-Punkt.</span>
            {{/isCompel}}
            {{^isCompel}}
            <p class="sheet-info">Einen Aspekt verwenden, kostet dich 1 Fate-Punkt:</p>
            <ul class="sheet-info">
                <li>
                    <span>Beim Wurf auf eine Fertigkeit hast du folgende Optionen:</span>
                    <ul>
                        <li>Wiederhole den Wurf auf die Fertikeit</li>
                        <li>Erhalte einen Bonus von (+2) auf deinen Wurf</li>
                    </ul>
                    <span>Der Aspekt soll mit der benutzten Fertigkeit Sinn ergeben. Sollte es Sinn ergebeb, kannst du mehrere Aspekte gleichzeitig verwenden.</span>
                </li>
                <li>
                    <span>Du kannst immer Story Details einbringen, welcher Dir in der Szene etwas bringen. Beispiele:</span>
                    <ul>
                        <li><span>"Ich habe Aspekt X, also macht es Sinn, das ich diesen NSC bereits kenne"</span></li>
                        <li><span>"Aufgrund Aspekt X war ich schlau genug, vor Abreise eine Karte der Location einzupacken</span></li>
                        <li><span>"Ich habe Aspekt X, deshalb ist mir diese Sprache bekannt"</span></li>
                    </ul>
                    <span>Bespreche die Details mit der SL. Sind sich alle einig, wir für die Kosten von 1 Fate-Punkt das Detail zu einem Aspekt.</span>
                </li>
            </ul>
            {{/isCompel}}
        </div>
        {{/showInfo}}
    </div>
</rolltemplate>

<rolltemplate class="sheet-rolltemplate-skill">
    <div class="sheet-rollTemplate">
        <div class="sheet-fate-point-circle">
            <span>{{fatePoints}}</span>
        </div>
        <div class="row sheet-header">
            <span>{{skill}}</span>
        </div>
        <div class="row">
            {{#rollGreater() skillRoll 7}}
            <span>Legendär</span>
            {{/rollGreater() skillRoll 7}}
            {{#rollTotal() skillRoll 7}}
            <span>Episch</span>
            {{/rollTotal() skillRoll 7}}
            {{#rollTotal() skillRoll 6}}
            <span>Fantastisch</span>
            {{/rollTotal() skillRoll 6}}
            {{#rollTotal() skillRoll 5}}
            <span>Hervorragend</span>
            {{/rollTotal() skillRoll 5}}
            {{#rollTotal() skillRoll 4}}
            <span>Grossartig</span>
            {{/rollTotal() skillRoll 4}}
            {{#rollTotal() skillRoll 3}}
            <span>Gut</span>
            {{/rollTotal() skillRoll 3}}
            {{#rollTotal() skillRoll 2}}
            <span>Ordentlich</span>
            {{/rollTotal() skillRoll 2}}
            {{#rollTotal() skillRoll 1}}
            <span>Durchschnittlich</span>
            {{/rollTotal() skillRoll 1}}
            {{#rollTotal() skillRoll 0}}
            <span>Mässig</span>
            {{/rollTotal() skillRoll 0}}
            {{#rollTotal() skillRoll -1}}
            <span>Schwach</span>
            {{/rollTotal() skillRoll -1}}
            {{#rollLess() skillRoll -1}}
            <span>Fürchterlich</span>
            {{/rollLess() skillRoll -1}}
            <span> ({{#rollGreater() skillRoll -1}}+{{/rollGreater() skillRoll -1}}{{skillRoll}})</span>
        </div>
        {{#showInfo}}
        <div class="row sheet-header">
            <span>Info</span>
        </div>
        <div class="row">
            <span class="sheet-info">Fertigkeiten werden verwendet für eine der vier folgenden Aktionen:</span>
            <ul class="sheet-info">
                <li>
                    <span class="sheet-uppercase">Überwinden</span>
                    <ul>
                        <li><span>Mit diesem Aktionstyp kannst du verschiedene Dinge erreichen was genau, hängt von der verwendeten Fertigkeit ab.</span></li>
                    </ul>
                </li>
                <li>
                    <span class="sheet-uppercase">Einen Vorteil erschaffen</span>
                    <ul>
                        <li><span>Du kannst einen Situationsaspekt erschaffen, der dir einen Vorteil bringt. Oder einen Aspekt den du schon kennst, in einen Vorteil verwandeln.</span></li>
                    </ul>
                </li>
                <li>
                    <span class="sheet-uppercase">Angreifen</span>
                    <ul>
                        <li><span>Mit diesem Aktionstyp kannst du jemanden in einem Konflikt verletzen oder ausschalten..</span></li>
                    </ul>
                </li>
                <li>
                    <span class="sheet-uppercase">Verteidigen</span>
                    <ul>
                        <li><span>Mit diesem Aktionstyp kannst du dich verteidigen, wenn dich jemand angreifen will oder versucht, einen Vorteil gegen dich zu erschaffen..</span></li>
                    </ul>
                </li>
            </ul>
        </div>
        {{/showInfo}}
    </div>
</rolltemplate>

<rolltemplate class="sheet-rolltemplate-stunt">
    <div class="sheet-rollTemplate">
        <div class="sheet-fate-point-circle">
            <span>{{fatePoints}}</span>
        </div>
        <div class="row sheet-header">
            <span>{{stunt}}</span>
        </div>
        {{#requiresFatePoint}}
        <div class="row">
            <span class="sheet-warning">Die Aktivierung des Stunts kostet einen Fate-Punkt</span>
        </div>
        {{/requiresFatePoint}}
        <div class="row">
            <span class="sheet-inlineLabel">Fertigkeit</span>
            <span class="sheet-inlineLabel">: </span>
            <span>{{skill}} - {{skillShiftLevelText}} ({{#rollGreater() skillShiftLevel -1}}+{{/rollGreater() skillShiftLevel -1}}{{skillShiftLevel}})</span>
        </div>
        <div class="row">
            <span class="sheet-inlineLabel">Stunt Typ</span>
            <span class="sheet-inlineLabel">: </span>
            <span>{{typeText}}</span>
        </div>
        {{#rollBetween() type 1 2}}
        <div class="row">
            <span class="sheet-inlineLabel">Aktion</span>
            <span class="sheet-inlineLabel">: </span>
            <ul>
                {{#isOvercome}}
                <li>Überwinden</li>
                {{/isOvercome}}
                {{#isAdvantage}}
                <li>Vorteil erschaffen</li>
                {{/isAdvantage}}
                {{#isAttack}}
                <li>Angreifen</li>
                {{/isAttack}}
                {{#isDefend}}
                <li>Verteidigen</li>
                {{/isDefend}}
            </ul>
        </div>
        {{/rollBetween() type 1 2}}
        {{#rollTotal() type 2}}
        <div class="row">
            <span class="sheet-inlineLabel">Bonus</span>
            <span class="sheet-inlineLabel">: </span>
            <span>{{bonusShiftsText}} (+{{bonusShifts}})</span>
        </div>
        {{/rollTotal() type 2}}
        {{#isSkillRoll}}
        <div class="row">
            <span class="sheet-inlineLabel">Fertigkeit Roll</span>
            <span class="sheet-inlineLabel">: </span>
            {{#rollGreater() skillRoll 7}}
            <span>Legendär</span>
            {{/rollGreater() skillRoll 7}}
            {{#rollTotal() skillRoll 7}}
            <span>Episch</span>
            {{/rollTotal() skillRoll 7}}
            {{#rollTotal() skillRoll 6}}
            <span>Fantastisch</span>
            {{/rollTotal() skillRoll 6}}
            {{#rollTotal() skillRoll 5}}
            <span>Hervorragend</span>
            {{/rollTotal() skillRoll 5}}
            {{#rollTotal() skillRoll 4}}
            <span>Grossartig</span>
            {{/rollTotal() skillRoll 4}}
            {{#rollTotal() skillRoll 3}}
            <span>Gut</span>
            {{/rollTotal() skillRoll 3}}
            {{#rollTotal() skillRoll 2}}
            <span>Ordentlich</span>
            {{/rollTotal() skillRoll 2}}
            {{#rollTotal() skillRoll 1}}
            <span>Durchschnittlich</span>
            {{/rollTotal() skillRoll 1}}
            {{#rollTotal() skillRoll 0}}
            <span>Mässig</span>
            {{/rollTotal() skillRoll 0}}
            {{#rollTotal() skillRoll -1}}
            <span>Schwach</span>
            {{/rollTotal() skillRoll -1}}
            {{#rollLess() skillRoll -1}}
            <span>Fürchterlich</span>
            {{/rollLess() skillRoll -1}}
            <span> ({{#rollGreater() skillRoll -1}}+{{/rollGreater() skillRoll -1}}{{skillRoll}})</span>
        </div>
        {{/isSkillRoll}}
        <div class="row">
            <span class="sheet-keep-whitespace">{{description}}</span>
        </div>
        {{#showInfo}}
        <div class="row sheet-header">
            <span>Info</span>
        </div>
        <div class="row">
            <span class="sheet-info">Stunts sind das, was dein Charakter vom Rest der Gruppe abhebt. Jeder kann ein großer (+5) Kämpfer sein, aber wie viele können einen ordentlichen (+2) Bonus schaffen, wenn sie mit ihrem großen Kriegshammer den Boden zerschlagen und alle "wackelig auf den Beinen" machen?</span>
            <ul class="sheet-info">
                <li>
                    <span class="sheet-uppercase">Überwinden</span>
                    <ul>
                        <li><span>Mit diesem Aktionstyp kannst du verschiedene Dinge erreichen - was genau, hängt von der verwendeten Fertigkeit ab.</span></li>
                    </ul>
                </li>
                <li>
                    <span class="sheet-uppercase">Einen Vorteil erschaffen</span>
                    <ul>
                        <li><span>Mit diesem Aktionstyp kannst du einen Situationsaspekt erschaffen, der dir einen Vorteil bringt, oder du kannst einen Aspekt, den du schon kennst, in einen Vorteil für dich verwandeln.</span></li>
                    </ul>
                </li>
                <li>
                    <span class="sheet-uppercase">Angreifen</span>
                    <ul>
                        <li><span>Mit diesem Aktionstyp kannst du jemanden in einem Konflikt verletzen oder ausschalten.</span></li>
                    </ul>
                </li>
                <li>
                    <span class="sheet-uppercase">Verteidigen</span>
                    <ul>
                        <li><span>Mit diesem Aktionstyp kannst du dich verteidigen, wenn dich jemand angreifen will oder versucht, einen Vorteil gegen dich zu erschaffen.</span></li>
                    </ul>
                </li>
            </ul>
        </div>
        {{/showInfo}}
    </div>
</rolltemplate>

<rolltemplate class="sheet-rolltemplate-extra">
    <div class="sheet-rollTemplate">
        <div class="sheet-fate-point-circle">
            <span>{{fatePoints}}</span>
        </div>
        <div class="row sheet-header">
            <span>Extra</span>
            <span>: </span>
            <span>{{extra}}</span>
        </div>
        <div class="row">
            <span class="sheet-inlineLabel">Zulassung</span>
            <span class="sheet-inlineLabel">: </span>
            <span>{{permissions}}</span>
        </div>
        <div class="row">
            <span class="sheet-inlineLabel">Kosten</span>
            <span class="sheet-inlineLabel">: </span>
            <span>{{costs}}</span>
        </div>
        <div class="row">
            <span class="sheet-keep-whitespace">{{description}}</span>
        </div>
    </div>
</rolltemplate>
    
<rolltemplate class="sheet-rolltemplate-consequence">
    <div class="sheet-rollTemplate">
        <div class="sheet-fate-point-circle">
            <span>{{fatePoints}}</span>
        </div>
        {{^aspect}}
        <div class="row sheet-header">
            <span>Consequence</span>
        </div>
        <div class="row">
            <span>{{#charname}}{{charname}} is t{{/charname}}{{^charname}}T{{/charname}}aking a {{worthText}} ({{worth}}) consequence.</span>
        </div>
        {{/aspect}}
        {{#aspect}}
        <div class="row sheet-header">
            <span>{{#isCompel}}Compel{{/isCompel}}{{^isCompel}}Invoke{{/isCompel}} Aspect</span>
        </div>
        <div class="row">
            <span>{{#isCompel}}Compelling{{/isCompel}}{{^isCompel}}Invoking{{/isCompel}} {{#charname}}{{charname}}'s {{/charname}}Aspect "{{aspect}}".</span>
        </div>
        {{/aspect}}
        {{#showInfo}}
        <div class="row sheet-header">
            <span>Info</span>
        </div>
        <div class="row">
            {{^aspect}}
            <p class="sheet-info"><span>Die Konsequenz ist die Art und Weise, wie während eines Konflikts wirklicher Schaden angerichtet wird. Wenn Du einen Konsequenz-Slot verwendest, reduziere Sie den Wert des Angriffs um den Wertert der Konsequenz. Du kannst mehr als eine Konsequenz auf einmal verwenden. Jede der verbleibenden Schadenspunkte des Treffers muss von einem Stresskästchen abgehalten werden.</span></p>
            {{/aspect}}
            {{#aspect}}
            <p class="sheet-info"><span>Der Konflikt hat eine dauerhafte Verletzung oder einen Rückschlag für den Charakter verursacht. Der Charakter, der dies verursacht hat, erhält einen kostenlosen Einsatz des Aspekts, aber jeder kann den Aspekt gegen den Charakter geltend machen, wenn er weiß, dass er vorhanden ist.</span></p>
            {{#^rollTotal() isHealing 1}}
            <p class="sheet-info"><span>Die Wunde ist noch relativ frisch und muss, bevor es schlimmer wird, bald behandelt werden. </span></p>
            {{/^rollTotal() isHealing 1}}
            {{#rollTotal() isHealing 1}}
            <p class="sheet-info"><span>Die Wunde wurde behandelt, und die Figur ist bandagiert, aber die Erinnerung daran ist noch immer vorhanden. Die Wunde wird mit der Zeit, je nach Schwere, vollständig verheilt sein, und wenn die Wunde verschwunden ist, wird der Kosequenzen Slot wieder freigegeben.</span></p>
            {{/rollTotal() isHealing 1}}
            {{#isCompel}}
            <p class="sheet-info">
                <span>Wird ein Aspekt gegen dich gereizt, dann bezahle der Person entweder einen Fate-Punkt, oder erlaube das Reizen und erhalte dafür einen Fate-Punkt.</span>
            </p>
            {{/isCompel}}
            {{^isCompel}}
            <p class="sheet-info">Einen Aspekt verwenden, kostet dich 1 Fate-Punkt</p>
            <ul class="sheet-info">
                <li>
                    <span>Beim Wurf auf eine Fertigkeit hast du folgende Optionen:</span>
                    <ul>
                        <li>Wiederhole den Wurf auf die Fertigkeit</li>
                        <li>Erhalte einen Bonus von (+2) auf deinen Wurf</li>
                    </ul>
                    <span>Der Aspekt soll mit der benutzten Fertigkeit Sinn ergeben. Ist dies der Fall, kannst du auch mehrere Aspekte gleichzeitig verwenden. (Stack)</span>
                </li>
                <li>
                    <span>Du kannst immer Story Details einbringen, welche Dir in der Szene etwas bringen. Beispiele:</span>
                    <ul>
                        <li><span>”Ich habe Aspekt X, also macht es Sinn, das ich diesen NSC bereits kenne. "</span></li>
                        <li><span>”Aufgrund Aspekt X war ich schlau genug, vor Abreise eine Karte der Location einzupacken"</span></li>
                        <li><span>"Ich habe Aspekt X, weshalb mir diese Sprache bekannt ist"</span></li>
                    </ul>
                    <span>Bespreche die Details mit der SL. Sind sich alle einig, wird für die Kosten von 1 Fate-Punkt das Detail zu einem Aspekt.</span>
                </li>
            </ul>
            {{/isCompel}}
            {{/aspect}}
        </div>
        {{/showInfo}}
    </div>
</rolltemplate>
    
<script type="text/worker">
    on('sheet:opened', function () {
        getAttrs(["run_firstTime_setup", "default_stressSkills",
                    "default_consequences", "show_conditions_flag",
                    "importedOldData_flag"], function (values) {
            if (isNullOrWhitespace(values["importedOldData_flag"]))
            {
                ImportIdData();
                ImportSkills();
                ImportAspects();
                ImportStunts();
                ImportExtras();
                ImportStresses(values["run_firstTime_setup"], values["default_stressSkills"]);
                ImportConsequences(values["run_firstTime_setup"],
                    values["default_consequences"],
                    values["show_conditions_flag"]);
                ImportNotes();
    
                setAttrs({ importedOldData_flag: 1, run_firstTime_setup: 0 });
                return;
            }
            if (!isNullOrWhitespace(values["run_firstTime_setup"])) {
                SetDefaultStress(values["default_stressSkills"]);
                SetDefaultConsequences(values["default_consequences"], values["show_conditions_flag"]);
    
                setAttrs({ run_firstTime_setup: 0 });
            }
        });
    });
    
    function ImportIdData () {
        getAttrs(["Description", "Refresh", "Fate"], function (values) {
            if(isNullOrWhitespace(values["Description"])
                && isNullOrWhitespace(values["Refresh"]
                && isNullOrWhitespace(values["Fate"])))
                return;
    
            setAttrs({ character_description: values["Description"],
                        fatePoints_refresh: Number(values["Refresh"]),
                        fatepoints: Number(values["Fate"])
                     });
        });
    };
    
    function ImportSkills () {
        getAttrs(["LegendaryActive", "EpicActive", "FantasticActive",
                    "SuperbActive", "PoorActive", "TerribleActive"], settings => {
            var attrs = [];
            for (var i = 1; i < 9; i++) {
                if (!isNullOrWhitespace(settings["LegendaryActive"]) || typeof settings["LegendaryActive"] === "undefined")
                    attrs.push("Leg" + i);
                if (!isNullOrWhitespace(settings["EpicActive"]) || typeof settings["LegendaryActive"] === "undefined")
                    attrs.push("Epic" + i);
                if (!isNullOrWhitespace(settings["FantasticActive"]) || typeof settings["LegendaryActive"] === "undefined")
                    attrs.push("Fan" + i);
                if (!isNullOrWhitespace(settings["SuperbActive"]) || typeof settings["LegendaryActive"] === "undefined")
                    attrs.push("Sup" + i);
                attrs.push("Great" + i);
                attrs.push("Good" + i);
                attrs.push("Fair" + i);
                attrs.push("Avg" + i);
                if (!isNullOrWhitespace(settings["PoorActive"]) || typeof settings["LegendaryActive"] === "undefined")
                    attrs.push("Poor" + i);
                if (!isNullOrWhitespace(settings["TerribleActive"]) || typeof settings["LegendaryActive"] === "undefined")
                    attrs.push("Ter" + i);
            }
    
            getAttrs(attrs, function (values) {
                for (var i = 1; i < 9; i++) {
                    if (!isNullOrWhitespace(settings["LegendaryActive"]) || typeof settings["LegendaryActive"] === "undefined")
                        importSkill(values["Leg" + i], 8);
                    if (!isNullOrWhitespace(settings["EpicActive"]) || typeof settings["LegendaryActive"] === "undefined")
                        importSkill(values["Epic" + i], 7);
                    if (!isNullOrWhitespace(settings["FantasticActive"]) || typeof settings["LegendaryActive"] === "undefined")
                        importSkill(values["Fan" + i], 6);
                    if (!isNullOrWhitespace(settings["SuperbActive"]) || typeof settings["LegendaryActive"] === "undefined")
                        importSkill(values["Sup" + i], 5);
                    importSkill(values["Great" + i], 4);
                    importSkill(values["Good" + i], 3);
                    importSkill(values["Fair" + i], 2);
                    importSkill(values["Avg" + i], 1);
                    if (!isNullOrWhitespace(settings["PoorActive"]) || typeof settings["LegendaryActive"] === "undefined")
                        importSkill(values["Poor" + i], -1);
                    if (!isNullOrWhitespace(settings["TerribleActive"]) || typeof settings["LegendaryActive"] === "undefined")
                        importSkill(values["Ter" + i], -2);
                }
            });
        });
    };
    
    const importSkill = (skill, skillLevel) => {
        if (isNullOrWhitespace(skill))
            return;
    
        var newRowId = generateRowID();
        var newRowAttrs = {};
        newRowAttrs["repeating_skills_" + newRowId + "_skill"] = skill;
        newRowAttrs["repeating_skills_" + newRowId + "_shiftLevel"] = skillLevel;
        newRowAttrs["repeating_skills_" + newRowId + "_shiftLevelText"] = getShiftText(skillLevel);
        setAttrs(newRowAttrs);
    };
    
    function ImportAspects () {
        var attrs = [];
        attrs.push("HighConcept");
        attrs.push("Trouble");
        attrs.push("AdvantagesActive");
        for (var i = 1; i < 6; i++) {
            attrs.push("HiCon" + i);
            attrs.push("Trouble" + i);
        }
    
        getAttrs(attrs, function (values) {
            var hiCon = 0;
            var trbl = 0;
            for (var i = 1; i < 6; i++) {
                if (!isNullOrWhitespace(values["HiCon" + i]))
                    hiCon++;
                if (!isNullOrWhitespace(values["Trouble" + i]))
                    trbl++;
            }
    
            if (hiCon > 0)
                importSitAspect(values["HighConcept"], hiCon);
            if (trbl > 0)
                importSitAspect(values["Trouble"], trbl);
    
            if (isNullOrWhitespace(values["AdvantagesActive"]))
                return;
    
            getSectionIDs("repeating_Advantages", function (idArray) {
                if (idArray.length == 0)
                    return;
        
                idArray.forEach(id => {
                    var attrs = [];
                    attrs.push("repeating_Advantages_" + id + "_Advantages");
                    for (var i = 1; i < 6; i++) {
                        attrs.push("repeating_Advantages_" + id + "_Adv" + i);
                    }
        
                    getAttrs(attrs, function (values) {
                        var bonus = 0;
                        for (var i = 1; i < 6; i++) {
                            if (!isNullOrWhitespace(values["repeating_Advantages_" + id + "_Adv" + i]))
                                bonus++;
                        }
                
                        importSitAspect(values["repeating_Advantages_" + id + "_Advantages"], bonus);
                        removeRepeatingRow("repeating_Advantages_" + id);
                    });
                });
            });
        });
    
        getSectionIDs("repeating_Aspects", function (idArray) {
            if (idArray.length == 0)
                return;
    
            idArray.forEach(id => {
                var attrs = [];
                attrs.push("repeating_Aspects_" + id + "_Aspect");
                for (var i = 1; i < 6; i++) {
                    attrs.push("repeating_Aspects_" + id + "_Asp" + i);
                }
    
                getAttrs(attrs, function (values) {
                    var bonus = 0;
                    for (var i = 1; i < 6; i++) {
                        if (!isNullOrWhitespace(values["repeating_Aspects_" + id + "_Asp" + i]))
                            bonus++;
                    }
            
                    var index = idArray.indexOf(id);
                    if (index < 3) {
                        if (index == 0)
                            setAttrs({ aspect_one: values["repeating_Aspects_" + id + "_Aspect"]});
                        else if (index == 1)
                            setAttrs({ aspect_two: values["repeating_Aspects_" + id + "_Aspect"]});
                        else if (index == 2)
                            setAttrs({ aspect_three: values["repeating_Aspects_" + id + "_Aspect"]});
                        if (bonus > 0)
                            importSitAspect(values["repeating_Aspects_" + id + "_Aspect"], bonus);
                    }
                    else
                        importSitAspect(values["repeating_Aspects_" + id + "_Aspect"], bonus);
    
                    removeRepeatingRow("repeating_Aspects_" + id);
                });
            });
        });
    };
    
    const importSitAspect = (aspect, bonus) => {
        if (isNullOrWhitespace(aspect))
            return;
    
        var newRowId = generateRowID();
        var newRowAttrs = {};
        newRowAttrs["repeating_situationaspect_" + newRowId + "_aspect_name"] = aspect;
        newRowAttrs["repeating_situationaspect_" + newRowId + "_aspect_free_invokes"] = bonus;
        newRowAttrs["repeating_situationaspect_" + newRowId + "_options_flag"] = "on";
        setAttrs(newRowAttrs);
    };
    
    function ImportStunts () {
        getAttrs(["Stunts"], function (values) {
            getSectionIDs("repeating_Stunts", function (idArray) {
                importStunt(values["Stunts"]);
    
                if (idArray.length == 0)
                    return;
        
                var attrs = [];
                for (var i = 0; i < idArray.length; i++) {
                    attrs.push("repeating_Stunts_" + idArray[i] + "_Stunt");
                }
        
                getAttrs(attrs, function (stunts) {
                    for (var i = 0; i < idArray.length; i++) {
                        importStunt(stunts["repeating_Stunts_" + idArray[i] + "_Stunt"]);
                        removeRepeatingRow("repeating_Stunts_" + idArray[i]);
                    }
        
                    setAttrs(newRowAttrs);
                });
            });        
        });
    };
    
    const importStunt = (stunt) => {
        if (isNullOrWhitespace(stunt))
            return;
    
        var newRowId = generateRowID();
        var newRowAttrs = {};
        newRowAttrs["repeating_stunts_" + newRowId + "_description"] = stunt;
        setAttrs(newRowAttrs);
    };
    
    function ImportExtras () {
        getAttrs(["Extras"], function (values) {
            getSectionIDs("repeating_Extras", function (idArray) {
                importExtra(values["Extras"]);
    
                if (idArray.length == 0)
                    return;
        
                var attrs = [];
                for (var i = 0; i < idArray.length; i++) {
                    attrs.push("repeating_Extras_" + idArray[i] + "_Extra");
                }
        
                getAttrs(attrs, function (extras) {
                    for (var i = 0; i < idArray.length; i++) {
                        importExtra(extras["repeating_Extras_" + idArray[i] + "_Extra"]);
                        removeRepeatingRow("repeating_Extras_" + idArray[i]);
                    }
        
                    setAttrs(newRowAttrs);
                });
            });
        });
    };
    
    const importExtra = (extra) => {
        if (isNullOrWhitespace(extra))
            return;
    
        var newRowId = generateRowID();
        var newRowAttrs = {};
        newRowAttrs["repeating_extras_" + newRowId + "_description"] = extra;
        setAttrs(newRowAttrs);
    };
    
    function ImportStresses (runFirstTimeSetup, default_stressSkills) {
        var attr = [];
        attr.push("PhyGoverningSkill");
        attr.push("MenGoverningSkill");
        for (var i = 1; i < 5; i++) {
            attr.push("Phy" + i);
            attr.push("Phy" + i + "Active");
            attr.push("Men" + i);
            attr.push("Men" + i + "Active");
        }
        
        getAttrs(attr, function (basicValues) {
            var phyGoverningSkill = basicValues["PhyGoverningSkill"];
            if (isNullOrWhitespace(phyGoverningSkill))
                phyGoverningSkill = "Physique";
            
            var menGoverningSkill = basicValues["MenGoverningSkill"];
            if (isNullOrWhitespace(menGoverningSkill))
                menGoverningSkill = "Will";
            
            getSectionIDs("repeating_Stress", function (idArray) {
                if (idArray.length == 0) {
                    importStress("Physical", phyGoverningSkill, "Phy", basicValues);
                    importStress("Mental", menGoverningSkill, "Men", basicValues);
                        
                    if (!isNullOrWhitespace(runFirstTimeSetup))
                        SetDefaultStress(default_stressSkills);
    
                    return;
                }
            
                var attrs = [];
                idArray.forEach(id =>  {
                    attrs.push("repeating_Stress_" + id + "_Name");
                    attrs.push("repeating_Stress_" + id + "_Mirrored");
                    for (var x = 1; x < 5; x++) {
                        attr.push("repeating_Stress_" + id + "_Stress" + x);
                        attr.push("repeating_Stress_" + id + "_Stress" + x + "Active");
                    }
                });
    
                getAttrs(attrs, function (repValues) {
                    var mirrors = [];
                    for (var i = 0; i < idArray.length; i++) {
                        mirrors.push("repeating_StressOptions_" + repValues["repeating_Stress_" + idArray[i] + "_Mirrored"] + "_GoverningSkill");
                    }
        
                    getAttrs(mirrors, function (mirroredValues) {
                        importStress("Physical", phyGoverningSkill, "Phy", basicValues);
                        importStress("Mental", menGoverningSkill, "Men", basicValues);
    
                        idArray.forEach(id => {
                            importStress(repValues["repeating_Stress_" + id + "_Name"],
                                mirroredValues["repeating_StressOptions_" + repValues["repeating_Stress_" + id + "_Mirrored"] + "_GoverningSkill"],
                                "repeating_Stress_" + id + "_Stress", repValues);
                            
                            removeRepeatingRow("repeating_StressOptions_" + repValues["repeating_Stress_" + id + "_Mirrored"]);
                            removeRepeatingRow("repeating_Stress_" + id);
                        });
                        
                        if (!isNullOrWhitespace(runFirstTimeSetup))
                            SetDefaultStress(default_stressSkills);
                    });
                });
            });    
        });
    };
    
    const importStress = (stress, skill, prefix, attrs) => {
        var newRowAttrs = {};
        var stressMax = 0;
    
        var newRowId = generateRowID();
        newRowAttrs["repeating_stress_" + newRowId + "_name"] = stress.trim();
    
        for (var i = 1; i < 5; i++) {
            if(!isNullOrWhitespace(attrs[prefix + i + "Active"])) {
                stressMax++;
                if(!isNullOrWhitespace(attrs[prefix + i]))
                    newRowAttrs["repeating_stress_" + newRowId + "_isUsed" + i] = i;
            }
            else
                return;
        }
    
        if (stressMax == 0)
            return;
    
        newRowAttrs["repeating_stress_" + newRowId + "_usable"] = stressMax;
    
        if (!isNullOrWhitespace(skill)) {
            newRowAttrs["repeating_stress_" + newRowId + "_skill"] = skill.trim();
            newRowAttrs["repeating_stress_" + newRowId + "_bound"] = 1;
        }
    
        setAttrs(newRowAttrs);
    };
    
    function SetDefaultStress (default_stressSkills) {
        if (!isNullOrWhitespace(default_stressSkills)) {
            getSectionIDs("repeating_stress", function (idArray) {
                if (idArray.length == 0) {
                    var stressSkills = default_stressSkills.split(",");
                    var newRowAttrs = {};
                    stressSkills.forEach(element => {
                        var keyValuePair = element.split(":");
                        var newRowId = generateRowID();
                        newRowAttrs["repeating_stress_" + newRowId + "_name"] = keyValuePair[0].trim();
                        if (keyValuePair.length > 1) {
                            var skill = keyValuePair[1].trim();
                            var usable = Number(skill);
                            if (isNaN(usable)) {
                                newRowAttrs["repeating_stress_" + newRowId + "_skill"] = skill;
                                newRowAttrs["repeating_stress_" + newRowId + "_usable"] = 2;
                                newRowAttrs["repeating_stress_" + newRowId + "_bound"] = 1;
                            }
                            else {
                                newRowAttrs["repeating_stress_" + newRowId + "_usable"] = usable;
                                newRowAttrs["repeating_stress_" + newRowId + "_bound"] = 0;
                            }
                            newRowAttrs["repeating_stress_" + newRowId + "_options_flag"] = 0;
                        }
                        else {
                            newRowAttrs["repeating_stress_" + newRowId + "_options_flag"] = "on";
                        }
                    });
                    setAttrs(newRowAttrs);
                }
            });
        }
    };
    
    function ImportConsequences (runFirstTimeSetup, default_consequences, show_conditions_flag) {
        var attr = [];
        attr.push("MildConsequence");
        attr.push("MildInvoke");
        attr.push("ModerateConsequence");
        attr.push("ModerateInvoke");
        attr.push("SevereConsequence");
        attr.push("SevereInvoke");
        
        getAttrs(attr, function (basicValues) {
            getSectionIDs("repeating_Cons", function (idArray) {
                if (idArray.length == 0) {
                    if (isNullOrWhitespace(basicValues["MildConsequence"])
                        && isNullOrWhitespace(basicValues["MildInvoke"])
                        && isNullOrWhitespace(basicValues["ModerateConsequence"])
                        && isNullOrWhitespace(basicValues["ModerateInvoke"])
                        && isNullOrWhitespace(basicValues["SevereConsequence"])
                        && isNullOrWhitespace(basicValues["SevereInvoke"])) {
                            if (!isNullOrWhitespace(runFirstTimeSetup))
                                SetDefaultConsequences(default_consequences, show_conditions_flag);
                            return;
                        }
                    
                    importConsequence(2, basicValues["MildConsequence"], !isNullOrWhitespace(basicValues["MildInvoke"]));
                    importConsequence(4, basicValues["ModerateConsequence"], !isNullOrWhitespace(basicValues["ModerateInvoke"]));
                    importConsequence(6, basicValues["SevereConsequence"], !isNullOrWhitespace(basicValues["SevereInvoke"]));
                    return;
                }
            
                var attrs = [];
                for (var i = 0; i < idArray.length; i++) {
                    attrs.push("repeating_Cons_" + idArray[i] + "_conType");
                    attrs.push("repeating_Cons_" + idArray[i] + "_Consequence");
                    attrs.push("repeating_Cons_" + idArray[i] + "_Invoke");
                }
    
                getAttrs(attrs, function (repValues) {
                    importConsequence(2, basicValues["MildConsequence"], !isNullOrWhitespace(basicValues["MildInvoke"]));
                    importConsequence(4, basicValues["ModerateConsequence"], !isNullOrWhitespace(basicValues["ModerateInvoke"]));
                    importConsequence(6, basicValues["SevereConsequence"], !isNullOrWhitespace(basicValues["SevereInvoke"]));
    
                    for (var i = 0; i < idArray.length; i++) {
                        var worth = 0;
                        switch (repValues["repeating_Cons_" + idArray[i] + "_conType"]) {
                            case "Mild":
                                worth = 2;
                                break;
                            case "Moderate":
                                worth = 4;
                                break;
                            case "Severe":
                                worth = 6;
                                break;
                        }
                    
                        importConsequence(worth,
                            repValues["repeating_Cons_" + idArray[i] + "_Consequence"],
                            !isNullOrWhitespace(repValues["repeating_Cons_" + idArray[i] + "_Invoke"]));
                        
                        removeRepeatingRow("repeating_Cons_" + idArray[i]);
                    }
                });
            });    
        });
    };
    
    const importConsequence = (worth, aspect, addBonus) => {
        if (!isNaN(worth) && worth > 0) {
            var newRowAttrs = {};
            var newRowId = generateRowID();
            newRowAttrs["repeating_consequences_" + newRowId + "_worth"] = worth;
            newRowAttrs["repeating_consequences_" + newRowId + "_aspect"] = aspect;
            newRowAttrs["repeating_consequences_" + newRowId + "_worth_text"] = getConsequenceText(worth);
    
            setAttrs(newRowAttrs);
    
            if (addBonus)
                importSitAspect(aspect, 1);
        }
    };
    
    function SetDefaultConsequences (default_consequences, show_conditions_flag) {
        if (!isNullOrWhitespace(default_consequences)) {
            getSectionIDs("repeating_consequences", function (idArray) {
                if (idArray.length == 0) {
                    var consequences = default_consequences.split(",")
                    var newRowAttrs = {};
                    consequences.forEach(consequence => {
                        var elements = consequence.split("|");
                        var worth = Number(elements[0].trim());
                        if (!isNaN(worth) && worth > 0) {
                            var newRowId = generateRowID();
                            newRowAttrs["repeating_consequences_" + newRowId + "_worth"] = worth;
    
                            if (elements.length > 1)
                                newRowAttrs["repeating_consequences_" + newRowId + "_aspect"] = elements[1];
                            if (show_conditions_flag == "1")
                                newRowAttrs["repeating_consequences_" + newRowId + "_worth_text"] = getConditionsText(worth);
                            else
                                newRowAttrs["repeating_consequences_" + newRowId + "_worth_text"] = getConsequenceText(worth);
                        }
                    });
                    setAttrs(newRowAttrs);
                }
            });
        }
    };
    
    function ImportNotes () {
        getAttrs(["Notes"], function (values) {
            if(isNullOrWhitespace(values["Notes"]))
                return;
    
            var newRowAttrs = {};
            var newRowId = generateRowID();
            newRowAttrs["repeating_notes_" + newRowId + "_body"] = values["Notes"];
    
            setAttrs(newRowAttrs);
        });
    };
    
    on("change:repeating_consequences:worth", function (eventInfo) {
        getAttrs(["show_conditions_flag"], function (values) {
            if (!isNullOrWhitespace(values["show_conditions_flag"]))
                setAttrs({ repeating_consequences_worth_text: getConditionsText(Number(eventInfo.newValue)) });
            else
                setAttrs({ repeating_consequences_worth_text: getConsequenceText(Number(eventInfo.newValue)) });
        });
    });
    
    on("change:show_conditions_flag", function (eventInfo) {
        getSectionIDs("repeating_consequences", function (idArray) {
            if (idArray.length == 0)
                return;
    
            var attrs = [];
            for (var i = 0; i < idArray.length; i++) {
                attrs.push("repeating_consequences_" + idArray[i] + "_worth");
            }
    
            getAttrs(attrs, function (values) {
                var newRowAttrs = {};
                for (var i = 0; i < idArray.length; i++) {
                    var worth = Number(values["repeating_consequences_" + idArray[i] + "_worth"]);
                    if (!isNullOrWhitespace(eventInfo.newValue))
                        newRowAttrs["repeating_consequences_" + idArray[i] + "_worth_text"] = getConditionsText(worth);
                    else
                        newRowAttrs["repeating_consequences_" + idArray[i] + "_worth_text"] = getConsequenceText(worth);
                }
    
                setAttrs(newRowAttrs);
            });
        });
    });
    
    on("change:repeating_skills:skill", function (eventInfo) {
        skillChanged(eventInfo.previousValue, 0);
        getAttrs(["repeating_skills_shiftLevel"], function (values) {
            skillChanged(eventInfo.newValue, Number(values["repeating_skills_shiftLevel"]));
        });
    });
    
    on("change:repeating_skills:shiftLevel", function (eventInfo) {
        var skillLevel = Number(eventInfo.newValue);
        setAttrs({ repeating_skills_shiftLevelText: getShiftText(skillLevel) });
        getAttrs(["repeating_skills_skill"], function (values) {
            skillChanged(values["repeating_skills_skill"], skillLevel);
        });
    });
    
    on("clicked:addSkill8", function () {
        createSkill(8);
    });
    
    on("clicked:removeSkill8", function () {
        removeSkill(8);
    });
    
    on("clicked:addSkill7", function () {
        createSkill(7);
    });
    
    on("clicked:removeSkill7", function () {
        removeSkill(7);
    });
    
    on("clicked:addSkill6", function () {
        createSkill(6);
    });
    
    on("clicked:removeSkill6", function () {
        removeSkill(6);
    });
    
    on("clicked:addSkill5", function () {
        createSkill(5);
    });
    
    on("clicked:removeSkill5", function () {
        removeSkill(5);
    });
    
    on("clicked:addSkill4", function () {
        createSkill(4);
    });
    
    on("clicked:removeSkill4", function () {
        removeSkill(4);
    });
    
    on("clicked:addSkill3", function () {
        createSkill(3);
    });
    
    on("clicked:removeSkill3", function () {
        removeSkill(3);
    });
    
    on("clicked:addSkill2", function () {
        createSkill(2);
    });
    
    on("clicked:removeSkill2", function () {
        removeSkill(2);
    });
    
    on("clicked:addSkill1", function () {
        createSkill(1);
    });
    
    on("clicked:removeSkill1", function () {
        removeSkill(1);
    });
    
    on("clicked:addSkill0", function () {
        createSkill(0);
    });
    
    on("clicked:removeSkill0", function () {
        removeSkill(0);
    });
    
    on("clicked:addSkillN1", function () {
        createSkill(-1);
    });
    
    on("clicked:removeSkillN1", function () {
        removeSkill(-1);
    });
    
    on("clicked:addSkillN2", function () {
        createSkill(-2);
    });
    
    on("clicked:removeSkillN2", function () {
        removeSkill(-2);
    });
    
    on("change:repeating_stunts:skill", function (eventInfo) {
        getSectionIDs("repeating_skills", function (idArray) {
            if (idArray.length == 0)
                return;
    
            var attrs = [];
            for (var i = 0; i < idArray.length; i++) {
                attrs.push("repeating_skills_" + idArray[i] + "_skill");
                attrs.push("repeating_skills_" + idArray[i] + "_shiftLevel");
                attrs.push("repeating_skills_" + idArray[i] + "_shiftLevelText");
            }
    
            getAttrs(attrs, function (values) {
                var skillShiftLevel = 0;
                var skillShiftLevelText = getShiftText(0);
    
                for (var i = 0; i < idArray.length; i++) {
                    if (values["repeating_skills_" + idArray[i] + "_skill"] == eventInfo.newValue) {
                        skillShiftLevel = values["repeating_skills_" + idArray[i] + "_shiftLevel"];
                        skillShiftLevelText = values["repeating_skills_" + idArray[i] + "_shiftLevelText"];
                        break;
                    }
                }
    
                setAttrs({
                    repeating_stunts_skillShiftLevel: skillShiftLevel,
                    repeating_stunts_skillShiftLevelText: skillShiftLevelText
                });
            });
        });
    });
    
    on("change:repeating_stunts:bonusShifts", function (eventInfo) {
        var description = getShiftText(Number(eventInfo.newValue));
        setAttrs({ repeating_stunts_bonusShiftsText: description });
    });
    
    on("change:repeating_stunts:type", function (eventInfo) {
        var description;
        switch (Number(eventInfo.newValue)) {
            case 1:
                description = "Fertigkeit neue Aktion zuordnen";
                break;
            case 2:
                description = "Aktion einen Bonus zuordnen";
                break;
            default:
                description = "Ausnahme von der Regel erlauben";
                break;
        }
        setAttrs({ repeating_stunts_typeText: description });
    
        if (Number(eventInfo.newValue) == 2) {
            getAttrs(["repeating_stunts_bonusShifts"], function (values) {
                if (isNullOrWhitespace(values["repeating_stunts_bonusShifts"])) {
                    var description = getShiftText(2);
                    setAttrs({ repeating_stunts_bonusShiftsText: description, repeating_stunts_bonusShifts: 2 });
                }
                else {
                    var description = getShiftText(Number(values["repeating_stunts_bonusShifts"]));
                    setAttrs({ repeating_stunts_bonusShiftsText: description });
                }
            });
        }
    });
    
    on("change:repeating_stress:skill", function (eventInfo) {
        getSectionIDs("repeating_skills", function (idArray) {
            if (idArray.length == 0)
                return;
    
            var attrs = [];
            for (var i = 0; i < idArray.length; i++) {
                attrs.push("repeating_skills_" + idArray[i] + "_skill");
                attrs.push("repeating_skills_" + idArray[i] + "_shiftLevel");
            }
    
            getAttrs(attrs, function (values) {
                var stressMax;
    
                for (var i = 0; i < idArray.length; i++) {
                    if (values["repeating_skills_" + idArray[i] + "_skill"] == eventInfo.newValue) {
                        var skillShiftLevel = Number(values["repeating_skills_" + idArray[i] + "_shiftLevel"]);
                        stressMax = getStressMax(skillShiftLevel);
                    }
                }
    
                if (stressMax != null) {
                    setAttrs({ repeating_stress_usable: stressMax, repeating_stress_bound: 1 });
                }
            });
        });
    });
    
    on("change:repeating_stress:usable", function (eventInfo) {
        if (eventInfo.sourceType != "sheetworker")
            setAttrs({ repeating_stress_bound: 0 });
    });
    
    on("clicked:clearStress", function () {
        getSectionIDs("repeating_stress", function (idArray) {
            if (idArray.length == 0)
                return;
    
            var editAttrs = {};
            for (var i = 0; i < idArray.length; i++) {
                for (var x = 1; x < 9; x++) {
                    editAttrs["repeating_stress_" + idArray[i] + "_isUsed" + x] = "";
                }
            }
    
            setAttrs(editAttrs);
        });
    });
    
    function getShiftText(shiftLevel) {
        switch (shiftLevel) {
            case 8:
                return "Legendär";
            case 7:
                return "Episch";
            case 6:
                return "Fantastisch";
            case 5:
                return "Hervorragend";
            case 4:
                return "Grossartig";
            case 3:
                return "Gut";
            case 2:
                return "Ordentlich";
            case 1:
                return "Durchschnittlich";
            case 0:
                return "Mässig";
            case -1:
                return "Schwach";
            case -2:
                return "Fürchterlich";
        }
    
        if (shiftLevel > 8) {
            return "Legendär+" + (shiftLevel - 8);
        }
        if (shiftLevel < -2) {
            return "Fürchterlich" + (shiftLevel + 2);
        }
    
        return "";
    };
    
    function getConsequenceText(worth) {
        switch (Number(worth)) {
            case 2:
                return "Leichte";
            case 4:
                return "Mittlere";
            case 6:
                return "Schwere";
            case 8:
                return "Extreme";
            default:
                return "Custom";
        }
    };
    
    function getConditionsText(worth) {
        switch (Number(worth)) {
            case 1:
                return "Vergängliche";
            case 2:
                return "Angehängte";
            case 4:
                return "Dauerhafte";
            default:
                return "Custom";
        }
    };
    
    function getStressMax(skillShiftLevel) {
        if (skillShiftLevel < 1) {
            return 2;
        }
    
        if (skillShiftLevel < 3) {
            return 3;
        }
    
        return 4;
    };
    
    const createSkill = (skillLevel) => {
        var newRowId = generateRowID();
        var newRowAttrs = {};
        newRowAttrs["repeating_skills_" + newRowId + "_shiftLevel"] = skillLevel;
        newRowAttrs["repeating_skills_" + newRowId + "_shiftLevelText"] = getShiftText(skillLevel);
        setAttrs(newRowAttrs);
    };
    
    const removeSkill = (skillLevel) => {
        getSectionIDs("repeating_skills", function (idArray) {
            if (idArray.length == 0)
                return;
    
            var attrs = [];
            for (var i = 0; i < idArray.length; i++) {
                attrs.push("repeating_skills_" + idArray[i] + "_skill");
                attrs.push("repeating_skills_" + idArray[i] + "_shiftLevel");
            }
    
            getAttrs(attrs, function (values) {
                var lastRowId;
                var lastSkill;
    
                for (var i = 0; i < idArray.length; i++) {
                    if (Number(values["repeating_skills_" + idArray[i] + "_shiftLevel"]) == skillLevel) {
                        lastRowId = idArray[i];
                        lastSkill = values["repeating_skills_" + idArray[i] + "_skill"]
                    }
                }
    
                if (lastRowId != null) {
                    removeRepeatingRow("repeating_skills_" + lastRowId);
                    skillChanged(lastSkill, 0);
                }
            });
        });
    };
    
    const skillChanged = (skill, skillLevel) => {
        if (isNullOrWhitespace(skill))
            return;
    
        if (skillLevel == null || isNaN(skillLevel))
            skillLevel = 0;
    
        var skillLevelDesc = getShiftText(skillLevel);
    
        //adjust Stunts
        getSectionIDs("repeating_stunts", function (idArray) {
            if (idArray.length == 0)
                return;
    
            var attrs = [];
            for (var i = 0; i < idArray.length; i++) {
                attrs.push("repeating_stress_" + idArray[i] + "_skill");
            }
    
            getAttrs(attrs, function (values) {
                var editAttrs = {};
                for (var i = 0; i < idArray.length; i++) {
                    if (!isNullOrWhitespace(values["repeating_stress_" + idArray[i] + "_bound"])
                            && values["repeating_stress_" + idArray[i] + "_skill"] == skill) {
                        editAttrs["repeating_stress_" + idArray[i] + "_shiftLevel"] = skillLevel;
                        editAttrs["repeating_stress_" + idArray[i] + "_shiftLevelText"] = skillLevelDesc;
                    }
                }
    
                setAttrs(editAttrs);
            });
        });
    
        //adjust Stress
        getSectionIDs("repeating_stress", function (idArray) {
            if (idArray.length == 0)
                return;
    
            var attrs = [];
            for (var i = 0; i < idArray.length; i++) {
                attrs.push("repeating_stress_" + idArray[i] + "_skill");
                attrs.push("repeating_stress_" + idArray[i] + "_bound");
            }
    
            getAttrs(attrs, function (values) {
                var editAttrs = {};
                for (var i = 0; i < idArray.length; i++) {
                    if (!isNullOrWhitespace(values["repeating_stress_" + idArray[i] + "_bound"])
                            && values["repeating_stress_" + idArray[i] + "_skill"] == skill) {
                        editAttrs["repeating_stress_" + idArray[i] + "_usable"] = getStressMax(skillLevel);
                    }
                }
    
                setAttrs(editAttrs);
            });
        });
    }
    
    const isNullOrWhitespace = (attr) => !(attr && (attr.trim ? attr.trim() && attr.trim() != "0" : attr > 0));
</script>
