<script type="text/worker">

function rollDie(min, max) {
    min = Math.ceil(min);
    max = Math.floor(max);
    return Math.floor(Math.random() * (max - min + 1)) + min;
}

function updateAbility(name) {
    var baseName = name + "base";
    var lootName = name + "loot";
    
    getAttrs([baseName, lootName], function (values) {
        var calculated = parseInt(values[baseName]) + parseInt(values[lootName]);
        
        var obj = {};
        obj[name] = calculated;
        setAttrs(obj);
    });
}

on("change:RollDeathSaveCheck", function () {
    setAttrs({ DeathSaveCounter: rollDie(1, 6) });
});

on("change:strengthbase", function() { updateAbility("strength"); });
on("change:strengthloot", function() { updateAbility("strength"); });
on("change:dexteritybase", function() { updateAbility("dexterity"); });
on("change:dexterityloot", function() { updateAbility("dexterity"); });
on("change:constitutionbase", function() { updateAbility("constitution"); });
on("change:constitutionloot", function() { updateAbility("constitution"); });
on("change:intelligencebase", function() { updateAbility("intelligence"); });
on("change:intelligenceloot", function() { updateAbility("intelligence"); });
on("change:wisdombase", function() { updateAbility("wisdom"); });
on("change:wisdomloot", function() { updateAbility("wisdom"); });
on("change:charismabase", function() { updateAbility("charisma"); });
on("change:charismaloot", function() { updateAbility("charisma"); });

on("change:armorbase", function() { updateAbility("armor"); });
on("change:armorloot", function() { updateAbility("armor"); });

on("change:BasicEffortBase", function() { updateAbility("BasicEffort"); });
on("change:BasicEffortLootBonus", function() { updateAbility("BasicEffort"); });
on("change:WeaponsEffortBase", function() { updateAbility("WeaponsEffort"); });
on("change:WeaponsEffortLootBonus", function() { updateAbility("WeaponsEffort"); });
on("change:MagicEffortBase", function() { updateAbility("MagicEffort"); });
on("change:MagicEffortLootBonus", function() { updateAbility("MagicEffort"); });
on("change:UltimateEffortBase", function() { updateAbility("UltimateEffort"); });
on("change:UltimateEffortLootBonus", function() { updateAbility("UltimateEffort"); });

</script>

<div class="body">
	<!-- Set up the Tabs -->
	<input type="radio" class="sheet-tab sheet-tab1" name="attr_core-tab" value="1" title="Sheet1" checked="checked"/> 
	<span class="sheet-tab sheet-tab1" style='line-height: 20px;'>Sheet1</span>
	<input type="radio" class="sheet-tab sheet-tab2" name="attr_core-tab" value="2" title="Sheet2"/> 
	<span class="sheet-tab sheet-tab2" style='line-height: 20px;'>Sheet2</span>
	
    <div class="sheet-section-sheet1"><!-- Sheet1 Tab -->
        <div>
		    <input type="text" class="sheet-text" name="attr_name" style='position: absolute;  margin-top: 20px; margin-left: 105px; width: 180px'/>
		    <input type="text" class="sheet-text" name="attr_class" style='position: absolute; margin-top: 20px; margin-left: 357px; width: 125px'/>
		    <input type="text" class="sheet-text" name="attr_form" style='position: absolute; margin-top: 20px; margin-left: 595px; width: 180px'/>
		    <input type="text" class="sheet-text" name="attr_story" style='position: absolute; margin-top: 62px; margin-left: 117px; width: 665px'/>
		</div>
		<div>
		    <input type="number" name="attr_strengthbase" value="0" style='position: absolute; margin-top: 105px; margin-left: 160px; width: 40px; height: 20px' />
		    <input type="number" name="attr_strengthloot" value="0" style='position: absolute; margin-top: 125px; margin-left: 160px; width: 40px; height: 20px' />
		    <input type="text" class="sheet-text-center" name="attr_strengthmod" value="@{strength}" style='position: absolute; margin-top: 117px; margin-left: 92px; width: 40px; height: 40px' disabled="true"/>
		    <input type="hidden" name="attr_strength" value="0">
		    <button type='roll' value="Strength [[1d20 + @{strength}]]" name='roll_str' style='position: absolute; margin-top: 150px; margin-left: 50px; width: 25px; height: 25px'/>
		</div>
		<div>
		    <input type="number" name="attr_dexteritybase" value="0" style='position: absolute; margin-top: 155px; margin-left: 160px; width: 40px; height: 20px' />
		    <input type="number" name="attr_dexterityloot" value="0" style='position: absolute; margin-top: 175px; margin-left: 160px; width: 40px; height: 20px' />
		    <input type="text" class="sheet-text-center" name="attr_dexteritymod" value="@{dexterity}" style='position: absolute; margin-top: 164px; margin-left: 92px; width: 40px; height: 40px' disabled="true"/>
		    <input type="hidden" name="attr_dexterity" value="0">
		    <button type='roll' value="Dexterity [[1d20 + @{dexterity}]]" name='roll_dex' style='position: absolute; margin-top: 195px; margin-left: 50px; width: 25px; height: 25px'/>
		</div>
		<div>
		    <input type="number" name="attr_constitutionbase" value="0" style='position: absolute; margin-top: 203px; margin-left: 160px; width: 40px; height: 20px' />
		    <input type="number" name="attr_constitutionloot" value="0" style='position: absolute; margin-top: 223px; margin-left: 160px; width: 40px; height: 20px' />
		    <input type="text" class="sheet-text-center" name="attr_constitutionmod" value="@{constitution}" style='position: absolute; margin-top: 210px; margin-left: 92px; width: 40px; height: 40px' disabled="true"/>
		    <input type="hidden" name="attr_constitution" value="0">
		    <button type='roll' value="Constitution [[1d20 + @{constitution}]]" name='roll_con' style='position: absolute; margin-top: 242px; margin-left: 50px; width: 25px; height: 25px'/>
		</div>
		<div>
		    <input type="number" name="attr_intelligencebase" value="0" style='position: absolute; margin-top: 250px; margin-left: 160px; width: 40px; height: 20px' />
		    <input type="number" name="attr_intelligenceloot" value="0" style='position: absolute; margin-top: 270px; margin-left: 160px; width: 40px; height: 20px' />
		    <input type="text" class="sheet-text-center" name="attr_intelligencenmod" value="@{intelligence}" style='position: absolute; margin-top: 257px; margin-left: 92px; width: 40px; height: 40px' disabled="true"/>
		    <input type="hidden" name="attr_intelligence" value="0">
		    <button type='roll' value="Intelligence [[1d20 + @{intelligence}]]" name='roll_int' style='position: absolute; margin-top: 287px; margin-left: 50px; width: 25px; height: 25px'/>
		</div>
		<div>
		    <input type="number" name="attr_wisdombase" value="0" style='position: absolute; margin-top: 295px; margin-left: 160px; width: 40px; height: 20px' />
		    <input type="number" name="attr_wisdomloot" value="0" style='position: absolute; margin-top: 315px; margin-left: 160px; width: 40px; height: 20px' />
		    <input type="text" class="sheet-text-center" name="attr_wisdommod" value="@{wisdom}" style='position: absolute; margin-top: 301px; margin-left: 92px; width: 40px; height: 40px' disabled="true"/>
		    <input type="hidden" name="attr_wisdom" value="0">
		    <button type='roll' value="Wisdom [[1d20 + @{wisdom}]]" name='roll_wis' style='position: absolute; margin-top: 335px; margin-left: 50px; width: 25px; height: 25px'/>
		</div>
		<div>
		    <input type="number" name="attr_charismabase" value="0" style='position: absolute; margin-top: 342px; margin-left: 160px; width: 40px; height: 20px' />
		    <input type="number" name="attr_charismaloot" value="0" style='position: absolute; margin-top: 362px; margin-left: 160px; width: 40px; height: 20px' />
		    <input type="text" class="sheet-text-center" name="attr_charismamod" value="@{charisma}" style='position: absolute; margin-top: 347px; margin-left: 92px; width: 40px; height: 40px' disabled="true"/>
		    <input type="hidden" name="attr_charisma" value="0">
		    <button type='roll' value="Charisma [[1d20 + @{charisma}]]" name='roll_cha' style='position: absolute; margin-top: 380px; margin-left: 50px; width: 25px; height: 25px'/>
		</div>
		<div>
		    <input type="number" name="attr_armorbase" value="0" style='position: absolute; margin-top: 115px; margin-left: 380px; width: 40px; height: 20px' />
		    <input type="number" name="attr_armorloot" value="0" style='position: absolute; margin-top: 135px; margin-left: 380px; width: 40px; height: 20px' />
		    <input type="text" class="sheet-text-center" name="attr_armormod" value="@{armortotal}" style='position: absolute; margin-top: 130px; margin-left: 296px; width: 50px; height: 50px' disabled="true"/>
		    <input type="hidden" name="attr_armortotal" value="10 + @{armor}">
		    <input type="hidden" name="attr_armor" value="0">
		</div>
		<div>
		    <input type="number" name="attr_basicworkbase" value="0" style='position: absolute; margin-top: 215px; margin-left: 380px; width: 40px; height: 20px' />
		    <input type="number" name="attr_basicworkloot" value="0" style='position: absolute; margin-top: 235px; margin-left: 380px; width: 40px; height: 20px' />
		    <input type="text" class="sheet-text-center" name="attr_basicworkmod" value="@{basicwork}" style='position: absolute; margin-top: 227px; margin-left: 317px; width: 30px; height: 30px' disabled="true"/>
		    <input type="hidden" name="attr_basicwork" value="0">
		    <button type='roll' class="sheet-d4" value="Basic Work [[1d4 + @{basicwork}]]" name='roll_basicwork' style='position: absolute; margin-top: 230px; margin-left: 210px; width: 25px; height: 25px'/>
		</div>
		<div>
		    <input type="number" name="attr_weapondamagebase" value="0" style='position: absolute; margin-top: 261px; margin-left: 380px; width: 40px; height: 20px' />
		    <input type="number" name="attr_weapondamageloot" value="0" style='position: absolute; margin-top: 281px; margin-left: 380px; width: 40px; height: 20px' />
		    <input type="text" class="sheet-text-center" name="attr_weapondamagemod" value="@{weapondamage}" style='position: absolute; margin-top: 272px; margin-left: 317px; width: 30px; height: 30px' disabled="true"/>
		    <input type="hidden" name="attr_weapondamage" value="0">
		    <button type='roll' value="Weapon Damage [[1d6 + @{weapondamage}]]" name='roll_weapondamage' style='position: absolute; margin-top: 270px; margin-left: 200px; width: 25px; height: 25px'/>
		</div>
		<div>
		    <input type="number" name="attr_magiceffortbase" value="0" style='position: absolute; margin-top: 306px; margin-left: 380px; width: 40px; height: 20px' />
		    <input type="number" name="attr_magiceffortloot" value="0" style='position: absolute; margin-top: 326px; margin-left: 380px; width: 40px; height: 20px' />
		    <input type="text" class="sheet-text-center" name="attr_magiceffortmod" value="@{magiceffort}" style='position: absolute; margin-top: 315px; margin-left: 317px; width: 30px; height: 30px' disabled="true"/>
		    <input type="hidden" name="attr_magiceffort" value="0">
		    <button type='roll' value="Magic Effort [[1d8 + @{magiceffort}]]" name='roll_magiceffort' style='position: absolute; margin-top: 380px; margin-left: 50px; width: 25px; height: 25px'/>
		</div>
		<div>
		    <input type="number" name="attr_ultimatebase" value="0" style='position: absolute; margin-top: 352px; margin-left: 380px; width: 40px; height: 20px' />
		    <input type="number" name="attr_ultimateloot" value="0" style='position: absolute; margin-top: 371px; margin-left: 380px; width: 40px; height: 20px' />
		    <input type="text" class="sheet-text-center" name="attr_ultimatemod" value="@{ultimate}" style='position: absolute; margin-top: 361px; margin-left: 317px; width: 30px; height: 30px' disabled="true"/>
		    <input type="hidden" name="attr_ultimate" value="0">
		    <button type='roll' value="Ultimate Effort [[1d12 + @{ultimate}]]" name='roll_ultimate' style='position: absolute; margin-top: 380px; margin-left: 50px; width: 25px; height: 25px'/>
		</div>
	</div>
</div>