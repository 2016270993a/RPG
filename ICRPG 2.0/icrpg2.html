<script type="text/worker">

function rollDie(min, max) {
    min = Math.ceil(min);
    max = Math.floor(max);
    return Math.floor(Math.random() * (max - min + 1)) + min;
}

function updateAbility(name) {
    var baseName = name + "base";
    var lootName = name + "loot";
    
    getAttrs([baseName, lootName], function (values) {
        var calculated = parseInt(values[baseName]) + parseInt(values[lootName]);
        
        var obj = {};
        obj[name] = calculated;
        setAttrs(obj);
    });
}

on("change:deathcountdown", function () {
    setAttrs({ deathcountdownvalue: rollDie(1, 6) });
});

on("change:strengthbase", function() { updateAbility("strength"); });
on("change:strengthloot", function() { updateAbility("strength"); });
on("change:dexteritybase", function() { updateAbility("dexterity"); });
on("change:dexterityloot", function() { updateAbility("dexterity"); });
on("change:constitutionbase", function() { updateAbility("constitution"); });
on("change:constitutionloot", function() { updateAbility("constitution"); });
on("change:intelligencebase", function() { updateAbility("intelligence"); });
on("change:intelligenceloot", function() { updateAbility("intelligence"); });
on("change:wisdombase", function() { updateAbility("wisdom"); });
on("change:wisdomloot", function() { updateAbility("wisdom"); });
on("change:charismabase", function() { updateAbility("charisma"); });
on("change:charismaloot", function() { updateAbility("charisma"); });

on("change:armorbase", function() { updateAbility("armor"); });
on("change:armorloot", function() { updateAbility("armor"); });

on("change:basiceffortbase", function() { updateAbility("basiceffort"); });
on("change:basiceffortloot", function() { updateAbility("basiceffort"); });
on("change:weaponeffortbase", function() { updateAbility("weaponeffort"); });
on("change:weaponeffortloot", function() { updateAbility("weaponeffort"); });
on("change:magiceffortbase", function() { updateAbility("magiceffort"); });
on("change:magiceffortloot", function() { updateAbility("magiceffort"); });
on("change:ultimateeffortbase", function() { updateAbility("ultimateeffort"); });
on("change:ultimateeffortloot", function() { updateAbility("ultimateeffort"); });

</script>

<div class="body">
    <div>
        <div>
		    <input type="text" class="sheet-text" name="attr_character_name" style='position: absolute;  margin-top: 40px; margin-left: 105px; width: 180px'/>
		    <input type="text" class="sheet-text" name="attr_class" style='position: absolute; margin-top: 40px; margin-left: 357px; width: 125px'/>
		    <input type="text" class="sheet-text" name="attr_form" style='position: absolute; margin-top: 40px; margin-left: 595px; width: 180px'/>
		    <input type="text" class="sheet-text" name="attr_story" style='position: absolute; margin-top: 82px; margin-left: 117px; width: 665px'/>
		</div>
		<div class="attr-container">
		    <input type="number" name="attr_strengthbase" value="0" style='margin-top: 125px;' />
		    <input type="number" name="attr_strengthloot" value="0" style='margin-top: 145px;' />
		    <input type="text" class="sheet-text-center" name="attr_strengthmod" value="@{strength}" style='position: absolute; margin-top: 137px; margin-left: 92px; width: 40px; height: 40px' disabled="true"/>
		    <input type="hidden" name="attr_strength" value="0">
		    <button type='roll' value="Strength [[1d20 + @{strength}]]" name='roll_str' style='position: absolute; margin-top: 148px; margin-left: 38px; width: 50px; height: 25px;'/>
		</div>
		<div class="attr-container">
		    <input type="number" name="attr_dexteritybase" value="0" style='margin-top: 175px;' />
		    <input type="number" name="attr_dexterityloot" value="0" style='margin-top: 195px;' />
		    <input type="text" class="sheet-text-center" name="attr_dexteritymod" value="@{dexterity}" style='position: absolute; margin-top: 184px; margin-left: 92px; width: 40px; height: 40px' disabled="true"/>
		    <input type="hidden" name="attr_dexterity" value="0">
		    <button type='roll' value="Dexterity [[1d20 + @{dexterity}]]" name='roll_dex' style='position: absolute; margin-top: 195px; margin-left: 38px; width: 50px; height: 25px;'/>
		</div>
		<div class="attr-container">
		    <input type="number" name="attr_constitutionbase" value="0" style='margin-top: 223px;' />
		    <input type="number" name="attr_constitutionloot" value="0" style='margin-top: 243px;' />
		    <input type="text" class="sheet-text-center" name="attr_constitutionmod" value="@{constitution}" style='position: absolute; margin-top: 230px; margin-left: 92px; width: 40px; height: 40px' disabled="true"/>
		    <input type="hidden" name="attr_constitution" value="0">
		    <button type='roll' value="Constitution [[1d20 + @{constitution}]]" name='roll_con' style='position: absolute; margin-top: 242px; margin-left: 38px; width: 50px; height: 25px;'/>
		</div>
		<div class="attr-container">
		    <input type="number" name="attr_intelligencebase" value="0" style='margin-top: 270px;' />
		    <input type="number" name="attr_intelligenceloot" value="0" style='margin-top: 290px;' />
		    <input type="text" class="sheet-text-center" name="attr_intelligencenmod" value="@{intelligence}" style='position: absolute; margin-top: 277px; margin-left: 92px; width: 40px; height: 40px' disabled="true"/>
		    <input type="hidden" name="attr_intelligence" value="0">
		    <button type='roll' value="Intelligence [[1d20 + @{intelligence}]]" name='roll_int' style='position: absolute; margin-top: 287px; margin-left: 38px; width: 50px; height: 25px;'/>
		</div>
		<div class="attr-container">
		    <input type="number" name="attr_wisdombase" value="0" style='margin-top: 315px;' />
		    <input type="number" name="attr_wisdomloot" value="0" style='margin-top: 335px;' />
		    <input type="text" class="sheet-text-center" name="attr_wisdommod" value="@{wisdom}" style='position: absolute; margin-top: 321px; margin-left: 92px; width: 40px; height: 40px' disabled="true"/>
		    <input type="hidden" name="attr_wisdom" value="0">
		    <button type='roll' value="Wisdom [[1d20 + @{wisdom}]]" name='roll_wis' style='position: absolute; margin-top: 335px; margin-left: 38px; width: 50px; height: 25px;'/>
		</div>
		<div class="attr-container">
		    <input type="number" name="attr_charismabase" value="0" style='margin-top: 362px;' />
		    <input type="number" name="attr_charismaloot" value="0" style='margin-top: 382px;' />
		    <input type="text" class="sheet-text-center" name="attr_charismamod" value="@{charisma}" style='position: absolute; margin-top: 367px; margin-left: 92px; width: 40px; height: 40px' disabled="true"/>
		    <input type="hidden" name="attr_charisma" value="0">
		    <button type='roll' value="Charisma [[1d20 + @{charisma}]]" name='roll_cha' style='position: absolute; margin-top: 380px; margin-left: 38px; width: 50px; height: 25px;'/>
		</div>
		<div>
		    <input type="number" name="attr_armorbase" value="0" style='position: absolute; margin-top: 135px; margin-left: 380px; width: 40px; height: 20px' />
		    <input type="number" name="attr_armorloot" value="0" style='position: absolute; margin-top: 155px; margin-left: 380px; width: 40px; height: 20px' />
		    <input type="text" class="sheet-text-center" name="attr_armormod" value="@{armortotal}" style='position: absolute; margin-top: 150px; margin-left: 296px; width: 50px; height: 50px' disabled="true"/>
		    <input type="hidden" name="attr_armortotal" value="10 + @{armor}">
		    <input type="hidden" name="attr_armor" value="0">
		</div>
		<div class="effort-container">
		    <input type="number" name="attr_basiceffortbase" value="0" style='margin-top: 235px;' />
		    <input type="number" name="attr_basiceffortloot" value="0" style='margin-top: 255px;' />
		    <input type="text" class="sheet-text-center" name="attr_basiceffortmod" value="@{basiceffort}" style='position: absolute; margin-top: 247px; margin-left: 317px; width: 30px; height: 30px' disabled="true"/>
		    <input type="hidden" name="attr_basiceffort" value="0">
		    <button type='roll'  value="Basic Work [[1d4 + @{basiceffort}]]" name='roll_basiceffort' style='position: absolute; margin-top: 247px; margin-left: 277px; width: 35px; height: 35px;'/>
		</div>
		<div class="effort-container">
		    <input type="number" name="attr_weaponeffortbase" value="0" style='margin-top: 281px;' />
		    <input type="number" name="attr_weaponeffortloot" value="0" style='margin-top: 301px;' />
		    <input type="text" class="sheet-text-center" name="attr_weaponeffortmod" value="@{weaponeffort}" style='position: absolute; margin-top: 292px; margin-left: 317px; width: 30px; height: 30px' disabled="true"/>
		    <input type="hidden" name="attr_weaponeffort" value="0">
		    <button type='roll'  value="Weapon Damage [[1d6 + @{weaponeffort}]]" name='roll_weaponeffort' style='position: absolute; margin-top: 287px; margin-left: 277px; width: 35px; height: 35px;' />
		</div>
		<div class="effort-container">
		    <input type="number" name="attr_magiceffortbase" value="0" style='margin-top: 326px;' />
		    <input type="number" name="attr_magiceffortloot" value="0" style='margin-top: 346px;' />
		    <input type="text" class="sheet-text-center" name="attr_magiceffortmod" value="@{magiceffort}" style='position: absolute; margin-top: 335px; margin-left: 317px; width: 30px; height: 30px' disabled="true"/>
		    <input type="hidden" name="attr_magiceffort" value="0">
		    <button type='roll' value="Magic Effort [[1d8 + @{magiceffort}]]" name='roll_magiceffort' style='position: absolute; margin-top: 337px; margin-left: 277px; width: 35px; height: 35px;'/>
		</div>
		<div class="effort-container">
		    <input type="number" name="attr_ultimateeffortbase" value="0" style='margin-top: 372px;' />
		    <input type="number" name="attr_ultimateeffortloot" value="0" style='margin-top: 391px;' />
		    <input type="text" class="sheet-text-center" name="attr_ultimateeffortmod" value="@{ultimateeffort}" style='position: absolute; margin-top: 381px; margin-left: 317px; width: 30px; height: 30px' disabled="true"/>
		    <input type="hidden" name="attr_ultimateeffort" value="0">
		    <button type='roll' value="Ultimate Effort [[1d12 + @{ultimateeffort}]]" name='roll_ultimateeffort' style='position: absolute; margin-top: 380px; margin-left: 277px; width: 35px; height: 35px;'/>
		</div>
        <div class="hearts">
            <input type="checkbox" name="attr_heart10" value="10" checked="true" style='margin-top: 135px; margin-left: 515px;'/>
            <input type="checkbox" name="attr_heart20" value="10" checked="false" style='margin-top: 135px; margin-left: 548px;'/>
            <input type="checkbox" name="attr_heart30" value="10" checked="false" style='margin-top: 135px; margin-left: 581px;'/>
            <input type="checkbox" name="attr_heart40" value="10" checked="false" style='margin-top: 135px; margin-left: 614px;'/>
            <input type="checkbox" name="attr_heart50" value="10" checked="false" style='margin-top: 135px; margin-left: 647px;'/>
            <input type="checkbox" name="attr_heart60" value="10" checked="false" style='margin-top: 135px; margin-left: 680px;'/>
            <input type="checkbox" name="attr_heart70" value="10" checked="false" style='margin-top: 135px; margin-left: 713px;'/>
            <input type="checkbox" name="attr_heart80" value="10" checked="false" style='margin-top: 135px; margin-left: 746px;'/>
		</div>
		<div>
		    <span style='position: absolute; font-size: .8em; margin-top: 118px; margin-left: 455px; width: 70px; height: 30px; text-align:center;'>Current HP</span>
		    <input type="number" name="attr_currenthp" value="0" style='position: absolute; margin-top: 135px; margin-left: 465px; text-align:center; width: 50px' />
		</div>
		<div class="death-container">
		    <button type='roll' value="Death Countdown [[1d6]]" name='roll_deathcountdown' style='position: absolute; margin-top: 340px; margin-left: 645px; width: 50px; height: 60px;'/>
		    <button type='roll' value="Death Revive [[1d20]]" name='roll_deathrevive' style='position: absolute; margin-top: 405px; margin-left: 690px; width: 20px; height: 20px;'/>
		</div>
        
        <div class="repcontainer" data-groupname="repeating_equipped" style='position: absolute; margin-top: 471px; margin-left: 57px;'>
            <div class="repitem">
                <div class="loot">
                    <div >
                        <fieldset class="repeating_equipped">
                            <div class="compendium-drop-target">
                                <div>
                                    <input type="text" name="attr_equipped" accept="Name">
                                </div>
                            </div>
                        </fieldset>
                    </div>
                </div>
            </div>
            <!-- there will be a div.repitem for each item the user has actually added to the sheet -->
        </div>
        <div class="repcontainer" data-groupname="repeating_carried"  style='position: absolute; margin-top: 472px; margin-left: 422px;'>
            <div class="repitem">
                <div class="loot">
                    <div>
                        <fieldset class="repeating_carried">
                            <div class="compendium-drop-target">
                                <div>
                                    <input type="text" name="attr_carried" accept="Name">
                                </div>
                            </div>
                        </fieldset>
                    </div>
                </div>
            </div>
            <!-- there will be a div.repitem for each item the user has actually added to the sheet -->
        </div>
	</div>
	<div>
	    <input type="number" name="attr_coin" value="0" style='position: absolute; margin-top: 953px; margin-left: 482px; width: 80px' />
	</div>
</div>